#  -*- Autoconf -*-

AT_SETUP([calculation of incorrect unidiffs])

NEED_UNB64

MONOTONE_SETUP

AT_DATA(firstfile.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDAyLCAyMDAzIGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9i
b3guY29tPgovLyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVi
bGljIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBm
aWxlIENPUFlJTkcgZm9yIGRldGFpbHMKCiNpbmNsdWRlIDxtYXA+CiNpbmNsdWRlIDxjc3Rk
aW8+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDx2ZWN0b3I+CiNpbmNsdWRlIDxhbGdvcml0
aG0+CiNpbmNsdWRlIDxpdGVyYXRvcj4KI2luY2x1ZGUgPGJvb3N0L2ZpbGVzeXN0ZW0vcGF0
aC5ocHA+CiNpbmNsdWRlIDxib29zdC9maWxlc3lzdGVtL29wZXJhdGlvbnMuaHBwPgojaW5j
bHVkZSA8Ym9vc3QvbGV4aWNhbF9jYXN0LmhwcD4KCiNpbmNsdWRlICJjb21tYW5kcy5oaCIK
I2luY2x1ZGUgImNvbnN0YW50cy5oaCIKCiNpbmNsdWRlICJhcHBfc3RhdGUuaGgiCiNpbmNs
dWRlICJkaWZmX3BhdGNoLmhoIgojaW5jbHVkZSAiZmlsZV9pby5oaCIKI2luY2x1ZGUgImtl
eXMuaGgiCiNpbmNsdWRlICJtYW5pZmVzdC5oaCIKI2luY2x1ZGUgIm5ldHdvcmsuaGgiCiNp
bmNsdWRlICJwYWNrZXQuaGgiCiNpbmNsdWRlICJwYXRjaF9zZXQuaGgiCiNpbmNsdWRlICJy
Y3NfaW1wb3J0LmhoIgojaW5jbHVkZSAic2FuaXR5LmhoIgojaW5jbHVkZSAiY2VydC5oaCIK
I2luY2x1ZGUgInRyYW5zZm9ybXMuaGgiCiNpbmNsdWRlICJ1cGRhdGUuaGgiCiNpbmNsdWRl
ICJ2b2NhYi5oaCIKI2luY2x1ZGUgIndvcmsuaGgiCgovLwovLyB0aGlzIGZpbGUgZGVmaW5l
cyB0aGUgdGFzay1vcmllbnRlZCAidG9wIGxldmVsIiBjb21tYW5kcyB3aGljaCBjYW4gYmUK
Ly8gaXNzdWVkIGFzIHBhcnQgb2YgYSBtb25vdG9uZSBjb21tYW5kIGxpbmUuIHRoZSBjb21t
YW5kIGxpbmUgY2FuIG9ubHkKLy8gaGF2ZSBvbmUgc3VjaCBjb21tYW5kIG9uIGl0LCBmb2xs
b3dlZCBieSBhIHZlY3RvciBvZiBzdHJpbmdzIHdoaWNoIGFyZSBpdHMKLy8gYXJndW1lbnRz
LiBhbGwgLS1vcHRpb25zIHdpbGwgYmUgcHJvY2Vzc2VkIGJ5IHRoZSBtYWluIHByb2dyYW0g
KmJlZm9yZSoKLy8gY2FsbGluZyBhIGNvbW1hbmQKLy8KLy8gd2UgbWlnaHQgZXhwb3NlIHRo
aXMgYmx1bnQgY29tbWFuZCBpbnRlcmZhY2UgdG8gc2NyaXB0aW5nIHNvbWVkYXkuIGJ1dAov
LyBub3QgdG9kYXkuCgpuYW1lc3BhY2UgY29tbWFuZHMgCnsKICBzdHJ1Y3QgY29tbWFuZDsK
ICBib29sIG9wZXJhdG9yPChjb21tYW5kIGNvbnN0ICYgc2VsZiwgY29tbWFuZCBjb25zdCAm
IG90aGVyKTsKfTsKCm5hbWVzcGFjZSBzdGQKewogIHRlbXBsYXRlIDw+CiAgc3RydWN0IHN0
ZDo6Z3JlYXRlcjxjb21tYW5kczo6Y29tbWFuZCAqPgogIHsKICAgIGJvb2wgb3BlcmF0b3Io
KShjb21tYW5kczo6Y29tbWFuZCBjb25zdCAqIGEsIGNvbW1hbmRzOjpjb21tYW5kIGNvbnN0
ICogYikKICAgIHsKICAgICAgcmV0dXJuICphIDwgKmI7CiAgICB9CiAgfTsKfTsKCm5hbWVz
cGFjZSBjb21tYW5kcyAKewp1c2luZyBuYW1lc3BhY2Ugc3RkOwoKc3RydWN0IGNvbW1hbmQ7
IAoKc3RhdGljIG1hcDxzdHJpbmcsY29tbWFuZCAqPiBjbWRzOwoKc3RydWN0IGNvbW1hbmQg
CnsKICBzdHJpbmcgbmFtZTsKICBzdHJpbmcgY21kZ3JvdXA7CiAgc3RyaW5nIHBhcmFtczsK
ICBzdHJpbmcgZGVzYzsKICBjb21tYW5kKHN0cmluZyBjb25zdCAmIG4sCgkgIHN0cmluZyBj
b25zdCAmIGcsCgkgIHN0cmluZyBjb25zdCAmIHAsCgkgIHN0cmluZyBjb25zdCAmIGQpIDog
bmFtZShuKSwgY21kZ3JvdXAoZyksIHBhcmFtcyhwKSwgZGVzYyhkKSAKICB7IGNtZHNbbl0g
PSB0aGlzOyB9CiAgdmlydHVhbCB+Y29tbWFuZCgpIHt9CiAgdmlydHVhbCB2b2lkIGV4ZWMo
YXBwX3N0YXRlICYgYXBwLCB2ZWN0b3I8c3RyaW5nPiBjb25zdCAmIGFyZ3MpID0gMDsKfTsK
CmJvb2wgb3BlcmF0b3I8KGNvbW1hbmQgY29uc3QgJiBzZWxmLCBjb21tYW5kIGNvbnN0ICYg
b3RoZXIpCnsKICByZXR1cm4gKChzZWxmLmNtZGdyb3VwIDwgb3RoZXIuY21kZ3JvdXApCgkg
IHx8ICgoc2VsZi5jbWRncm91cCA9PSBvdGhlci5jbWRncm91cCkgJiYgKHNlbGYubmFtZSA8
IG90aGVyLm5hbWUpKSk7Cn0KCgp2b2lkIGV4cGxhaW5fdXNhZ2Uoc3RyaW5nIGNvbnN0ICYg
Y21kLCBvc3RyZWFtICYgb3V0KQp7CiAgbWFwPHN0cmluZyxjb21tYW5kICo+Ojpjb25zdF9p
dGVyYXRvciBpOwogIGkgPSBjbWRzLmZpbmQoY21kKTsKICBpZiAoaSAhPSBjbWRzLmVuZCgp
KQogICAgewogICAgICBvdXQgPDwgIiAgICAgIiA8PCBpLT5zZWNvbmQtPm5hbWUgPDwgIiAi
IDw8IGktPnNlY29uZC0+cGFyYW1zIDw8IGVuZGwKCSAgPDwgIiAgICAgIiA8PCBpLT5zZWNv
bmQtPmRlc2MgPDwgZW5kbCA8PCBlbmRsOwogICAgICByZXR1cm47CiAgICB9CgogIHZlY3Rv
cjxjb21tYW5kICo+IHNvcnRlZDsKICBvdXQgPDwgImNvbW1hbmRzOiIgPDwgZW5kbDsKICBm
b3IgKGkgPSBjbWRzLmJlZ2luKCk7IGkgIT0gY21kcy5lbmQoKTsgKytpKQogICAgewogICAg
ICBzb3J0ZWQucHVzaF9iYWNrKGktPnNlY29uZCk7CiAgICB9CiAgCiAgc29ydChzb3J0ZWQu
YmVnaW4oKSwgc29ydGVkLmVuZCgpLCBzdGQ6OmdyZWF0ZXI8Y29tbWFuZCAqPigpKTsKCiAg
c3RyaW5nIGN1cnJfZ3JvdXA7CiAgc2l6ZV90IGNvbCA9IDA7CiAgc2l6ZV90IGNvbDIgPSAw
OwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgc29ydGVkLnNpemUoKTsgKytpKQogICAgewog
ICAgICBjb2wyID0gY29sMiA+IHNvcnRlZFtpXS0+Y21kZ3JvdXAuc2l6ZSgpID8gY29sMiA6
IHNvcnRlZFtpXS0+Y21kZ3JvdXAuc2l6ZSgpOwogICAgfQoKICBmb3IgKHNpemVfdCBpID0g
MDsgaSA8IHNvcnRlZC5zaXplKCk7ICsraSkKICAgIHsKICAgICAgaWYgKHNvcnRlZFtpXS0+
Y21kZ3JvdXAgIT0gY3Vycl9ncm91cCkKCXsKCSAgY3Vycl9ncm91cCA9IHNvcnRlZFtpXS0+
Y21kZ3JvdXA7CgkgIG91dCA8PCBlbmRsOwoJICBvdXQgPDwgIiAgIiA8PCBzb3J0ZWRbaV0t
PmNtZGdyb3VwOwoJICBjb2wgPSBzb3J0ZWRbaV0tPmNtZGdyb3VwLnNpemUoKSArIDI7Cgkg
IHdoaWxlIChjb2wrKyA8IChjb2wyICsgMykpCgkgICAgb3V0IDw8ICcgJzsKCX0KICAgICAg
b3V0IDw8ICIgIiA8PCBzb3J0ZWRbaV0tPm5hbWU7CiAgICAgIGNvbCArPSBzb3J0ZWRbaV0t
Pm5hbWUuc2l6ZSgpICsgMTsKICAgICAgaWYgKGNvbCA+PSA3MCkKCXsKCSAgb3V0IDw8IGVu
ZGw7CgkgIGNvbCA9IDA7CgkgIHdoaWxlIChjb2wrKyA8IChjb2wyICsgMykpCgkgICAgb3V0
IDw8ICcgJzsKCX0KICAgIH0KICBvdXQgPDwgZW5kbCA8PCBlbmRsOwp9Cgp2b2lkIHByb2Nl
c3MoYXBwX3N0YXRlICYgYXBwLCBzdHJpbmcgY29uc3QgJiBjbWQsIHZlY3RvcjxzdHJpbmc+
IGNvbnN0ICYgYXJncykKewogIGlmIChjbWRzLmZpbmQoY21kKSAhPSBjbWRzLmVuZCgpKQog
ICAgewogICAgICBMKCJleGVjdXRpbmcgJXMgY29tbWFuZFxuIiwgY21kLmNfc3RyKCkpOwog
ICAgICBjbWRzW2NtZF0tPmV4ZWMoYXBwLCBhcmdzKTsKICAgIH0KICBlbHNlCiAgICB7CiAg
ICAgIHRocm93IHVzYWdlKGNtZCk7CiAgICB9Cn0KCiNkZWZpbmUgQ01EKEMsIGdyb3VwLCBw
YXJhbXMsIGRlc2MpICAgICAgICAgICAgICAgXApzdHJ1Y3QgY21kXyAjIyBDIDogcHVibGlj
IGNvbW1hbmQgICAgICAgICAgICAgICAgIFwKeyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBcCiAgY21kXyAjIyBDKCkgOiBjb21tYW5kKCNDLCBn
cm91cCwgcGFyYW1zLCBkZXNjKSAgXAogIHt9ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFwKICB2aXJ0dWFsIHZvaWQgZXhlYyhhcHBfc3RhdGUgJiBh
cHAsICAgICAgICAgICAgICBcCiAgICAgICAgICAgICAgICAgICAgdmVjdG9yPHN0cmluZz4g
Y29uc3QgJiBhcmdzKTsgXAp9OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFwKc3RhdGljIGNtZF8gIyMgQyBDICMjIF9jbWQ7ICAgICAgICAgICAg
ICAgICAgICAgICBcCnZvaWQgY21kXyAjIyBDOjpleGVjKGFwcF9zdGF0ZSAmIGFwcCwgICAg
ICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICB2ZWN0b3I8c3RyaW5nPiBjb25zdCAm
IGFyZ3MpIFwKCiNkZWZpbmUgQUxJQVMoQywgcmVhbGNvbW1hbmQsIGdyb3VwLCBwYXJhbXMs
IGRlc2MpCVwKQ01EKEMsIGdyb3VwLCBwYXJhbXMsIGRlc2MpCQkJCVwKewkJCQkJCQlcCiAg
cHJvY2VzcyhhcHAsIHN0cmluZygjcmVhbGNvbW1hbmQpLCBhcmdzKTsJCVwKfQoKCnN0YXRp
YyB2b2lkIGVuc3VyZV9ib29rZGlyKCkKewogIG1rZGlyX3AobG9jYWxfcGF0aChib29rX2tl
ZXBpbmdfZGlyKSk7Cn0KCnN0YXRpYyB2b2lkIGdldF9tYW5pZmVzdF9wYXRoKGxvY2FsX3Bh
dGggJiBtX3BhdGgpCnsKICBtX3BhdGggPSAoZnM6OnBhdGgoYm9va19rZWVwaW5nX2Rpcikg
LyBmczo6cGF0aChtYW5pZmVzdF9maWxlX25hbWUpKS5zdHJpbmcoKTsKICBMKCJtYW5pZmVz
dCBwYXRoIGlzICVzXG4iLCBtX3BhdGgoKS5jX3N0cigpKTsKfQoKc3RhdGljIHZvaWQgZ2V0
X3dvcmtfcGF0aChsb2NhbF9wYXRoICYgd19wYXRoKQp7CiAgd19wYXRoID0gKGZzOjpwYXRo
KGJvb2tfa2VlcGluZ19kaXIpIC8gZnM6OnBhdGgod29ya19maWxlX25hbWUpKS5zdHJpbmco
KTsKICBMKCJ3b3JrIHBhdGggaXMgJXNcbiIsIHdfcGF0aCgpLmNfc3RyKCkpOwp9CgpzdGF0
aWMgdm9pZCBnZXRfbWFuaWZlc3RfbWFwKG1hbmlmZXN0X21hcCAmIG0pCnsKICBlbnN1cmVf
Ym9va2RpcigpOwogIGxvY2FsX3BhdGggbV9wYXRoOwogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+
IG1fZGF0YTsKICBnZXRfbWFuaWZlc3RfcGF0aChtX3BhdGgpOwogIGlmIChmaWxlX2V4aXN0
cyhtX3BhdGgpKQogICAgewogICAgICBMKCJsb2FkaW5nIG1hbmlmZXN0IGZpbGUgJXNcbiIs
IG1fcGF0aCgpLmNfc3RyKCkpOyAgICAgIAogICAgICByZWFkX2RhdGEobV9wYXRoLCBtX2Rh
dGEpOwogICAgICByZWFkX21hbmlmZXN0X21hcChtYW5pZmVzdF9kYXRhKG1fZGF0YSksIG0p
OwogICAgICBMKCJyZWFkICVkIG1hbmlmZXN0IGVudHJpZXNcbiIsIG0uc2l6ZSgpKTsKICAg
IH0KICBlbHNlCiAgICB7CiAgICAgIEwoIm5vIG1hbmlmZXN0IGZpbGUgJXNcbiIsIG1fcGF0
aCgpLmNfc3RyKCkpOwogICAgfQp9CgpzdGF0aWMgdm9pZCBwdXRfbWFuaWZlc3RfbWFwKG1h
bmlmZXN0X21hcCBjb25zdCAmIG0pCnsKICBlbnN1cmVfYm9va2RpcigpOwogIGxvY2FsX3Bh
dGggbV9wYXRoOwogIG1hbmlmZXN0X2RhdGEgbV9kYXRhOwogIGdldF9tYW5pZmVzdF9wYXRo
KG1fcGF0aCk7CiAgTCgid3JpdGluZyBtYW5pZmVzdCBmaWxlICVzXG4iLCBtX3BhdGgoKS5j
X3N0cigpKTsKICB3cml0ZV9tYW5pZmVzdF9tYXAobSwgbV9kYXRhKTsKICB3cml0ZV9kYXRh
KG1fcGF0aCwgbV9kYXRhLmlubmVyKCkpOwogIEwoIndyb3RlICVkIG1hbmlmZXN0IGVudHJp
ZXNcbiIsIG0uc2l6ZSgpKTsKfQoKc3RhdGljIHZvaWQgZ2V0X3dvcmtfc2V0KHdvcmtfc2V0
ICYgdykKewogIGVuc3VyZV9ib29rZGlyKCk7CiAgbG9jYWxfcGF0aCB3X3BhdGg7CiAgZ2V0
X3dvcmtfcGF0aCh3X3BhdGgpOwogIGlmIChmaWxlX2V4aXN0cyh3X3BhdGgpKQogICAgewog
ICAgICBMKCJjaGVja2luZyBmb3IgdW4tY29tbWl0dGVkIHdvcmsgZmlsZSAlc1xuIiwgCgl3
X3BhdGgoKS5jX3N0cigpKTsKICAgICAgZGF0YSB3X2RhdGE7CiAgICAgIHJlYWRfZGF0YSh3
X3BhdGgsIHdfZGF0YSk7CiAgICAgIHJlYWRfd29ya19zZXQod19kYXRhLCB3KTsKICAgICAg
TCgicmVhZCAlZCBkZWxzLCAlZCBhZGRzIGZyb20gJXNcbiIsIAoJdy5kZWxzLnNpemUoKSwg
dy5hZGRzLnNpemUoKSwgd19wYXRoKCkuY19zdHIoKSk7CiAgICB9CiAgZWxzZQogICAgewog
ICAgICBMKCJubyB1bi1jb21taXR0ZWQgd29yayBmaWxlICVzXG4iLCB3X3BhdGgoKS5jX3N0
cigpKTsKICAgIH0KfQoKc3RhdGljIHZvaWQgcHV0X3dvcmtfc2V0KHdvcmtfc2V0ICYgdykK
ewogIGxvY2FsX3BhdGggd19wYXRoOwogIGdldF93b3JrX3BhdGgod19wYXRoKTsKCiAgaWYg
KHcuYWRkcy5zaXplKCkgPiAwCiAgICAgIHx8IHcuZGVscy5zaXplKCkgPiAwKQogICAgewog
ICAgICBlbnN1cmVfYm9va2RpcigpOwogICAgICBkYXRhIHdfZGF0YTsKICAgICAgd3JpdGVf
d29ya19zZXQod19kYXRhLCB3KTsKICAgICAgd3JpdGVfZGF0YSh3X3BhdGgsIHdfZGF0YSk7
CiAgICB9CiAgZWxzZQogICAgewogICAgICBkZWxldGVfZmlsZSh3X3BhdGgpOwogICAgfQp9
CgpzdGF0aWMgdm9pZCBjYWxjdWxhdGVfbmV3X21hbmlmZXN0X21hcChtYW5pZmVzdF9tYXAg
Y29uc3QgJiBtX29sZCwgCgkJCQkgICAgICAgbWFuaWZlc3RfbWFwICYgbV9uZXcpCnsKICBw
YXRoX3NldCBwYXRoczsKICB3b3JrX3NldCB3b3JrOwogIGV4dHJhY3RfcGF0aF9zZXQobV9v
bGQsIHBhdGhzKTsKICBnZXRfd29ya19zZXQod29yayk7CiAgaWYgKHdvcmsuZGVscy5zaXpl
KCkgPiAwKQogICAgTCgicmVtb3ZpbmcgJWQgZGVhZCBmaWxlcyBmcm9tIG1hbmlmZXN0XG4i
LCAKICAgICAgd29yay5kZWxzLnNpemUoKSk7CiAgaWYgKHdvcmsuYWRkcy5zaXplKCkgPiAw
KQogICAgTCgiYWRkaW5nICVkIGZpbGVzIHRvIG1hbmlmZXN0XG4iLCB3b3JrLmFkZHMuc2l6
ZSgpKTsKICBhcHBseV93b3JrX3NldCh3b3JrLCBwYXRocyk7CiAgYnVpbGRfbWFuaWZlc3Rf
bWFwKHBhdGhzLCBtX25ldyk7Cn0KCnN0YXRpYyBzdHJpbmcgZ2V0X3N0ZGluKCkKewogIGNo
YXIgYnVmW2J1ZnN6XTsKICBzdHJpbmcgdG1wOwogIHdoaWxlKGNpbikKICAgIHsKICAgICAg
Y2luLnJlYWQoYnVmLCBidWZzeik7CiAgICAgIHRtcC5hcHBlbmQoYnVmLCBjaW4uZ2NvdW50
KCkpOwogICAgfQogIHJldHVybiB0bXA7Cn0KCnN0YXRpYyB2b2lkIGdldF9sb2dfbWVzc2Fn
ZShwYXRjaF9zZXQgY29uc3QgJiBwcywgCgkJCSAgICBhcHBfc3RhdGUgJiBhcHAsCgkJCSAg
ICBzdHJpbmcgJiBsb2dfbWVzc2FnZSkKewogIHN0cmluZyBjb21tZW50YXJ5OwogIHN0cmlu
ZyBzdW1tYXJ5OwogIHN0cmluZ3N0cmVhbSBzczsKICBwYXRjaF9zZXRfdG9fdGV4dF9zdW1t
YXJ5KHBzLCBzcyk7CiAgc3VtbWFyeSA9IHNzLnN0cigpOwogIGNvbW1lbnRhcnkgKz0gIi0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS1cbiI7CiAgY29tbWVudGFyeSArPSAiRW50ZXIgTG9nLiAgTGluZXMg
YmVnaW5uaW5nIHdpdGggYE1UOicgYXJlIHJlbW92ZWQgYXV0b21hdGljYWxseVxuIjsKICBj
b21tZW50YXJ5ICs9ICJcbiI7CiAgY29tbWVudGFyeSArPSAiU3VtbWFyeSBvZiBjaGFuZ2Vz
OlxuIjsKICBjb21tZW50YXJ5ICs9ICJcbiI7CiAgY29tbWVudGFyeSArPSBzdW1tYXJ5Owog
IGNvbW1lbnRhcnkgKz0gIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiI7CiAgTihhcHAubHVhLmhvb2tf
ZWRpdF9jb21tZW50KGNvbW1lbnRhcnksIGxvZ19tZXNzYWdlKSwKICAgICJlZGl0IG9mIGxv
ZyBtZXNzYWdlIGZhaWxlZCIpOwp9CgoKLy8gdGhlIGdvYWwgaGVyZSBpcyB0byBsb29rIGJh
Y2sgdGhyb3VnaCB0aGUgYW5jZXN0cnkgb2YgdGhlIHByb3ZpZGVkCi8vIGNoaWxkLCBjaGVj
a2luZyB0byBzZWUgdGhlIGxlYXN0IGFuY2VzdG9yIGl0IGhhcyB3aGljaCB3ZSByZWNlaXZl
ZCBmcm9tCi8vIHRoZSBnaXZlbiBuZXR3b3JrIHVybC9ncm91cCBwYWlyLgovLwovLyB3ZSB1
c2UgdGhlIGFuY2VzdG9yIGFzIHRoZSBzb3VyY2UgbWFuaWZlc3Qgd2hlbiBidWlsZGluZyBh
IHBhdGNoc2V0IHRvCi8vIHNlbmQgdG8gdGhhdCB1cmwvZ3JvdXAuCgpzdGF0aWMgYm9vbCBm
aW5kX2FuY2VzdG9yX29uX25ldHNlcnZlciAobWFuaWZlc3RfaWQgY29uc3QgJiBjaGlsZCwg
CgkJCQkJdXJsIGNvbnN0ICYgdSwKCQkJCQlncm91cCBjb25zdCAmIGcsIAoJCQkJCW1hbmlm
ZXN0X2lkICYgYW5jLAoJCQkJCWFwcF9zdGF0ZSAmIGFwcCkKewogIHNldDxtYW5pZmVzdF9p
ZD4gZnJvbnRpZXI7CiAgY2VydF9uYW1lIHRuKGFuY2VzdG9yX2NlcnRfbmFtZSk7CiAgZnJv
bnRpZXIuaW5zZXJ0KGNoaWxkKTsKCiAgd2hpbGUgKCFmcm9udGllci5lbXB0eSgpKQogICAg
ewogICAgICBzZXQ8bWFuaWZlc3RfaWQ+IG5leHRfZnJvbnRpZXI7CiAgICAgIGZvciAoc2V0
PG1hbmlmZXN0X2lkPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGZyb250aWVyLmJlZ2luKCk7Cgkg
ICBpICE9IGZyb250aWVyLmVuZCgpOyArK2kpCgl7CgkgIHZlY3RvcjwgbWFuaWZlc3Q8Y2Vy
dD4gPiB0bXA7CgkgIGFwcC5kYi5nZXRfbWFuaWZlc3RfY2VydHMoKmksIHRuLCB0bXApOwoK
CSAgLy8gd2UgZ28gdGhyb3VnaCB0aGlzIHZlY3RvciBiYWNrd2FyZHMgYmVjYXVzZSB3ZSB3
b3VsZCBwcmVmZXIgdG8KCSAgLy8gaGl0IG1vcmUgcmVjZW50bHktcXVldWVkIGFuY2VzdG9y
cyAoc3VjaCBhcyBpbnRlcm1lZGlhdGUgbm9kZXMKCSAgLy8gaW4gYSBtdWx0aS1ub2RlIG1l
cmdlKSByYXRoZXIgdGhhbiBvbGRlciBhbmNlc3RvcnMuIGJ1dCBvZgoJICAvLyBjb3Vyc2Us
IGFueSBhbmNlc3RvciB3aWxsIGRvLgoKCSAgZm9yICh2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+
ID46OnJldmVyc2VfaXRlcmF0b3IgaiA9IHRtcC5yYmVnaW4oKTsKCSAgICAgICBqICE9IHRt
cC5yZW5kKCk7ICsraikKCSAgICB7CgkgICAgICBjZXJ0X3ZhbHVlIHR2OwoJICAgICAgZGVj
b2RlX2Jhc2U2NChqLT5pbm5lcigpLnZhbHVlLCB0dik7CgkgICAgICBtYW5pZmVzdF9pZCBh
bmNfaWQgKHR2KCkpOwoKCSAgICAgIEwoImxvb2tpbmcgZm9yIHBhcmVudCAlcyBvZiAlcyBv
biBzZXJ2ZXJcbiIsIAoJCWktPmlubmVyKCkoKS5jX3N0cigpLAoJCWFuY19pZC5pbm5lcigp
KCkuY19zdHIoKSk7CgoJICAgICAgaWYgKGFwcC5kYi5tYW5pZmVzdF9leGlzdHNfb25fbmV0
c2VydmVyICh1LCBnLCBhbmNfaWQpKQoJCXsKCQkgIEwoImZvdW5kIHBhcmVudCAlcyBvbiBz
ZXJ2ZXJcbiIsIGFuY19pZC5pbm5lcigpKCkuY19zdHIoKSk7CgkJICBhbmMgPSBhbmNfaWQ7
CgkJICByZXR1cm4gdHJ1ZTsKCQl9CgkgICAgICBlbHNlCgkJbmV4dF9mcm9udGllci5pbnNl
cnQoYW5jX2lkKTsKCSAgICB9CSAgCgl9CgogICAgICBmcm9udGllciA9IG5leHRfZnJvbnRp
ZXI7CiAgICB9CgogIHJldHVybiBmYWxzZTsKfQoKCnN0YXRpYyB2b2lkIHF1ZXVlX2VkZ2Vf
Zm9yX3RhcmdldF9hbmNlc3RvciAocGFpcjx1cmwsZ3JvdXA+IGNvbnN0ICYgdGFyZywKCQkJ
CQkgICAgbWFuaWZlc3RfaWQgY29uc3QgJiBjaGlsZF9pZCwKCQkJCQkgICAgbWFuaWZlc3Rf
bWFwIGNvbnN0ICYgY2hpbGRfbWFwLAoJCQkJCSAgICBhcHBfc3RhdGUgJiBhcHApCnsgIAog
IC8vIG5vdyBoZXJlIGlzIGFuIGludGVyZXN0aW5nIHRoaW5nOiB3ZSAqbWlnaHQqIGJlIHNl
bmRpbmcgZGF0YSB0byBhCiAgLy8gZGVwb3QsIG9yIHNvbWVvbmUgd2l0aCBpbmRldGVybWlu
YXRlIHByZS1leGlzdGluZyBzdGF0ZSAoc2F5IHRoZSBmaXJzdAogIC8vIHRpbWUgd2UgcG9z
dCB0byBuZXRuZXdzKSwgdGhlcmVmb3JlIHdlIGNhbm5vdCBqdXN0ICJzZW5kIHRoZSBlZGdl
IiB3ZQogIC8vIGp1c3QgY29uc3RydWN0ZWQgaW4gYSBtZXJnZSBvciBjb21taXQsIHdlIG5l
ZWQgdG8gc2VuZCBhbiBlZGdlIGZyb20gYQogIC8vIHBhcmVudCB3aGljaCB3ZSBrbm93IHRv
IGJlIHByZXNlbnQgaW4gdGhlIGRlcG90IChvciBlbHNlIGFuIGVkZ2UgZnJvbQogIC8vIHRo
ZSBlbXB0eSBtYXAgLS0gZnVsbCBjb250ZW50cyBvZiBhbGwgZmlsZXMpLiB3aGF0IGlzIHNl
bnQgdGhlcmVmb3JlCiAgLy8gY2hhbmdlcyBvbiBhIGRlcG90LWJ5LWRlcG90IGJhc2lzLiB0
aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgdGhlCiAgLy8gYXBwcm9wcmlhdGUgdGhpbmcgdG8g
c2VuZC4KICAvLwogIC8vIG5iOiB0aGlzIGhhcyBubyBkaXJlY3QgcmVsYXRpb24gdG8gd2hh
dCB3ZSBzdG9yZSBpbiBvdXIgb3duCiAgLy8gZGF0YWJhc2UuIHdlIGFsd2F5cyBzdG9yZSB0
aGUgZWRnZSBmcm9tIG91ciBwYXJlbnQsIGFuZCB3ZSBhbHdheXMga25vdwogIC8vIHdoZW4g
d2UgaGF2ZSBhIHBhcmVudC4KCiAgdmVjdG9yPCBwYWlyPHVybCwgZ3JvdXA+ID4gb25lX3Rh
cmdldDsKICBvbmVfdGFyZ2V0LnB1c2hfYmFjayh0YXJnKTsKICBxdWV1ZWluZ19wYWNrZXRf
d3JpdGVyIHFwdyhhcHAsIG9uZV90YXJnZXQpOwogIAogIG1hbmlmZXN0X2RhdGEgdGFyZ19h
bmNlc3Rvcl9kYXRhOwogIG1hbmlmZXN0X21hcCB0YXJnX2FuY2VzdG9yX21hcDsKICBtYW5p
ZmVzdF9pZCB0YXJnX2FuY2VzdG9yX2lkOwogIAogIGlmIChmaW5kX2FuY2VzdG9yX29uX25l
dHNlcnZlciAoY2hpbGRfaWQsIAoJCQkJICB0YXJnLmZpcnN0LCAKCQkJCSAgdGFyZy5zZWNv
bmQsIAoJCQkJICB0YXJnX2FuY2VzdG9yX2lkLCAKCQkJCSAgYXBwKSkKICAgIHsJICAgIAog
ICAgICBhcHAuZGIuZ2V0X21hbmlmZXN0X3ZlcnNpb24odGFyZ19hbmNlc3Rvcl9pZCwgdGFy
Z19hbmNlc3Rvcl9kYXRhKTsKICAgICAgcmVhZF9tYW5pZmVzdF9tYXAodGFyZ19hbmNlc3Rv
cl9kYXRhLCB0YXJnX2FuY2VzdG9yX21hcCk7CiAgICB9CgogIHBhdGNoX3NldCBwczsKICBt
YW5pZmVzdHNfdG9fcGF0Y2hfc2V0KHRhcmdfYW5jZXN0b3JfbWFwLCBjaGlsZF9tYXAsIGFw
cCwgcHMpOwogIHBhdGNoX3NldF90b19wYWNrZXRzKHBzLCBhcHAsIHFwdyk7CgogIC8vIG5v
dyB0aGF0IHdlJ3ZlIHF1ZXVlZCB0aGUgZGF0YSwgd2UgY2FuIG5vdGUgdGhpcyBuZXcgY2hp
bGQKICAvLyBub2RlIGFzIGV4aXN0aW5nICh3ZWxsIC4uIHNvb24tdG8tZXhpc3QpIG9uIHRo
ZSBzZXJ2ZXIKICBhcHAuZGIubm90ZV9tYW5pZmVzdF9vbl9uZXRzZXJ2ZXIgKHRhcmcuZmly
c3QsIHRhcmcuc2Vjb25kLCBjaGlsZF9pZCk7Cgp9CgoKLy8gdGhpcyBoZWxwZXIgdHJpZXMg
dG8gcHJvZHVjZSBtZXJnZSA8LSBtZXJnZU4obGVmdCxyaWdodCksIHBvc3NpYmx5Ci8vIG1l
cmdlMyBpZiBpdCBjYW4gZmluZCBhbiBhbmNlc3Rvciwgb3RoZXJ3aXNlIG1lcmdlMi4gaXQg
YWxzbyBxdWV1ZXMgdGhlCi8vIGFwcHJvcHJpYXRlIGVkZ2VzIGZyb20ga25vd24gYW5jZXN0
b3JzIHRvIHRoZSBuZXcgbWVyZ2Ugbm9kZSwgdG8gYmUKLy8gdHJhbnNtaXR0ZWQgdG8gZWFj
aCBvZiB0aGUgdGFyZ2V0cyBwcm92aWRlZC4KCnN0YXRpYyB2b2lkIHRyeV9vbmVfbWVyZ2Uo
bWFuaWZlc3RfaWQgY29uc3QgJiBsZWZ0LAoJCQkgIG1hbmlmZXN0X2lkIGNvbnN0ICYgcmln
aHQsCgkJCSAgbWFuaWZlc3RfaWQgJiBtZXJnZWQsCgkJCSAgYXBwX3N0YXRlICYgYXBwLCAK
CQkJICB2ZWN0b3I8IHBhaXI8dXJsLGdyb3VwPiA+IGNvbnN0ICYgdGFyZ2V0cykKewogIG1h
bmlmZXN0X2RhdGEgbGVmdF9kYXRhLCByaWdodF9kYXRhLCBhbmNlc3Rvcl9kYXRhLCBtZXJn
ZWRfZGF0YTsKICBtYW5pZmVzdF9tYXAgbGVmdF9tYXAsIHJpZ2h0X21hcCwgYW5jZXN0b3Jf
bWFwLCBtZXJnZWRfbWFwOwogIG1hbmlmZXN0X2lkIGFuY2VzdG9yOwoKICBhcHAuZGIuZ2V0
X21hbmlmZXN0X3ZlcnNpb24obGVmdCwgbGVmdF9kYXRhKTsKICBhcHAuZGIuZ2V0X21hbmlm
ZXN0X3ZlcnNpb24ocmlnaHQsIHJpZ2h0X2RhdGEpOwogIHJlYWRfbWFuaWZlc3RfbWFwKGxl
ZnRfZGF0YSwgbGVmdF9tYXApOwogIHJlYWRfbWFuaWZlc3RfbWFwKHJpZ2h0X2RhdGEsIHJp
Z2h0X21hcCk7CiAgCiAgc2ltcGxlX21lcmdlX3Byb3ZpZGVyIG1lcmdlcihhcHApOwogIAog
IGlmKGZpbmRfY29tbW9uX2FuY2VzdG9yKGxlZnQsIHJpZ2h0LCBhbmNlc3RvciwgYXBwKSkJ
ICAgIAogICAgewogICAgICBQKCJjb21tb24gYW5jZXN0b3IgJXMgZm91bmQsIHRyeWluZyBt
ZXJnZTNcbiIsIGFuY2VzdG9yLmlubmVyKCkoKS5jX3N0cigpKTsgCiAgICAgIGFwcC5kYi5n
ZXRfbWFuaWZlc3RfdmVyc2lvbihhbmNlc3RvciwgYW5jZXN0b3JfZGF0YSk7CiAgICAgIHJl
YWRfbWFuaWZlc3RfbWFwKGFuY2VzdG9yX2RhdGEsIGFuY2VzdG9yX21hcCk7CiAgICAgIE4o
bWVyZ2UzKGFuY2VzdG9yX21hcCwgbGVmdF9tYXAsIHJpZ2h0X21hcCwgCgkgICAgICAgYXBw
LCBtZXJnZXIsIG1lcmdlZF9tYXApLAoJKHN0cmluZygiZmFpbGVkIHRvIG1lcmdlIG1hbmlm
ZXN0cyAiKQoJICsgbGVmdC5pbm5lcigpKCkgKyAiIGFuZCAiICsgcmlnaHQuaW5uZXIoKSgp
KSk7CSAgICAgIAogICAgfQogIGVsc2UKICAgIHsKICAgICAgUCgibm8gY29tbW9uIGFuY2Vz
dG9yIGZvdW5kLCB0cnlpbmcgbWVyZ2UyXG4iKTsgCiAgICAgIE4obWVyZ2UyKGxlZnRfbWFw
LCByaWdodF9tYXAsIGFwcCwgbWVyZ2VyLCBtZXJnZWRfbWFwKSwKCShzdHJpbmcoImZhaWxl
ZCB0byBtZXJnZSBtYW5pZmVzdHMgIikKCSArIGxlZnQuaW5uZXIoKSgpICsgIiBhbmQgIiAr
IHJpZ2h0LmlubmVyKCkoKSkpOwkgICAgICAKICAgIH0KICAKICB3cml0ZV9tYW5pZmVzdF9t
YXAobWVyZ2VkX21hcCwgbWVyZ2VkX2RhdGEpOwogIGNhbGN1bGF0ZV9tYW5pZmVzdF9tYXBf
aWRlbnQobWVyZ2VkX21hcCwgbWVyZ2VkKTsJICAKICAKICBiYXNlNjQ8IGd6aXA8ZGVsdGE+
ID4gbGVmdF9lZGdlOwogIGRpZmYobGVmdF9kYXRhLmlubmVyKCksIG1lcmdlZF9kYXRhLmlu
bmVyKCksIGxlZnRfZWRnZSk7CgogIC8vIEZJWE1FOiB3ZSBkbyAqbm90KiBtYW51ZmFjdHVy
ZSBvciBzdG9yZSB0aGUgc2Vjb25kIGVkZ2UgdG8KICAvLyB0aGUgbWVyZ2VkIHZlcnNpb24s
IHNpbmNlIGRvaW5nIHNvIHZpb2xhdGVzIHRoZQogIC8vIGFzc3VtcHRpb25zIG9mIHRoZSBk
YiwgYW5kIHRoZSAncmlnaHQnIHZlcnNpb24gYWxyZWFkeQogIC8vIGV4aXN0cyBpbiBpdHMg
ZW50aXJldHksIGFueXdheXMuIHRoaXMgaXMgYSBzdWJ0bGUgaXNzdWUKICAvLyB0aG91Z2gg
YW5kIEknbSBub3Qgc3VyZSBJJ20gbWFraW5nIHRoZSByaWdodAogIC8vIGRlY2lzaW9uLiBy
ZXZpc2l0LiBpZiB5b3UgZG8gbm90IHNlZSB0aGF0IGl0IGlzIGEgc3VidGxlCiAgLy8gaXNz
dWUgSSBzdWdnZXN0IHlvdSBhcmUgbm90IHRoaW5raW5nIGFib3V0IGl0IGxvbmcgZW5vdWdo
LgogIC8vCiAgLy8gYmFzZTY0PCBnemlwPGRlbHRhPiA+IHJpZ2h0X2VkZ2U7CiAgLy8gZGlm
ZihyaWdodF9kYXRhLmlubmVyKCksIG1lcmdlZF9kYXRhLmlubmVyKCksIHJpZ2h0X2VkZ2Up
OwogIC8vIGFwcC5kYi5wdXRfbWFuaWZlc3RfdmVyc2lvbihyaWdodCwgbWVyZ2VkLCByaWdo
dF9lZGdlKTsKICAKICAKICAvLyB3ZSBkbyBvZiBjb3Vyc2UgcmVjb3JkIHRoZSBsZWZ0IGVk
Z2UsIGFuZCBhbmNlc3RyeSByZWxhdGlvbnNoaXAgdG8KICAvLyBib3RoIHByZWRlY2Vzc29y
cy4KCiAgewogICAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsgICAgCgogICAgZGJ3LmNv
bnN1bWVfbWFuaWZlc3RfZGVsdGEobGVmdCwgbWVyZ2VkLCBsZWZ0X2VkZ2UpOyAgCiAgICBj
ZXJ0X21hbmlmZXN0X2FuY2VzdG9yKGxlZnQsIG1lcmdlZCwgYXBwLCBkYncpOwogICAgY2Vy
dF9tYW5pZmVzdF9hbmNlc3RvcihyaWdodCwgbWVyZ2VkLCBhcHAsIGRidyk7CiAgICBjZXJ0
X21hbmlmZXN0X2RhdGVfbm93KG1lcmdlZCwgYXBwLCBkYncpOwogICAgY2VydF9tYW5pZmVz
dF9hdXRob3JfZGVmYXVsdChtZXJnZWQsIGFwcCwgZGJ3KTsKICAgIAogICAgLy8gbWFrZSBz
dXJlIHRoZSBhcHByb3ByaWF0ZSBlZGdlcyBnZXQgcXVldWVkIGZvciB0aGUgbmV0d29yay4K
ICAgIGZvciAodmVjdG9yPCBwYWlyPHVybCxncm91cD4gPjo6Y29uc3RfaXRlcmF0b3IgdGFy
ZyA9IHRhcmdldHMuYmVnaW4oKTsKCSB0YXJnICE9IHRhcmdldHMuZW5kKCk7ICsrdGFyZykK
ICAgICAgewoJcXVldWVfZWRnZV9mb3JfdGFyZ2V0X2FuY2VzdG9yICgqdGFyZywgbWVyZ2Vk
LCBtZXJnZWRfbWFwLCBhcHApOwogICAgICB9CiAgICAKICAgIHF1ZXVlaW5nX3BhY2tldF93
cml0ZXIgcXB3KGFwcCwgdGFyZ2V0cyk7CiAgICBjZXJ0X21hbmlmZXN0X2FuY2VzdG9yKGxl
ZnQsIG1lcmdlZCwgYXBwLCBxcHcpOwogICAgY2VydF9tYW5pZmVzdF9hbmNlc3RvcihyaWdo
dCwgbWVyZ2VkLCBhcHAsIHFwdyk7CiAgICBjZXJ0X21hbmlmZXN0X2RhdGVfbm93KG1lcmdl
ZCwgYXBwLCBxcHcpOwogICAgY2VydF9tYW5pZmVzdF9hdXRob3JfZGVmYXVsdChtZXJnZWQs
IGFwcCwgcXB3KTsKICB9Cgp9CQkJICAKCgovLyBhY3R1YWwgY29tbWFuZHMgZm9sbG93CgpD
TUQobHNjZXJ0cywgImtleSBhbmQgY2VydCIsICIoZmlsZXxtYW5pZmVzdCkgPGlkPiIsIAog
ICAgImxpc3QgY2VydHMgYXNzb2NpYXRlZCB3aXRoIG1hbmlmZXN0IG9yIGZpbGUiKQp7CiAg
aWYgKGFyZ3Muc2l6ZSgpICE9IDIpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKCiAgdmVjdG9y
PGNlcnQ+IGNlcnRzOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwoKICBp
ZiAoYXJnc1swXSA9PSAibWFuaWZlc3QiKQogICAgewogICAgICBtYW5pZmVzdF9pZCBpZGVu
dChhcmdzWzFdKTsKICAgICAgdmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IHRzOwogICAgICBh
cHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKGlkZW50LCB0cyk7CiAgICAgIGZvciAoc2l6ZV90
IGkgPSAwOyBpIDwgdHMuc2l6ZSgpOyArK2kpCgljZXJ0cy5wdXNoX2JhY2sodHNbaV0uaW5u
ZXIoKSk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAg
IGZpbGVfaWQgaWRlbnQoYXJnc1sxXSk7CiAgICAgIHZlY3RvcjwgZmlsZTxjZXJ0PiA+IHRz
OwogICAgICBhcHAuZGIuZ2V0X2ZpbGVfY2VydHMoaWRlbnQsIHRzKTsKICAgICAgZm9yIChz
aXplX3QgaSA9IDA7IGkgPCB0cy5zaXplKCk7ICsraSkKCWNlcnRzLnB1c2hfYmFjayh0c1tp
XS5pbm5lcigpKTsKICAgIH0KICBlbHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKCQogIGZv
ciAoc2l6ZV90IGkgPSAwOyBpIDwgY2VydHMuc2l6ZSgpOyArK2kpCiAgICB7CiAgICAgIGJv
b2wgb2sgPSBjaGVja19jZXJ0KGFwcCwgY2VydHNbaV0pOwogICAgICBjZXJ0X3ZhbHVlIHR2
OyAgICAgIAogICAgICBkZWNvZGVfYmFzZTY0KGNlcnRzW2ldLnZhbHVlLCB0dik7CiAgICAg
IHN0cmluZyB3YXNoZWQ7CiAgICAgIGlmIChndWVzc19iaW5hcnkodHYoKSkpCgl7CgkgIHdh
c2hlZCA9ICI8YmluYXJ5IGRhdGE+IjsKCX0KICAgICAgZWxzZQoJewoJICB3YXNoZWQgPSB0
digpOwoJfQogICAgICBzdHJpbmcgaGVhZCA9IHN0cmluZyhvayA/ICJvayBzaWcgZnJvbSAi
IDogImJhZCBzaWcgZnJvbSAiKQoJKyAiWyIgKyBjZXJ0c1tpXS5rZXkoKSArICJdIDogIiAK
CSsgIlsiICsgY2VydHNbaV0ubmFtZSgpICsgIl0gPSBbIjsKICAgICAgc3RyaW5nIHBhZCho
ZWFkLnNpemUoKSwgJyAnKTsKICAgICAgdmVjdG9yPHN0cmluZz4gbGluZXM7CiAgICAgIHNw
bGl0X2ludG9fbGluZXMod2FzaGVkLCBsaW5lcyk7CiAgICAgIEkobGluZXMuc2l6ZSgpID4g
MCk7CiAgICAgIGNvdXQgPDwgaGVhZCA8PCBsaW5lc1swXSA7CiAgICAgIGZvciAoc2l6ZV90
IGkgPSAxOyBpIDwgbGluZXMuc2l6ZSgpOyArK2kpCgljb3V0IDw8IGVuZGwgPDwgcGFkIDw8
IGxpbmVzW2ldOwogICAgICBjb3V0IDw8ICJdIiA8PCBlbmRsOwogICAgfSAgCiAgZ3VhcmQu
Y29tbWl0KCk7Cn0KCkNNRChsc2tleXMsICJrZXkgYW5kIGNlcnQiLCAiW3BhcnRpYWwtaWRd
IiwgImxpc3Qga2V5cyIpCnsKICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+IHB1YmtleXM7CiAg
dmVjdG9yPHJzYV9rZXlwYWlyX2lkPiBwcml2a2V5czsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQg
Z3VhcmQoYXBwLmRiKTsKCiAgaWYgKGFyZ3Muc2l6ZSgpID09IDApCiAgICBhcHAuZGIuZ2V0
X2tleV9pZHMoIiIsIHB1YmtleXMsIHByaXZrZXlzKTsKICBlbHNlIGlmIChhcmdzLnNpemUo
KSA9PSAxKQogICAgYXBwLmRiLmdldF9rZXlfaWRzKGFyZ3NbMF0sIHB1YmtleXMsIHByaXZr
ZXlzKTsKICBlbHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKICAKICBpZiAocHVia2V5cy5z
aXplKCkgPiAwKQogICAgewogICAgICBjb3V0IDw8IGVuZGwgPDwgIltwdWJsaWMga2V5c10i
IDw8IGVuZGw7CiAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcHVia2V5cy5zaXplKCk7
ICsraSkKCWNvdXQgPDwgcHVia2V5c1tpXSgpIDw8IGVuZGw7CiAgICAgIGNvdXQgPDwgZW5k
bDsKICAgIH0KCiAgaWYgKHByaXZrZXlzLnNpemUoKSA+IDApCiAgICB7CiAgICAgIGNvdXQg
PDwgZW5kbCA8PCAiW3ByaXZhdGUga2V5c10iIDw8IGVuZGw7CiAgICAgIGZvciAoc2l6ZV90
IGkgPSAwOyBpIDwgcHJpdmtleXMuc2l6ZSgpOyArK2kpCgljb3V0IDw8IHByaXZrZXlzW2ld
KCkgPDwgZW5kbDsKICAgICAgY291dCA8PCBlbmRsOwogICAgfQoKICBndWFyZC5jb21taXQo
KTsKfQoKQ01EKGdlbmtleSwgImtleSBhbmQgY2VydCIsICI8a2V5aWQ+IiwgImdlbmVyYXRl
IGFuIFJTQSBrZXktcGFpciIpCnsKICBpZiAoYXJncy5zaXplKCkgIT0gMSkKICAgIHRocm93
IHVzYWdlKG5hbWUpOwogIAogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CiAg
cnNhX2tleXBhaXJfaWQgaWRlbnQoYXJnc1swXSk7CgogIE4oISBhcHAuZGIua2V5X2V4aXN0
cyhpZGVudCksCiAgICAoc3RyaW5nKCJrZXkgJyIpICsgaWRlbnQoKSArICInIGFscmVhZHkg
ZXhpc3RzIGluIGRhdGFiYXNlIikpOwogIAogIGJhc2U2NDxyc2FfcHViX2tleT4gcHViOwog
IGJhc2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gcHJpdjsKICBQKCJnZW5lcmF0aW5nIGtl
eS1wYWlyICclcydcbiIsIGlkZW50KCkuY19zdHIoKSk7CiAgZ2VuZXJhdGVfa2V5X3BhaXIo
YXBwLmx1YSwgaWRlbnQsIHB1YiwgcHJpdik7CiAgUCgic3RvcmluZyBrZXktcGFpciAnJXMn
IGluIGRhdGFiYXNlXG4iLCBpZGVudCgpLmNfc3RyKCkpOwogIGFwcC5kYi5wdXRfa2V5X3Bh
aXIoaWRlbnQsIHB1YiwgcHJpdik7CgogIGd1YXJkLmNvbW1pdCgpOwp9CgpDTUQoY2VydCwg
ImtleSBhbmQgY2VydCIsICIoZmlsZXxtYW5pZmVzdCkgPGlkPiA8Y2VydG5hbWU+IFtjZXJ0
dmFsXSIsIAogICAgICAgICAgICAgICAgICAgICAgICAiY3JlYXRlIGEgY2VydCBmb3IgYSBm
aWxlIG9yIG1hbmlmZXN0IikKewogIGlmICgoYXJncy5zaXplKCkgIT0gNCkgJiYgKGFyZ3Mu
c2l6ZSgpICE9IDMpKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7CgogIHRyYW5zYWN0aW9uX2d1
YXJkIGd1YXJkKGFwcC5kYik7CgogIGhleGVuYzxpZD4gaWRlbnQoYXJnc1sxXSk7CiAgY2Vy
dF9uYW1lIG5hbWUoYXJnc1syXSk7CgogIHJzYV9rZXlwYWlyX2lkIGtleTsKICBpZiAoYXBw
LnNpZ25pbmdfa2V5KCkgIT0gIiIpCiAgICBrZXkgPSBhcHAuc2lnbmluZ19rZXk7CiAgZWxz
ZQogICAgTihndWVzc19kZWZhdWx0X2tleShrZXksIGFwcCksCiAgICAgICJubyB1bmlxdWUg
cHJpdmF0ZSBrZXkgZm91bmQsIGFuZCBubyBrZXkgc3BlY2lmaWVkIik7CiAgCiAgY2VydF92
YWx1ZSB2YWw7CiAgaWYgKGFyZ3Muc2l6ZSgpID09IDQpCiAgICB2YWwgPSBjZXJ0X3ZhbHVl
KGFyZ3NbM10pOwogIGVsc2UKICAgIHZhbCA9IGNlcnRfdmFsdWUoZ2V0X3N0ZGluKCkpOwoK
ICBiYXNlNjQ8Y2VydF92YWx1ZT4gdmFsX2VuY29kZWQ7CiAgZW5jb2RlX2Jhc2U2NCh2YWws
IHZhbF9lbmNvZGVkKTsKCiAgY2VydCB0KGlkZW50LCBuYW1lLCB2YWxfZW5jb2RlZCwga2V5
KTsKICAKICAvLyBuYjogd2Ugd2FudCB0byB0aHJvdyB1c2FnZSBvbiBtaXMtdXNlICpiZWZv
cmUqIGFza2luZyBmb3IgYQogIC8vIHBhc3NwaHJhc2UuCgogIGlmIChhcmdzWzBdID09ICJm
aWxlIikKICAgIHsKICAgICAgY2FsY3VsYXRlX2NlcnQoYXBwLCB0KTsKICAgICAgYXBwLmRi
LnB1dF9maWxlX2NlcnQoZmlsZTxjZXJ0Pih0KSk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1sw
XSA9PSAibWFuaWZlc3QiKQogICAgewogICAgICBjYWxjdWxhdGVfY2VydChhcHAsIHQpOwog
ICAgICBhcHAuZGIucHV0X21hbmlmZXN0X2NlcnQobWFuaWZlc3Q8Y2VydD4odCkpOwogICAg
fQogIGVsc2UKICAgIHRocm93IHVzYWdlKHRoaXMtPm5hbWUpOwoKICBndWFyZC5jb21taXQo
KTsKfQoKCkNNRCh0YWcsICJjZXJ0aWZpY2F0ZSIsICI8aWQ+IDx0YWduYW1lPiIsIAogICAg
InB1dCBhIHN5bWJvbGljIHRhZyBjZXJ0IG9uIGEgbWFuaWZlc3QgdmVyc2lvbiIpCnsKICBp
ZiAoYXJncy5zaXplKCkgIT0gMikKICAgIHRocm93IHVzYWdlKG5hbWUpOwogIG1hbmlmZXN0
X2lkIG0oYXJnc1swXSk7CiAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsKICBjZXJ0X21h
bmlmZXN0X3RhZyhtLCBhcmdzWzFdLCBhcHAsIGRidyk7Cn0KCkNNRChhcHByb3ZlLCAiY2Vy
dGlmaWNhdGUiLCAiKGZpbGV8bWFuaWZlc3QpIDxpZD4iLCAKICAgICJhcHByb3ZlIG9mIGEg
bWFuaWZlc3Qgb3IgZmlsZSB2ZXJzaW9uIikKewogIGlmIChhcmdzLnNpemUoKSAhPSAyKQog
ICAgdGhyb3cgdXNhZ2UobmFtZSk7CiAgaWYgKGFyZ3NbMF0gPT0gIm1hbmlmZXN0IikKICAg
IHsKICAgICAgbWFuaWZlc3RfaWQgbShhcmdzWzFdKTsKICAgICAgcGFja2V0X2RiX3dyaXRl
ciBkYncoYXBwKTsKICAgICAgY2VydF9tYW5pZmVzdF9hcHByb3ZhbChtLCB0cnVlLCBhcHAs
IGRidyk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAg
IHBhY2tldF9kYl93cml0ZXIgZGJ3KGFwcCk7CiAgICAgIGZpbGVfaWQgZihhcmdzWzFdKTsK
ICAgICAgY2VydF9maWxlX2FwcHJvdmFsKGYsIHRydWUsIGFwcCwgZGJ3KTsKICAgIH0KICBl
bHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKfQoKQ01EKGRpc2FwcHJvdmUsICJjZXJ0aWZp
Y2F0ZSIsICIoZmlsZXxtYW5pZmVzdCkgPGlkPiIsIAogICAgImRpc2FwcHJvdmUgb2YgYSBt
YW5pZmVzdCBvciBmaWxlIHZlcnNpb24iKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDIpCiAg
ICB0aHJvdyB1c2FnZShuYW1lKTsKICBpZiAoYXJnc1swXSA9PSAibWFuaWZlc3QiKQogICAg
ewogICAgICBtYW5pZmVzdF9pZCBtKGFyZ3NbMV0pOwogICAgICBwYWNrZXRfZGJfd3JpdGVy
IGRidyhhcHApOwogICAgICBjZXJ0X21hbmlmZXN0X2FwcHJvdmFsKG0sIGZhbHNlLCBhcHAs
IGRidyk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAg
IGZpbGVfaWQgZihhcmdzWzFdKTsKICAgICAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsK
ICAgICAgY2VydF9maWxlX2FwcHJvdmFsKGYsIGZhbHNlLCBhcHAsIGRidyk7CiAgICB9CiAg
ZWxzZQogICAgdGhyb3cgdXNhZ2UobmFtZSk7Cn0KCgpDTUQoY29tbWVudCwgImNlcnRpZmlj
YXRlIiwgIihmaWxlfG1hbmlmZXN0KSA8aWQ+IFtjb21tZW50XSIsIAogICAgImNvbW1lbnQg
b24gYSBmaWxlIG9yIG1hbmlmZXN0IHZlcnNpb24iKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9
IDIgJiYgYXJncy5zaXplKCkgIT0gMykKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICBzdHJp
bmcgY29tbWVudDsKICBpZiAoYXJncy5zaXplKCkgPT0gMykKICAgIGNvbW1lbnQgPSBhcmdz
WzJdOwogIGVsc2UKICAgIE4oYXBwLmx1YS5ob29rX2VkaXRfY29tbWVudCgiIiwgY29tbWVu
dCksICJlZGl0IGNvbW1lbnQgZmFpbGVkIik7CiAgCiAgTihjb21tZW50LmZpbmRfZmlyc3Rf
bm90X29mKCIgXHJcdFxuIikgPT0gc3RyaW5nOjpucG9zLCAiZW1wdHkgY29tbWVudCIpOwoK
ICBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAgIHBhY2tldF9kYl93cml0ZXIg
ZGJ3KGFwcCk7CiAgICAgIGNlcnRfZmlsZV9jb21tZW50KGZpbGVfaWQoYXJnc1sxXSksIGNv
bW1lbnQsIGFwcCwgZGJ3KTsgCiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAibWFuaWZl
c3QiKQogICAgewogICAgICBwYWNrZXRfZGJfd3JpdGVyIGRidyhhcHApOwogICAgICBjZXJ0
X21hbmlmZXN0X2NvbW1lbnQobWFuaWZlc3RfaWQoYXJnc1sxXSksIGNvbW1lbnQsIGFwcCwg
ZGJ3KTsKICAgIH0KICBlbHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKfQoKCgpDTUQoYWRk
LCAid29ya2luZyBjb3B5IiwgIjxwYXRobmFtZT4gWy4uLl0iLCAiYWRkIGZpbGVzIHRvIHdv
cmtpbmcgY29weSIpCnsKICBpZiAoYXJncy5zaXplKCkgPCAxKQogICAgdGhyb3cgdXNhZ2Uo
bmFtZSk7CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CgogIG1hbmlmZXN0
X21hcCBtYW47CiAgd29ya19zZXQgd29yazsgIAogIGdldF9tYW5pZmVzdF9tYXAobWFuKTsK
ICBnZXRfd29ya19zZXQod29yayk7CiAgYm9vbCByZXdyaXRlX3dvcmsgPSBmYWxzZTsKCiAg
Zm9yICh2ZWN0b3I8c3RyaW5nPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGFyZ3MuYmVnaW4oKTsg
aSAhPSBhcmdzLmVuZCgpOyArK2kpCiAgICBidWlsZF9hZGRpdGlvbihmaWxlX3BhdGgoKmkp
LCBhcHAsIHdvcmssIG1hbiwgcmV3cml0ZV93b3JrKTsKICAKICBndWFyZC5jb21taXQoKTsK
ICAKICAvLyBzbWFsbCByYWNlIGhlcmUKICBpZiAocmV3cml0ZV93b3JrKQogICAgcHV0X3dv
cmtfc2V0KHdvcmspOwp9CgpDTUQoZHJvcCwgIndvcmtpbmcgY29weSIsICI8cGF0aG5hbWU+
IFsuLi5dIiwgImRyb3AgZmlsZXMgZnJvbSB3b3JraW5nIGNvcHkiKQp7CiAgaWYgKGFyZ3Mu
c2l6ZSgpIDwgMSkKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICBtYW5pZmVzdF9tYXAgbWFu
OwogIHdvcmtfc2V0IHdvcms7CiAgZ2V0X21hbmlmZXN0X21hcChtYW4pOwogIGdldF93b3Jr
X3NldCh3b3JrKTsKICBib29sIHJld3JpdGVfd29yayA9IGZhbHNlOwoKICB0cmFuc2FjdGlv
bl9ndWFyZCBndWFyZChhcHAuZGIpOwoKICBmb3IgKHZlY3RvcjxzdHJpbmc+Ojpjb25zdF9p
dGVyYXRvciBpID0gYXJncy5iZWdpbigpOyBpICE9IGFyZ3MuZW5kKCk7ICsraSkKICAgIGJ1
aWxkX2RlbGV0aW9uKGZpbGVfcGF0aCgqaSksIGFwcCwgd29yaywgbWFuLCByZXdyaXRlX3dv
cmspOwogIAogIGd1YXJkLmNvbW1pdCgpOwoKICAvLyBzbWFsbCByYWNlIGhlcmUKICBpZiAo
cmV3cml0ZV93b3JrKQogICAgcHV0X3dvcmtfc2V0KHdvcmspOwp9CgpDTUQoY29tbWl0LCAi
d29ya2luZyBjb3B5IiwgIltsb2cgbWVzc2FnZV0iLCAiY29tbWl0IHdvcmtpbmcgY29weSB0
byBkYXRhYmFzZSIpCnsKICBzdHJpbmcgbG9nX21lc3NhZ2UoIiIpOwogIG1hbmlmZXN0X21h
cCBtX29sZCwgbV9uZXc7CiAgcGF0Y2hfc2V0IHBzOwoKICBnZXRfbWFuaWZlc3RfbWFwKG1f
b2xkKTsKICBjYWxjdWxhdGVfbmV3X21hbmlmZXN0X21hcChtX29sZCwgbV9uZXcpOwogIG1h
bmlmZXN0X2lkIG9sZF9pZCwgbmV3X2lkOwogIGNhbGN1bGF0ZV9tYW5pZmVzdF9tYXBfaWRl
bnQobV9vbGQsIG9sZF9pZCk7CiAgY2FsY3VsYXRlX21hbmlmZXN0X21hcF9pZGVudChtX25l
dywgbmV3X2lkKTsKCiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDAgJiYgYXJncy5zaXplKCkgIT0g
MSkKICAgIHRocm93IHVzYWdlKG5hbWUpOwogIAogIGNlcnRfdmFsdWUgYnJhbmNobmFtZTsK
ICBpZiAoYXBwLmJyYW5jaF9uYW1lICE9ICIiKQogICAgewogICAgICBicmFuY2huYW1lID0g
YXBwLmJyYW5jaF9uYW1lOwogICAgfQogIGVsc2UKICAgIHsKICAgICAgdmVjdG9yPCBtYW5p
ZmVzdDxjZXJ0PiA+IGNlcnRzOwogICAgICBjZXJ0X25hbWUgYnJhbmNoKGJyYW5jaF9jZXJ0
X25hbWUpOwogICAgICBhcHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKG9sZF9pZCwgYnJhbmNo
LCBjZXJ0cyk7CgogICAgICBOKGNlcnRzLnNpemUoKSAhPSAwLCAKCXN0cmluZygibm8gYnJh
bmNoIGNlcnRzIGZvdW5kIGZvciBvbGQgbWFuaWZlc3QgIikKCSsgb2xkX2lkLmlubmVyKCko
KSArICIsIHBsZWFzZSBwcm92aWRlIGEgYnJhbmNoIG5hbWUiKTsKCiAgICAgIE4oY2VydHMu
c2l6ZSgpID09IDEsCglzdHJpbmcoIm11bHRpcGxlIGJyYW5jaCBjZXJ0cyBmb3VuZCBmb3Ig
b2xkIG1hbmlmZXN0ICIpCgkrIG9sZF9pZC5pbm5lcigpKCkgKyAiLCBwbGVhc2UgcHJvdmlk
ZSBhIGJyYW5jaCBuYW1lIik7CgogICAgICBkZWNvZGVfYmFzZTY0KGNlcnRzWzBdLmlubmVy
KCkudmFsdWUsIGJyYW5jaG5hbWUpOwogICAgfQogICAgCiAgTCgiY29tbWl0dGluZyAlcyB0
byBicmFuY2ggJXNcbiIsIAogICAgbmV3X2lkLmlubmVyKCkoKS5jX3N0cigpLCBicmFuY2hu
YW1lKCkuY19zdHIoKSk7CiAgYXBwLmJyYW5jaF9uYW1lID0gYnJhbmNobmFtZSgpOwoKICBt
YW5pZmVzdHNfdG9fcGF0Y2hfc2V0KG1fb2xkLCBtX25ldywgYXBwLCBwcyk7CgogIC8vIGdl
dCBsb2cgbWVzc2FnZQogIGlmIChhcmdzLnNpemUoKSA9PSAxKQogICAgbG9nX21lc3NhZ2Ug
PSBhcmdzWzBdOwogIGVsc2UKICAgIGdldF9sb2dfbWVzc2FnZShwcywgYXBwLCBsb2dfbWVz
c2FnZSk7CgogIE4obG9nX21lc3NhZ2UuZmluZF9maXJzdF9ub3Rfb2YoIiBcclx0XG4iKSAh
PSBzdHJpbmc6Om5wb3MsCiAgICAiZW1wdHkgbG9nIG1lc3NhZ2UiKTsKCiAgewogICAgdHJh
bnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRiKTsKCiAgICAvLyBwcm9jZXNzIG1hbmlmZXN0
IGRlbHRhIG9yIG5ldyBtYW5pZmVzdAogICAgaWYgKGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9u
X2V4aXN0cyhwcy5tX25ldykpCiAgICAgIHsKCUwoInNraXBwaW5nIG1hbmlmZXN0ICVzLCBh
bHJlYWR5IGluIGRhdGFiYXNlXG4iLCBwcy5tX25ldy5pbm5lcigpKCkuY19zdHIoKSk7CiAg
ICAgIH0KICAgIGVsc2UKICAgICAgewoJaWYgKGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9uX2V4
aXN0cyhwcy5tX29sZCkpCgkgIHsKCSAgICBMKCJpbnNlcnRpbmcgbWFuaWZlc3QgZGVsdGEg
JXMgLT4gJXNcbiIsIAoJICAgICAgcHMubV9vbGQuaW5uZXIoKSgpLmNfc3RyKCksIHBzLm1f
bmV3LmlubmVyKCkoKS5jX3N0cigpKTsKCSAgICBtYW5pZmVzdF9kYXRhIG1fb2xkX2RhdGEs
IG1fbmV3X2RhdGE7CgkgICAgYXBwLmRiLmdldF9tYW5pZmVzdF92ZXJzaW9uKHBzLm1fb2xk
LCBtX29sZF9kYXRhKTsKCSAgICB3cml0ZV9tYW5pZmVzdF9tYXAobV9uZXcsIG1fbmV3X2Rh
dGEpOwoJICAgIGJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBkZWw7CgkgICAgZGlmZihtX29sZF9k
YXRhLmlubmVyKCksIG1fbmV3X2RhdGEuaW5uZXIoKSwgZGVsKTsKCSAgICBhcHAuZGIucHV0
X21hbmlmZXN0X3ZlcnNpb24ocHMubV9vbGQsIHBzLm1fbmV3LCBtYW5pZmVzdF9kZWx0YShk
ZWwpKTsKCSAgfQoJZWxzZQoJICB7CgkgICAgTCgiaW5zZXJ0aW5nIGZ1bGwgbWFuaWZlc3Qg
JXNcbiIsIAoJICAgICAgcHMubV9uZXcuaW5uZXIoKSgpLmNfc3RyKCkpOwoJICAgIG1hbmlm
ZXN0X2RhdGEgbV9uZXdfZGF0YTsKCSAgICB3cml0ZV9tYW5pZmVzdF9tYXAobV9uZXcsIG1f
bmV3X2RhdGEpOwoJICAgIGFwcC5kYi5wdXRfbWFuaWZlc3QocHMubV9uZXcsIG1fbmV3X2Rh
dGEpOwoJICB9CiAgICAgIH0KCiAgICAvLyBwcm9jZXNzIGZpbGUgZGVsdGFzCiAgICBmb3Ig
KHNldDxwYXRjaF9kZWx0YT46OmNvbnN0X2l0ZXJhdG9yIGkgPSBwcy5mX2RlbHRhcy5iZWdp
bigpOwoJIGkgIT0gcHMuZl9kZWx0YXMuZW5kKCk7ICsraSkKICAgICAgewoJaWYgKGFwcC5k
Yi5maWxlX3ZlcnNpb25fZXhpc3RzKGktPmlkX25ldykpCgkgIHsKCSAgICBMKCJza2lwcGlu
ZyBmaWxlIGRlbHRhICVzLCBhbHJlYWR5IGluIGRhdGFiYXNlXG4iLCBpLT5pZF9uZXcuaW5u
ZXIoKSgpLmNfc3RyKCkpOwoJICB9CgllbHNlCgkgIHsKCSAgICBpZiAoYXBwLmRiLmZpbGVf
dmVyc2lvbl9leGlzdHMoaS0+aWRfb2xkKSkKCSAgICAgIHsKCQlMKCJpbnNlcnRpbmcgZGVs
dGEgJXMgLT4gJXNcbiIsIAoJCSAgaS0+aWRfb2xkLmlubmVyKCkoKS5jX3N0cigpLCBpLT5p
ZF9uZXcuaW5uZXIoKSgpLmNfc3RyKCkpOwoJCWZpbGVfZGF0YSBvbGRfZGF0YTsKCQliYXNl
NjQ8IGd6aXA8ZGF0YT4gPiBuZXdfZGF0YTsKCQlhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lvbihp
LT5pZF9vbGQsIG9sZF9kYXRhKTsKCQlyZWFkX2RhdGEoaS0+cGF0aCwgbmV3X2RhdGEpOwoJ
CWJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBkZWw7CgkJZGlmZihvbGRfZGF0YS5pbm5lcigpLCBu
ZXdfZGF0YSwgZGVsKTsKCQlhcHAuZGIucHV0X2ZpbGVfdmVyc2lvbihpLT5pZF9vbGQsIGkt
PmlkX25ldywgZmlsZV9kZWx0YShkZWwpKTsKCSAgICAgIH0KCSAgICBlbHNlCgkgICAgICB7
CgkJTCgiaW5zZXJ0aW5nIGZ1bGwgdmVyc2lvbiAlc1xuIiwgaS0+aWRfb2xkLmlubmVyKCko
KS5jX3N0cigpKTsKCQliYXNlNjQ8IGd6aXA8ZGF0YT4gPiBuZXdfZGF0YTsKCQlyZWFkX2Rh
dGEoaS0+cGF0aCwgbmV3X2RhdGEpOwoJCS8vIHNhbml0eSBjaGVjawoJCWhleGVuYzxpZD4g
dGlkOwoJCWNhbGN1bGF0ZV9pZGVudChuZXdfZGF0YSwgdGlkKTsKCQlJKHRpZCA9PSBpLT5p
ZF9uZXcuaW5uZXIoKSk7CgkJYXBwLmRiLnB1dF9maWxlKGktPmlkX25ldywgZmlsZV9kYXRh
KG5ld19kYXRhKSk7CgkgICAgICB9CgkgIH0KICAgICAgfQogIAogICAgLy8gcHJvY2VzcyBm
aWxlIGFkZHMKICAgIGZvciAoc2V0PHBhdGNoX2FkZGl0aW9uPjo6Y29uc3RfaXRlcmF0b3Ig
aSA9IHBzLmZfYWRkcy5iZWdpbigpOwoJIGkgIT0gcHMuZl9hZGRzLmVuZCgpOyArK2kpCiAg
ICAgIHsKCWlmIChhcHAuZGIuZmlsZV92ZXJzaW9uX2V4aXN0cyhpLT5pZGVudCkpCgkgIHsK
CSAgICBMKCJza2lwcGluZyBmaWxlICVzICVzLCBhbHJlYWR5IGluIGRhdGFiYXNlXG4iLCAK
CSAgICAgIGktPnBhdGgoKS5jX3N0cigpLCBpLT5pZGVudC5pbm5lcigpKCkuY19zdHIoKSk7
CgkgIH0KCWVsc2UKCSAgewoJICAgIC8vIGl0J3MgYSBuZXcgZmlsZQoJICAgIEwoImluc2Vy
dGluZyBuZXcgZmlsZSAlcyAlc1xuIiwgCgkgICAgICBpLT5wYXRoKCkuY19zdHIoKSwgaS0+
aWRlbnQuaW5uZXIoKSgpLmNfc3RyKCkpOwoJICAgIGJhc2U2NDwgZ3ppcDxkYXRhPiA+IG5l
d19kYXRhOwoJICAgIHJlYWRfZGF0YShpLT5wYXRoLCBuZXdfZGF0YSk7CgkgICAgYXBwLmRi
LnB1dF9maWxlKGktPmlkZW50LCBuZXdfZGF0YSk7CgkgIH0KICAgICAgfQoKICAgIHBhY2tl
dF9kYl93cml0ZXIgZGJ3KGFwcCk7CgogICAgaWYgKCEgbV9vbGQuZW1wdHkoKSkKICAgICAg
Y2VydF9tYW5pZmVzdF9hbmNlc3Rvcihwcy5tX29sZCwgcHMubV9uZXcsIGFwcCwgZGJ3KTsK
CiAgICBjZXJ0X21hbmlmZXN0X2luX2JyYW5jaChwcy5tX25ldywgYnJhbmNobmFtZSwgYXBw
LCBkYncpOyAKICAgIGNlcnRfbWFuaWZlc3RfZGF0ZV9ub3cocHMubV9uZXcsIGFwcCwgZGJ3
KTsKICAgIGNlcnRfbWFuaWZlc3RfYXV0aG9yX2RlZmF1bHQocHMubV9uZXcsIGFwcCwgZGJ3
KTsKICAgIGNlcnRfbWFuaWZlc3RfY2hhbmdlbG9nKHBzLm1fbmV3LCBsb2dfbWVzc2FnZSwg
YXBwLCBkYncpOwoKICAgIC8vIGNvbW1pdCBkb25lLCBub3cgcXVldWUgZGlmZiBmb3Igc2Vu
ZGluZwoKICAgIGlmIChhcHAuZGIubWFuaWZlc3RfdmVyc2lvbl9leGlzdHMocHMubV9uZXcp
KQogICAgICB7Cgl2ZWN0b3I8IHBhaXI8dXJsLGdyb3VwPiA+IHRhcmdldHM7CglhcHAubHVh
Lmhvb2tfZ2V0X3Bvc3RfdGFyZ2V0cyhicmFuY2huYW1lLCB0YXJnZXRzKTsKCQoJLy8gbWFr
ZSBzdXJlIHRoZSBhcHByb3ByaWF0ZSBlZGdlcyBnZXQgcXVldWVkIGZvciB0aGUgbmV0d29y
ay4KCWZvciAodmVjdG9yPCBwYWlyPHVybCxncm91cD4gPjo6Y29uc3RfaXRlcmF0b3IgdGFy
ZyA9IHRhcmdldHMuYmVnaW4oKTsKCSAgICAgdGFyZyAhPSB0YXJnZXRzLmVuZCgpOyArK3Rh
cmcpCgkgIHsKCSAgICBxdWV1ZV9lZGdlX2Zvcl90YXJnZXRfYW5jZXN0b3IgKCp0YXJnLCBw
cy5tX25ldywgbV9uZXcsIGFwcCk7CgkgIH0KCQoJLy8gdGhyb3cgaW4gYWxsIGF2YWlsYWJs
ZSBjZXJ0cyBmb3IgZ29vZCBtZWFzdXJlCglxdWV1ZWluZ19wYWNrZXRfd3JpdGVyIHFwdyhh
cHAsIHRhcmdldHMpOwoJdmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IGNlcnRzOwoJYXBwLmRi
LmdldF9tYW5pZmVzdF9jZXJ0cyhwcy5tX25ldywgY2VydHMpOwoJZm9yKHZlY3RvcjwgbWFu
aWZlc3Q8Y2VydD4gPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7CgkgICAg
aSAhPSBjZXJ0cy5lbmQoKTsgKytpKQoJICBxcHcuY29uc3VtZV9tYW5pZmVzdF9jZXJ0KCpp
KTsKICAgICAgfSAKICAgIAogICAgZ3VhcmQuY29tbWl0KCk7CiAgfQogIC8vIHNtYWxsIHJh
Y2UgY29uZGl0aW9uIGhlcmUuLi4KICBsb2NhbF9wYXRoIHdfcGF0aDsKICBnZXRfd29ya19w
YXRoKHdfcGF0aCk7CiAgZGVsZXRlX2ZpbGUod19wYXRoKTsKICBwdXRfbWFuaWZlc3RfbWFw
KG1fbmV3KTsKICBQKCJjb21taXR0ZWQgJXNcbiIsIHBzLm1fbmV3LmlubmVyKCkoKS5jX3N0
cigpKTsKfQoKQ01EKHVwZGF0ZSwgIndvcmtpbmcgY29weSIsICJbc29ydCBrZXlzLi4uXSIs
ICJ1cGRhdGUgd29ya2luZyBjb3B5LCByZWxhdGl2ZSB0byBzb3J0aW5nIGtleXMiKQp7Cgog
IG1hbmlmZXN0X2RhdGEgbV9jaG9zZW5fZGF0YTsKICBtYW5pZmVzdF9tYXAgbV9vbGQsIG1f
d29ya2luZywgbV9jaG9zZW4sIG1fbmV3OwogIG1hbmlmZXN0X2lkIG1fb2xkX2lkLCBtX2No
b3Nlbl9pZDsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRiKTsKCiAgZ2V0X21h
bmlmZXN0X21hcChtX29sZCk7CiAgY2FsY3VsYXRlX21hbmlmZXN0X21hcF9pZGVudChtX29s
ZCwgbV9vbGRfaWQpOwogIGNhbGN1bGF0ZV9uZXdfbWFuaWZlc3RfbWFwKG1fb2xkLCBtX3dv
cmtpbmcpOwogIAogIHBpY2tfdXBkYXRlX3RhcmdldChtX29sZF9pZCwgYXJncywgYXBwLCBt
X2Nob3Nlbl9pZCk7CiAgUCgic2VsZWN0ZWQgdXBkYXRlIHRhcmdldCAlc1xuIiwKICAgIG1f
Y2hvc2VuX2lkLmlubmVyKCkoKS5jX3N0cigpKTsKICBhcHAuZGIuZ2V0X21hbmlmZXN0X3Zl
cnNpb24obV9jaG9zZW5faWQsIG1fY2hvc2VuX2RhdGEpOwogIHJlYWRfbWFuaWZlc3RfbWFw
KG1fY2hvc2VuX2RhdGEsIG1fY2hvc2VuKTsKCiAgdXBkYXRlX21lcmdlX3Byb3ZpZGVyIG1l
cmdlcihhcHApOwogIE4obWVyZ2UzKG1fb2xkLCBtX2Nob3NlbiwgbV93b3JraW5nLCBhcHAs
IG1lcmdlciwgbV9uZXcpLAogICAgc3RyaW5nKCJtYW5pZmVzdCBtZXJnZSBmYWlsZWQsIG5v
IHVwZGF0ZSBwZXJmb3JtZWQiKSk7CgogIFAoImNhbGN1bGF0aW5nIHBhdGNoc2V0IGZvciB1
cGRhdGVcbiIpOwogIHBhdGNoX3NldCBwczsKICBtYW5pZmVzdHNfdG9fcGF0Y2hfc2V0KG1f
d29ya2luZywgbV9uZXcsIGFwcCwgcHMpOwoKICBMKCJhcHBseWluZyAlZCBkZWxldGlvbnMg
dG8gZmlsZXMgaW4gdHJlZVxuIiwgcHMuZl9kZWxzLnNpemUoKSk7CiAgZm9yIChzZXQ8Zmls
ZV9wYXRoPjo6Y29uc3RfaXRlcmF0b3IgaSA9IHBzLmZfZGVscy5iZWdpbigpOwogICAgICAg
aSAhPSBwcy5mX2RlbHMuZW5kKCk7ICsraSkKICAgIHsKICAgICAgTCgiZGVsZXRpbmcgJXNc
biIsICgqaSkoKS5jX3N0cigpKTsKICAgICAgZGVsZXRlX2ZpbGUoKmkpOwogICAgfQoKICBM
KCJhcHBseWluZyAlZCBtb3ZlcyB0byBmaWxlcyBpbiB0cmVlXG4iLCBwcy5mX21vdmVzLnNp
emUoKSk7CiAgZm9yIChzZXQ8cGF0Y2hfbW92ZT46OmNvbnN0X2l0ZXJhdG9yIGkgPSBwcy5m
X21vdmVzLmJlZ2luKCk7CiAgICAgICBpICE9IHBzLmZfbW92ZXMuZW5kKCk7ICsraSkKICAg
IHsKICAgICAgTCgibW92aW5nICVzIC0+ICVzXG4iLCBpLT5wYXRoX29sZCgpLmNfc3RyKCks
IGktPnBhdGhfbmV3KCkuY19zdHIoKSk7CiAgICAgIG1vdmVfZmlsZShpLT5wYXRoX29sZCwg
aS0+cGF0aF9uZXcpOwogICAgfQogIAogIEwoImFwcGx5aW5nICVkIGFkZGl0aW9ucyB0byB0
cmVlXG4iLCBwcy5mX2FkZHMuc2l6ZSgpKTsKICBmb3IgKHNldDxwYXRjaF9hZGRpdGlvbj46
OmNvbnN0X2l0ZXJhdG9yIGkgPSBwcy5mX2FkZHMuYmVnaW4oKTsKICAgICAgIGkgIT0gcHMu
Zl9hZGRzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIEwoImFkZGluZyAlcyBhcyAlc1xuIiwg
aS0+aWRlbnQuaW5uZXIoKSgpLmNfc3RyKCksIGktPnBhdGgoKS5jX3N0cigpKTsKICAgICAg
ZmlsZV9kYXRhIHRtcDsKICAgICAgaWYgKGFwcC5kYi5maWxlX3ZlcnNpb25fZXhpc3RzKGkt
PmlkZW50KSkKCWFwcC5kYi5nZXRfZmlsZV92ZXJzaW9uKGktPmlkZW50LCB0bXApOwogICAg
ICBlbHNlIGlmIChtZXJnZXIudGVtcG9yYXJ5X3N0b3JlLmZpbmQoaS0+aWRlbnQpICE9IG1l
cmdlci50ZW1wb3Jhcnlfc3RvcmUuZW5kKCkpCgl0bXAgPSBtZXJnZXIudGVtcG9yYXJ5X3N0
b3JlW2ktPmlkZW50XTsKICAgICAgZWxzZQoJSShmYWxzZSk7IC8vIHRyaXAgYXNzZXJ0LiB0
aGlzIHNob3VsZCBiZSBpbXBvc3NpYmxlLgogICAgICB3cml0ZV9kYXRhKGktPnBhdGgsIHRt
cC5pbm5lcigpKTsKICAgIH0KCiAgTCgiYXBwbHlpbmcgJWQgZGVsdGFzIHRvIHRyZWVcbiIs
IHBzLmZfZGVsdGFzLnNpemUoKSk7CiAgZm9yIChzZXQ8cGF0Y2hfZGVsdGE+Ojpjb25zdF9p
dGVyYXRvciBpID0gcHMuZl9kZWx0YXMuYmVnaW4oKTsKICAgICAgIGkgIT0gcHMuZl9kZWx0
YXMuZW5kKCk7ICsraSkKICAgIHsKICAgICAgUCgidXBkYXRpbmcgZmlsZSAlczogJXMgLT4g
JXNcbiIsIAoJaS0+cGF0aCgpLmNfc3RyKCksCglpLT5pZF9vbGQuaW5uZXIoKSgpLmNfc3Ry
KCksCglpLT5pZF9uZXcuaW5uZXIoKSgpLmNfc3RyKCkpOwogICAgICAKICAgICAgLy8gc2Fu
aXR5IGNoZWNrCiAgICAgIHsKCWJhc2U2NDwgZ3ppcDxkYXRhPiA+IGR0bXA7CgloZXhlbmM8
aWQ+IGR0bXBfaWQ7CglyZWFkX2RhdGEoaS0+cGF0aCwgZHRtcCk7CgljYWxjdWxhdGVfaWRl
bnQoZHRtcCwgZHRtcF9pZCk7CglJKGR0bXBfaWQgPT0gaS0+aWRfb2xkLmlubmVyKCkpOwog
ICAgICB9CgogICAgICAvLyBvaywgcmVwbGFjZSB3aXRoIG5ldyB2ZXJzaW9uCiAgICAgIHsK
CWZpbGVfZGF0YSB0bXA7CglpZiAoYXBwLmRiLmZpbGVfdmVyc2lvbl9leGlzdHMoaS0+aWRf
bmV3KSkKCSAgYXBwLmRiLmdldF9maWxlX3ZlcnNpb24oaS0+aWRfbmV3LCB0bXApOwoJZWxz
ZSBpZiAobWVyZ2VyLnRlbXBvcmFyeV9zdG9yZS5maW5kKGktPmlkX25ldykgIT0gbWVyZ2Vy
LnRlbXBvcmFyeV9zdG9yZS5lbmQoKSkKCSAgdG1wID0gbWVyZ2VyLnRlbXBvcmFyeV9zdG9y
ZVtpLT5pZF9uZXddOwoJZWxzZQoJICBJKGZhbHNlKTsgLy8gdHJpcCBhc3NlcnQuIHRoaXMg
c2hvdWxkIGJlIGltcG9zc2libGUuCgl3cml0ZV9kYXRhKGktPnBhdGgsIHRtcC5pbm5lcigp
KTsKICAgICAgfQogICAgfQogIAogIEwoInVwZGF0ZSBzdWNjZXNzZnVsXG4iKTsKICBndWFy
ZC5jb21taXQoKTsKCiAgLy8gc21hbGwgcmFjZSBjb25kaXRpb24gaGVyZS4uLgogIC8vIG5i
OiB3ZSB3cml0ZSBvdXQgbV9jaG9zZW4sIG5vdCBtX25ldywgYmVjYXVzZSB0aGUgbWFuaWZl
c3Qtb24tZGlzawogIC8vIGlzIHRoZSBiYXNpcyBvZiB0aGUgd29ya2luZyBjb3B5LCBub3Qg
dGhlIHdvcmtpbmcgY29weSBpdHNlbGYuCiAgcHV0X21hbmlmZXN0X21hcChtX2Nob3Nlbik7
CiAgUCgidXBkYXRlZCB0byBiYXNlIHZlcnNpb24gJXNcbiIsIG1fY2hvc2VuX2lkLmlubmVy
KCkoKS5jX3N0cigpKTsKfQoKCgpDTUQoY2F0LCAidHJlZSIsICIoZmlsZXxtYW5pZmVzdCkg
PGlkPiIsICJ3cml0ZSBmaWxlIG9yIG1hbmlmZXN0IGZyb20gZGF0YWJhc2UgdG8gc3Rkb3V0
IikKewogIGlmIChhcmdzLnNpemUoKSAhPSAyKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7Cgog
IHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CgogIGlmIChhcmdzWzBdID09ICJm
aWxlIikKICAgIHsKICAgICAgZmlsZV9kYXRhIGRhdDsKICAgICAgZmlsZV9pZCBpZGVudChh
cmdzWzFdKTsKCiAgICAgIE4oYXBwLmRiLmZpbGVfdmVyc2lvbl9leGlzdHMoaWRlbnQpLAoJ
KHN0cmluZygibm8gZmlsZSB2ZXJzaW9uICIpICsgaWRlbnQuaW5uZXIoKSgpICsgIiBmb3Vu
ZCBpbiBkYXRhYmFzZSIpKTsKCiAgICAgIEwoImR1bXBpbmcgZmlsZSAlc1xuIiwgaWRlbnQu
aW5uZXIoKSgpLmNfc3RyKCkpOwogICAgICBhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lvbihpZGVu
dCwgZGF0KTsKICAgICAgZGF0YSB1bnBhY2tlZDsKICAgICAgdW5wYWNrKGRhdC5pbm5lcigp
LCB1bnBhY2tlZCk7CiAgICAgIGNvdXQud3JpdGUodW5wYWNrZWQoKS5kYXRhKCksIHVucGFj
a2VkKCkuc2l6ZSgpKTsKCiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAibWFuaWZlc3Qi
KQogICAgewogICAgICBtYW5pZmVzdF9kYXRhIGRhdDsKICAgICAgbWFuaWZlc3RfaWQgaWRl
bnQoYXJnc1sxXSk7CgogICAgICBOKGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9uX2V4aXN0cyhp
ZGVudCksCgkoc3RyaW5nKCJubyBmaWxlIHZlcnNpb24gIikgKyBpZGVudC5pbm5lcigpKCkg
KyAiIGZvdW5kIGluIGRhdGFiYXNlIikpOwoKICAgICAgTCgiZHVtcGluZyBtYW5pZmVzdCAl
c1xuIiwgaWRlbnQuaW5uZXIoKSgpLmNfc3RyKCkpOwogICAgICBhcHAuZGIuZ2V0X21hbmlm
ZXN0X3ZlcnNpb24oaWRlbnQsIGRhdCk7CiAgICAgIGRhdGEgdW5wYWNrZWQ7CiAgICAgIHVu
cGFjayhkYXQuaW5uZXIoKSwgdW5wYWNrZWQpOwogICAgICBjb3V0LndyaXRlKHVucGFja2Vk
KCkuZGF0YSgpLCB1bnBhY2tlZCgpLnNpemUoKSk7CiAgICB9CiAgZWxzZSAKICAgIHRocm93
IHVzYWdlKG5hbWUpOwoKICBndWFyZC5jb21taXQoKTsKfQoKCkNNRChjaGVja291dCwgInRy
ZWUiLCAiPG1hbmlmZXN0LWlkPiIsICJjaGVjayBvdXQgdHJlZSBzdGF0ZSBmcm9tIGRhdGFi
YXNlIikKewogIGlmIChhcmdzLnNpemUoKSAhPSAxKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7
CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CgogIGZpbGVfZGF0YSBkYXRh
OwogIG1hbmlmZXN0X2lkIGlkZW50KGFyZ3NbMF0pOwogIG1hbmlmZXN0X21hcCBtOwoKICBO
KGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9uX2V4aXN0cyhpZGVudCksCiAgICAoc3RyaW5nKCJu
byBtYW5pZmVzdCB2ZXJzaW9uICIpICsgaWRlbnQuaW5uZXIoKSgpICsgIiBmb3VuZCBpbiBk
YXRhYmFzZSIpKTsKICAKICBMKCJleHBvcnRpbmcgbWFuaWZlc3QgJXNcbiIsIGlkZW50Lmlu
bmVyKCkoKS5jX3N0cigpKTsKICBtYW5pZmVzdF9kYXRhIG1fZGF0YTsKICBhcHAuZGIuZ2V0
X21hbmlmZXN0X3ZlcnNpb24oaWRlbnQsIG1fZGF0YSk7CiAgcmVhZF9tYW5pZmVzdF9tYXAo
bV9kYXRhLCBtKTsgICAgICAKICBwdXRfbWFuaWZlc3RfbWFwKG0pOwogIAogIGZvciAobWFu
aWZlc3RfbWFwOjpjb25zdF9pdGVyYXRvciBpID0gbS5iZWdpbigpOyBpICE9IG0uZW5kKCk7
ICsraSkKICAgIHsKICAgICAgdmVjdG9yPHN0cmluZz4gYXJnczsKICAgICAgcGF0aF9pZF9w
YWlyIHBpcCgqaSk7CiAgICAgIAogICAgICBOKGFwcC5kYi5maWxlX3ZlcnNpb25fZXhpc3Rz
KHBpcC5pZGVudCgpKSwKCShzdHJpbmcoIm5vIGZpbGUgdmVyc2lvbiAiKQoJICsgcGlwLmlk
ZW50KCkuaW5uZXIoKSgpIAoJICsgIiBmb3VuZCBpbiBkYXRhYmFzZSBmb3IgIgoJICsgcGlw
LnBhdGgoKSgpLmNfc3RyKCkpKTsKICAgICAgCiAgICAgIGZpbGVfZGF0YSBkYXQ7CiAgICAg
IEwoIndyaXRpbmcgZmlsZSAlcyB0byAlc1xuIiwgCglwaXAuaWRlbnQoKS5pbm5lcigpKCku
Y19zdHIoKSwKCXBpcC5wYXRoKCkoKS5jX3N0cigpKTsKICAgICAgYXBwLmRiLmdldF9maWxl
X3ZlcnNpb24ocGlwLmlkZW50KCksIGRhdCk7CiAgICAgIHdyaXRlX2RhdGEocGlwLnBhdGgo
KSwgZGF0LmlubmVyKCkpOwogICAgfQoKICBndWFyZC5jb21taXQoKTsKfQoKQUxJQVMoY28s
IGNoZWNrb3V0LCAidHJlZSIsICI8bWFuaWZlc3QtaWQ+IiwKICAgICAgImNoZWNrIG91dCB0
cmVlIHN0YXRlIGZyb20gZGF0YWJhc2U7IGFsaWFzIGZvciBjaGVja291dCIpCgpDTUQoaGVh
ZHMsICJ0cmVlIiwgIiIsICJzaG93IHVubWVyZ2VkIGhlYWRzIG9mIGJyYW5jaCIpCnsKICB2
ZWN0b3I8bWFuaWZlc3RfaWQ+IGhlYWRzOwogIGlmIChhcmdzLnNpemUoKSAhPSAwKQogICAg
dGhyb3cgdXNhZ2UobmFtZSk7CgogIGlmIChhcHAuYnJhbmNoX25hbWUgPT0gIiIpCiAgICB7
CiAgICAgIGNvdXQgPDwgInBsZWFzZSBzcGVjaWZ5IGEgYnJhbmNoLCB3aXRoIC0tYnJhbmNo
PTxicmFuY2huYW1lPiIgPDwgZW5kbDsKICAgICAgcmV0dXJuOwogICAgfQoKICBnZXRfYnJh
bmNoX2hlYWRzKGFwcC5icmFuY2hfbmFtZSwgYXBwLCBoZWFkcyk7CgogIGlmIChoZWFkcy5z
aXplKCkgPT0gMCkKICAgIGNvdXQgPDwgImJyYW5jaCAnIiA8PCBhcHAuYnJhbmNoX25hbWUg
PDwgIicgaXMgZW1wdHkiIDw8IGVuZGw7CiAgZWxzZSBpZiAoaGVhZHMuc2l6ZSgpID09IDEp
CiAgICBjb3V0IDw8ICJicmFuY2ggJyIgPDwgYXBwLmJyYW5jaF9uYW1lIDw8ICInIGlzIGN1
cnJlbnRseSBtZXJnZWQ6IiA8PCBlbmRsOwogIGVsc2UKICAgIGNvdXQgPDwgImJyYW5jaCAn
IiA8PCBhcHAuYnJhbmNoX25hbWUgPDwgIicgaXMgY3VycmVudGx5IHVubWVyZ2VkOiIgPDwg
ZW5kbDsKCiAgZm9yICh2ZWN0b3I8bWFuaWZlc3RfaWQ+Ojpjb25zdF9pdGVyYXRvciBpID0g
aGVhZHMuYmVnaW4oKTsgCiAgICAgICBpICE9IGhlYWRzLmVuZCgpOyArK2kpCiAgICB7CiAg
ICAgIGNvdXQgPDwgaS0+aW5uZXIoKSgpIDw8IGVuZGw7CiAgICB9Cn0KCgpDTUQobWVyZ2Us
ICJ0cmVlIiwgIiIsICJtZXJnZSB1bm1lcmdlZCBoZWFkcyBvZiBicmFuY2giKQp7CgogIHZl
Y3RvcjxtYW5pZmVzdF9pZD4gaGVhZHM7CgogIGlmIChhcmdzLnNpemUoKSAhPSAwKQogICAg
dGhyb3cgdXNhZ2UobmFtZSk7CgogIGlmIChhcHAuYnJhbmNoX25hbWUgPT0gIiIpCiAgICB7
CiAgICAgIGNvdXQgPDwgInBsZWFzZSBzcGVjaWZ5IGEgYnJhbmNoLCB3aXRoIC0tYnJhbmNo
PTxicmFuY2huYW1lPiIgPDwgZW5kbDsKICAgICAgcmV0dXJuOwogICAgfQoKICBnZXRfYnJh
bmNoX2hlYWRzKGFwcC5icmFuY2hfbmFtZSwgYXBwLCBoZWFkcyk7CgogIGlmIChoZWFkcy5z
aXplKCkgPT0gMCkKICAgIHsKICAgICAgY291dCA8PCAiYnJhbmNoICIgPDwgYXJnc1swXSA8
PCAiaXMgZW1wdHkiIDw8IGVuZGw7CiAgICAgIHJldHVybjsKICAgIH0KICBlbHNlIGlmICho
ZWFkcy5zaXplKCkgPT0gMSkKICAgIHsKICAgICAgY291dCA8PCAiYnJhbmNoICIgPDwgYXJn
c1swXSA8PCAiaXMgbWVyZ2VkIiA8PCBlbmRsOwogICAgICByZXR1cm47CiAgICB9CiAgZWxz
ZQogICAgewogICAgICB2ZWN0b3I8IHBhaXI8dXJsLGdyb3VwPiA+IHRhcmdldHM7CiAgICAg
IGFwcC5sdWEuaG9va19nZXRfcG9zdF90YXJnZXRzKGFwcC5icmFuY2hfbmFtZSwgdGFyZ2V0
cyk7CgogICAgICBtYW5pZmVzdF9pZCBsZWZ0ID0gaGVhZHNbMF07CiAgICAgIG1hbmlmZXN0
X2lkIGFuY2VzdG9yOwogICAgICBmb3IgKHNpemVfdCBpID0gMTsgaSA8IGhlYWRzLnNpemUo
KTsgKytpKQoJewoJICBtYW5pZmVzdF9pZCByaWdodCA9IGhlYWRzW2ldOwoJICBQKCJtZXJn
aW5nIHdpdGggbWFuaWZlc3QgJWQgLyAlZDogJXMgPC0+ICVzXG4iLAoJICAgIGksIGhlYWRz
LnNpemUoKSwKCSAgICBsZWZ0LmlubmVyKCkoKS5jX3N0cigpLCByaWdodC5pbm5lcigpKCku
Y19zdHIoKSk7CgoJICBtYW5pZmVzdF9pZCBtZXJnZWQ7CgkgIHRyYW5zYWN0aW9uX2d1YXJk
IGd1YXJkKGFwcC5kYik7CgkgIHRyeV9vbmVfbWVyZ2UgKGxlZnQsIHJpZ2h0LCBtZXJnZWQs
IGFwcCwgdGFyZ2V0cyk7CgkgIAkgIAoJICAvLyBtZXJnZWQgMSBlZGdlOyBub3cgd2UgY29t
bWl0IHRoaXMsIHVwZGF0ZSBtZXJnZSBzb3VyY2UgYW5kCgkgIC8vIHRyeSBuZXh0IG9uZQoK
CSAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsKCSAgcXVldWVpbmdfcGFja2V0X3dyaXRl
ciBxcHcoYXBwLCB0YXJnZXRzKTsKCSAgY2VydF9tYW5pZmVzdF9pbl9icmFuY2gobWVyZ2Vk
LCBhcHAuYnJhbmNoX25hbWUsIGFwcCwgZGJ3KTsKCSAgY2VydF9tYW5pZmVzdF9pbl9icmFu
Y2gobWVyZ2VkLCBhcHAuYnJhbmNoX25hbWUsIGFwcCwgcXB3KTsKCgkgIHN0cmluZyBsb2cg
PSAibWVyZ2Ugb2YgIiArIGxlZnQuaW5uZXIoKSgpICsgIiBhbmQgIiArIHJpZ2h0LmlubmVy
KCkoKTsKCSAgY2VydF9tYW5pZmVzdF9jaGFuZ2Vsb2cobWVyZ2VkLCBsb2csIGFwcCwgZGJ3
KTsKCSAgY2VydF9tYW5pZmVzdF9jaGFuZ2Vsb2cobWVyZ2VkLCBsb2csIGFwcCwgcXB3KTsK
CSAgCgkgIGd1YXJkLmNvbW1pdCgpOwoJICBQKCJbc291cmNlXSAlc1xuW3NvdXJjZV0gJXNc
blttZXJnZWRdICVzXG4iLAoJICAgIGxlZnQuaW5uZXIoKSgpLmNfc3RyKCksCgkgICAgcmln
aHQuaW5uZXIoKSgpLmNfc3RyKCksCgkgICAgbWVyZ2VkLmlubmVyKCkoKS5jX3N0cigpKTsK
CSAgbGVmdCA9IG1lcmdlZDsKCX0KICAgIH0gIAp9CgoKQ01EKHByb3BhZ2F0ZSwgInRyZWUi
LCAiPHNyYy1icmFuY2g+IDxkc3QtYnJhbmNoPiIsIAogICAgIm1lcmdlIGZyb20gb25lIGJy
YW5jaCB0byBhbm90aGVyIGFzeW1tZXRyaWNhbGx5IikKewogIC8qICAKCiAgdGhpcyBpcyBh
IHNwZWNpYWwgbWVyZ2Ugb3BlcmF0b3IsIGJ1dCB2ZXJ5IHVzZWZ1bCBmb3IgcGVvcGxlIG1h
aW50YWluaW5nCiAgInNsaWdodGx5IGRpc3BhcmF0ZSBidXQgcmVsYXRlZCIgdHJlZXMuIGl0
IGRvZXMgYSBvbmUtd2F5IG1lcmdlOyBsZXNzCiAgcG93ZXJmdWwgdGhhbiBwdXR0aW5nIHRo
aW5ncyBpbiB0aGUgc2FtZSBicmFuY2ggYW5kIGFsc28gbW9yZSBmbGV4aWJsZS4KCiAgMS4g
Y2hlY2sgdG8gc2VlIGlmIHNyYyBhbmQgZHN0IGJyYW5jaGVzIGFyZSBtZXJnZWQsIGlmIG5v
dCBhYm9ydCwgaWYgc28KICAgICBjYWxsIGhlYWRzIE4xIGFuZCBOMiByZXNwZWN0aXZlbHku
CgogIDIuIChGSVhNRTogbm90IHlldCBwcmVzZW50KSBydW4gdGhlIGhvb2sgcHJvcGFnYXRl
ICgic3JjLWJyYW5jaCIsCiAgICAgImRzdC1icmFuY2giLCBOMSwgTjIpIHdoaWNoIGdpdmVz
IHRoZSB1c2VyIGEgY2hhbmNlIHRvIG1hc3NhZ2UgTjEgaW50bwogICAgIGEgc3RhdGUgd2hp
Y2ggaXMgbGlrZWx5IHRvICJtZXJnZSBuaWNlbHkiIHdpdGggTjIsIGVnLiBlZGl0IHBhdGhu
YW1lcywKICAgICBvbWl0IG9wdGlvbmFsIGZpbGVzIG9mIG5vIGludGVyZXN0LgoKICAzLiBk
byBhIG5vcm1hbCAyIG9yIDMtd2F5IG1lcmdlIG9uIE4xIGFuZCBOMiwgZGVwZW5kaW5nIG9u
IHRoZQogICAgIGV4aXN0ZW5jZSBvZiBjb21tb24gYW5jZXN0b3JzLgoKICA0LiBzYXZlIHRo
ZSByZXN1bHRzIGFzIHRoZSBkZWx0YSAoTjIsTSksIHRoZSBhbmNlc3RyeSBlZGdlcyAoTjEs
TSkKICAgICBhbmQgKE4yLE0pLCBhbmQgdGhlIGNlcnQgKE4yLGRzdCkuCgogIDUuIHF1ZXVl
IHRoZSByZXN1bHRpbmcgcGFja2V0cyB0byBzZW5kIHRvIHRoZSB1cmwgZm9yIGRzdC1icmFu
Y2gsIG5vdAogICAgIHNyYy1icmFuY2guCgogICovCgogIHZlY3RvcjxtYW5pZmVzdF9pZD4g
c3JjX2hlYWRzLCBkc3RfaGVhZHM7CgogIGlmIChhcmdzLnNpemUoKSAhPSAyKQogICAgdGhy
b3cgdXNhZ2UobmFtZSk7CgogIGdldF9icmFuY2hfaGVhZHMoYXJnc1swXSwgYXBwLCBzcmNf
aGVhZHMpOwogIGdldF9icmFuY2hfaGVhZHMoYXJnc1sxXSwgYXBwLCBkc3RfaGVhZHMpOwoK
ICBpZiAoc3JjX2hlYWRzLnNpemUoKSA9PSAwKQogICAgewogICAgICBjb3V0IDw8ICJicmFu
Y2ggIiA8PCBhcmdzWzBdIDw8ICJpcyBlbXB0eSIgPDwgZW5kbDsKICAgICAgcmV0dXJuOwog
ICAgfQogIGVsc2UgaWYgKHNyY19oZWFkcy5zaXplKCkgIT0gMSkKICAgIHsKICAgICAgY291
dCA8PCAiYnJhbmNoICIgPDwgYXJnc1swXSA8PCAiaXMgbm90IG1lcmdlZCIgPDwgZW5kbDsK
ICAgICAgcmV0dXJuOwogICAgfQogIGVsc2UgaWYgKGRzdF9oZWFkcy5zaXplKCkgPT0gMCkK
ICAgIHsKICAgICAgY291dCA8PCAiYnJhbmNoICIgPDwgYXJnc1sxXSA8PCAiaXMgZW1wdHki
IDw8IGVuZGw7CiAgICAgIHJldHVybjsKICAgIH0KICBlbHNlIGlmIChkc3RfaGVhZHMuc2l6
ZSgpICE9IDEpCiAgICB7CiAgICAgIGNvdXQgPDwgImJyYW5jaCAiIDw8IGFyZ3NbMV0gPDwg
ImlzIG5vdCBtZXJnZWQiIDw8IGVuZGw7CiAgICAgIHJldHVybjsKICAgIH0KICBlbHNlCiAg
ICB7CiAgICAgIHZlY3RvcjwgcGFpcjx1cmwsZ3JvdXA+ID4gdGFyZ2V0czsKICAgICAgYXBw
Lmx1YS5ob29rX2dldF9wb3N0X3RhcmdldHMoYXJnc1sxXSwgdGFyZ2V0cyk7CgogICAgICBt
YW5pZmVzdF9pZCBtZXJnZWQ7CiAgICAgIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5k
Yik7CiAgICAgIHRyeV9vbmVfbWVyZ2UgKHNyY19oZWFkc1swXSwgZHN0X2hlYWRzWzBdLCBt
ZXJnZWQsIGFwcCwgdGFyZ2V0cyk7ICAgICAgCgogICAgICBxdWV1ZWluZ19wYWNrZXRfd3Jp
dGVyIHFwdyhhcHAsIHRhcmdldHMpOwogICAgICBjZXJ0X21hbmlmZXN0X2luX2JyYW5jaCht
ZXJnZWQsIGFwcC5icmFuY2hfbmFtZSwgYXBwLCBxcHcpOwogICAgICBjZXJ0X21hbmlmZXN0
X2NoYW5nZWxvZyhtZXJnZWQsIAoJCQkgICAgICAicHJvcGFnYXRlIG9mICIgCgkJCSAgICAg
ICsgc3JjX2hlYWRzWzBdLmlubmVyKCkoKSAKCQkJICAgICAgKyAiIGFuZCAiIAoJCQkgICAg
ICArIGRzdF9oZWFkc1swXS5pbm5lcigpKCkKCQkJICAgICAgKyAiXG4iCgkJCSAgICAgICsg
ImZyb20gYnJhbmNoICIgCgkJCSAgICAgICsgYXJnc1swXSArICIgdG8gIiArIGFyZ3NbMV0g
KyAiXG4iLCAKCQkJICAgICAgYXBwLCBxcHcpOwkgIAogICAgICBndWFyZC5jb21taXQoKTsg
ICAgICAKICAgIH0KfQoKCgpDTUQoZGlmZiwgImluZm9ybWF0aXZlIiwgIiIsICJzaG93IGN1
cnJlbnQgZGlmZnMgb24gc3Rkb3V0IikKewogIG1hbmlmZXN0X21hcCBtX29sZCwgbV9uZXc7
CiAgcGF0Y2hfc2V0IHBzOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwoK
ICBnZXRfbWFuaWZlc3RfbWFwKG1fb2xkKTsKICBjYWxjdWxhdGVfbmV3X21hbmlmZXN0X21h
cChtX29sZCwgbV9uZXcpOwogIG1hbmlmZXN0c190b19wYXRjaF9zZXQobV9vbGQsIG1fbmV3
LCBhcHAsIHBzKTsKCiAgZm9yIChzZXQ8cGF0Y2hfZGVsdGE+Ojpjb25zdF9pdGVyYXRvciBp
ID0gcHMuZl9kZWx0YXMuYmVnaW4oKTsKICAgICAgIGkgIT0gcHMuZl9kZWx0YXMuZW5kKCk7
ICsraSkKICAgIHsKICAgICAgZmlsZV9kYXRhIGZfb2xkOwogICAgICBnemlwPGRhdGE+IGRl
Y29kZWRfb2xkOwogICAgICBkYXRhIGRlY29tcHJlc3NlZF9vbGQsIGRlY29tcHJlc3NlZF9u
ZXc7CiAgICAgIHZlY3RvcjxzdHJpbmc+IG9sZF9saW5lcywgbmV3X2xpbmVzOwoKICAgICAg
YXBwLmRiLmdldF9maWxlX3ZlcnNpb24oaS0+aWRfb2xkLCBmX29sZCk7CiAgICAgIGRlY29k
ZV9iYXNlNjQoZl9vbGQuaW5uZXIoKSwgZGVjb2RlZF9vbGQpOwogICAgICBkZWNvZGVfZ3pp
cChkZWNvZGVkX29sZCwgZGVjb21wcmVzc2VkX29sZCk7CgogICAgICByZWFkX2RhdGEoaS0+
cGF0aCwgZGVjb21wcmVzc2VkX25ldyk7CgogICAgICBzcGxpdF9pbnRvX2xpbmVzKGRlY29t
cHJlc3NlZF9vbGQoKSwgb2xkX2xpbmVzKTsKICAgICAgc3BsaXRfaW50b19saW5lcyhkZWNv
bXByZXNzZWRfbmV3KCksIG5ld19saW5lcyk7CgogICAgICB1bmlkaWZmKGktPnBhdGgoKSwg
aS0+cGF0aCgpLCBvbGRfbGluZXMsIG5ld19saW5lcywgY291dCk7CiAgICB9ICAKICBndWFy
ZC5jb21taXQoKTsKfQoKQ01EKHN0YXR1cywgImluZm9ybWF0aXZlIiwgIiIsICJzaG93IHN0
YXR1cyBvZiB3b3JraW5nIGNvcHkiKQp7CiAgbWFuaWZlc3RfbWFwIG1fb2xkLCBtX25ldzsK
ICBwYXRjaF9zZXQgcHM7CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CiAg
Z2V0X21hbmlmZXN0X21hcChtX29sZCk7CiAgY2FsY3VsYXRlX25ld19tYW5pZmVzdF9tYXAo
bV9vbGQsIG1fbmV3KTsKICBtYW5pZmVzdHNfdG9fcGF0Y2hfc2V0KG1fb2xkLCBtX25ldywg
YXBwLCBwcyk7CiAgcGF0Y2hfc2V0X3RvX3RleHRfc3VtbWFyeShwcywgY291dCk7CiAgZ3Vh
cmQuY29tbWl0KCk7Cn0KCgpDTUQobWRlbHRhLCAicGFja2V0IGkvbyIsICI8b2xkaWQ+IDxu
ZXdpZD4iLCAid3JpdGUgbWFuaWZlc3QgZGVsdGEgcGFja2V0IHRvIHN0ZG91dCIpCnsKICBp
ZiAoYXJncy5zaXplKCkgIT0gMikKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICB0cmFuc2Fj
dGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwogIHBhY2tldF93cml0ZXIgcHcoY291dCk7Cgog
IG1hbmlmZXN0X2lkIG1fb2xkX2lkLCBtX25ld19pZDsgCiAgbWFuaWZlc3RfZGF0YSBtX29s
ZF9kYXRhLCBtX25ld19kYXRhOwogIG1hbmlmZXN0X21hcCBtX29sZCwgbV9uZXc7CiAgcGF0
Y2hfc2V0IHBzOyAgICAgIAogIG1fb2xkX2lkID0gaGV4ZW5jPGlkPihhcmdzWzBdKTsgCiAg
bV9uZXdfaWQgPSBoZXhlbmM8aWQ+KGFyZ3NbMV0pOwogIGFwcC5kYi5nZXRfbWFuaWZlc3Rf
dmVyc2lvbihtX29sZF9pZCwgbV9vbGRfZGF0YSk7CiAgYXBwLmRiLmdldF9tYW5pZmVzdF92
ZXJzaW9uKG1fbmV3X2lkLCBtX25ld19kYXRhKTsKICByZWFkX21hbmlmZXN0X21hcChtX29s
ZF9kYXRhLCBtX29sZCk7CiAgcmVhZF9tYW5pZmVzdF9tYXAobV9uZXdfZGF0YSwgbV9uZXcp
OwogIG1hbmlmZXN0c190b19wYXRjaF9zZXQobV9vbGQsIG1fbmV3LCBhcHAsIHBzKTsKICBw
YXRjaF9zZXRfdG9fcGFja2V0cyhwcywgYXBwLCBwdyk7ICAKICBndWFyZC5jb21taXQoKTsK
fQoKQ01EKGZkZWx0YSwgInBhY2tldCBpL28iLCAiPG9sZGlkPiA8bmV3aWQ+IiwgIndyaXRl
IGZpbGUgZGVsdGEgcGFja2V0IHRvIHN0ZG91dCIpCnsKICBpZiAoYXJncy5zaXplKCkgIT0g
MikKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChh
cHAuZGIpOwogIHBhY2tldF93cml0ZXIgcHcoY291dCk7CgogIGZpbGVfaWQgZl9vbGRfaWQs
IGZfbmV3X2lkOwogIGZpbGVfZGF0YSBmX29sZF9kYXRhLCBmX25ld19kYXRhOwogIGZfb2xk
X2lkID0gaGV4ZW5jPGlkPihhcmdzWzBdKTsKICBmX25ld19pZCA9IGhleGVuYzxpZD4oYXJn
c1sxXSk7ICAgICAKICBhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lvbihmX29sZF9pZCwgZl9vbGRf
ZGF0YSk7CiAgYXBwLmRiLmdldF9maWxlX3ZlcnNpb24oZl9uZXdfaWQsIGZfbmV3X2RhdGEp
OwogIGJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBkZWw7CiAgZGlmZihmX29sZF9kYXRhLmlubmVy
KCksIGZfbmV3X2RhdGEuaW5uZXIoKSwgZGVsKTsKICBwdy5jb25zdW1lX2ZpbGVfZGVsdGEo
Zl9vbGRfaWQsIGZfbmV3X2lkLCBmaWxlX2RlbHRhKGRlbCkpOyAgCiAgZ3VhcmQuY29tbWl0
KCk7Cn0KCkNNRChtZGF0YSwgInBhY2tldCBpL28iLCAiPGlkPiIsICJ3cml0ZSBtYW5pZmVz
dCBkYXRhIHBhY2tldCB0byBzdGRvdXQiKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDEpCiAg
ICB0aHJvdyB1c2FnZShuYW1lKTsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRi
KTsKICBwYWNrZXRfd3JpdGVyIHB3KGNvdXQpOwoKICBtYW5pZmVzdF9pZCBtX2lkOwogIG1h
bmlmZXN0X2RhdGEgbV9kYXRhOwogIG1faWQgPSBoZXhlbmM8aWQ+KGFyZ3NbMF0pOwogIGFw
cC5kYi5nZXRfbWFuaWZlc3RfdmVyc2lvbihtX2lkLCBtX2RhdGEpOwogIHB3LmNvbnN1bWVf
bWFuaWZlc3RfZGF0YShtX2lkLCBtX2RhdGEpOyAgCiAgZ3VhcmQuY29tbWl0KCk7Cn0KCgpD
TUQoZmRhdGEsICJwYWNrZXQgaS9vIiwgIjxpZD4iLCAid3JpdGUgZmlsZSBkYXRhIHBhY2tl
dCB0byBzdGRvdXQiKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDEpCiAgICB0aHJvdyB1c2Fn
ZShuYW1lKTsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRiKTsKICBwYWNrZXRf
d3JpdGVyIHB3KGNvdXQpOwoKICBmaWxlX2lkIGZfaWQ7CiAgZmlsZV9kYXRhIGZfZGF0YTsK
ICBmX2lkID0gaGV4ZW5jPGlkPihhcmdzWzBdKTsKICBhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lv
bihmX2lkLCBmX2RhdGEpOwogIHB3LmNvbnN1bWVfZmlsZV9kYXRhKGZfaWQsIGZfZGF0YSk7
ICAKICBndWFyZC5jb21taXQoKTsKfQoKQ01EKG1jZXJ0cywgInBhY2tldCBpL28iLCAiPGlk
PiIsICJ3cml0ZSBtYW5pZmVzdCBjZXJ0IHBhY2tldHMgdG8gc3Rkb3V0IikKewogIGlmIChh
cmdzLnNpemUoKSAhPSAxKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7CgogIHRyYW5zYWN0aW9u
X2d1YXJkIGd1YXJkKGFwcC5kYik7CiAgcGFja2V0X3dyaXRlciBwdyhjb3V0KTsKCiAgbWFu
aWZlc3RfaWQgbV9pZDsKICB2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID4gY2VydHM7CgogIG1f
aWQgPSBoZXhlbmM8aWQ+KGFyZ3NbMF0pOwogIGFwcC5kYi5nZXRfbWFuaWZlc3RfY2VydHMo
bV9pZCwgY2VydHMpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgY2VydHMuc2l6ZSgpOyAr
K2kpCiAgICBwdy5jb25zdW1lX21hbmlmZXN0X2NlcnQoY2VydHNbaV0pOwogIGd1YXJkLmNv
bW1pdCgpOwp9CgpDTUQoZmNlcnRzLCAicGFja2V0IGkvbyIsICI8aWQ+IiwgIndyaXRlIGZp
bGUgY2VydCBwYWNrZXRzIHRvIHN0ZG91dCIpCnsKICBpZiAoYXJncy5zaXplKCkgIT0gMSkK
ICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAu
ZGIpOwogIHBhY2tldF93cml0ZXIgcHcoY291dCk7CgogIGZpbGVfaWQgZl9pZDsKICB2ZWN0
b3I8IGZpbGU8Y2VydD4gPiBjZXJ0czsKCiAgZl9pZCA9IGhleGVuYzxpZD4oYXJnc1swXSk7
CiAgYXBwLmRiLmdldF9maWxlX2NlcnRzKGZfaWQsIGNlcnRzKTsKICBmb3IgKHNpemVfdCBp
ID0gMDsgaSA8IGNlcnRzLnNpemUoKTsgKytpKQogICAgcHcuY29uc3VtZV9maWxlX2NlcnQo
Y2VydHNbaV0pOwogIGd1YXJkLmNvbW1pdCgpOwp9CgpDTUQocHVia2V5LCAicGFja2V0IGkv
byIsICI8aWQ+IiwgIndyaXRlIHB1YmxpYyBrZXkgcGFja2V0IHRvIHN0ZG91dCIpCnsKICBp
ZiAoYXJncy5zaXplKCkgIT0gMSkKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICB0cmFuc2Fj
dGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwogIHBhY2tldF93cml0ZXIgcHcoY291dCk7CiAg
cnNhX2tleXBhaXJfaWQgaWRlbnQoYXJnc1swXSk7CiAgYmFzZTY0PCByc2FfcHViX2tleSA+
IGtleTsKICBhcHAuZGIuZ2V0X2tleShpZGVudCwga2V5KTsKICBwdy5jb25zdW1lX3B1Ymxp
Y19rZXkoaWRlbnQsIGtleSk7CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCkNNRChwcml2a2V5LCAi
cGFja2V0IGkvbyIsICI8aWQ+IiwgIndyaXRlIHByaXZhdGUga2V5IHBhY2tldCB0byBzdGRv
dXQiKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDEpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsK
CiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRiKTsKICBwYWNrZXRfd3JpdGVyIHB3
KGNvdXQpOwogIHJzYV9rZXlwYWlyX2lkIGlkZW50KGFyZ3NbMF0pOwogIGJhc2U2NDwgYXJj
NDxyc2FfcHJpdl9rZXk+ID4ga2V5OwogIGFwcC5kYi5nZXRfa2V5KGlkZW50LCBrZXkpOwog
IHB3LmNvbnN1bWVfcHJpdmF0ZV9rZXkoaWRlbnQsIGtleSk7CiAgZ3VhcmQuY29tbWl0KCk7
Cn0KCgpDTUQocmVhZCwgInBhY2tldCBpL28iLCAiIiwgInJlYWQgcGFja2V0cyBmcm9tIHN0
ZGluIikKewogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CiAgcGFja2V0X2Ri
X3dyaXRlciBkYncoYXBwLCB0cnVlKTsKICBzaXplX3QgY291bnQgPSByZWFkX3BhY2tldHMo
Y2luLCBkYncpOwogIE4oY291bnQgIT0gMCwgIm5vIHBhY2tldHMgZm91bmQgb24gc3RkaW4i
KTsKICBpZiAoY291bnQgPT0gMSkKICAgIFAoInJlYWQgMSBwYWNrZXRcbiIpOwogIGVsc2UK
ICAgIFAoInJlYWQgJWQgcGFja2V0c1xuIiwgY291bnQpOwogIGd1YXJkLmNvbW1pdCgpOwp9
CgoKQ01EKGFncmFwaCwgImdyYXBoIHZpc3VhbGl6YXRpb24iLCAiIiwgImR1bXAgYW5jZXN0
cnkgZ3JhcGggdG8gc3Rkb3V0IikKewogIHZlY3RvcjwgbWFuaWZlc3Q8Y2VydD4gPiBjZXJ0
czsKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwogIGFwcC5kYi5nZXRfbWFu
aWZlc3RfY2VydHMoYW5jZXN0b3JfY2VydF9uYW1lLCBjZXJ0cyk7CiAgc2V0PHN0cmluZz4g
bm9kZXM7CiAgdmVjdG9yPCBwYWlyPHN0cmluZywgc3RyaW5nPiA+IGVkZ2VzOwogIGZvcih2
ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID46Oml0ZXJhdG9yIGkgPSBjZXJ0cy5iZWdpbigpOwog
ICAgICBpICE9IGNlcnRzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIGNlcnRfdmFsdWUgdHY7
CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1ZSwgdHYpOwogICAgICBub2Rl
cy5pbnNlcnQodHYoKSk7CiAgICAgIG5vZGVzLmluc2VydChpLT5pbm5lcigpLmlkZW50KCkp
OwogICAgICBlZGdlcy5wdXNoX2JhY2sobWFrZV9wYWlyKHR2KCksIGktPmlubmVyKCkuaWRl
bnQoKSkpOwogICAgfQogIGNvdXQgPDwgImdyYXBoOiAiIDw8IGVuZGwgPDwgInsiIDw8IGVu
ZGw7IC8vIG9wZW4gZ3JhcGgKICBmb3IgKHNldDxzdHJpbmc+OjppdGVyYXRvciBpID0gbm9k
ZXMuYmVnaW4oKTsgaSAhPSBub2Rlcy5lbmQoKTsKICAgICAgICsraSkKICAgIHsKICAgICAg
Y291dCA8PCAibm9kZTogeyB0aXRsZSA6IFwiIiA8PCAqaSA8PCAiXCJ9IiA8PCBlbmRsOwog
ICAgfQogIGZvciAodmVjdG9yPCBwYWlyPHN0cmluZyxzdHJpbmc+ID46Oml0ZXJhdG9yIGkg
PSBlZGdlcy5iZWdpbigpOyBpICE9IGVkZ2VzLmVuZCgpOwogICAgICAgKytpKQogICAgewog
ICAgICBjb3V0IDw8ICJlZGdlOiB7IHNvdXJjZW5hbWUgOiBcIiIgPDwgaS0+Zmlyc3QgPDwg
IlwiIiA8PCBlbmRsCgkgICA8PCAiICAgICAgICB0YXJnZXRuYW1lIDogXCIiIDw8IGktPnNl
Y29uZCA8PCAiXCIgfSIgPDwgZW5kbDsKICAgIH0KICBjb3V0IDw8ICJ9IiA8PCBlbmRsIDw8
IGVuZGw7IC8vIGNsb3NlIGdyYXBoCiAgZ3VhcmQuY29tbWl0KCk7Cn0KCkNNRChmZXRjaCwg
Im5ldHdvcmsiLCAiW1VSTF0gW2dyb3VwbmFtZV0iLCAiZmV0Y2ggcmVjZW50IGNoYW5nZXMg
ZnJvbSBuZXR3b3JrIikKewogIGlmIChhcmdzLnNpemUoKSA+IDIpCiAgICB0aHJvdyB1c2Fn
ZShuYW1lKTsKCiAgdmVjdG9yPCBwYWlyPHVybCxncm91cD4gPiBzb3VyY2VzOwoKICBpZiAo
YXJncy5zaXplKCkgPT0gMCkKICAgIHsKICAgICAgaWYgKGFwcC5icmFuY2hfbmFtZSA9PSAi
IikKCXsKCSAgUCgibm8gYnJhbmNoIG5hbWUgcHJvdmlkZWQsIGZldGNoaW5nIGZyb20gYWxs
IGtub3duIFVSTHNcbiIpOwoJICBhcHAuZGIuZ2V0X2FsbF9rbm93bl9zb3VyY2VzKHNvdXJj
ZXMpOwoJfQogICAgICBlbHNlCgl7CgkgIE4oYXBwLmx1YS5ob29rX2dldF9mZXRjaF9zb3Vy
Y2VzKGFwcC5icmFuY2hfbmFtZSwgc291cmNlcyksCgkgICAgKCJubyBVUkwgLyBncm91cCBw
YWlycyBmb3VuZCBmb3IgYnJhbmNoICIgKyBhcHAuYnJhbmNoX25hbWUpKTsgCgl9CiAgICB9
CiAgZWxzZQogICAgewogICAgICBOKGFyZ3Muc2l6ZSgpID09IDIsICJuZWVkIFVSTCBhbmQg
Z3JvdXBuYW1lIik7CiAgICAgIHNvdXJjZXMucHVzaF9iYWNrKG1ha2VfcGFpcih1cmwoYXJn
c1swXSksCgkJCQkgIGdyb3VwKGFyZ3NbMV0pKSk7CiAgICB9CiAgCiAgZmV0Y2hfcXVldWVk
X2Jsb2JzX2Zyb21fbmV0d29yayhzb3VyY2VzLCBhcHApOwp9CgpDTUQocG9zdCwgIm5ldHdv
cmsiLCAiW1VSTF0gW2dyb3VwbmFtZV0iLCAicG9zdCBxdWV1ZWQgY2hhbmdlcyB0byBuZXR3
b3JrIikKewogIGlmIChhcmdzLnNpemUoKSA+IDIpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsK
CiAgdmVjdG9yPCBwYWlyPHVybCxncm91cD4gPiB0YXJnZXRzOwogIGlmIChhcmdzLnNpemUo
KSA9PSAwKQogICAgewogICAgICBpZiAoYXBwLmJyYW5jaF9uYW1lID09ICIiKQoJewoJICBQ
KCJubyBicmFuY2ggbmFtZSBwcm92aWRlZCwgcG9zdGluZyBhbGwgcXVldWVkIHRhcmdldHNc
biIpOwoJICBhcHAuZGIuZ2V0X3F1ZXVlZF90YXJnZXRzKHRhcmdldHMpOwoJfQogICAgICBl
bHNlCgl7CgkgIE4oYXBwLmx1YS5ob29rX2dldF9wb3N0X3RhcmdldHMoYXBwLmJyYW5jaF9u
YW1lLCB0YXJnZXRzKSwKCSAgICAoIm5vIFVSTCAvIGdyb3VwIHBhaXJzIGZvdW5kIGZvciBi
cmFuY2ggIiArIGFwcC5icmFuY2hfbmFtZSkpOyAKCX0KICAgIH0gIAogIGVsc2UKICAgIHsK
ICAgICAgTihhcmdzLnNpemUoKSA9PSAyLCAibmVlZCBVUkwgYW5kIGdyb3VwbmFtZSIpOwog
ICAgICB0YXJnZXRzLnB1c2hfYmFjayhtYWtlX3BhaXIodXJsKGFyZ3NbMF0pLAoJCQkJICBn
cm91cChhcmdzWzFdKSkpOwogICAgfQoKICBwb3N0X3F1ZXVlZF9ibG9ic190b19uZXR3b3Jr
KHRhcmdldHMsIGFwcCk7Cn0KCgpDTUQocmNzX2ltcG9ydCwgInJjcyIsICI8cmNzZmlsZT4g
Li4uIiwgImltcG9ydCBhbGwgdmVyc2lvbnMgaW4gUkNTIGZpbGVzIikKewogIGlmIChhcmdz
LnNpemUoKSA8IDEpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKICAKICB0cmFuc2FjdGlvbl9n
dWFyZCBndWFyZChhcHAuZGIpOwogIGZvciAodmVjdG9yPHN0cmluZz46OmNvbnN0X2l0ZXJh
dG9yIGkgPSBhcmdzLmJlZ2luKCk7CiAgICAgICBpICE9IGFyZ3MuZW5kKCk7ICsraSkKICAg
IHsKICAgICAgaW1wb3J0X3Jjc19maWxlKGZzOjpwYXRoKCppKSwgYXBwLmRiKTsKICAgIH0K
ICBndWFyZC5jb21taXQoKTsKfQoKCkNNRChjdnNfaW1wb3J0LCAicmNzIiwgIjxjdnNyb290
PiIsICJpbXBvcnQgYWxsIHZlcnNpb25zIGluIENWUyByZXBvc2l0b3J5IikKewogIGlmIChh
cmdzLnNpemUoKSAhPSAxKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7CgogIGltcG9ydF9jdnNf
cmVwbyhmczo6cGF0aChhcmdzLmF0KDApKSwgYXBwKTsKfQoKCn07IC8vIG5hbWVzcGFjZSBj
b21tYW5kcwo=
])

AT_DATA(secondfile.b64, [Ly8gY29weXJpZ2h0IChDKSAyMDAyLCAyMDAzIGdyYXlkb24gaG9hcmUgPGdyYXlkb25AcG9i
b3guY29tPgovLyBhbGwgcmlnaHRzIHJlc2VydmVkLgovLyBsaWNlbnNlZCB0byB0aGUgcHVi
bGljIHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdQTCAoPj0gMikKLy8gc2VlIHRoZSBm
aWxlIENPUFlJTkcgZm9yIGRldGFpbHMKCiNpbmNsdWRlIDxtYXA+CiNpbmNsdWRlIDxjc3Rk
aW8+CiNpbmNsdWRlIDxzZXQ+CiNpbmNsdWRlIDx2ZWN0b3I+CiNpbmNsdWRlIDxhbGdvcml0
aG0+CiNpbmNsdWRlIDxpdGVyYXRvcj4KI2luY2x1ZGUgPGJvb3N0L2ZpbGVzeXN0ZW0vcGF0
aC5ocHA+CiNpbmNsdWRlIDxib29zdC9maWxlc3lzdGVtL29wZXJhdGlvbnMuaHBwPgojaW5j
bHVkZSA8Ym9vc3QvbGV4aWNhbF9jYXN0LmhwcD4KCiNpbmNsdWRlICJjb21tYW5kcy5oaCIK
I2luY2x1ZGUgImNvbnN0YW50cy5oaCIKCiNpbmNsdWRlICJhcHBfc3RhdGUuaGgiCiNpbmNs
dWRlICJkaWZmX3BhdGNoLmhoIgojaW5jbHVkZSAiZmlsZV9pby5oaCIKI2luY2x1ZGUgImtl
eXMuaGgiCiNpbmNsdWRlICJtYW5pZmVzdC5oaCIKI2luY2x1ZGUgIm5ldHdvcmsuaGgiCiNp
bmNsdWRlICJwYWNrZXQuaGgiCiNpbmNsdWRlICJwYXRjaF9zZXQuaGgiCiNpbmNsdWRlICJy
Y3NfaW1wb3J0LmhoIgojaW5jbHVkZSAic2FuaXR5LmhoIgojaW5jbHVkZSAiY2VydC5oaCIK
I2luY2x1ZGUgInRyYW5zZm9ybXMuaGgiCiNpbmNsdWRlICJ1cGRhdGUuaGgiCiNpbmNsdWRl
ICJ2b2NhYi5oaCIKI2luY2x1ZGUgIndvcmsuaGgiCgovLwovLyB0aGlzIGZpbGUgZGVmaW5l
cyB0aGUgdGFzay1vcmllbnRlZCAidG9wIGxldmVsIiBjb21tYW5kcyB3aGljaCBjYW4gYmUK
Ly8gaXNzdWVkIGFzIHBhcnQgb2YgYSBtb25vdG9uZSBjb21tYW5kIGxpbmUuIHRoZSBjb21t
YW5kIGxpbmUgY2FuIG9ubHkKLy8gaGF2ZSBvbmUgc3VjaCBjb21tYW5kIG9uIGl0LCBmb2xs
b3dlZCBieSBhIHZlY3RvciBvZiBzdHJpbmdzIHdoaWNoIGFyZSBpdHMKLy8gYXJndW1lbnRz
LiBhbGwgLS1vcHRpb25zIHdpbGwgYmUgcHJvY2Vzc2VkIGJ5IHRoZSBtYWluIHByb2dyYW0g
KmJlZm9yZSoKLy8gY2FsbGluZyBhIGNvbW1hbmQKLy8KLy8gd2UgbWlnaHQgZXhwb3NlIHRo
aXMgYmx1bnQgY29tbWFuZCBpbnRlcmZhY2UgdG8gc2NyaXB0aW5nIHNvbWVkYXkuIGJ1dAov
LyBub3QgdG9kYXkuCgpuYW1lc3BhY2UgY29tbWFuZHMgCnsKICBzdHJ1Y3QgY29tbWFuZDsK
ICBib29sIG9wZXJhdG9yPChjb21tYW5kIGNvbnN0ICYgc2VsZiwgY29tbWFuZCBjb25zdCAm
IG90aGVyKTsKfTsKCm5hbWVzcGFjZSBzdGQKewogIHRlbXBsYXRlIDw+CiAgc3RydWN0IHN0
ZDo6Z3JlYXRlcjxjb21tYW5kczo6Y29tbWFuZCAqPgogIHsKICAgIGJvb2wgb3BlcmF0b3Io
KShjb21tYW5kczo6Y29tbWFuZCBjb25zdCAqIGEsIGNvbW1hbmRzOjpjb21tYW5kIGNvbnN0
ICogYikKICAgIHsKICAgICAgcmV0dXJuICphIDwgKmI7CiAgICB9CiAgfTsKfTsKCm5hbWVz
cGFjZSBjb21tYW5kcyAKewp1c2luZyBuYW1lc3BhY2Ugc3RkOwoKc3RydWN0IGNvbW1hbmQ7
IAoKc3RhdGljIG1hcDxzdHJpbmcsY29tbWFuZCAqPiBjbWRzOwoKc3RydWN0IGNvbW1hbmQg
CnsKICBzdHJpbmcgbmFtZTsKICBzdHJpbmcgY21kZ3JvdXA7CiAgc3RyaW5nIHBhcmFtczsK
ICBzdHJpbmcgZGVzYzsKICBjb21tYW5kKHN0cmluZyBjb25zdCAmIG4sCgkgIHN0cmluZyBj
b25zdCAmIGcsCgkgIHN0cmluZyBjb25zdCAmIHAsCgkgIHN0cmluZyBjb25zdCAmIGQpIDog
bmFtZShuKSwgY21kZ3JvdXAoZyksIHBhcmFtcyhwKSwgZGVzYyhkKSAKICB7IGNtZHNbbl0g
PSB0aGlzOyB9CiAgdmlydHVhbCB+Y29tbWFuZCgpIHt9CiAgdmlydHVhbCB2b2lkIGV4ZWMo
YXBwX3N0YXRlICYgYXBwLCB2ZWN0b3I8c3RyaW5nPiBjb25zdCAmIGFyZ3MpID0gMDsKfTsK
CmJvb2wgb3BlcmF0b3I8KGNvbW1hbmQgY29uc3QgJiBzZWxmLCBjb21tYW5kIGNvbnN0ICYg
b3RoZXIpCnsKICByZXR1cm4gKChzZWxmLmNtZGdyb3VwIDwgb3RoZXIuY21kZ3JvdXApCgkg
IHx8ICgoc2VsZi5jbWRncm91cCA9PSBvdGhlci5jbWRncm91cCkgJiYgKHNlbGYubmFtZSA8
IG90aGVyLm5hbWUpKSk7Cn0KCgp2b2lkIGV4cGxhaW5fdXNhZ2Uoc3RyaW5nIGNvbnN0ICYg
Y21kLCBvc3RyZWFtICYgb3V0KQp7CiAgbWFwPHN0cmluZyxjb21tYW5kICo+Ojpjb25zdF9p
dGVyYXRvciBpOwogIGkgPSBjbWRzLmZpbmQoY21kKTsKICBpZiAoaSAhPSBjbWRzLmVuZCgp
KQogICAgewogICAgICBvdXQgPDwgIiAgICAgIiA8PCBpLT5zZWNvbmQtPm5hbWUgPDwgIiAi
IDw8IGktPnNlY29uZC0+cGFyYW1zIDw8IGVuZGwKCSAgPDwgIiAgICAgIiA8PCBpLT5zZWNv
bmQtPmRlc2MgPDwgZW5kbCA8PCBlbmRsOwogICAgICByZXR1cm47CiAgICB9CgogIHZlY3Rv
cjxjb21tYW5kICo+IHNvcnRlZDsKICBvdXQgPDwgImNvbW1hbmRzOiIgPDwgZW5kbDsKICBm
b3IgKGkgPSBjbWRzLmJlZ2luKCk7IGkgIT0gY21kcy5lbmQoKTsgKytpKQogICAgewogICAg
ICBzb3J0ZWQucHVzaF9iYWNrKGktPnNlY29uZCk7CiAgICB9CiAgCiAgc29ydChzb3J0ZWQu
YmVnaW4oKSwgc29ydGVkLmVuZCgpLCBzdGQ6OmdyZWF0ZXI8Y29tbWFuZCAqPigpKTsKCiAg
c3RyaW5nIGN1cnJfZ3JvdXA7CiAgc2l6ZV90IGNvbCA9IDA7CiAgc2l6ZV90IGNvbDIgPSAw
OwogIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgc29ydGVkLnNpemUoKTsgKytpKQogICAgewog
ICAgICBjb2wyID0gY29sMiA+IHNvcnRlZFtpXS0+Y21kZ3JvdXAuc2l6ZSgpID8gY29sMiA6
IHNvcnRlZFtpXS0+Y21kZ3JvdXAuc2l6ZSgpOwogICAgfQoKICBmb3IgKHNpemVfdCBpID0g
MDsgaSA8IHNvcnRlZC5zaXplKCk7ICsraSkKICAgIHsKICAgICAgaWYgKHNvcnRlZFtpXS0+
Y21kZ3JvdXAgIT0gY3Vycl9ncm91cCkKCXsKCSAgY3Vycl9ncm91cCA9IHNvcnRlZFtpXS0+
Y21kZ3JvdXA7CgkgIG91dCA8PCBlbmRsOwoJICBvdXQgPDwgIiAgIiA8PCBzb3J0ZWRbaV0t
PmNtZGdyb3VwOwoJICBjb2wgPSBzb3J0ZWRbaV0tPmNtZGdyb3VwLnNpemUoKSArIDI7Cgkg
IHdoaWxlIChjb2wrKyA8IChjb2wyICsgMykpCgkgICAgb3V0IDw8ICcgJzsKCX0KICAgICAg
b3V0IDw8ICIgIiA8PCBzb3J0ZWRbaV0tPm5hbWU7CiAgICAgIGNvbCArPSBzb3J0ZWRbaV0t
Pm5hbWUuc2l6ZSgpICsgMTsKICAgICAgaWYgKGNvbCA+PSA3MCkKCXsKCSAgb3V0IDw8IGVu
ZGw7CgkgIGNvbCA9IDA7CgkgIHdoaWxlIChjb2wrKyA8IChjb2wyICsgMykpCgkgICAgb3V0
IDw8ICcgJzsKCX0KICAgIH0KICBvdXQgPDwgZW5kbCA8PCBlbmRsOwp9Cgp2b2lkIHByb2Nl
c3MoYXBwX3N0YXRlICYgYXBwLCBzdHJpbmcgY29uc3QgJiBjbWQsIHZlY3RvcjxzdHJpbmc+
IGNvbnN0ICYgYXJncykKewogIGlmIChjbWRzLmZpbmQoY21kKSAhPSBjbWRzLmVuZCgpKQog
ICAgewogICAgICBMKCJleGVjdXRpbmcgJXMgY29tbWFuZFxuIiwgY21kLmNfc3RyKCkpOwog
ICAgICBjbWRzW2NtZF0tPmV4ZWMoYXBwLCBhcmdzKTsKICAgIH0KICBlbHNlCiAgICB7CiAg
ICAgIHRocm93IHVzYWdlKGNtZCk7CiAgICB9Cn0KCiNkZWZpbmUgQ01EKEMsIGdyb3VwLCBw
YXJhbXMsIGRlc2MpICAgICAgICAgICAgICAgXApzdHJ1Y3QgY21kXyAjIyBDIDogcHVibGlj
IGNvbW1hbmQgICAgICAgICAgICAgICAgIFwKeyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBcCiAgY21kXyAjIyBDKCkgOiBjb21tYW5kKCNDLCBn
cm91cCwgcGFyYW1zLCBkZXNjKSAgXAogIHt9ICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIFwKICB2aXJ0dWFsIHZvaWQgZXhlYyhhcHBfc3RhdGUgJiBh
cHAsICAgICAgICAgICAgICBcCiAgICAgICAgICAgICAgICAgICAgdmVjdG9yPHN0cmluZz4g
Y29uc3QgJiBhcmdzKTsgXAp9OyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgIFwKc3RhdGljIGNtZF8gIyMgQyBDICMjIF9jbWQ7ICAgICAgICAgICAg
ICAgICAgICAgICBcCnZvaWQgY21kXyAjIyBDOjpleGVjKGFwcF9zdGF0ZSAmIGFwcCwgICAg
ICAgICAgICAgXAogICAgICAgICAgICAgICAgICAgICB2ZWN0b3I8c3RyaW5nPiBjb25zdCAm
IGFyZ3MpIFwKCiNkZWZpbmUgQUxJQVMoQywgcmVhbGNvbW1hbmQsIGdyb3VwLCBwYXJhbXMs
IGRlc2MpCVwKQ01EKEMsIGdyb3VwLCBwYXJhbXMsIGRlc2MpCQkJCVwKewkJCQkJCQlcCiAg
cHJvY2VzcyhhcHAsIHN0cmluZygjcmVhbGNvbW1hbmQpLCBhcmdzKTsJCVwKfQoKCnN0YXRp
YyB2b2lkIGVuc3VyZV9ib29rZGlyKCkKewogIG1rZGlyX3AobG9jYWxfcGF0aChib29rX2tl
ZXBpbmdfZGlyKSk7Cn0KCnN0YXRpYyB2b2lkIGdldF9tYW5pZmVzdF9wYXRoKGxvY2FsX3Bh
dGggJiBtX3BhdGgpCnsKICBtX3BhdGggPSAoZnM6OnBhdGgoYm9va19rZWVwaW5nX2Rpcikg
LyBmczo6cGF0aChtYW5pZmVzdF9maWxlX25hbWUpKS5zdHJpbmcoKTsKICBMKCJtYW5pZmVz
dCBwYXRoIGlzICVzXG4iLCBtX3BhdGgoKS5jX3N0cigpKTsKfQoKc3RhdGljIHZvaWQgZ2V0
X3dvcmtfcGF0aChsb2NhbF9wYXRoICYgd19wYXRoKQp7CiAgd19wYXRoID0gKGZzOjpwYXRo
KGJvb2tfa2VlcGluZ19kaXIpIC8gZnM6OnBhdGgod29ya19maWxlX25hbWUpKS5zdHJpbmco
KTsKICBMKCJ3b3JrIHBhdGggaXMgJXNcbiIsIHdfcGF0aCgpLmNfc3RyKCkpOwp9CgpzdGF0
aWMgdm9pZCBnZXRfbWFuaWZlc3RfbWFwKG1hbmlmZXN0X21hcCAmIG0pCnsKICBlbnN1cmVf
Ym9va2RpcigpOwogIGxvY2FsX3BhdGggbV9wYXRoOwogIGJhc2U2NDwgZ3ppcDxkYXRhPiA+
IG1fZGF0YTsKICBnZXRfbWFuaWZlc3RfcGF0aChtX3BhdGgpOwogIGlmIChmaWxlX2V4aXN0
cyhtX3BhdGgpKQogICAgewogICAgICBMKCJsb2FkaW5nIG1hbmlmZXN0IGZpbGUgJXNcbiIs
IG1fcGF0aCgpLmNfc3RyKCkpOyAgICAgIAogICAgICByZWFkX2RhdGEobV9wYXRoLCBtX2Rh
dGEpOwogICAgICByZWFkX21hbmlmZXN0X21hcChtYW5pZmVzdF9kYXRhKG1fZGF0YSksIG0p
OwogICAgICBMKCJyZWFkICVkIG1hbmlmZXN0IGVudHJpZXNcbiIsIG0uc2l6ZSgpKTsKICAg
IH0KICBlbHNlCiAgICB7CiAgICAgIEwoIm5vIG1hbmlmZXN0IGZpbGUgJXNcbiIsIG1fcGF0
aCgpLmNfc3RyKCkpOwogICAgfQp9CgpzdGF0aWMgdm9pZCBwdXRfbWFuaWZlc3RfbWFwKG1h
bmlmZXN0X21hcCBjb25zdCAmIG0pCnsKICBlbnN1cmVfYm9va2RpcigpOwogIGxvY2FsX3Bh
dGggbV9wYXRoOwogIG1hbmlmZXN0X2RhdGEgbV9kYXRhOwogIGdldF9tYW5pZmVzdF9wYXRo
KG1fcGF0aCk7CiAgTCgid3JpdGluZyBtYW5pZmVzdCBmaWxlICVzXG4iLCBtX3BhdGgoKS5j
X3N0cigpKTsKICB3cml0ZV9tYW5pZmVzdF9tYXAobSwgbV9kYXRhKTsKICB3cml0ZV9kYXRh
KG1fcGF0aCwgbV9kYXRhLmlubmVyKCkpOwogIEwoIndyb3RlICVkIG1hbmlmZXN0IGVudHJp
ZXNcbiIsIG0uc2l6ZSgpKTsKfQoKc3RhdGljIHZvaWQgZ2V0X3dvcmtfc2V0KHdvcmtfc2V0
ICYgdykKewogIGVuc3VyZV9ib29rZGlyKCk7CiAgbG9jYWxfcGF0aCB3X3BhdGg7CiAgZ2V0
X3dvcmtfcGF0aCh3X3BhdGgpOwogIGlmIChmaWxlX2V4aXN0cyh3X3BhdGgpKQogICAgewog
ICAgICBMKCJjaGVja2luZyBmb3IgdW4tY29tbWl0dGVkIHdvcmsgZmlsZSAlc1xuIiwgCgl3
X3BhdGgoKS5jX3N0cigpKTsKICAgICAgZGF0YSB3X2RhdGE7CiAgICAgIHJlYWRfZGF0YSh3
X3BhdGgsIHdfZGF0YSk7CiAgICAgIHJlYWRfd29ya19zZXQod19kYXRhLCB3KTsKICAgICAg
TCgicmVhZCAlZCBkZWxzLCAlZCBhZGRzIGZyb20gJXNcbiIsIAoJdy5kZWxzLnNpemUoKSwg
dy5hZGRzLnNpemUoKSwgd19wYXRoKCkuY19zdHIoKSk7CiAgICB9CiAgZWxzZQogICAgewog
ICAgICBMKCJubyB1bi1jb21taXR0ZWQgd29yayBmaWxlICVzXG4iLCB3X3BhdGgoKS5jX3N0
cigpKTsKICAgIH0KfQoKc3RhdGljIHZvaWQgcHV0X3dvcmtfc2V0KHdvcmtfc2V0ICYgdykK
ewogIGxvY2FsX3BhdGggd19wYXRoOwogIGdldF93b3JrX3BhdGgod19wYXRoKTsKCiAgaWYg
KHcuYWRkcy5zaXplKCkgPiAwCiAgICAgIHx8IHcuZGVscy5zaXplKCkgPiAwKQogICAgewog
ICAgICBlbnN1cmVfYm9va2RpcigpOwogICAgICBkYXRhIHdfZGF0YTsKICAgICAgd3JpdGVf
d29ya19zZXQod19kYXRhLCB3KTsKICAgICAgd3JpdGVfZGF0YSh3X3BhdGgsIHdfZGF0YSk7
CiAgICB9CiAgZWxzZQogICAgewogICAgICBkZWxldGVfZmlsZSh3X3BhdGgpOwogICAgfQp9
CgpzdGF0aWMgdm9pZCBjYWxjdWxhdGVfbmV3X21hbmlmZXN0X21hcChtYW5pZmVzdF9tYXAg
Y29uc3QgJiBtX29sZCwgCgkJCQkgICAgICAgbWFuaWZlc3RfbWFwICYgbV9uZXcpCnsKICBw
YXRoX3NldCBwYXRoczsKICB3b3JrX3NldCB3b3JrOwogIGV4dHJhY3RfcGF0aF9zZXQobV9v
bGQsIHBhdGhzKTsKICBnZXRfd29ya19zZXQod29yayk7CiAgaWYgKHdvcmsuZGVscy5zaXpl
KCkgPiAwKQogICAgTCgicmVtb3ZpbmcgJWQgZGVhZCBmaWxlcyBmcm9tIG1hbmlmZXN0XG4i
LCAKICAgICAgd29yay5kZWxzLnNpemUoKSk7CiAgaWYgKHdvcmsuYWRkcy5zaXplKCkgPiAw
KQogICAgTCgiYWRkaW5nICVkIGZpbGVzIHRvIG1hbmlmZXN0XG4iLCB3b3JrLmFkZHMuc2l6
ZSgpKTsKICBhcHBseV93b3JrX3NldCh3b3JrLCBwYXRocyk7CiAgYnVpbGRfbWFuaWZlc3Rf
bWFwKHBhdGhzLCBtX25ldyk7Cn0KCnN0YXRpYyBzdHJpbmcgZ2V0X3N0ZGluKCkKewogIGNo
YXIgYnVmW2J1ZnN6XTsKICBzdHJpbmcgdG1wOwogIHdoaWxlKGNpbikKICAgIHsKICAgICAg
Y2luLnJlYWQoYnVmLCBidWZzeik7CiAgICAgIHRtcC5hcHBlbmQoYnVmLCBjaW4uZ2NvdW50
KCkpOwogICAgfQogIHJldHVybiB0bXA7Cn0KCnN0YXRpYyB2b2lkIGdldF9sb2dfbWVzc2Fn
ZShwYXRjaF9zZXQgY29uc3QgJiBwcywgCgkJCSAgICBhcHBfc3RhdGUgJiBhcHAsCgkJCSAg
ICBzdHJpbmcgJiBsb2dfbWVzc2FnZSkKewogIHN0cmluZyBjb21tZW50YXJ5OwogIHN0cmlu
ZyBzdW1tYXJ5OwogIHN0cmluZ3N0cmVhbSBzczsKICBwYXRjaF9zZXRfdG9fdGV4dF9zdW1t
YXJ5KHBzLCBzcyk7CiAgc3VtbWFyeSA9IHNzLnN0cigpOwogIGNvbW1lbnRhcnkgKz0gIi0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS1cbiI7CiAgY29tbWVudGFyeSArPSAiRW50ZXIgTG9nLiAgTGluZXMg
YmVnaW5uaW5nIHdpdGggYE1UOicgYXJlIHJlbW92ZWQgYXV0b21hdGljYWxseVxuIjsKICBj
b21tZW50YXJ5ICs9ICJcbiI7CiAgY29tbWVudGFyeSArPSAiU3VtbWFyeSBvZiBjaGFuZ2Vz
OlxuIjsKICBjb21tZW50YXJ5ICs9ICJcbiI7CiAgY29tbWVudGFyeSArPSBzdW1tYXJ5Owog
IGNvbW1lbnRhcnkgKz0gIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiI7CiAgTihhcHAubHVhLmhvb2tf
ZWRpdF9jb21tZW50KGNvbW1lbnRhcnksIGxvZ19tZXNzYWdlKSwKICAgICJlZGl0IG9mIGxv
ZyBtZXNzYWdlIGZhaWxlZCIpOwp9CgoKLy8gdGhlIGdvYWwgaGVyZSBpcyB0byBsb29rIGJh
Y2sgdGhyb3VnaCB0aGUgYW5jZXN0cnkgb2YgdGhlIHByb3ZpZGVkCi8vIGNoaWxkLCBjaGVj
a2luZyB0byBzZWUgdGhlIGxlYXN0IGFuY2VzdG9yIGl0IGhhcyB3aGljaCB3ZSByZWNlaXZl
ZCBmcm9tCi8vIHRoZSBnaXZlbiBuZXR3b3JrIHVybC9ncm91cCBwYWlyLgovLwovLyB3ZSB1
c2UgdGhlIGFuY2VzdG9yIGFzIHRoZSBzb3VyY2UgbWFuaWZlc3Qgd2hlbiBidWlsZGluZyBh
IHBhdGNoc2V0IHRvCi8vIHNlbmQgdG8gdGhhdCB1cmwvZ3JvdXAuCgpzdGF0aWMgYm9vbCBm
aW5kX2FuY2VzdG9yX29uX25ldHNlcnZlciAobWFuaWZlc3RfaWQgY29uc3QgJiBjaGlsZCwg
CgkJCQkJdXJsIGNvbnN0ICYgdSwKCQkJCQlncm91cCBjb25zdCAmIGcsIAoJCQkJCW1hbmlm
ZXN0X2lkICYgYW5jLAoJCQkJCWFwcF9zdGF0ZSAmIGFwcCkKewogIHNldDxtYW5pZmVzdF9p
ZD4gZnJvbnRpZXI7CiAgY2VydF9uYW1lIHRuKGFuY2VzdG9yX2NlcnRfbmFtZSk7CiAgZnJv
bnRpZXIuaW5zZXJ0KGNoaWxkKTsKCiAgd2hpbGUgKCFmcm9udGllci5lbXB0eSgpKQogICAg
ewogICAgICBzZXQ8bWFuaWZlc3RfaWQ+IG5leHRfZnJvbnRpZXI7CiAgICAgIGZvciAoc2V0
PG1hbmlmZXN0X2lkPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGZyb250aWVyLmJlZ2luKCk7Cgkg
ICBpICE9IGZyb250aWVyLmVuZCgpOyArK2kpCgl7CgkgIHZlY3RvcjwgbWFuaWZlc3Q8Y2Vy
dD4gPiB0bXA7CgkgIGFwcC5kYi5nZXRfbWFuaWZlc3RfY2VydHMoKmksIHRuLCB0bXApOwoK
CSAgLy8gd2UgZ28gdGhyb3VnaCB0aGlzIHZlY3RvciBiYWNrd2FyZHMgYmVjYXVzZSB3ZSB3
b3VsZCBwcmVmZXIgdG8KCSAgLy8gaGl0IG1vcmUgcmVjZW50bHktcXVldWVkIGFuY2VzdG9y
cyAoc3VjaCBhcyBpbnRlcm1lZGlhdGUgbm9kZXMKCSAgLy8gaW4gYSBtdWx0aS1ub2RlIG1l
cmdlKSByYXRoZXIgdGhhbiBvbGRlciBhbmNlc3RvcnMuIGJ1dCBvZgoJICAvLyBjb3Vyc2Us
IGFueSBhbmNlc3RvciB3aWxsIGRvLgoKCSAgZm9yICh2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+
ID46OnJldmVyc2VfaXRlcmF0b3IgaiA9IHRtcC5yYmVnaW4oKTsKCSAgICAgICBqICE9IHRt
cC5yZW5kKCk7ICsraikKCSAgICB7CgkgICAgICBjZXJ0X3ZhbHVlIHR2OwoJICAgICAgZGVj
b2RlX2Jhc2U2NChqLT5pbm5lcigpLnZhbHVlLCB0dik7CgkgICAgICBtYW5pZmVzdF9pZCBh
bmNfaWQgKHR2KCkpOwoKCSAgICAgIEwoImxvb2tpbmcgZm9yIHBhcmVudCAlcyBvZiAlcyBv
biBzZXJ2ZXJcbiIsIAoJCWktPmlubmVyKCkoKS5jX3N0cigpLAoJCWFuY19pZC5pbm5lcigp
KCkuY19zdHIoKSk7CgoJICAgICAgaWYgKGFwcC5kYi5tYW5pZmVzdF9leGlzdHNfb25fbmV0
c2VydmVyICh1LCBnLCBhbmNfaWQpKQoJCXsKCQkgIEwoImZvdW5kIHBhcmVudCAlcyBvbiBz
ZXJ2ZXJcbiIsIGFuY19pZC5pbm5lcigpKCkuY19zdHIoKSk7CgkJICBhbmMgPSBhbmNfaWQ7
CgkJICByZXR1cm4gdHJ1ZTsKCQl9CgkgICAgICBlbHNlCgkJbmV4dF9mcm9udGllci5pbnNl
cnQoYW5jX2lkKTsKCSAgICB9CSAgCgl9CgogICAgICBmcm9udGllciA9IG5leHRfZnJvbnRp
ZXI7CiAgICB9CgogIHJldHVybiBmYWxzZTsKfQoKCnN0YXRpYyB2b2lkIHF1ZXVlX2VkZ2Vf
Zm9yX3RhcmdldF9hbmNlc3RvciAocGFpcjx1cmwsZ3JvdXA+IGNvbnN0ICYgdGFyZywKCQkJ
CQkgICAgbWFuaWZlc3RfaWQgY29uc3QgJiBjaGlsZF9pZCwKCQkJCQkgICAgbWFuaWZlc3Rf
bWFwIGNvbnN0ICYgY2hpbGRfbWFwLAoJCQkJCSAgICBhcHBfc3RhdGUgJiBhcHApCnsgIAog
IC8vIG5vdyBoZXJlIGlzIGFuIGludGVyZXN0aW5nIHRoaW5nOiB3ZSAqbWlnaHQqIGJlIHNl
bmRpbmcgZGF0YSB0byBhCiAgLy8gZGVwb3QsIG9yIHNvbWVvbmUgd2l0aCBpbmRldGVybWlu
YXRlIHByZS1leGlzdGluZyBzdGF0ZSAoc2F5IHRoZSBmaXJzdAogIC8vIHRpbWUgd2UgcG9z
dCB0byBuZXRuZXdzKSwgdGhlcmVmb3JlIHdlIGNhbm5vdCBqdXN0ICJzZW5kIHRoZSBlZGdl
IiB3ZQogIC8vIGp1c3QgY29uc3RydWN0ZWQgaW4gYSBtZXJnZSBvciBjb21taXQsIHdlIG5l
ZWQgdG8gc2VuZCBhbiBlZGdlIGZyb20gYQogIC8vIHBhcmVudCB3aGljaCB3ZSBrbm93IHRv
IGJlIHByZXNlbnQgaW4gdGhlIGRlcG90IChvciBlbHNlIGFuIGVkZ2UgZnJvbQogIC8vIHRo
ZSBlbXB0eSBtYXAgLS0gZnVsbCBjb250ZW50cyBvZiBhbGwgZmlsZXMpLiB3aGF0IGlzIHNl
bnQgdGhlcmVmb3JlCiAgLy8gY2hhbmdlcyBvbiBhIGRlcG90LWJ5LWRlcG90IGJhc2lzLiB0
aGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgdGhlCiAgLy8gYXBwcm9wcmlhdGUgdGhpbmcgdG8g
c2VuZC4KICAvLwogIC8vIG5iOiB0aGlzIGhhcyBubyBkaXJlY3QgcmVsYXRpb24gdG8gd2hh
dCB3ZSBzdG9yZSBpbiBvdXIgb3duCiAgLy8gZGF0YWJhc2UuIHdlIGFsd2F5cyBzdG9yZSB0
aGUgZWRnZSBmcm9tIG91ciBwYXJlbnQsIGFuZCB3ZSBhbHdheXMga25vdwogIC8vIHdoZW4g
d2UgaGF2ZSBhIHBhcmVudC4KCiAgdmVjdG9yPCBwYWlyPHVybCwgZ3JvdXA+ID4gb25lX3Rh
cmdldDsKICBvbmVfdGFyZ2V0LnB1c2hfYmFjayh0YXJnKTsKICBxdWV1ZWluZ19wYWNrZXRf
d3JpdGVyIHFwdyhhcHAsIG9uZV90YXJnZXQpOwogIAogIG1hbmlmZXN0X2RhdGEgdGFyZ19h
bmNlc3Rvcl9kYXRhOwogIG1hbmlmZXN0X21hcCB0YXJnX2FuY2VzdG9yX21hcDsKICBtYW5p
ZmVzdF9pZCB0YXJnX2FuY2VzdG9yX2lkOwogIAogIGlmIChmaW5kX2FuY2VzdG9yX29uX25l
dHNlcnZlciAoY2hpbGRfaWQsIAoJCQkJICB0YXJnLmZpcnN0LCAKCQkJCSAgdGFyZy5zZWNv
bmQsIAoJCQkJICB0YXJnX2FuY2VzdG9yX2lkLCAKCQkJCSAgYXBwKSkKICAgIHsJICAgIAog
ICAgICBhcHAuZGIuZ2V0X21hbmlmZXN0X3ZlcnNpb24odGFyZ19hbmNlc3Rvcl9pZCwgdGFy
Z19hbmNlc3Rvcl9kYXRhKTsKICAgICAgcmVhZF9tYW5pZmVzdF9tYXAodGFyZ19hbmNlc3Rv
cl9kYXRhLCB0YXJnX2FuY2VzdG9yX21hcCk7CiAgICB9CgogIHBhdGNoX3NldCBwczsKICBt
YW5pZmVzdHNfdG9fcGF0Y2hfc2V0KHRhcmdfYW5jZXN0b3JfbWFwLCBjaGlsZF9tYXAsIGFw
cCwgcHMpOwogIHBhdGNoX3NldF90b19wYWNrZXRzKHBzLCBhcHAsIHFwdyk7CgogIC8vIG5v
dyB0aGF0IHdlJ3ZlIHF1ZXVlZCB0aGUgZGF0YSwgd2UgY2FuIG5vdGUgdGhpcyBuZXcgY2hp
bGQKICAvLyBub2RlIGFzIGV4aXN0aW5nICh3ZWxsIC4uIHNvb24tdG8tZXhpc3QpIG9uIHRo
ZSBzZXJ2ZXIKICBhcHAuZGIubm90ZV9tYW5pZmVzdF9vbl9uZXRzZXJ2ZXIgKHRhcmcuZmly
c3QsIHRhcmcuc2Vjb25kLCBjaGlsZF9pZCk7Cgp9CgoKLy8gdGhpcyBoZWxwZXIgdHJpZXMg
dG8gcHJvZHVjZSBtZXJnZSA8LSBtZXJnZU4obGVmdCxyaWdodCksIHBvc3NpYmx5Ci8vIG1l
cmdlMyBpZiBpdCBjYW4gZmluZCBhbiBhbmNlc3Rvciwgb3RoZXJ3aXNlIG1lcmdlMi4gaXQg
YWxzbyBxdWV1ZXMgdGhlCi8vIGFwcHJvcHJpYXRlIGVkZ2VzIGZyb20ga25vd24gYW5jZXN0
b3JzIHRvIHRoZSBuZXcgbWVyZ2Ugbm9kZSwgdG8gYmUKLy8gdHJhbnNtaXR0ZWQgdG8gZWFj
aCBvZiB0aGUgdGFyZ2V0cyBwcm92aWRlZC4KCnN0YXRpYyB2b2lkIHRyeV9vbmVfbWVyZ2Uo
bWFuaWZlc3RfaWQgY29uc3QgJiBsZWZ0LAoJCQkgIG1hbmlmZXN0X2lkIGNvbnN0ICYgcmln
aHQsCgkJCSAgbWFuaWZlc3RfaWQgJiBtZXJnZWQsCgkJCSAgYXBwX3N0YXRlICYgYXBwLCAK
CQkJICB2ZWN0b3I8IHBhaXI8dXJsLGdyb3VwPiA+IGNvbnN0ICYgdGFyZ2V0cykKewogIG1h
bmlmZXN0X2RhdGEgbGVmdF9kYXRhLCByaWdodF9kYXRhLCBhbmNlc3Rvcl9kYXRhLCBtZXJn
ZWRfZGF0YTsKICBtYW5pZmVzdF9tYXAgbGVmdF9tYXAsIHJpZ2h0X21hcCwgYW5jZXN0b3Jf
bWFwLCBtZXJnZWRfbWFwOwogIG1hbmlmZXN0X2lkIGFuY2VzdG9yOwoKICBhcHAuZGIuZ2V0
X21hbmlmZXN0X3ZlcnNpb24obGVmdCwgbGVmdF9kYXRhKTsKICBhcHAuZGIuZ2V0X21hbmlm
ZXN0X3ZlcnNpb24ocmlnaHQsIHJpZ2h0X2RhdGEpOwogIHJlYWRfbWFuaWZlc3RfbWFwKGxl
ZnRfZGF0YSwgbGVmdF9tYXApOwogIHJlYWRfbWFuaWZlc3RfbWFwKHJpZ2h0X2RhdGEsIHJp
Z2h0X21hcCk7CiAgCiAgc2ltcGxlX21lcmdlX3Byb3ZpZGVyIG1lcmdlcihhcHApOwogIAog
IGlmKGZpbmRfY29tbW9uX2FuY2VzdG9yKGxlZnQsIHJpZ2h0LCBhbmNlc3RvciwgYXBwKSkJ
ICAgIAogICAgewogICAgICBQKCJjb21tb24gYW5jZXN0b3IgJXMgZm91bmQsIHRyeWluZyBt
ZXJnZTNcbiIsIGFuY2VzdG9yLmlubmVyKCkoKS5jX3N0cigpKTsgCiAgICAgIGFwcC5kYi5n
ZXRfbWFuaWZlc3RfdmVyc2lvbihhbmNlc3RvciwgYW5jZXN0b3JfZGF0YSk7CiAgICAgIHJl
YWRfbWFuaWZlc3RfbWFwKGFuY2VzdG9yX2RhdGEsIGFuY2VzdG9yX21hcCk7CiAgICAgIE4o
bWVyZ2UzKGFuY2VzdG9yX21hcCwgbGVmdF9tYXAsIHJpZ2h0X21hcCwgCgkgICAgICAgYXBw
LCBtZXJnZXIsIG1lcmdlZF9tYXApLAoJKHN0cmluZygiZmFpbGVkIHRvIG1lcmdlIG1hbmlm
ZXN0cyAiKQoJICsgbGVmdC5pbm5lcigpKCkgKyAiIGFuZCAiICsgcmlnaHQuaW5uZXIoKSgp
KSk7CSAgICAgIAogICAgfQogIGVsc2UKICAgIHsKICAgICAgUCgibm8gY29tbW9uIGFuY2Vz
dG9yIGZvdW5kLCB0cnlpbmcgbWVyZ2UyXG4iKTsgCiAgICAgIE4obWVyZ2UyKGxlZnRfbWFw
LCByaWdodF9tYXAsIGFwcCwgbWVyZ2VyLCBtZXJnZWRfbWFwKSwKCShzdHJpbmcoImZhaWxl
ZCB0byBtZXJnZSBtYW5pZmVzdHMgIikKCSArIGxlZnQuaW5uZXIoKSgpICsgIiBhbmQgIiAr
IHJpZ2h0LmlubmVyKCkoKSkpOwkgICAgICAKICAgIH0KICAKICB3cml0ZV9tYW5pZmVzdF9t
YXAobWVyZ2VkX21hcCwgbWVyZ2VkX2RhdGEpOwogIGNhbGN1bGF0ZV9tYW5pZmVzdF9tYXBf
aWRlbnQobWVyZ2VkX21hcCwgbWVyZ2VkKTsJICAKICAKICBiYXNlNjQ8IGd6aXA8ZGVsdGE+
ID4gbGVmdF9lZGdlOwogIGRpZmYobGVmdF9kYXRhLmlubmVyKCksIG1lcmdlZF9kYXRhLmlu
bmVyKCksIGxlZnRfZWRnZSk7CgogIC8vIEZJWE1FOiB3ZSBkbyAqbm90KiBtYW51ZmFjdHVy
ZSBvciBzdG9yZSB0aGUgc2Vjb25kIGVkZ2UgdG8KICAvLyB0aGUgbWVyZ2VkIHZlcnNpb24s
IHNpbmNlIGRvaW5nIHNvIHZpb2xhdGVzIHRoZQogIC8vIGFzc3VtcHRpb25zIG9mIHRoZSBk
YiwgYW5kIHRoZSAncmlnaHQnIHZlcnNpb24gYWxyZWFkeQogIC8vIGV4aXN0cyBpbiBpdHMg
ZW50aXJldHksIGFueXdheXMuIHRoaXMgaXMgYSBzdWJ0bGUgaXNzdWUKICAvLyB0aG91Z2gg
YW5kIEknbSBub3Qgc3VyZSBJJ20gbWFraW5nIHRoZSByaWdodAogIC8vIGRlY2lzaW9uLiBy
ZXZpc2l0LiBpZiB5b3UgZG8gbm90IHNlZSB0aGF0IGl0IGlzIGEgc3VidGxlCiAgLy8gaXNz
dWUgSSBzdWdnZXN0IHlvdSBhcmUgbm90IHRoaW5raW5nIGFib3V0IGl0IGxvbmcgZW5vdWdo
LgogIC8vCiAgLy8gYmFzZTY0PCBnemlwPGRlbHRhPiA+IHJpZ2h0X2VkZ2U7CiAgLy8gZGlm
ZihyaWdodF9kYXRhLmlubmVyKCksIG1lcmdlZF9kYXRhLmlubmVyKCksIHJpZ2h0X2VkZ2Up
OwogIC8vIGFwcC5kYi5wdXRfbWFuaWZlc3RfdmVyc2lvbihyaWdodCwgbWVyZ2VkLCByaWdo
dF9lZGdlKTsKICAKICAKICAvLyB3ZSBkbyBvZiBjb3Vyc2UgcmVjb3JkIHRoZSBsZWZ0IGVk
Z2UsIGFuZCBhbmNlc3RyeSByZWxhdGlvbnNoaXAgdG8KICAvLyBib3RoIHByZWRlY2Vzc29y
cy4KCiAgewogICAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsgICAgCgogICAgZGJ3LmNv
bnN1bWVfbWFuaWZlc3RfZGVsdGEobGVmdCwgbWVyZ2VkLCBsZWZ0X2VkZ2UpOyAgCiAgICBj
ZXJ0X21hbmlmZXN0X2FuY2VzdG9yKGxlZnQsIG1lcmdlZCwgYXBwLCBkYncpOwogICAgY2Vy
dF9tYW5pZmVzdF9hbmNlc3RvcihyaWdodCwgbWVyZ2VkLCBhcHAsIGRidyk7CiAgICBjZXJ0
X21hbmlmZXN0X2RhdGVfbm93KG1lcmdlZCwgYXBwLCBkYncpOwogICAgY2VydF9tYW5pZmVz
dF9hdXRob3JfZGVmYXVsdChtZXJnZWQsIGFwcCwgZGJ3KTsKICAgIAogICAgLy8gbWFrZSBz
dXJlIHRoZSBhcHByb3ByaWF0ZSBlZGdlcyBnZXQgcXVldWVkIGZvciB0aGUgbmV0d29yay4K
ICAgIGZvciAodmVjdG9yPCBwYWlyPHVybCxncm91cD4gPjo6Y29uc3RfaXRlcmF0b3IgdGFy
ZyA9IHRhcmdldHMuYmVnaW4oKTsKCSB0YXJnICE9IHRhcmdldHMuZW5kKCk7ICsrdGFyZykK
ICAgICAgewoJcXVldWVfZWRnZV9mb3JfdGFyZ2V0X2FuY2VzdG9yICgqdGFyZywgbWVyZ2Vk
LCBtZXJnZWRfbWFwLCBhcHApOwogICAgICB9CiAgICAKICAgIHF1ZXVlaW5nX3BhY2tldF93
cml0ZXIgcXB3KGFwcCwgdGFyZ2V0cyk7CiAgICBjZXJ0X21hbmlmZXN0X2FuY2VzdG9yKGxl
ZnQsIG1lcmdlZCwgYXBwLCBxcHcpOwogICAgY2VydF9tYW5pZmVzdF9hbmNlc3RvcihyaWdo
dCwgbWVyZ2VkLCBhcHAsIHFwdyk7CiAgICBjZXJ0X21hbmlmZXN0X2RhdGVfbm93KG1lcmdl
ZCwgYXBwLCBxcHcpOwogICAgY2VydF9tYW5pZmVzdF9hdXRob3JfZGVmYXVsdChtZXJnZWQs
IGFwcCwgcXB3KTsKICB9Cgp9CQkJICAKCgovLyBhY3R1YWwgY29tbWFuZHMgZm9sbG93CgpD
TUQobHNjZXJ0cywgImtleSBhbmQgY2VydCIsICIoZmlsZXxtYW5pZmVzdCkgPGlkPiIsIAog
ICAgImxpc3QgY2VydHMgYXNzb2NpYXRlZCB3aXRoIG1hbmlmZXN0IG9yIGZpbGUiKQp7CiAg
aWYgKGFyZ3Muc2l6ZSgpICE9IDIpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKCiAgdmVjdG9y
PGNlcnQ+IGNlcnRzOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwoKICBp
ZiAoYXJnc1swXSA9PSAibWFuaWZlc3QiKQogICAgewogICAgICBtYW5pZmVzdF9pZCBpZGVu
dChhcmdzWzFdKTsKICAgICAgdmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IHRzOwogICAgICBh
cHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKGlkZW50LCB0cyk7CiAgICAgIGZvciAoc2l6ZV90
IGkgPSAwOyBpIDwgdHMuc2l6ZSgpOyArK2kpCgljZXJ0cy5wdXNoX2JhY2sodHNbaV0uaW5u
ZXIoKSk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAg
IGZpbGVfaWQgaWRlbnQoYXJnc1sxXSk7CiAgICAgIHZlY3RvcjwgZmlsZTxjZXJ0PiA+IHRz
OwogICAgICBhcHAuZGIuZ2V0X2ZpbGVfY2VydHMoaWRlbnQsIHRzKTsKICAgICAgZm9yIChz
aXplX3QgaSA9IDA7IGkgPCB0cy5zaXplKCk7ICsraSkKCWNlcnRzLnB1c2hfYmFjayh0c1tp
XS5pbm5lcigpKTsKICAgIH0KICBlbHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKCQogIGZv
ciAoc2l6ZV90IGkgPSAwOyBpIDwgY2VydHMuc2l6ZSgpOyArK2kpCiAgICB7CiAgICAgIGJv
b2wgb2sgPSBjaGVja19jZXJ0KGFwcCwgY2VydHNbaV0pOwogICAgICBjZXJ0X3ZhbHVlIHR2
OyAgICAgIAogICAgICBkZWNvZGVfYmFzZTY0KGNlcnRzW2ldLnZhbHVlLCB0dik7CiAgICAg
IHN0cmluZyB3YXNoZWQ7CiAgICAgIGlmIChndWVzc19iaW5hcnkodHYoKSkpCgl7CgkgIHdh
c2hlZCA9ICI8YmluYXJ5IGRhdGE+IjsKCX0KICAgICAgZWxzZQoJewoJICB3YXNoZWQgPSB0
digpOwoJfQogICAgICBzdHJpbmcgaGVhZCA9IHN0cmluZyhvayA/ICJvayBzaWcgZnJvbSAi
IDogImJhZCBzaWcgZnJvbSAiKQoJKyAiWyIgKyBjZXJ0c1tpXS5rZXkoKSArICJdIDogIiAK
CSsgIlsiICsgY2VydHNbaV0ubmFtZSgpICsgIl0gPSBbIjsKICAgICAgc3RyaW5nIHBhZCho
ZWFkLnNpemUoKSwgJyAnKTsKICAgICAgdmVjdG9yPHN0cmluZz4gbGluZXM7CiAgICAgIHNw
bGl0X2ludG9fbGluZXMod2FzaGVkLCBsaW5lcyk7CiAgICAgIEkobGluZXMuc2l6ZSgpID4g
MCk7CiAgICAgIGNvdXQgPDwgaGVhZCA8PCBsaW5lc1swXSA7CiAgICAgIGZvciAoc2l6ZV90
IGkgPSAxOyBpIDwgbGluZXMuc2l6ZSgpOyArK2kpCgljb3V0IDw8IGVuZGwgPDwgcGFkIDw8
IGxpbmVzW2ldOwogICAgICBjb3V0IDw8ICJdIiA8PCBlbmRsOwogICAgfSAgCiAgZ3VhcmQu
Y29tbWl0KCk7Cn0KCkNNRChsc2tleXMsICJrZXkgYW5kIGNlcnQiLCAiW3BhcnRpYWwtaWRd
IiwgImxpc3Qga2V5cyIpCnsKICB2ZWN0b3I8cnNhX2tleXBhaXJfaWQ+IHB1YmtleXM7CiAg
dmVjdG9yPHJzYV9rZXlwYWlyX2lkPiBwcml2a2V5czsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQg
Z3VhcmQoYXBwLmRiKTsKCiAgaWYgKGFyZ3Muc2l6ZSgpID09IDApCiAgICBhcHAuZGIuZ2V0
X2tleV9pZHMoIiIsIHB1YmtleXMsIHByaXZrZXlzKTsKICBlbHNlIGlmIChhcmdzLnNpemUo
KSA9PSAxKQogICAgYXBwLmRiLmdldF9rZXlfaWRzKGFyZ3NbMF0sIHB1YmtleXMsIHByaXZr
ZXlzKTsKICBlbHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKICAKICBpZiAocHVia2V5cy5z
aXplKCkgPiAwKQogICAgewogICAgICBjb3V0IDw8IGVuZGwgPDwgIltwdWJsaWMga2V5c10i
IDw8IGVuZGw7CiAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcHVia2V5cy5zaXplKCk7
ICsraSkKCWNvdXQgPDwgcHVia2V5c1tpXSgpIDw8IGVuZGw7CiAgICAgIGNvdXQgPDwgZW5k
bDsKICAgIH0KCiAgaWYgKHByaXZrZXlzLnNpemUoKSA+IDApCiAgICB7CiAgICAgIGNvdXQg
PDwgZW5kbCA8PCAiW3ByaXZhdGUga2V5c10iIDw8IGVuZGw7CiAgICAgIGZvciAoc2l6ZV90
IGkgPSAwOyBpIDwgcHJpdmtleXMuc2l6ZSgpOyArK2kpCgljb3V0IDw8IHByaXZrZXlzW2ld
KCkgPDwgZW5kbDsKICAgICAgY291dCA8PCBlbmRsOwogICAgfQoKICBndWFyZC5jb21taXQo
KTsKfQoKQ01EKGdlbmtleSwgImtleSBhbmQgY2VydCIsICI8a2V5aWQ+IiwgImdlbmVyYXRl
IGFuIFJTQSBrZXktcGFpciIpCnsKICBpZiAoYXJncy5zaXplKCkgIT0gMSkKICAgIHRocm93
IHVzYWdlKG5hbWUpOwogIAogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CiAg
cnNhX2tleXBhaXJfaWQgaWRlbnQoYXJnc1swXSk7CgogIE4oISBhcHAuZGIua2V5X2V4aXN0
cyhpZGVudCksCiAgICAoc3RyaW5nKCJrZXkgJyIpICsgaWRlbnQoKSArICInIGFscmVhZHkg
ZXhpc3RzIGluIGRhdGFiYXNlIikpOwogIAogIGJhc2U2NDxyc2FfcHViX2tleT4gcHViOwog
IGJhc2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4gcHJpdjsKICBQKCJnZW5lcmF0aW5nIGtl
eS1wYWlyICclcydcbiIsIGlkZW50KCkuY19zdHIoKSk7CiAgZ2VuZXJhdGVfa2V5X3BhaXIo
YXBwLmx1YSwgaWRlbnQsIHB1YiwgcHJpdik7CiAgUCgic3RvcmluZyBrZXktcGFpciAnJXMn
IGluIGRhdGFiYXNlXG4iLCBpZGVudCgpLmNfc3RyKCkpOwogIGFwcC5kYi5wdXRfa2V5X3Bh
aXIoaWRlbnQsIHB1YiwgcHJpdik7CgogIGd1YXJkLmNvbW1pdCgpOwp9CgpDTUQoY2VydCwg
ImtleSBhbmQgY2VydCIsICIoZmlsZXxtYW5pZmVzdCkgPGlkPiA8Y2VydG5hbWU+IFtjZXJ0
dmFsXSIsIAogICAgICAgICAgICAgICAgICAgICAgICAiY3JlYXRlIGEgY2VydCBmb3IgYSBm
aWxlIG9yIG1hbmlmZXN0IikKewogIGlmICgoYXJncy5zaXplKCkgIT0gNCkgJiYgKGFyZ3Mu
c2l6ZSgpICE9IDMpKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7CgogIHRyYW5zYWN0aW9uX2d1
YXJkIGd1YXJkKGFwcC5kYik7CgogIGhleGVuYzxpZD4gaWRlbnQoYXJnc1sxXSk7CiAgY2Vy
dF9uYW1lIG5hbWUoYXJnc1syXSk7CgogIHJzYV9rZXlwYWlyX2lkIGtleTsKICBpZiAoYXBw
LnNpZ25pbmdfa2V5KCkgIT0gIiIpCiAgICBrZXkgPSBhcHAuc2lnbmluZ19rZXk7CiAgZWxz
ZQogICAgTihndWVzc19kZWZhdWx0X2tleShrZXksIGFwcCksCiAgICAgICJubyB1bmlxdWUg
cHJpdmF0ZSBrZXkgZm91bmQsIGFuZCBubyBrZXkgc3BlY2lmaWVkIik7CiAgCiAgY2VydF92
YWx1ZSB2YWw7CiAgaWYgKGFyZ3Muc2l6ZSgpID09IDQpCiAgICB2YWwgPSBjZXJ0X3ZhbHVl
KGFyZ3NbM10pOwogIGVsc2UKICAgIHZhbCA9IGNlcnRfdmFsdWUoZ2V0X3N0ZGluKCkpOwoK
ICBiYXNlNjQ8Y2VydF92YWx1ZT4gdmFsX2VuY29kZWQ7CiAgZW5jb2RlX2Jhc2U2NCh2YWws
IHZhbF9lbmNvZGVkKTsKCiAgY2VydCB0KGlkZW50LCBuYW1lLCB2YWxfZW5jb2RlZCwga2V5
KTsKICAKICAvLyBuYjogd2Ugd2FudCB0byB0aHJvdyB1c2FnZSBvbiBtaXMtdXNlICpiZWZv
cmUqIGFza2luZyBmb3IgYQogIC8vIHBhc3NwaHJhc2UuCgogIGlmIChhcmdzWzBdID09ICJm
aWxlIikKICAgIHsKICAgICAgY2FsY3VsYXRlX2NlcnQoYXBwLCB0KTsKICAgICAgYXBwLmRi
LnB1dF9maWxlX2NlcnQoZmlsZTxjZXJ0Pih0KSk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1sw
XSA9PSAibWFuaWZlc3QiKQogICAgewogICAgICBjYWxjdWxhdGVfY2VydChhcHAsIHQpOwog
ICAgICBhcHAuZGIucHV0X21hbmlmZXN0X2NlcnQobWFuaWZlc3Q8Y2VydD4odCkpOwogICAg
fQogIGVsc2UKICAgIHRocm93IHVzYWdlKHRoaXMtPm5hbWUpOwoKICBndWFyZC5jb21taXQo
KTsKfQoKCkNNRCh0YWcsICJjZXJ0aWZpY2F0ZSIsICI8aWQ+IDx0YWduYW1lPiIsIAogICAg
InB1dCBhIHN5bWJvbGljIHRhZyBjZXJ0IG9uIGEgbWFuaWZlc3QgdmVyc2lvbiIpCnsKICBp
ZiAoYXJncy5zaXplKCkgIT0gMikKICAgIHRocm93IHVzYWdlKG5hbWUpOwogIG1hbmlmZXN0
X2lkIG0oYXJnc1swXSk7CiAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsKICBjZXJ0X21h
bmlmZXN0X3RhZyhtLCBhcmdzWzFdLCBhcHAsIGRidyk7Cn0KCkNNRChhcHByb3ZlLCAiY2Vy
dGlmaWNhdGUiLCAiKGZpbGV8bWFuaWZlc3QpIDxpZD4iLCAKICAgICJhcHByb3ZlIG9mIGEg
bWFuaWZlc3Qgb3IgZmlsZSB2ZXJzaW9uIikKewogIGlmIChhcmdzLnNpemUoKSAhPSAyKQog
ICAgdGhyb3cgdXNhZ2UobmFtZSk7CiAgaWYgKGFyZ3NbMF0gPT0gIm1hbmlmZXN0IikKICAg
IHsKICAgICAgbWFuaWZlc3RfaWQgbShhcmdzWzFdKTsKICAgICAgcGFja2V0X2RiX3dyaXRl
ciBkYncoYXBwKTsKICAgICAgY2VydF9tYW5pZmVzdF9hcHByb3ZhbChtLCB0cnVlLCBhcHAs
IGRidyk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAg
IHBhY2tldF9kYl93cml0ZXIgZGJ3KGFwcCk7CiAgICAgIGZpbGVfaWQgZihhcmdzWzFdKTsK
ICAgICAgY2VydF9maWxlX2FwcHJvdmFsKGYsIHRydWUsIGFwcCwgZGJ3KTsKICAgIH0KICBl
bHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKfQoKQ01EKGRpc2FwcHJvdmUsICJjZXJ0aWZp
Y2F0ZSIsICIoZmlsZXxtYW5pZmVzdCkgPGlkPiIsIAogICAgImRpc2FwcHJvdmUgb2YgYSBt
YW5pZmVzdCBvciBmaWxlIHZlcnNpb24iKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDIpCiAg
ICB0aHJvdyB1c2FnZShuYW1lKTsKICBpZiAoYXJnc1swXSA9PSAibWFuaWZlc3QiKQogICAg
ewogICAgICBtYW5pZmVzdF9pZCBtKGFyZ3NbMV0pOwogICAgICBwYWNrZXRfZGJfd3JpdGVy
IGRidyhhcHApOwogICAgICBjZXJ0X21hbmlmZXN0X2FwcHJvdmFsKG0sIGZhbHNlLCBhcHAs
IGRidyk7CiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAg
IGZpbGVfaWQgZihhcmdzWzFdKTsKICAgICAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsK
ICAgICAgY2VydF9maWxlX2FwcHJvdmFsKGYsIGZhbHNlLCBhcHAsIGRidyk7CiAgICB9CiAg
ZWxzZQogICAgdGhyb3cgdXNhZ2UobmFtZSk7Cn0KCgpDTUQoY29tbWVudCwgImNlcnRpZmlj
YXRlIiwgIihmaWxlfG1hbmlmZXN0KSA8aWQ+IFtjb21tZW50XSIsIAogICAgImNvbW1lbnQg
b24gYSBmaWxlIG9yIG1hbmlmZXN0IHZlcnNpb24iKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9
IDIgJiYgYXJncy5zaXplKCkgIT0gMykKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICBzdHJp
bmcgY29tbWVudDsKICBpZiAoYXJncy5zaXplKCkgPT0gMykKICAgIGNvbW1lbnQgPSBhcmdz
WzJdOwogIGVsc2UKICAgIE4oYXBwLmx1YS5ob29rX2VkaXRfY29tbWVudCgiIiwgY29tbWVu
dCksICJlZGl0IGNvbW1lbnQgZmFpbGVkIik7CiAgCiAgTihjb21tZW50LmZpbmRfZmlyc3Rf
bm90X29mKCIgXHJcdFxuIikgPT0gc3RyaW5nOjpucG9zLCAiZW1wdHkgY29tbWVudCIpOwoK
ICBpZiAoYXJnc1swXSA9PSAiZmlsZSIpCiAgICB7CiAgICAgIHBhY2tldF9kYl93cml0ZXIg
ZGJ3KGFwcCk7CiAgICAgIGNlcnRfZmlsZV9jb21tZW50KGZpbGVfaWQoYXJnc1sxXSksIGNv
bW1lbnQsIGFwcCwgZGJ3KTsgCiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAibWFuaWZl
c3QiKQogICAgewogICAgICBwYWNrZXRfZGJfd3JpdGVyIGRidyhhcHApOwogICAgICBjZXJ0
X21hbmlmZXN0X2NvbW1lbnQobWFuaWZlc3RfaWQoYXJnc1sxXSksIGNvbW1lbnQsIGFwcCwg
ZGJ3KTsKICAgIH0KICBlbHNlCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKfQoKCgpDTUQoYWRk
LCAid29ya2luZyBjb3B5IiwgIjxwYXRobmFtZT4gWy4uLl0iLCAiYWRkIGZpbGVzIHRvIHdv
cmtpbmcgY29weSIpCnsKICBpZiAoYXJncy5zaXplKCkgPCAxKQogICAgdGhyb3cgdXNhZ2Uo
bmFtZSk7CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CgogIG1hbmlmZXN0
X21hcCBtYW47CiAgd29ya19zZXQgd29yazsgIAogIGdldF9tYW5pZmVzdF9tYXAobWFuKTsK
ICBnZXRfd29ya19zZXQod29yayk7CiAgYm9vbCByZXdyaXRlX3dvcmsgPSBmYWxzZTsKCiAg
Zm9yICh2ZWN0b3I8c3RyaW5nPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGFyZ3MuYmVnaW4oKTsg
aSAhPSBhcmdzLmVuZCgpOyArK2kpCiAgICBidWlsZF9hZGRpdGlvbihmaWxlX3BhdGgoKmkp
LCBhcHAsIHdvcmssIG1hbiwgcmV3cml0ZV93b3JrKTsKICAKICBndWFyZC5jb21taXQoKTsK
ICAKICAvLyBzbWFsbCByYWNlIGhlcmUKICBpZiAocmV3cml0ZV93b3JrKQogICAgcHV0X3dv
cmtfc2V0KHdvcmspOwp9CgpDTUQoZHJvcCwgIndvcmtpbmcgY29weSIsICI8cGF0aG5hbWU+
IFsuLi5dIiwgImRyb3AgZmlsZXMgZnJvbSB3b3JraW5nIGNvcHkiKQp7CiAgaWYgKGFyZ3Mu
c2l6ZSgpIDwgMSkKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICBtYW5pZmVzdF9tYXAgbWFu
OwogIHdvcmtfc2V0IHdvcms7CiAgZ2V0X21hbmlmZXN0X21hcChtYW4pOwogIGdldF93b3Jr
X3NldCh3b3JrKTsKICBib29sIHJld3JpdGVfd29yayA9IGZhbHNlOwoKICB0cmFuc2FjdGlv
bl9ndWFyZCBndWFyZChhcHAuZGIpOwoKICBmb3IgKHZlY3RvcjxzdHJpbmc+Ojpjb25zdF9p
dGVyYXRvciBpID0gYXJncy5iZWdpbigpOyBpICE9IGFyZ3MuZW5kKCk7ICsraSkKICAgIGJ1
aWxkX2RlbGV0aW9uKGZpbGVfcGF0aCgqaSksIGFwcCwgd29yaywgbWFuLCByZXdyaXRlX3dv
cmspOwogIAogIGd1YXJkLmNvbW1pdCgpOwoKICAvLyBzbWFsbCByYWNlIGhlcmUKICBpZiAo
cmV3cml0ZV93b3JrKQogICAgcHV0X3dvcmtfc2V0KHdvcmspOwp9CgpDTUQoY29tbWl0LCAi
d29ya2luZyBjb3B5IiwgIltsb2cgbWVzc2FnZV0iLCAiY29tbWl0IHdvcmtpbmcgY29weSB0
byBkYXRhYmFzZSIpCnsKICBzdHJpbmcgbG9nX21lc3NhZ2UoIiIpOwogIG1hbmlmZXN0X21h
cCBtX29sZCwgbV9uZXc7CiAgcGF0Y2hfc2V0IHBzOwoKICBnZXRfbWFuaWZlc3RfbWFwKG1f
b2xkKTsKICBjYWxjdWxhdGVfbmV3X21hbmlmZXN0X21hcChtX29sZCwgbV9uZXcpOwogIG1h
bmlmZXN0X2lkIG9sZF9pZCwgbmV3X2lkOwogIGNhbGN1bGF0ZV9tYW5pZmVzdF9tYXBfaWRl
bnQobV9vbGQsIG9sZF9pZCk7CiAgY2FsY3VsYXRlX21hbmlmZXN0X21hcF9pZGVudChtX25l
dywgbmV3X2lkKTsKCiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDAgJiYgYXJncy5zaXplKCkgIT0g
MSkKICAgIHRocm93IHVzYWdlKG5hbWUpOwogIAogIGNlcnRfdmFsdWUgYnJhbmNobmFtZTsK
ICBpZiAoYXBwLmJyYW5jaF9uYW1lICE9ICIiKQogICAgewogICAgICBicmFuY2huYW1lID0g
YXBwLmJyYW5jaF9uYW1lOwogICAgfQogIGVsc2UKICAgIHsKICAgICAgdmVjdG9yPCBtYW5p
ZmVzdDxjZXJ0PiA+IGNlcnRzOwogICAgICBjZXJ0X25hbWUgYnJhbmNoKGJyYW5jaF9jZXJ0
X25hbWUpOwogICAgICBhcHAuZGIuZ2V0X21hbmlmZXN0X2NlcnRzKG9sZF9pZCwgYnJhbmNo
LCBjZXJ0cyk7CgogICAgICBOKGNlcnRzLnNpemUoKSAhPSAwLCAKCXN0cmluZygibm8gYnJh
bmNoIGNlcnRzIGZvdW5kIGZvciBvbGQgbWFuaWZlc3QgIikKCSsgb2xkX2lkLmlubmVyKCko
KSArICIsIHBsZWFzZSBwcm92aWRlIGEgYnJhbmNoIG5hbWUiKTsKCiAgICAgIE4oY2VydHMu
c2l6ZSgpID09IDEsCglzdHJpbmcoIm11bHRpcGxlIGJyYW5jaCBjZXJ0cyBmb3VuZCBmb3Ig
b2xkIG1hbmlmZXN0ICIpCgkrIG9sZF9pZC5pbm5lcigpKCkgKyAiLCBwbGVhc2UgcHJvdmlk
ZSBhIGJyYW5jaCBuYW1lIik7CgogICAgICBkZWNvZGVfYmFzZTY0KGNlcnRzWzBdLmlubmVy
KCkudmFsdWUsIGJyYW5jaG5hbWUpOwogICAgfQogICAgCiAgTCgiY29tbWl0dGluZyAlcyB0
byBicmFuY2ggJXNcbiIsIAogICAgbmV3X2lkLmlubmVyKCkoKS5jX3N0cigpLCBicmFuY2hu
YW1lKCkuY19zdHIoKSk7CiAgYXBwLmJyYW5jaF9uYW1lID0gYnJhbmNobmFtZSgpOwoKICBt
YW5pZmVzdHNfdG9fcGF0Y2hfc2V0KG1fb2xkLCBtX25ldywgYXBwLCBwcyk7CgogIC8vIGdl
dCBsb2cgbWVzc2FnZQogIGlmIChhcmdzLnNpemUoKSA9PSAxKQogICAgbG9nX21lc3NhZ2Ug
PSBhcmdzWzBdOwogIGVsc2UKICAgIGdldF9sb2dfbWVzc2FnZShwcywgYXBwLCBsb2dfbWVz
c2FnZSk7CgogIE4obG9nX21lc3NhZ2UuZmluZF9maXJzdF9ub3Rfb2YoIiBcclx0XG4iKSAh
PSBzdHJpbmc6Om5wb3MsCiAgICAiZW1wdHkgbG9nIG1lc3NhZ2UiKTsKCiAgewogICAgdHJh
bnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRiKTsKCiAgICAvLyBwcm9jZXNzIG1hbmlmZXN0
IGRlbHRhIG9yIG5ldyBtYW5pZmVzdAogICAgaWYgKGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9u
X2V4aXN0cyhwcy5tX25ldykpCiAgICAgIHsKCUwoInNraXBwaW5nIG1hbmlmZXN0ICVzLCBh
bHJlYWR5IGluIGRhdGFiYXNlXG4iLCBwcy5tX25ldy5pbm5lcigpKCkuY19zdHIoKSk7CiAg
ICAgIH0KICAgIGVsc2UKICAgICAgewoJaWYgKGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9uX2V4
aXN0cyhwcy5tX29sZCkpCgkgIHsKCSAgICBMKCJpbnNlcnRpbmcgbWFuaWZlc3QgZGVsdGEg
JXMgLT4gJXNcbiIsIAoJICAgICAgcHMubV9vbGQuaW5uZXIoKSgpLmNfc3RyKCksIHBzLm1f
bmV3LmlubmVyKCkoKS5jX3N0cigpKTsKCSAgICBtYW5pZmVzdF9kYXRhIG1fb2xkX2RhdGEs
IG1fbmV3X2RhdGE7CgkgICAgYXBwLmRiLmdldF9tYW5pZmVzdF92ZXJzaW9uKHBzLm1fb2xk
LCBtX29sZF9kYXRhKTsKCSAgICB3cml0ZV9tYW5pZmVzdF9tYXAobV9uZXcsIG1fbmV3X2Rh
dGEpOwoJICAgIGJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBkZWw7CgkgICAgZGlmZihtX29sZF9k
YXRhLmlubmVyKCksIG1fbmV3X2RhdGEuaW5uZXIoKSwgZGVsKTsKCSAgICBhcHAuZGIucHV0
X21hbmlmZXN0X3ZlcnNpb24ocHMubV9vbGQsIHBzLm1fbmV3LCBtYW5pZmVzdF9kZWx0YShk
ZWwpKTsKCSAgfQoJZWxzZQoJICB7CgkgICAgTCgiaW5zZXJ0aW5nIGZ1bGwgbWFuaWZlc3Qg
JXNcbiIsIAoJICAgICAgcHMubV9uZXcuaW5uZXIoKSgpLmNfc3RyKCkpOwoJICAgIG1hbmlm
ZXN0X2RhdGEgbV9uZXdfZGF0YTsKCSAgICB3cml0ZV9tYW5pZmVzdF9tYXAobV9uZXcsIG1f
bmV3X2RhdGEpOwoJICAgIGFwcC5kYi5wdXRfbWFuaWZlc3QocHMubV9uZXcsIG1fbmV3X2Rh
dGEpOwoJICB9CiAgICAgIH0KCiAgICAvLyBwcm9jZXNzIGZpbGUgZGVsdGFzCiAgICBmb3Ig
KHNldDxwYXRjaF9kZWx0YT46OmNvbnN0X2l0ZXJhdG9yIGkgPSBwcy5mX2RlbHRhcy5iZWdp
bigpOwoJIGkgIT0gcHMuZl9kZWx0YXMuZW5kKCk7ICsraSkKICAgICAgewoJaWYgKGFwcC5k
Yi5maWxlX3ZlcnNpb25fZXhpc3RzKGktPmlkX25ldykpCgkgIHsKCSAgICBMKCJza2lwcGlu
ZyBmaWxlIGRlbHRhICVzLCBhbHJlYWR5IGluIGRhdGFiYXNlXG4iLCBpLT5pZF9uZXcuaW5u
ZXIoKSgpLmNfc3RyKCkpOwoJICB9CgllbHNlCgkgIHsKCSAgICBpZiAoYXBwLmRiLmZpbGVf
dmVyc2lvbl9leGlzdHMoaS0+aWRfb2xkKSkKCSAgICAgIHsKCQlMKCJpbnNlcnRpbmcgZGVs
dGEgJXMgLT4gJXNcbiIsIAoJCSAgaS0+aWRfb2xkLmlubmVyKCkoKS5jX3N0cigpLCBpLT5p
ZF9uZXcuaW5uZXIoKSgpLmNfc3RyKCkpOwoJCWZpbGVfZGF0YSBvbGRfZGF0YTsKCQliYXNl
NjQ8IGd6aXA8ZGF0YT4gPiBuZXdfZGF0YTsKCQlhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lvbihp
LT5pZF9vbGQsIG9sZF9kYXRhKTsKCQlyZWFkX2RhdGEoaS0+cGF0aCwgbmV3X2RhdGEpOwoJ
CWJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBkZWw7CgkJZGlmZihvbGRfZGF0YS5pbm5lcigpLCBu
ZXdfZGF0YSwgZGVsKTsKCQlhcHAuZGIucHV0X2ZpbGVfdmVyc2lvbihpLT5pZF9vbGQsIGkt
PmlkX25ldywgZmlsZV9kZWx0YShkZWwpKTsKCSAgICAgIH0KCSAgICBlbHNlCgkgICAgICB7
CgkJTCgiaW5zZXJ0aW5nIGZ1bGwgdmVyc2lvbiAlc1xuIiwgaS0+aWRfb2xkLmlubmVyKCko
KS5jX3N0cigpKTsKCQliYXNlNjQ8IGd6aXA8ZGF0YT4gPiBuZXdfZGF0YTsKCQlyZWFkX2Rh
dGEoaS0+cGF0aCwgbmV3X2RhdGEpOwoJCS8vIHNhbml0eSBjaGVjawoJCWhleGVuYzxpZD4g
dGlkOwoJCWNhbGN1bGF0ZV9pZGVudChuZXdfZGF0YSwgdGlkKTsKCQlJKHRpZCA9PSBpLT5p
ZF9uZXcuaW5uZXIoKSk7CgkJYXBwLmRiLnB1dF9maWxlKGktPmlkX25ldywgZmlsZV9kYXRh
KG5ld19kYXRhKSk7CgkgICAgICB9CgkgIH0KICAgICAgfQogIAogICAgLy8gcHJvY2VzcyBm
aWxlIGFkZHMKICAgIGZvciAoc2V0PHBhdGNoX2FkZGl0aW9uPjo6Y29uc3RfaXRlcmF0b3Ig
aSA9IHBzLmZfYWRkcy5iZWdpbigpOwoJIGkgIT0gcHMuZl9hZGRzLmVuZCgpOyArK2kpCiAg
ICAgIHsKCWlmIChhcHAuZGIuZmlsZV92ZXJzaW9uX2V4aXN0cyhpLT5pZGVudCkpCgkgIHsK
CSAgICBMKCJza2lwcGluZyBmaWxlICVzICVzLCBhbHJlYWR5IGluIGRhdGFiYXNlXG4iLCAK
CSAgICAgIGktPnBhdGgoKS5jX3N0cigpLCBpLT5pZGVudC5pbm5lcigpKCkuY19zdHIoKSk7
CgkgIH0KCWVsc2UKCSAgewoJICAgIC8vIGl0J3MgYSBuZXcgZmlsZQoJICAgIEwoImluc2Vy
dGluZyBuZXcgZmlsZSAlcyAlc1xuIiwgCgkgICAgICBpLT5wYXRoKCkuY19zdHIoKSwgaS0+
aWRlbnQuaW5uZXIoKSgpLmNfc3RyKCkpOwoJICAgIGJhc2U2NDwgZ3ppcDxkYXRhPiA+IG5l
d19kYXRhOwoJICAgIHJlYWRfZGF0YShpLT5wYXRoLCBuZXdfZGF0YSk7CgkgICAgYXBwLmRi
LnB1dF9maWxlKGktPmlkZW50LCBuZXdfZGF0YSk7CgkgIH0KICAgICAgfQoKICAgIHBhY2tl
dF9kYl93cml0ZXIgZGJ3KGFwcCk7CgogICAgaWYgKCEgbV9vbGQuZW1wdHkoKSkKICAgICAg
Y2VydF9tYW5pZmVzdF9hbmNlc3Rvcihwcy5tX29sZCwgcHMubV9uZXcsIGFwcCwgZGJ3KTsK
CiAgICBjZXJ0X21hbmlmZXN0X2luX2JyYW5jaChwcy5tX25ldywgYnJhbmNobmFtZSwgYXBw
LCBkYncpOyAKICAgIGNlcnRfbWFuaWZlc3RfZGF0ZV9ub3cocHMubV9uZXcsIGFwcCwgZGJ3
KTsKICAgIGNlcnRfbWFuaWZlc3RfYXV0aG9yX2RlZmF1bHQocHMubV9uZXcsIGFwcCwgZGJ3
KTsKICAgIGNlcnRfbWFuaWZlc3RfY2hhbmdlbG9nKHBzLm1fbmV3LCBsb2dfbWVzc2FnZSwg
YXBwLCBkYncpOwoKICAgIC8vIGNvbW1pdCBkb25lLCBub3cgcXVldWUgZGlmZiBmb3Igc2Vu
ZGluZwoKICAgIGlmIChhcHAuZGIubWFuaWZlc3RfdmVyc2lvbl9leGlzdHMocHMubV9uZXcp
KQogICAgICB7Cgl2ZWN0b3I8IHBhaXI8dXJsLGdyb3VwPiA+IHRhcmdldHM7CglhcHAubHVh
Lmhvb2tfZ2V0X3Bvc3RfdGFyZ2V0cyhicmFuY2huYW1lLCB0YXJnZXRzKTsKCQoJLy8gbWFr
ZSBzdXJlIHRoZSBhcHByb3ByaWF0ZSBlZGdlcyBnZXQgcXVldWVkIGZvciB0aGUgbmV0d29y
ay4KCWZvciAodmVjdG9yPCBwYWlyPHVybCxncm91cD4gPjo6Y29uc3RfaXRlcmF0b3IgdGFy
ZyA9IHRhcmdldHMuYmVnaW4oKTsKCSAgICAgdGFyZyAhPSB0YXJnZXRzLmVuZCgpOyArK3Rh
cmcpCgkgIHsKCSAgICBxdWV1ZV9lZGdlX2Zvcl90YXJnZXRfYW5jZXN0b3IgKCp0YXJnLCBw
cy5tX25ldywgbV9uZXcsIGFwcCk7CgkgIH0KCQoJLy8gdGhyb3cgaW4gYWxsIGF2YWlsYWJs
ZSBjZXJ0cyBmb3IgZ29vZCBtZWFzdXJlCglxdWV1ZWluZ19wYWNrZXRfd3JpdGVyIHFwdyhh
cHAsIHRhcmdldHMpOwoJdmVjdG9yPCBtYW5pZmVzdDxjZXJ0PiA+IGNlcnRzOwoJYXBwLmRi
LmdldF9tYW5pZmVzdF9jZXJ0cyhwcy5tX25ldywgY2VydHMpOwoJZm9yKHZlY3RvcjwgbWFu
aWZlc3Q8Y2VydD4gPjo6Y29uc3RfaXRlcmF0b3IgaSA9IGNlcnRzLmJlZ2luKCk7CgkgICAg
aSAhPSBjZXJ0cy5lbmQoKTsgKytpKQoJICBxcHcuY29uc3VtZV9tYW5pZmVzdF9jZXJ0KCpp
KTsKICAgICAgfSAKICAgIAogICAgZ3VhcmQuY29tbWl0KCk7CiAgfQogIC8vIHNtYWxsIHJh
Y2UgY29uZGl0aW9uIGhlcmUuLi4KICBsb2NhbF9wYXRoIHdfcGF0aDsKICBnZXRfd29ya19w
YXRoKHdfcGF0aCk7CiAgZGVsZXRlX2ZpbGUod19wYXRoKTsKICBwdXRfbWFuaWZlc3RfbWFw
KG1fbmV3KTsKICBQKCJjb21taXR0ZWQgJXNcbiIsIHBzLm1fbmV3LmlubmVyKCkoKS5jX3N0
cigpKTsKfQoKQ01EKHVwZGF0ZSwgIndvcmtpbmcgY29weSIsICJbc29ydCBrZXlzLi4uXSIs
ICJ1cGRhdGUgd29ya2luZyBjb3B5LCByZWxhdGl2ZSB0byBzb3J0aW5nIGtleXMiKQp7Cgog
IG1hbmlmZXN0X2RhdGEgbV9jaG9zZW5fZGF0YTsKICBtYW5pZmVzdF9tYXAgbV9vbGQsIG1f
d29ya2luZywgbV9jaG9zZW4sIG1fbmV3OwogIG1hbmlmZXN0X2lkIG1fb2xkX2lkLCBtX2No
b3Nlbl9pZDsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRiKTsKCiAgZ2V0X21h
bmlmZXN0X21hcChtX29sZCk7CiAgY2FsY3VsYXRlX21hbmlmZXN0X21hcF9pZGVudChtX29s
ZCwgbV9vbGRfaWQpOwogIGNhbGN1bGF0ZV9uZXdfbWFuaWZlc3RfbWFwKG1fb2xkLCBtX3dv
cmtpbmcpOwogIAogIHBpY2tfdXBkYXRlX3RhcmdldChtX29sZF9pZCwgYXJncywgYXBwLCBt
X2Nob3Nlbl9pZCk7CiAgUCgic2VsZWN0ZWQgdXBkYXRlIHRhcmdldCAlc1xuIiwKICAgIG1f
Y2hvc2VuX2lkLmlubmVyKCkoKS5jX3N0cigpKTsKICBhcHAuZGIuZ2V0X21hbmlmZXN0X3Zl
cnNpb24obV9jaG9zZW5faWQsIG1fY2hvc2VuX2RhdGEpOwogIHJlYWRfbWFuaWZlc3RfbWFw
KG1fY2hvc2VuX2RhdGEsIG1fY2hvc2VuKTsKCiAgdXBkYXRlX21lcmdlX3Byb3ZpZGVyIG1l
cmdlcihhcHApOwogIE4obWVyZ2UzKG1fb2xkLCBtX2Nob3NlbiwgbV93b3JraW5nLCBhcHAs
IG1lcmdlciwgbV9uZXcpLAogICAgc3RyaW5nKCJtYW5pZmVzdCBtZXJnZSBmYWlsZWQsIG5v
IHVwZGF0ZSBwZXJmb3JtZWQiKSk7CgogIFAoImNhbGN1bGF0aW5nIHBhdGNoc2V0IGZvciB1
cGRhdGVcbiIpOwogIHBhdGNoX3NldCBwczsKICBtYW5pZmVzdHNfdG9fcGF0Y2hfc2V0KG1f
d29ya2luZywgbV9uZXcsIGFwcCwgcHMpOwoKICBMKCJhcHBseWluZyAlZCBkZWxldGlvbnMg
dG8gZmlsZXMgaW4gdHJlZVxuIiwgcHMuZl9kZWxzLnNpemUoKSk7CiAgZm9yIChzZXQ8Zmls
ZV9wYXRoPjo6Y29uc3RfaXRlcmF0b3IgaSA9IHBzLmZfZGVscy5iZWdpbigpOwogICAgICAg
aSAhPSBwcy5mX2RlbHMuZW5kKCk7ICsraSkKICAgIHsKICAgICAgTCgiZGVsZXRpbmcgJXNc
biIsICgqaSkoKS5jX3N0cigpKTsKICAgICAgZGVsZXRlX2ZpbGUoKmkpOwogICAgfQoKICBM
KCJhcHBseWluZyAlZCBtb3ZlcyB0byBmaWxlcyBpbiB0cmVlXG4iLCBwcy5mX21vdmVzLnNp
emUoKSk7CiAgZm9yIChzZXQ8cGF0Y2hfbW92ZT46OmNvbnN0X2l0ZXJhdG9yIGkgPSBwcy5m
X21vdmVzLmJlZ2luKCk7CiAgICAgICBpICE9IHBzLmZfbW92ZXMuZW5kKCk7ICsraSkKICAg
IHsKICAgICAgTCgibW92aW5nICVzIC0+ICVzXG4iLCBpLT5wYXRoX29sZCgpLmNfc3RyKCks
IGktPnBhdGhfbmV3KCkuY19zdHIoKSk7CiAgICAgIG1vdmVfZmlsZShpLT5wYXRoX29sZCwg
aS0+cGF0aF9uZXcpOwogICAgfQogIAogIEwoImFwcGx5aW5nICVkIGFkZGl0aW9ucyB0byB0
cmVlXG4iLCBwcy5mX2FkZHMuc2l6ZSgpKTsKICBmb3IgKHNldDxwYXRjaF9hZGRpdGlvbj46
OmNvbnN0X2l0ZXJhdG9yIGkgPSBwcy5mX2FkZHMuYmVnaW4oKTsKICAgICAgIGkgIT0gcHMu
Zl9hZGRzLmVuZCgpOyArK2kpCiAgICB7CiAgICAgIEwoImFkZGluZyAlcyBhcyAlc1xuIiwg
aS0+aWRlbnQuaW5uZXIoKSgpLmNfc3RyKCksIGktPnBhdGgoKS5jX3N0cigpKTsKICAgICAg
ZmlsZV9kYXRhIHRtcDsKICAgICAgaWYgKGFwcC5kYi5maWxlX3ZlcnNpb25fZXhpc3RzKGkt
PmlkZW50KSkKCWFwcC5kYi5nZXRfZmlsZV92ZXJzaW9uKGktPmlkZW50LCB0bXApOwogICAg
ICBlbHNlIGlmIChtZXJnZXIudGVtcG9yYXJ5X3N0b3JlLmZpbmQoaS0+aWRlbnQpICE9IG1l
cmdlci50ZW1wb3Jhcnlfc3RvcmUuZW5kKCkpCgl0bXAgPSBtZXJnZXIudGVtcG9yYXJ5X3N0
b3JlW2ktPmlkZW50XTsKICAgICAgZWxzZQoJSShmYWxzZSk7IC8vIHRyaXAgYXNzZXJ0LiB0
aGlzIHNob3VsZCBiZSBpbXBvc3NpYmxlLgogICAgICB3cml0ZV9kYXRhKGktPnBhdGgsIHRt
cC5pbm5lcigpKTsKICAgIH0KCiAgTCgiYXBwbHlpbmcgJWQgZGVsdGFzIHRvIHRyZWVcbiIs
IHBzLmZfZGVsdGFzLnNpemUoKSk7CiAgZm9yIChzZXQ8cGF0Y2hfZGVsdGE+Ojpjb25zdF9p
dGVyYXRvciBpID0gcHMuZl9kZWx0YXMuYmVnaW4oKTsKICAgICAgIGkgIT0gcHMuZl9kZWx0
YXMuZW5kKCk7ICsraSkKICAgIHsKICAgICAgUCgidXBkYXRpbmcgZmlsZSAlczogJXMgLT4g
JXNcbiIsIAoJaS0+cGF0aCgpLmNfc3RyKCksCglpLT5pZF9vbGQuaW5uZXIoKSgpLmNfc3Ry
KCksCglpLT5pZF9uZXcuaW5uZXIoKSgpLmNfc3RyKCkpOwogICAgICAKICAgICAgLy8gc2Fu
aXR5IGNoZWNrCiAgICAgIHsKCWJhc2U2NDwgZ3ppcDxkYXRhPiA+IGR0bXA7CgloZXhlbmM8
aWQ+IGR0bXBfaWQ7CglyZWFkX2RhdGEoaS0+cGF0aCwgZHRtcCk7CgljYWxjdWxhdGVfaWRl
bnQoZHRtcCwgZHRtcF9pZCk7CglJKGR0bXBfaWQgPT0gaS0+aWRfb2xkLmlubmVyKCkpOwog
ICAgICB9CgogICAgICAvLyBvaywgcmVwbGFjZSB3aXRoIG5ldyB2ZXJzaW9uCiAgICAgIHsK
CWZpbGVfZGF0YSB0bXA7CglpZiAoYXBwLmRiLmZpbGVfdmVyc2lvbl9leGlzdHMoaS0+aWRf
bmV3KSkKCSAgYXBwLmRiLmdldF9maWxlX3ZlcnNpb24oaS0+aWRfbmV3LCB0bXApOwoJZWxz
ZSBpZiAobWVyZ2VyLnRlbXBvcmFyeV9zdG9yZS5maW5kKGktPmlkX25ldykgIT0gbWVyZ2Vy
LnRlbXBvcmFyeV9zdG9yZS5lbmQoKSkKCSAgdG1wID0gbWVyZ2VyLnRlbXBvcmFyeV9zdG9y
ZVtpLT5pZF9uZXddOwoJZWxzZQoJICBJKGZhbHNlKTsgLy8gdHJpcCBhc3NlcnQuIHRoaXMg
c2hvdWxkIGJlIGltcG9zc2libGUuCgl3cml0ZV9kYXRhKGktPnBhdGgsIHRtcC5pbm5lcigp
KTsKICAgICAgfQogICAgfQogIAogIEwoInVwZGF0ZSBzdWNjZXNzZnVsXG4iKTsKICBndWFy
ZC5jb21taXQoKTsKCiAgLy8gc21hbGwgcmFjZSBjb25kaXRpb24gaGVyZS4uLgogIC8vIG5i
OiB3ZSB3cml0ZSBvdXQgbV9jaG9zZW4sIG5vdCBtX25ldywgYmVjYXVzZSB0aGUgbWFuaWZl
c3Qtb24tZGlzawogIC8vIGlzIHRoZSBiYXNpcyBvZiB0aGUgd29ya2luZyBjb3B5LCBub3Qg
dGhlIHdvcmtpbmcgY29weSBpdHNlbGYuCiAgcHV0X21hbmlmZXN0X21hcChtX2Nob3Nlbik7
CiAgUCgidXBkYXRlZCB0byBiYXNlIHZlcnNpb24gJXNcbiIsIG1fY2hvc2VuX2lkLmlubmVy
KCkoKS5jX3N0cigpKTsKfQoKCgpDTUQoY2F0LCAidHJlZSIsICIoZmlsZXxtYW5pZmVzdCkg
PGlkPiIsICJ3cml0ZSBmaWxlIG9yIG1hbmlmZXN0IGZyb20gZGF0YWJhc2UgdG8gc3Rkb3V0
IikKewogIGlmIChhcmdzLnNpemUoKSAhPSAyKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7Cgog
IHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CgogIGlmIChhcmdzWzBdID09ICJm
aWxlIikKICAgIHsKICAgICAgZmlsZV9kYXRhIGRhdDsKICAgICAgZmlsZV9pZCBpZGVudChh
cmdzWzFdKTsKCiAgICAgIE4oYXBwLmRiLmZpbGVfdmVyc2lvbl9leGlzdHMoaWRlbnQpLAoJ
KHN0cmluZygibm8gZmlsZSB2ZXJzaW9uICIpICsgaWRlbnQuaW5uZXIoKSgpICsgIiBmb3Vu
ZCBpbiBkYXRhYmFzZSIpKTsKCiAgICAgIEwoImR1bXBpbmcgZmlsZSAlc1xuIiwgaWRlbnQu
aW5uZXIoKSgpLmNfc3RyKCkpOwogICAgICBhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lvbihpZGVu
dCwgZGF0KTsKICAgICAgZGF0YSB1bnBhY2tlZDsKICAgICAgdW5wYWNrKGRhdC5pbm5lcigp
LCB1bnBhY2tlZCk7CiAgICAgIGNvdXQud3JpdGUodW5wYWNrZWQoKS5kYXRhKCksIHVucGFj
a2VkKCkuc2l6ZSgpKTsKCiAgICB9CiAgZWxzZSBpZiAoYXJnc1swXSA9PSAibWFuaWZlc3Qi
KQogICAgewogICAgICBtYW5pZmVzdF9kYXRhIGRhdDsKICAgICAgbWFuaWZlc3RfaWQgaWRl
bnQoYXJnc1sxXSk7CgogICAgICBOKGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9uX2V4aXN0cyhp
ZGVudCksCgkoc3RyaW5nKCJubyBmaWxlIHZlcnNpb24gIikgKyBpZGVudC5pbm5lcigpKCkg
KyAiIGZvdW5kIGluIGRhdGFiYXNlIikpOwoKICAgICAgTCgiZHVtcGluZyBtYW5pZmVzdCAl
c1xuIiwgaWRlbnQuaW5uZXIoKSgpLmNfc3RyKCkpOwogICAgICBhcHAuZGIuZ2V0X21hbmlm
ZXN0X3ZlcnNpb24oaWRlbnQsIGRhdCk7CiAgICAgIGRhdGEgdW5wYWNrZWQ7CiAgICAgIHVu
cGFjayhkYXQuaW5uZXIoKSwgdW5wYWNrZWQpOwogICAgICBjb3V0LndyaXRlKHVucGFja2Vk
KCkuZGF0YSgpLCB1bnBhY2tlZCgpLnNpemUoKSk7CiAgICB9CiAgZWxzZSAKICAgIHRocm93
IHVzYWdlKG5hbWUpOwoKICBndWFyZC5jb21taXQoKTsKfQoKCkNNRChjaGVja291dCwgInRy
ZWUiLCAiPG1hbmlmZXN0LWlkPiIsICJjaGVjayBvdXQgdHJlZSBzdGF0ZSBmcm9tIGRhdGFi
YXNlIikKewogIGlmIChhcmdzLnNpemUoKSAhPSAxKQogICAgdGhyb3cgdXNhZ2UobmFtZSk7
CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CgogIGZpbGVfZGF0YSBkYXRh
OwogIG1hbmlmZXN0X2lkIGlkZW50KGFyZ3NbMF0pOwogIG1hbmlmZXN0X21hcCBtOwoKICBO
KGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9uX2V4aXN0cyhpZGVudCksCiAgICAoc3RyaW5nKCJu
byBtYW5pZmVzdCB2ZXJzaW9uICIpICsgaWRlbnQuaW5uZXIoKSgpICsgIiBmb3VuZCBpbiBk
YXRhYmFzZSIpKTsKICAKICBMKCJleHBvcnRpbmcgbWFuaWZlc3QgJXNcbiIsIGlkZW50Lmlu
bmVyKCkoKS5jX3N0cigpKTsKICBtYW5pZmVzdF9kYXRhIG1fZGF0YTsKICBhcHAuZGIuZ2V0
X21hbmlmZXN0X3ZlcnNpb24oaWRlbnQsIG1fZGF0YSk7CiAgcmVhZF9tYW5pZmVzdF9tYXAo
bV9kYXRhLCBtKTsgICAgICAKICBwdXRfbWFuaWZlc3RfbWFwKG0pOwogIAogIGZvciAobWFu
aWZlc3RfbWFwOjpjb25zdF9pdGVyYXRvciBpID0gbS5iZWdpbigpOyBpICE9IG0uZW5kKCk7
ICsraSkKICAgIHsKICAgICAgdmVjdG9yPHN0cmluZz4gYXJnczsKICAgICAgcGF0aF9pZF9w
YWlyIHBpcCgqaSk7CiAgICAgIAogICAgICBOKGFwcC5kYi5maWxlX3ZlcnNpb25fZXhpc3Rz
KHBpcC5pZGVudCgpKSwKCShzdHJpbmcoIm5vIGZpbGUgdmVyc2lvbiAiKQoJICsgcGlwLmlk
ZW50KCkuaW5uZXIoKSgpIAoJICsgIiBmb3VuZCBpbiBkYXRhYmFzZSBmb3IgIgoJICsgcGlw
LnBhdGgoKSgpLmNfc3RyKCkpKTsKICAgICAgCiAgICAgIGZpbGVfZGF0YSBkYXQ7CiAgICAg
IEwoIndyaXRpbmcgZmlsZSAlcyB0byAlc1xuIiwgCglwaXAuaWRlbnQoKS5pbm5lcigpKCku
Y19zdHIoKSwKCXBpcC5wYXRoKCkoKS5jX3N0cigpKTsKICAgICAgYXBwLmRiLmdldF9maWxl
X3ZlcnNpb24ocGlwLmlkZW50KCksIGRhdCk7CiAgICAgIHdyaXRlX2RhdGEocGlwLnBhdGgo
KSwgZGF0LmlubmVyKCkpOwogICAgfQoKICBndWFyZC5jb21taXQoKTsKfQoKQUxJQVMoY28s
IGNoZWNrb3V0LCAidHJlZSIsICI8bWFuaWZlc3QtaWQ+IiwKICAgICAgImNoZWNrIG91dCB0
cmVlIHN0YXRlIGZyb20gZGF0YWJhc2U7IGFsaWFzIGZvciBjaGVja291dCIpCgpDTUQoaGVh
ZHMsICJ0cmVlIiwgIiIsICJzaG93IHVubWVyZ2VkIGhlYWRzIG9mIGJyYW5jaCIpCnsKICB2
ZWN0b3I8bWFuaWZlc3RfaWQ+IGhlYWRzOwogIGlmIChhcmdzLnNpemUoKSAhPSAwKQogICAg
dGhyb3cgdXNhZ2UobmFtZSk7CgogIGlmIChhcHAuYnJhbmNoX25hbWUgPT0gIiIpCiAgICB7
CiAgICAgIGNvdXQgPDwgInBsZWFzZSBzcGVjaWZ5IGEgYnJhbmNoLCB3aXRoIC0tYnJhbmNo
PTxicmFuY2huYW1lPiIgPDwgZW5kbDsKICAgICAgcmV0dXJuOwogICAgfQoKICBnZXRfYnJh
bmNoX2hlYWRzKGFwcC5icmFuY2hfbmFtZSwgYXBwLCBoZWFkcyk7CgogIGlmIChoZWFkcy5z
aXplKCkgPT0gMCkKICAgIGNvdXQgPDwgImJyYW5jaCAnIiA8PCBhcHAuYnJhbmNoX25hbWUg
PDwgIicgaXMgZW1wdHkiIDw8IGVuZGw7CiAgZWxzZSBpZiAoaGVhZHMuc2l6ZSgpID09IDEp
CiAgICBjb3V0IDw8ICJicmFuY2ggJyIgPDwgYXBwLmJyYW5jaF9uYW1lIDw8ICInIGlzIGN1
cnJlbnRseSBtZXJnZWQ6IiA8PCBlbmRsOwogIGVsc2UKICAgIGNvdXQgPDwgImJyYW5jaCAn
IiA8PCBhcHAuYnJhbmNoX25hbWUgPDwgIicgaXMgY3VycmVudGx5IHVubWVyZ2VkOiIgPDwg
ZW5kbDsKCiAgZm9yICh2ZWN0b3I8bWFuaWZlc3RfaWQ+Ojpjb25zdF9pdGVyYXRvciBpID0g
aGVhZHMuYmVnaW4oKTsgCiAgICAgICBpICE9IGhlYWRzLmVuZCgpOyArK2kpCiAgICB7CiAg
ICAgIGNvdXQgPDwgaS0+aW5uZXIoKSgpIDw8IGVuZGw7CiAgICB9Cn0KCgpDTUQobWVyZ2Us
ICJ0cmVlIiwgIiIsICJtZXJnZSB1bm1lcmdlZCBoZWFkcyBvZiBicmFuY2giKQp7CgogIHZl
Y3RvcjxtYW5pZmVzdF9pZD4gaGVhZHM7CgogIGlmIChhcmdzLnNpemUoKSAhPSAwKQogICAg
dGhyb3cgdXNhZ2UobmFtZSk7CgogIGlmIChhcHAuYnJhbmNoX25hbWUgPT0gIiIpCiAgICB7
CiAgICAgIGNvdXQgPDwgInBsZWFzZSBzcGVjaWZ5IGEgYnJhbmNoLCB3aXRoIC0tYnJhbmNo
PTxicmFuY2huYW1lPiIgPDwgZW5kbDsKICAgICAgcmV0dXJuOwogICAgfQoKICBnZXRfYnJh
bmNoX2hlYWRzKGFwcC5icmFuY2hfbmFtZSwgYXBwLCBoZWFkcyk7CgogIGlmIChoZWFkcy5z
aXplKCkgPT0gMCkKICAgIHsKICAgICAgY291dCA8PCAiYnJhbmNoICIgPDwgYXJnc1swXSA8
PCAiaXMgZW1wdHkiIDw8IGVuZGw7CiAgICAgIHJldHVybjsKICAgIH0KICBlbHNlIGlmICho
ZWFkcy5zaXplKCkgPT0gMSkKICAgIHsKICAgICAgY291dCA8PCAiYnJhbmNoICIgPDwgYXJn
c1swXSA8PCAiaXMgbWVyZ2VkIiA8PCBlbmRsOwogICAgICByZXR1cm47CiAgICB9CiAgZWxz
ZQogICAgewogICAgICB2ZWN0b3I8IHBhaXI8dXJsLGdyb3VwPiA+IHRhcmdldHM7CiAgICAg
IGFwcC5sdWEuaG9va19nZXRfcG9zdF90YXJnZXRzKGFwcC5icmFuY2hfbmFtZSwgdGFyZ2V0
cyk7CgogICAgICBtYW5pZmVzdF9pZCBsZWZ0ID0gaGVhZHNbMF07CiAgICAgIG1hbmlmZXN0
X2lkIGFuY2VzdG9yOwogICAgICBmb3IgKHNpemVfdCBpID0gMTsgaSA8IGhlYWRzLnNpemUo
KTsgKytpKQoJewoJICBtYW5pZmVzdF9pZCByaWdodCA9IGhlYWRzW2ldOwoJICBQKCJtZXJn
aW5nIHdpdGggbWFuaWZlc3QgJWQgLyAlZDogJXMgPC0+ICVzXG4iLAoJICAgIGksIGhlYWRz
LnNpemUoKSwKCSAgICBsZWZ0LmlubmVyKCkoKS5jX3N0cigpLCByaWdodC5pbm5lcigpKCku
Y19zdHIoKSk7CgoJICBtYW5pZmVzdF9pZCBtZXJnZWQ7CgkgIHRyYW5zYWN0aW9uX2d1YXJk
IGd1YXJkKGFwcC5kYik7CgkgIHRyeV9vbmVfbWVyZ2UgKGxlZnQsIHJpZ2h0LCBtZXJnZWQs
IGFwcCwgdGFyZ2V0cyk7CgkgIAkgIAoJICAvLyBtZXJnZWQgMSBlZGdlOyBub3cgd2UgY29t
bWl0IHRoaXMsIHVwZGF0ZSBtZXJnZSBzb3VyY2UgYW5kCgkgIC8vIHRyeSBuZXh0IG9uZQoK
CSAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwKTsKCSAgcXVldWVpbmdfcGFja2V0X3dyaXRl
ciBxcHcoYXBwLCB0YXJnZXRzKTsKCSAgY2VydF9tYW5pZmVzdF9pbl9icmFuY2gobWVyZ2Vk
LCBhcHAuYnJhbmNoX25hbWUsIGFwcCwgZGJ3KTsKCSAgY2VydF9tYW5pZmVzdF9pbl9icmFu
Y2gobWVyZ2VkLCBhcHAuYnJhbmNoX25hbWUsIGFwcCwgcXB3KTsKCgkgIHN0cmluZyBsb2cg
PSAibWVyZ2Ugb2YgIiArIGxlZnQuaW5uZXIoKSgpICsgIiBhbmQgIiArIHJpZ2h0LmlubmVy
KCkoKTsKCSAgY2VydF9tYW5pZmVzdF9jaGFuZ2Vsb2cobWVyZ2VkLCBsb2csIGFwcCwgZGJ3
KTsKCSAgY2VydF9tYW5pZmVzdF9jaGFuZ2Vsb2cobWVyZ2VkLCBsb2csIGFwcCwgcXB3KTsK
CSAgCgkgIGd1YXJkLmNvbW1pdCgpOwoJICBQKCJbc291cmNlXSAlc1xuW3NvdXJjZV0gJXNc
blttZXJnZWRdICVzXG4iLAoJICAgIGxlZnQuaW5uZXIoKSgpLmNfc3RyKCksCgkgICAgcmln
aHQuaW5uZXIoKSgpLmNfc3RyKCksCgkgICAgbWVyZ2VkLmlubmVyKCkoKS5jX3N0cigpKTsK
CSAgbGVmdCA9IG1lcmdlZDsKCX0KICAgIH0gIAp9CgoKQ01EKHByb3BhZ2F0ZSwgInRyZWUi
LCAiPHNyYy1icmFuY2g+IDxkc3QtYnJhbmNoPiIsIAogICAgIm1lcmdlIGZyb20gb25lIGJy
YW5jaCB0byBhbm90aGVyIGFzeW1tZXRyaWNhbGx5IikKewogIC8qICAKCiAgdGhpcyBpcyBh
IHNwZWNpYWwgbWVyZ2Ugb3BlcmF0b3IsIGJ1dCB2ZXJ5IHVzZWZ1bCBmb3IgcGVvcGxlIG1h
aW50YWluaW5nCiAgInNsaWdodGx5IGRpc3BhcmF0ZSBidXQgcmVsYXRlZCIgdHJlZXMuIGl0
IGRvZXMgYSBvbmUtd2F5IG1lcmdlOyBsZXNzCiAgcG93ZXJmdWwgdGhhbiBwdXR0aW5nIHRo
aW5ncyBpbiB0aGUgc2FtZSBicmFuY2ggYW5kIGFsc28gbW9yZSBmbGV4aWJsZS4KCiAgMS4g
Y2hlY2sgdG8gc2VlIGlmIHNyYyBhbmQgZHN0IGJyYW5jaGVzIGFyZSBtZXJnZWQsIGlmIG5v
dCBhYm9ydCwgaWYgc28KICAgICBjYWxsIGhlYWRzIE4xIGFuZCBOMiByZXNwZWN0aXZlbHku
CgogIDIuIChGSVhNRTogbm90IHlldCBwcmVzZW50KSBydW4gdGhlIGhvb2sgcHJvcGFnYXRl
ICgic3JjLWJyYW5jaCIsCiAgICAgImRzdC1icmFuY2giLCBOMSwgTjIpIHdoaWNoIGdpdmVz
IHRoZSB1c2VyIGEgY2hhbmNlIHRvIG1hc3NhZ2UgTjEgaW50bwogICAgIGEgc3RhdGUgd2hp
Y2ggaXMgbGlrZWx5IHRvICJtZXJnZSBuaWNlbHkiIHdpdGggTjIsIGVnLiBlZGl0IHBhdGhu
YW1lcywKICAgICBvbWl0IG9wdGlvbmFsIGZpbGVzIG9mIG5vIGludGVyZXN0LgoKICAzLiBk
byBhIG5vcm1hbCAyIG9yIDMtd2F5IG1lcmdlIG9uIE4xIGFuZCBOMiwgZGVwZW5kaW5nIG9u
IHRoZQogICAgIGV4aXN0ZW5jZSBvZiBjb21tb24gYW5jZXN0b3JzLgoKICA0LiBzYXZlIHRo
ZSByZXN1bHRzIGFzIHRoZSBkZWx0YSAoTjIsTSksIHRoZSBhbmNlc3RyeSBlZGdlcyAoTjEs
TSkKICAgICBhbmQgKE4yLE0pLCBhbmQgdGhlIGNlcnQgKE4yLGRzdCkuCgogIDUuIHF1ZXVl
IHRoZSByZXN1bHRpbmcgcGFja2V0cyB0byBzZW5kIHRvIHRoZSB1cmwgZm9yIGRzdC1icmFu
Y2gsIG5vdAogICAgIHNyYy1icmFuY2guCgogICovCgogIHZlY3RvcjxtYW5pZmVzdF9pZD4g
c3JjX2hlYWRzLCBkc3RfaGVhZHM7CgogIGlmIChhcmdzLnNpemUoKSAhPSAyKQogICAgdGhy
b3cgdXNhZ2UobmFtZSk7CgogIGdldF9icmFuY2hfaGVhZHMoYXJnc1swXSwgYXBwLCBzcmNf
aGVhZHMpOwogIGdldF9icmFuY2hfaGVhZHMoYXJnc1sxXSwgYXBwLCBkc3RfaGVhZHMpOwoK
ICBpZiAoc3JjX2hlYWRzLnNpemUoKSA9PSAwKQogICAgewogICAgICBjb3V0IDw8ICJicmFu
Y2ggIiA8PCBhcmdzWzBdIDw8ICJpcyBlbXB0eSIgPDwgZW5kbDsKICAgICAgcmV0dXJuOwog
ICAgfQogIGVsc2UgaWYgKHNyY19oZWFkcy5zaXplKCkgIT0gMSkKICAgIHsKICAgICAgY291
dCA8PCAiYnJhbmNoICIgPDwgYXJnc1swXSA8PCAiaXMgbm90IG1lcmdlZCIgPDwgZW5kbDsK
ICAgICAgcmV0dXJuOwogICAgfQogIGVsc2UgaWYgKGRzdF9oZWFkcy5zaXplKCkgPT0gMCkK
ICAgIHsKICAgICAgY291dCA8PCAiYnJhbmNoICIgPDwgYXJnc1sxXSA8PCAiaXMgZW1wdHki
IDw8IGVuZGw7CiAgICAgIHJldHVybjsKICAgIH0KICBlbHNlIGlmIChkc3RfaGVhZHMuc2l6
ZSgpICE9IDEpCiAgICB7CiAgICAgIGNvdXQgPDwgImJyYW5jaCAiIDw8IGFyZ3NbMV0gPDwg
ImlzIG5vdCBtZXJnZWQiIDw8IGVuZGw7CiAgICAgIHJldHVybjsKICAgIH0KICBlbHNlCiAg
ICB7CiAgICAgIHZlY3RvcjwgcGFpcjx1cmwsZ3JvdXA+ID4gdGFyZ2V0czsKICAgICAgYXBw
Lmx1YS5ob29rX2dldF9wb3N0X3RhcmdldHMoYXJnc1sxXSwgdGFyZ2V0cyk7CgogICAgICBt
YW5pZmVzdF9pZCBtZXJnZWQ7CiAgICAgIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5k
Yik7CiAgICAgIHRyeV9vbmVfbWVyZ2UgKHNyY19oZWFkc1swXSwgZHN0X2hlYWRzWzBdLCBt
ZXJnZWQsIGFwcCwgdGFyZ2V0cyk7ICAgICAgCgogICAgICBxdWV1ZWluZ19wYWNrZXRfd3Jp
dGVyIHFwdyhhcHAsIHRhcmdldHMpOwogICAgICBjZXJ0X21hbmlmZXN0X2luX2JyYW5jaCht
ZXJnZWQsIGFwcC5icmFuY2hfbmFtZSwgYXBwLCBxcHcpOwogICAgICBjZXJ0X21hbmlmZXN0
X2NoYW5nZWxvZyhtZXJnZWQsIAoJCQkgICAgICAicHJvcGFnYXRlIG9mICIgCgkJCSAgICAg
ICsgc3JjX2hlYWRzWzBdLmlubmVyKCkoKSAKCQkJICAgICAgKyAiIGFuZCAiIAoJCQkgICAg
ICArIGRzdF9oZWFkc1swXS5pbm5lcigpKCkKCQkJICAgICAgKyAiXG4iCgkJCSAgICAgICsg
ImZyb20gYnJhbmNoICIgCgkJCSAgICAgICsgYXJnc1swXSArICIgdG8gIiArIGFyZ3NbMV0g
KyAiXG4iLCAKCQkJICAgICAgYXBwLCBxcHcpOwkgIAogICAgICBndWFyZC5jb21taXQoKTsg
ICAgICAKICAgIH0KfQoKCgpDTUQoZGlmZiwgImluZm9ybWF0aXZlIiwgIiIsICJzaG93IGN1
cnJlbnQgZGlmZnMgb24gc3Rkb3V0IikKewogIG1hbmlmZXN0X21hcCBtX29sZCwgbV9uZXc7
CiAgcGF0Y2hfc2V0IHBzOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwoK
ICBpZiAoYXJncy5zaXplKCkgPiAwKQogICAgewogICAgICBtYW5pZmVzdF9kYXRhIGRhdDsK
ICAgICAgbWFuaWZlc3RfaWQgaWRlbnQoYXJnc1swXSk7CgogICAgICBOKGFwcC5kYi5tYW5p
ZmVzdF92ZXJzaW9uX2V4aXN0cyhpZGVudCksCgkoc3RyaW5nKCJubyBmaWxlIHZlcnNpb24g
IikgKyBpZGVudC5pbm5lcigpKCkgKyAiIGZvdW5kIGluIGRhdGFiYXNlIikpOwoKICAgICAg
TCgiZ2V0dGluZyBtYW5pZmVzdCAlc1xuIiwgaWRlbnQuaW5uZXIoKSgpLmNfc3RyKCkpOwog
ICAgICBhcHAuZGIuZ2V0X21hbmlmZXN0X3ZlcnNpb24oaWRlbnQsIGRhdCk7CiAgICAgIHJl
YWRfbWFuaWZlc3RfbWFwKGRhdCwgbV9vbGQpOwogICAgfQogIGVsc2UKICAgIGdldF9tYW5p
ZmVzdF9tYXAobV9vbGQpOwoKICBpZiAoYXJncy5zaXplKCkgPiAxKQogICAgewogICAgICBt
YW5pZmVzdF9kYXRhIGRhdDsKICAgICAgbWFuaWZlc3RfaWQgaWRlbnQoYXJnc1sxXSk7Cgog
ICAgICBOKGFwcC5kYi5tYW5pZmVzdF92ZXJzaW9uX2V4aXN0cyhpZGVudCksCgkoc3RyaW5n
KCJubyBmaWxlIHZlcnNpb24gIikgKyBpZGVudC5pbm5lcigpKCkgKyAiIGZvdW5kIGluIGRh
dGFiYXNlIikpOwoKICAgICAgTCgiZ2V0dGluZyBtYW5pZmVzdCAlc1xuIiwgaWRlbnQuaW5u
ZXIoKSgpLmNfc3RyKCkpOwogICAgICBhcHAuZGIuZ2V0X21hbmlmZXN0X3ZlcnNpb24oaWRl
bnQsIGRhdCk7CiAgICAgIHJlYWRfbWFuaWZlc3RfbWFwKGRhdCwgbV9uZXcpOwogICAgfQog
IGVsc2UKICAgIGNhbGN1bGF0ZV9uZXdfbWFuaWZlc3RfbWFwKG1fb2xkLCBtX25ldyk7Cgog
IG1hbmlmZXN0c190b19wYXRjaF9zZXQobV9vbGQsIG1fbmV3LCBhcHAsIHBzKTsKCiAgZm9y
IChzZXQ8cGF0Y2hfZGVsdGE+Ojpjb25zdF9pdGVyYXRvciBpID0gcHMuZl9kZWx0YXMuYmVn
aW4oKTsKICAgICAgIGkgIT0gcHMuZl9kZWx0YXMuZW5kKCk7ICsraSkKICAgIHsKICAgICAg
ZmlsZV9kYXRhIGZfb2xkLCBmX25ldzsKICAgICAgZ3ppcDxkYXRhPiBkZWNvZGVkX29sZCwg
ZGVjb2RlZF9uZXc7CiAgICAgIGRhdGEgZGVjb21wcmVzc2VkX29sZCwgZGVjb21wcmVzc2Vk
X25ldzsKICAgICAgdmVjdG9yPHN0cmluZz4gb2xkX2xpbmVzLCBuZXdfbGluZXM7CgogICAg
ICBhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lvbihpLT5pZF9vbGQsIGZfb2xkKTsKICAgICAgZGVj
b2RlX2Jhc2U2NChmX29sZC5pbm5lcigpLCBkZWNvZGVkX29sZCk7CiAgICAgIGRlY29kZV9n
emlwKGRlY29kZWRfb2xkLCBkZWNvbXByZXNzZWRfb2xkKTsKCiAgICAgIGlmIChhcmdzLnNp
emUoKSA+IDEpCgl7CgkgIGFwcC5kYi5nZXRfZmlsZV92ZXJzaW9uKGktPmlkX25ldywgZl9u
ZXcpOwoJICBkZWNvZGVfYmFzZTY0KGZfbmV3LmlubmVyKCksIGRlY29kZWRfbmV3KTsKCSAg
ZGVjb2RlX2d6aXAoZGVjb2RlZF9uZXcsIGRlY29tcHJlc3NlZF9uZXcpOwoJfQogICAgICBl
bHNlCglyZWFkX2RhdGEoaS0+cGF0aCwgZGVjb21wcmVzc2VkX25ldyk7CgogICAgICBzcGxp
dF9pbnRvX2xpbmVzKGRlY29tcHJlc3NlZF9vbGQoKSwgb2xkX2xpbmVzKTsKICAgICAgc3Bs
aXRfaW50b19saW5lcyhkZWNvbXByZXNzZWRfbmV3KCksIG5ld19saW5lcyk7CgogICAgICB1
bmlkaWZmKGktPnBhdGgoKSwgaS0+cGF0aCgpLCBvbGRfbGluZXMsIG5ld19saW5lcywgY291
dCk7CiAgICB9ICAKICBndWFyZC5jb21taXQoKTsKfQoKQ01EKHN0YXR1cywgImluZm9ybWF0
aXZlIiwgIiIsICJzaG93IHN0YXR1cyBvZiB3b3JraW5nIGNvcHkiKQp7CiAgbWFuaWZlc3Rf
bWFwIG1fb2xkLCBtX25ldzsKICBwYXRjaF9zZXQgcHM7CgogIHRyYW5zYWN0aW9uX2d1YXJk
IGd1YXJkKGFwcC5kYik7CiAgZ2V0X21hbmlmZXN0X21hcChtX29sZCk7CiAgY2FsY3VsYXRl
X25ld19tYW5pZmVzdF9tYXAobV9vbGQsIG1fbmV3KTsKICBtYW5pZmVzdHNfdG9fcGF0Y2hf
c2V0KG1fb2xkLCBtX25ldywgYXBwLCBwcyk7CiAgcGF0Y2hfc2V0X3RvX3RleHRfc3VtbWFy
eShwcywgY291dCk7CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCgpDTUQobWRlbHRhLCAicGFja2V0
IGkvbyIsICI8b2xkaWQ+IDxuZXdpZD4iLCAid3JpdGUgbWFuaWZlc3QgZGVsdGEgcGFja2V0
IHRvIHN0ZG91dCIpCnsKICBpZiAoYXJncy5zaXplKCkgIT0gMikKICAgIHRocm93IHVzYWdl
KG5hbWUpOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwogIHBhY2tldF93
cml0ZXIgcHcoY291dCk7CgogIG1hbmlmZXN0X2lkIG1fb2xkX2lkLCBtX25ld19pZDsgCiAg
bWFuaWZlc3RfZGF0YSBtX29sZF9kYXRhLCBtX25ld19kYXRhOwogIG1hbmlmZXN0X21hcCBt
X29sZCwgbV9uZXc7CiAgcGF0Y2hfc2V0IHBzOyAgICAgIAogIG1fb2xkX2lkID0gaGV4ZW5j
PGlkPihhcmdzWzBdKTsgCiAgbV9uZXdfaWQgPSBoZXhlbmM8aWQ+KGFyZ3NbMV0pOwogIGFw
cC5kYi5nZXRfbWFuaWZlc3RfdmVyc2lvbihtX29sZF9pZCwgbV9vbGRfZGF0YSk7CiAgYXBw
LmRiLmdldF9tYW5pZmVzdF92ZXJzaW9uKG1fbmV3X2lkLCBtX25ld19kYXRhKTsKICByZWFk
X21hbmlmZXN0X21hcChtX29sZF9kYXRhLCBtX29sZCk7CiAgcmVhZF9tYW5pZmVzdF9tYXAo
bV9uZXdfZGF0YSwgbV9uZXcpOwogIG1hbmlmZXN0c190b19wYXRjaF9zZXQobV9vbGQsIG1f
bmV3LCBhcHAsIHBzKTsKICBwYXRjaF9zZXRfdG9fcGFja2V0cyhwcywgYXBwLCBwdyk7ICAK
ICBndWFyZC5jb21taXQoKTsKfQoKQ01EKGZkZWx0YSwgInBhY2tldCBpL28iLCAiPG9sZGlk
PiA8bmV3aWQ+IiwgIndyaXRlIGZpbGUgZGVsdGEgcGFja2V0IHRvIHN0ZG91dCIpCnsKICBp
ZiAoYXJncy5zaXplKCkgIT0gMikKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICB0cmFuc2Fj
dGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwogIHBhY2tldF93cml0ZXIgcHcoY291dCk7Cgog
IGZpbGVfaWQgZl9vbGRfaWQsIGZfbmV3X2lkOwogIGZpbGVfZGF0YSBmX29sZF9kYXRhLCBm
X25ld19kYXRhOwogIGZfb2xkX2lkID0gaGV4ZW5jPGlkPihhcmdzWzBdKTsKICBmX25ld19p
ZCA9IGhleGVuYzxpZD4oYXJnc1sxXSk7ICAgICAKICBhcHAuZGIuZ2V0X2ZpbGVfdmVyc2lv
bihmX29sZF9pZCwgZl9vbGRfZGF0YSk7CiAgYXBwLmRiLmdldF9maWxlX3ZlcnNpb24oZl9u
ZXdfaWQsIGZfbmV3X2RhdGEpOwogIGJhc2U2NDwgZ3ppcDxkZWx0YT4gPiBkZWw7CiAgZGlm
ZihmX29sZF9kYXRhLmlubmVyKCksIGZfbmV3X2RhdGEuaW5uZXIoKSwgZGVsKTsKICBwdy5j
b25zdW1lX2ZpbGVfZGVsdGEoZl9vbGRfaWQsIGZfbmV3X2lkLCBmaWxlX2RlbHRhKGRlbCkp
OyAgCiAgZ3VhcmQuY29tbWl0KCk7Cn0KCkNNRChtZGF0YSwgInBhY2tldCBpL28iLCAiPGlk
PiIsICJ3cml0ZSBtYW5pZmVzdCBkYXRhIHBhY2tldCB0byBzdGRvdXQiKQp7CiAgaWYgKGFy
Z3Muc2l6ZSgpICE9IDEpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKCiAgdHJhbnNhY3Rpb25f
Z3VhcmQgZ3VhcmQoYXBwLmRiKTsKICBwYWNrZXRfd3JpdGVyIHB3KGNvdXQpOwoKICBtYW5p
ZmVzdF9pZCBtX2lkOwogIG1hbmlmZXN0X2RhdGEgbV9kYXRhOwogIG1faWQgPSBoZXhlbmM8
aWQ+KGFyZ3NbMF0pOwogIGFwcC5kYi5nZXRfbWFuaWZlc3RfdmVyc2lvbihtX2lkLCBtX2Rh
dGEpOwogIHB3LmNvbnN1bWVfbWFuaWZlc3RfZGF0YShtX2lkLCBtX2RhdGEpOyAgCiAgZ3Vh
cmQuY29tbWl0KCk7Cn0KCgpDTUQoZmRhdGEsICJwYWNrZXQgaS9vIiwgIjxpZD4iLCAid3Jp
dGUgZmlsZSBkYXRhIHBhY2tldCB0byBzdGRvdXQiKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9
IDEpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQo
YXBwLmRiKTsKICBwYWNrZXRfd3JpdGVyIHB3KGNvdXQpOwoKICBmaWxlX2lkIGZfaWQ7CiAg
ZmlsZV9kYXRhIGZfZGF0YTsKICBmX2lkID0gaGV4ZW5jPGlkPihhcmdzWzBdKTsKICBhcHAu
ZGIuZ2V0X2ZpbGVfdmVyc2lvbihmX2lkLCBmX2RhdGEpOwogIHB3LmNvbnN1bWVfZmlsZV9k
YXRhKGZfaWQsIGZfZGF0YSk7ICAKICBndWFyZC5jb21taXQoKTsKfQoKQ01EKG1jZXJ0cywg
InBhY2tldCBpL28iLCAiPGlkPiIsICJ3cml0ZSBtYW5pZmVzdCBjZXJ0IHBhY2tldHMgdG8g
c3Rkb3V0IikKewogIGlmIChhcmdzLnNpemUoKSAhPSAxKQogICAgdGhyb3cgdXNhZ2UobmFt
ZSk7CgogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFwcC5kYik7CiAgcGFja2V0X3dyaXRl
ciBwdyhjb3V0KTsKCiAgbWFuaWZlc3RfaWQgbV9pZDsKICB2ZWN0b3I8IG1hbmlmZXN0PGNl
cnQ+ID4gY2VydHM7CgogIG1faWQgPSBoZXhlbmM8aWQ+KGFyZ3NbMF0pOwogIGFwcC5kYi5n
ZXRfbWFuaWZlc3RfY2VydHMobV9pZCwgY2VydHMpOwogIGZvciAoc2l6ZV90IGkgPSAwOyBp
IDwgY2VydHMuc2l6ZSgpOyArK2kpCiAgICBwdy5jb25zdW1lX21hbmlmZXN0X2NlcnQoY2Vy
dHNbaV0pOwogIGd1YXJkLmNvbW1pdCgpOwp9CgpDTUQoZmNlcnRzLCAicGFja2V0IGkvbyIs
ICI8aWQ+IiwgIndyaXRlIGZpbGUgY2VydCBwYWNrZXRzIHRvIHN0ZG91dCIpCnsKICBpZiAo
YXJncy5zaXplKCkgIT0gMSkKICAgIHRocm93IHVzYWdlKG5hbWUpOwoKICB0cmFuc2FjdGlv
bl9ndWFyZCBndWFyZChhcHAuZGIpOwogIHBhY2tldF93cml0ZXIgcHcoY291dCk7CgogIGZp
bGVfaWQgZl9pZDsKICB2ZWN0b3I8IGZpbGU8Y2VydD4gPiBjZXJ0czsKCiAgZl9pZCA9IGhl
eGVuYzxpZD4oYXJnc1swXSk7CiAgYXBwLmRiLmdldF9maWxlX2NlcnRzKGZfaWQsIGNlcnRz
KTsKICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IGNlcnRzLnNpemUoKTsgKytpKQogICAgcHcu
Y29uc3VtZV9maWxlX2NlcnQoY2VydHNbaV0pOwogIGd1YXJkLmNvbW1pdCgpOwp9CgpDTUQo
cHVia2V5LCAicGFja2V0IGkvbyIsICI8aWQ+IiwgIndyaXRlIHB1YmxpYyBrZXkgcGFja2V0
IHRvIHN0ZG91dCIpCnsKICBpZiAoYXJncy5zaXplKCkgIT0gMSkKICAgIHRocm93IHVzYWdl
KG5hbWUpOwoKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwogIHBhY2tldF93
cml0ZXIgcHcoY291dCk7CiAgcnNhX2tleXBhaXJfaWQgaWRlbnQoYXJnc1swXSk7CiAgYmFz
ZTY0PCByc2FfcHViX2tleSA+IGtleTsKICBhcHAuZGIuZ2V0X2tleShpZGVudCwga2V5KTsK
ICBwdy5jb25zdW1lX3B1YmxpY19rZXkoaWRlbnQsIGtleSk7CiAgZ3VhcmQuY29tbWl0KCk7
Cn0KCkNNRChwcml2a2V5LCAicGFja2V0IGkvbyIsICI8aWQ+IiwgIndyaXRlIHByaXZhdGUg
a2V5IHBhY2tldCB0byBzdGRvdXQiKQp7CiAgaWYgKGFyZ3Muc2l6ZSgpICE9IDEpCiAgICB0
aHJvdyB1c2FnZShuYW1lKTsKCiAgdHJhbnNhY3Rpb25fZ3VhcmQgZ3VhcmQoYXBwLmRiKTsK
ICBwYWNrZXRfd3JpdGVyIHB3KGNvdXQpOwogIHJzYV9rZXlwYWlyX2lkIGlkZW50KGFyZ3Nb
MF0pOwogIGJhc2U2NDwgYXJjNDxyc2FfcHJpdl9rZXk+ID4ga2V5OwogIGFwcC5kYi5nZXRf
a2V5KGlkZW50LCBrZXkpOwogIHB3LmNvbnN1bWVfcHJpdmF0ZV9rZXkoaWRlbnQsIGtleSk7
CiAgZ3VhcmQuY29tbWl0KCk7Cn0KCgpDTUQocmVhZCwgInBhY2tldCBpL28iLCAiIiwgInJl
YWQgcGFja2V0cyBmcm9tIHN0ZGluIikKewogIHRyYW5zYWN0aW9uX2d1YXJkIGd1YXJkKGFw
cC5kYik7CiAgcGFja2V0X2RiX3dyaXRlciBkYncoYXBwLCB0cnVlKTsKICBzaXplX3QgY291
bnQgPSByZWFkX3BhY2tldHMoY2luLCBkYncpOwogIE4oY291bnQgIT0gMCwgIm5vIHBhY2tl
dHMgZm91bmQgb24gc3RkaW4iKTsKICBpZiAoY291bnQgPT0gMSkKICAgIFAoInJlYWQgMSBw
YWNrZXRcbiIpOwogIGVsc2UKICAgIFAoInJlYWQgJWQgcGFja2V0c1xuIiwgY291bnQpOwog
IGd1YXJkLmNvbW1pdCgpOwp9CgoKQ01EKGFncmFwaCwgImdyYXBoIHZpc3VhbGl6YXRpb24i
LCAiIiwgImR1bXAgYW5jZXN0cnkgZ3JhcGggdG8gc3Rkb3V0IikKewogIHZlY3RvcjwgbWFu
aWZlc3Q8Y2VydD4gPiBjZXJ0czsKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIp
OwogIGFwcC5kYi5nZXRfbWFuaWZlc3RfY2VydHMoYW5jZXN0b3JfY2VydF9uYW1lLCBjZXJ0
cyk7CiAgc2V0PHN0cmluZz4gbm9kZXM7CiAgdmVjdG9yPCBwYWlyPHN0cmluZywgc3RyaW5n
PiA+IGVkZ2VzOwogIGZvcih2ZWN0b3I8IG1hbmlmZXN0PGNlcnQ+ID46Oml0ZXJhdG9yIGkg
PSBjZXJ0cy5iZWdpbigpOwogICAgICBpICE9IGNlcnRzLmVuZCgpOyArK2kpCiAgICB7CiAg
ICAgIGNlcnRfdmFsdWUgdHY7CiAgICAgIGRlY29kZV9iYXNlNjQoaS0+aW5uZXIoKS52YWx1
ZSwgdHYpOwogICAgICBub2Rlcy5pbnNlcnQodHYoKSk7CiAgICAgIG5vZGVzLmluc2VydChp
LT5pbm5lcigpLmlkZW50KCkpOwogICAgICBlZGdlcy5wdXNoX2JhY2sobWFrZV9wYWlyKHR2
KCksIGktPmlubmVyKCkuaWRlbnQoKSkpOwogICAgfQogIGNvdXQgPDwgImdyYXBoOiAiIDw8
IGVuZGwgPDwgInsiIDw8IGVuZGw7IC8vIG9wZW4gZ3JhcGgKICBmb3IgKHNldDxzdHJpbmc+
OjppdGVyYXRvciBpID0gbm9kZXMuYmVnaW4oKTsgaSAhPSBub2Rlcy5lbmQoKTsKICAgICAg
ICsraSkKICAgIHsKICAgICAgY291dCA8PCAibm9kZTogeyB0aXRsZSA6IFwiIiA8PCAqaSA8
PCAiXCJ9IiA8PCBlbmRsOwogICAgfQogIGZvciAodmVjdG9yPCBwYWlyPHN0cmluZyxzdHJp
bmc+ID46Oml0ZXJhdG9yIGkgPSBlZGdlcy5iZWdpbigpOyBpICE9IGVkZ2VzLmVuZCgpOwog
ICAgICAgKytpKQogICAgewogICAgICBjb3V0IDw8ICJlZGdlOiB7IHNvdXJjZW5hbWUgOiBc
IiIgPDwgaS0+Zmlyc3QgPDwgIlwiIiA8PCBlbmRsCgkgICA8PCAiICAgICAgICB0YXJnZXRu
YW1lIDogXCIiIDw8IGktPnNlY29uZCA8PCAiXCIgfSIgPDwgZW5kbDsKICAgIH0KICBjb3V0
IDw8ICJ9IiA8PCBlbmRsIDw8IGVuZGw7IC8vIGNsb3NlIGdyYXBoCiAgZ3VhcmQuY29tbWl0
KCk7Cn0KCkNNRChmZXRjaCwgIm5ldHdvcmsiLCAiW1VSTF0gW2dyb3VwbmFtZV0iLCAiZmV0
Y2ggcmVjZW50IGNoYW5nZXMgZnJvbSBuZXR3b3JrIikKewogIGlmIChhcmdzLnNpemUoKSA+
IDIpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsKCiAgdmVjdG9yPCBwYWlyPHVybCxncm91cD4g
PiBzb3VyY2VzOwoKICBpZiAoYXJncy5zaXplKCkgPT0gMCkKICAgIHsKICAgICAgaWYgKGFw
cC5icmFuY2hfbmFtZSA9PSAiIikKCXsKCSAgUCgibm8gYnJhbmNoIG5hbWUgcHJvdmlkZWQs
IGZldGNoaW5nIGZyb20gYWxsIGtub3duIFVSTHNcbiIpOwoJICBhcHAuZGIuZ2V0X2FsbF9r
bm93bl9zb3VyY2VzKHNvdXJjZXMpOwoJfQogICAgICBlbHNlCgl7CgkgIE4oYXBwLmx1YS5o
b29rX2dldF9mZXRjaF9zb3VyY2VzKGFwcC5icmFuY2hfbmFtZSwgc291cmNlcyksCgkgICAg
KCJubyBVUkwgLyBncm91cCBwYWlycyBmb3VuZCBmb3IgYnJhbmNoICIgKyBhcHAuYnJhbmNo
X25hbWUpKTsgCgl9CiAgICB9CiAgZWxzZQogICAgewogICAgICBOKGFyZ3Muc2l6ZSgpID09
IDIsICJuZWVkIFVSTCBhbmQgZ3JvdXBuYW1lIik7CiAgICAgIHNvdXJjZXMucHVzaF9iYWNr
KG1ha2VfcGFpcih1cmwoYXJnc1swXSksCgkJCQkgIGdyb3VwKGFyZ3NbMV0pKSk7CiAgICB9
CiAgCiAgZmV0Y2hfcXVldWVkX2Jsb2JzX2Zyb21fbmV0d29yayhzb3VyY2VzLCBhcHApOwp9
CgpDTUQocG9zdCwgIm5ldHdvcmsiLCAiW1VSTF0gW2dyb3VwbmFtZV0iLCAicG9zdCBxdWV1
ZWQgY2hhbmdlcyB0byBuZXR3b3JrIikKewogIGlmIChhcmdzLnNpemUoKSA+IDIpCiAgICB0
aHJvdyB1c2FnZShuYW1lKTsKCiAgdmVjdG9yPCBwYWlyPHVybCxncm91cD4gPiB0YXJnZXRz
OwogIGlmIChhcmdzLnNpemUoKSA9PSAwKQogICAgewogICAgICBpZiAoYXBwLmJyYW5jaF9u
YW1lID09ICIiKQoJewoJICBQKCJubyBicmFuY2ggbmFtZSBwcm92aWRlZCwgcG9zdGluZyBh
bGwgcXVldWVkIHRhcmdldHNcbiIpOwoJICBhcHAuZGIuZ2V0X3F1ZXVlZF90YXJnZXRzKHRh
cmdldHMpOwoJfQogICAgICBlbHNlCgl7CgkgIE4oYXBwLmx1YS5ob29rX2dldF9wb3N0X3Rh
cmdldHMoYXBwLmJyYW5jaF9uYW1lLCB0YXJnZXRzKSwKCSAgICAoIm5vIFVSTCAvIGdyb3Vw
IHBhaXJzIGZvdW5kIGZvciBicmFuY2ggIiArIGFwcC5icmFuY2hfbmFtZSkpOyAKCX0KICAg
IH0gIAogIGVsc2UKICAgIHsKICAgICAgTihhcmdzLnNpemUoKSA9PSAyLCAibmVlZCBVUkwg
YW5kIGdyb3VwbmFtZSIpOwogICAgICB0YXJnZXRzLnB1c2hfYmFjayhtYWtlX3BhaXIodXJs
KGFyZ3NbMF0pLAoJCQkJICBncm91cChhcmdzWzFdKSkpOwogICAgfQoKICBwb3N0X3F1ZXVl
ZF9ibG9ic190b19uZXR3b3JrKHRhcmdldHMsIGFwcCk7Cn0KCgpDTUQocmNzX2ltcG9ydCwg
InJjcyIsICI8cmNzZmlsZT4gLi4uIiwgImltcG9ydCBhbGwgdmVyc2lvbnMgaW4gUkNTIGZp
bGVzIikKewogIGlmIChhcmdzLnNpemUoKSA8IDEpCiAgICB0aHJvdyB1c2FnZShuYW1lKTsK
ICAKICB0cmFuc2FjdGlvbl9ndWFyZCBndWFyZChhcHAuZGIpOwogIGZvciAodmVjdG9yPHN0
cmluZz46OmNvbnN0X2l0ZXJhdG9yIGkgPSBhcmdzLmJlZ2luKCk7CiAgICAgICBpICE9IGFy
Z3MuZW5kKCk7ICsraSkKICAgIHsKICAgICAgaW1wb3J0X3Jjc19maWxlKGZzOjpwYXRoKCpp
KSwgYXBwLmRiKTsKICAgIH0KICBndWFyZC5jb21taXQoKTsKfQoKCkNNRChjdnNfaW1wb3J0
LCAicmNzIiwgIjxjdnNyb290PiIsICJpbXBvcnQgYWxsIHZlcnNpb25zIGluIENWUyByZXBv
c2l0b3J5IikKewogIGlmIChhcmdzLnNpemUoKSAhPSAxKQogICAgdGhyb3cgdXNhZ2UobmFt
ZSk7CgogIGltcG9ydF9jdnNfcmVwbyhmczo6cGF0aChhcmdzLmF0KDApKSwgYXBwKTsKfQoK
Cn07IC8vIG5hbWVzcGFjZSBjb21tYW5kcwo=
])

# decode first file and commit to db
UNB64(firstfile.b64, firstfile)
AT_CHECK(cp firstfile testfile, [], [ignore])
AT_CHECK(MONOTONE add testfile, [], [ignore], [ignore])
AT_CHECK(MONOTONE --branch=testbranch commit --message=blah-blah, [], [ignore], [ignore])
AT_CHECK(mv testfile firstfile, [], [ignore])

# decode second file
UNB64(secondfile.b64, secondfile)

# calculate diff to second file using monotone
AT_CHECK(cp secondfile testfile, [], [ignore])
AT_CHECK(MONOTONE diff, [], [stdout])
AT_CHECK(mv stdout monodiff, [], [ignore])

# look for a meaningless change
AT_CHECK(grep [^-$] monodiff, [1], [stdout])

AT_CLEANUP
