2005-02-27  Jon Bright  <jon@siliconcircus.com>
	* lposix.c (win32 Pspawn): Search the path
	(win32 Pexistsonpath): Added.  'which' isn't easily available,
	and not available at all from a normal Win32 command shell
	(Piswin32): Added a function for both Unix and Win32 to detect
	if running on Windows
	* std_hooks.lua (program_exists_in_path): Now calls 
	posix.iswin32.  If win32, calls posix.existsonpath, otherwise
	calls which as it always did.

2005-02-27  Jon Bright  <jon@siliconcircus.com>
	* lposix.c (win32 Pspawn): Remove dumb strlen bug resulting in
	AVs on commit.

2005-02-27  Jon Bright  <jon@siliconcircus.com>
	* t_can_execute.at: Test to see if hooks can execute things
	* testsuite.at: Add t_can_execute

2005-02-27  Jon Bright  <jon@siliconcircus.com>
	* lposix.c (win32 Pspawn): Ensure the command string is always
	NUL-terminated.  Also, allocate enough memory for the quotes
	around the command string.

2005-02-27  Jon Bright  <jon@siliconcircus.com>
	* xdelta.cc (unittests): Define BOOST_STDC_NO_NAMESPACE, needed
	to compile with the latest MinGW which uses gcc 3.4.2
	* vocab.cc (verify(local_path)): Catch fs::filesystem_error too
	and rethrow this as an informative_failure, thereby fixing the
	Win32 unit tests without disabling anything
	* idna/toutf8.c (stringprep_convert): Fix a potential segfault
	when memory allocation fails.  Potentially security-relevant.
	* tests/t_i18n_file.at: Add a SET_FUNNY_FILENAME macro, which 
	gets a platform-appropriate funny filename (with/without 
	colon).  
	Change references to utf8 to utf-8, iso88591 to iso-8859-1, and
	eucjp to euc-jp, on the grounds that MinGW's iconv knows all
	of the latter and none of the former, but Linux iconv knows all
	of them.  Test now passes one Win32.  I'm presuming we weren't
	deliberately using non-standard names for charsets here.
	* tests/t_i18n_changelog.at: Same charset name changes.
	* tests/t_dump_load.at: Canonicalise dump before loading it
	* tests/t_load_into_existing.at: Ditto
	* tests/t_fmerge.at: Canonicalise fmerge output
	* tests/t_merge_normalization_edge_case.at: Ditto
	* tests/t_unidiff.at: Canonicalise diff output
	* tests/t_largish_file.at: Instead of using dd, which MinGW
	doesn't have, I've generated the file with dd on a nearby Linux
	box, then gziped and b64ed it, and the test case now generates
	it with UNGZB64
	* testsuite.at: Add a comment every 10 tests with the test
	number.  Useful if you're trying to locate which test number
	you're trying to run and only have the filename.  If people 
	hate this, though, please do delete.
	(UNB64_COMMAND) Do special handling for Win32 to avoid
	having to canonicalise the file.
	(UNGZ_COMMAND) Canonicalise the file after ungzipping it.
	* lposix.c: (Pfork, Pexec) Removed, on the grounds that we only
	really want to support fork+exec as a single operation.  fork()
	without exec() could be risky with a child process also having
	our sqlite handles, etc.  exec() could be risky since we 
	wouldn't be exiting gracefully, just dying in the middle of a
	hook.
	(Pspawn) Implemented for both Win32 and Unix.  Does fork/exec
	for Unix, CreateProcess for Win32.  Returns -1 on error, pid on
	success in both cases.
	(Pwait, Pkill, Psleep) Implemented for Win32.  Note that pid is
	not optional for Pwait on Win32.
	* std_hooks.lua: (execute) Now uses spawn()

2005-02-25  Jon Bright  <jon@siliconcircus.com>
	* ChangeLog: Add all my previous changes.
	* tests/t_add_owndb.at: Add test for trying to add the db to
	itself.
	* testsuite.at: Call it
	* tests/t_automate_heads.at: Canonicalise stdout output.
	* tests/t_automate_version.at: Use arithmetic comparison against
	wc output instead of string comparison, to avoid problems with
	MinGW's wc, which outputs with initial space-padding
	* tests/t_change_empty_file.at: Canonicalise stdout output 
	and compare manually instead of letting autotest check it
	* tests/t_fmerge_normalize.at: Canonicalise stdout output.
	* tests/t_netsync_single.at: Use NETSYNC_KILLHARD instead of 
	killall, as for the NETSYNC functions in testsuite.at

2005-02-27  Matt Johnston  <matt@ucc.asn.au>

        * main.cc: ignore SIGPIPE so that monotone won't be killed
        unexpectedly upon remote disconnection for netsync

2005-02-27  Nathaniel Smith  <njs@codesourcery.com>

	* idna/idn-int.h: Oops, really add this time.

2005-02-27  Nathaniel Smith  <njs@codesourcery.com>

	* AUTHORS: Add Corey Halpin.
	
	* idna/idn-int.h: New file (don't generate from configure anymore,
	but just ship).
	* configure.ac: Don't generate idna/idn-int.h.  Do generate
	mt-stdint.h.
	* Makefile.am: Adjust for idna/idn-int.h and mt-stdint.h.
	* acinclude.m4: Remove AX_CREATE_STDINT_H, ACX_PTHREAD,
	AC_COMPILE_CHECK_SIZEOF (let aclocal pick them up from m4/
	instead).
	* m4/ax_create_stdint_h.m4:
	* m4/acx_pthread.m4: Update from http://autoconf-archive.cryp.to/
	
	* numeric_vocab.hh: Instead of dancing around which header to
	include, include mt-stdint.h.
	
	* app_state.cc (restriction_includes, set_restriction): Move
	global static 'dot' into these functions, because file_path
	depends on global book_keeping_dir being initialized already, and
	there is no guaranteed order of initialization of C++ statics.
	(Bug reported by Matt Johnston.)
	
2005-02-27  Corey Halpin  <chalpin@cs.wisc.edu>

	* numeric_vocab.hh: Try both stdint.h and inttypes.h.
	* main.cc: OpenBSD has Unix signals too.

2005-02-26  Derek Scherger  <derek@echologic.com>

	* file_io.cc (absolutify): normalize fs::path to remove ..'s
	* tests/t_db_with_dots.at: ensure database path in MT/options
	doesn't contain ..'s

2005-02-25  Jon Bright  <jon@siliconcircus.com>
	* ChangeLog: Add all my previous changes.
	* tests/t_add_owndb.at: Add test for trying to add the db to
	itself.
	* testsuite.at: Call it
	* tests/t_automate_heads.at: Canonicalise stdout output.
	* tests/t_automate_version.at: Use arithmetic comparison against
	wc output instead of string comparison, to avoid problems with
	MinGW's wc, which outputs with initial space-padding
	* tests/t_change_empty_file.at: Canonicalise stdout output 
	and compare manually instead of letting autotest check it
	* tests/t_fmerge_normalize.at: Canonicalise stdout output.
	* tests/t_netsync_single.at: Use NETSYNC_KILLHARD instead of 
	killall, as for the NETSYNC functions in testsuite.at

2005-02-25  Nathaniel Smith  <njs@codesourcery.com>

	* vocab.cc (test_file_path_verification): Re-enable some tests
	disabled by Jon Bright, following discussion on IRC concluding
	that they were catching a real bug.

2005-02-24  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_add_dot.at: Run "add ." in a subdirectory, so as not to
	add the test database.  (Reported by Jon Bright.)

	* AUTHORS: Fix gettext.h copyright note, to not be in the middle
	of libidn copyright note.
	Add Jon Bright.

2005-02-24  Jon Bright  <jon@siliconcircus.com>

	* app_state.cc (prefix): Use string() instead of 
	native_directory_string().  For Unix, these should be equivalent.
	For Win32, I believe string()'s correct (since we compare 
	everywhere against normalized paths with / characters, but 
	native_directory_string produces paths with \ characters on Win32.
	* rcs_file.cc (file_source): Map the map, not the mapping.
	* tests/t_i18n_file.at: Remove colon from filename with symbols.
	I need to return to this and add a proper test for Win32, so we
	only use the colon on non-Win32.
	* testsuite.at: Add a CANONICALISE function, which does nothing
	on Unix and strips out carriage returns from files on Win32.  This
	is useful for being able to compare Monotone's stdout output to
	files on disk.  Add NETSYNC_KILL and NETSYNC_KILLHARD functions,
	to deal with MinGW not having killall (Unix still uses killall,
	though).
	* tests/t_import.at: Add CANONICALISE calls before comparing
	stdout output.
	* tests/t_netsync.at: Likewise
	* tests/t_netsync_single.at: Likewise
	* tests/t_scan.at: Likewise
	* tests/t_versions.at: Likewise
	* tests/t_ls_missing.at: Likewise.  Also, generate missingfoo and
	missingbar files with expected output from ls missing for these
	files being missing and compare against those.

2005-02-24  Derek Scherger  <derek@echologic.com>

	* app_state.{cc,hh} (add_restriction): rename to ...
	(set_restriction) this; and add path validation
	* commands.cc (get_valid_paths): new function
	(get_path_rearrangement) remove restricted include/exclude variant
	(calculate_restricted_revision) get valid paths and use to set up
	restriction
	(status, ls_unknown, commit, do_diff) pass args to
	calculate_restricted_revision to valid restriction paths
	(ls_missing, revert) get valid paths and use to set up restriction
	* tests/t_checkout_options.at: remove bug report priority (it's
	fixed!)
	* tests/t_diff_added_file.at: add --revision options to diff
	* tests/t_restrictions.at: remove invalid paths from ls unknown
	and ls ignored
	* tests/t_restrictions_warn_on_unknown.at: un-XFAIL
	
2005-02-23  Derek Scherger  <derek@echologic.com>

	* commands.cc (ls_missing): replace duplicated code with call to
	calculate_base_revision

2005-02-23  Jon Bright  <jon@siliconcircus.com>
	* vocab.cc (test_file_path_verification): Disable foo//nonsense
	test for Win32, add tests for UNC paths.  This was the only
	failing unit test on Win32.

2005-02-23  Jon Bright  <jon@siliconcircus.com>

	* txt2c.cc (main): Don't claim the file was generated from 
	--strip-trailing if that option's used.

2005-02-23  Jon Bright  <jon@siliconcircus.com>

	* app_state.cc: Add include of io.h for Win32, for chdir()
	* file_io.cc (get_homedir): Correct assertion (remove bracket)
	* lua/lposix.c, lua/modemuncher.c: Remove all references to
	functions and modes that don't exist on Win32.
	* monotone.cc: Include libintl.h on Win32
	
2005-02-21  Nathaniel Smith  <njs@codesourcery.com>

	* file_io.cc (get_homedir): Add more comments and logging to Win32
	version.  Also, only check HOME under Cygwin/MinGW.

2005-02-21  Derek Scherger  <derek@echologic.com>

	* Makefile.am: merge fixup
	
2005-02-21  Derek Scherger  <derek@echologic.com>

	* Makefile.am: add fsck.{cc,hh}
	* commands.cc(check_db): move to ...
	* fsck.{cc,hh}: here and do lots more checking
	* database.{cc,hh}(get_ids): new method
	(get_file_ids,get_manifest_ids,get_revision_ids): more new methods
	* tests/t_fsck.at: new test
	* testsuite.at: call it
	
2005-02-21  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (commit): Simplify chatter.

2005-02-21  Nathaniel Smith  <njs@codesourcery.com>

	* file_io.cc (get_homedir): Check more environment variables in
	Win32 version.

2005-02-21  Nathaniel Smith  <njs@codesourcery.com>

	* file_io.cc: Remove tabs.

2005-02-21  Nathaniel Smith  <njs@codesourcery.com>

	* smap.hh (smap): Remove leading underscores, add comments.

2005-02-20  Nathaniel Smith  <njs@codesourcery.com>

	* std_hooks.lua (merge2, merge3): Check for DISPLAY before
	invoking gvim.

2005-02-20  Julio M. Merino Vidal  <jmmv@menta.net>

	* ChangeLog: Use tabs for indentation rather than spaces.  Drop
	trailing whitespace.  While here, fix a date by adding zeros before
	the month and the day number.

2005-02-20  Julio M. Merino Vidal  <jmmv@menta.net>

	* gettext.h: Add file.
	* AUTHORS: Mention that it comes from the GNU Gettext package.
	* Makefile.am: Distribute it.
	* sanity.hh: Use gettext.h rather than libintl.h so that --disable-nls
	works.  Also improves portability, according to the GNU Gettext
	manual.

2005-02-19  Derek Scherger  <derek@echologic.com>

	* automate.cc (automate_heads): remove bogus call to 
	app.allow_working_copy() which is called in cpp_main
	* database.cc (check_sqlite_format_version): don't check database
	version when "file" is really a directory; add filename to error
	message
	(sql): check for empty database early, even though this seems
	impossible as absolutify changes "" into path to working dir;
	convert to use N-style assertions; add check to ensure "file" is
	not really a directory
	* tests/t_db_missing.at: new test for above problems
	* testsuite.at: call it

2005-02-19  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_add_intermediate_MT_path.at: Tighten up.

	* tests/t_merge_3.at: New test.
	* tests/t_merge_4.at: Likewise.
	* testsuite.at: Add them.

2005-02-19  Ole Dalgaard  <josua+monotone@giraffen.dk>

	* configure.ac: Check for 64-bit versions of Boost static
	libraries.

2005-02-18  Julio M. Merino Vidal  <jmmv@menta.net>

	* INSTALL:
	* configure.ac: Improve Boost detection by trying several possible
	library suffixes before aborting.

2005-02-18  graydon hoare  <graydon@pobox.com>

	* change_set.cc
	(apply_change_set): Avoid fast path when there are adds.
	(apply_path_rearrangement): Likewise.

2005-02-18  graydon hoare  <graydon@pobox.com>

	* automate.cc (automate_heads): Fix initialize() call.
	* change_set.{cc,hh}
	(apply_path_rearrangement): Add quick version.
	* revision.cc
	(check_sane_history): Use quick version of apply_change_set.
	* work.cc
	(build_addition): Use quick version of apply_path_rearrangement.
	(known_preimage_path): Likewise.
	* testsuite.at: Fix definitions of _ROOT_DIR, add --norc some
	places.
	* AUTHORS: Mention Daniel.

2005-02-18  Daniel Berlin  <dberlin@dberlin.org>

	* xdelta.cc (compute_delta_insns): Correct 1-byte-source bug.

2005-02-18  graydon hoare  <graydon@pobox.com>

	* Makefile.am (MOST_SOURCES): Add smap.hh.

2005-02-18  graydon hoare  <graydon@pobox.com>

	* basic_io.{cc,hh}: Inline some stuff.
	* change_set.cc: Use smap various places, reduce to 32-bit tids.
	* commands.cc: Use shared_ptr<change_set> everywhere.
	* netsync.cc: Likewise.
	* rcs_import.cc: Likewise.
	* revision.{cc,hh}: Likewise.
	* smap.hh: New file.

2005-02-18  Julio M. Merino Vidal  <jmmv@menta.net>

	* INSTALL:
	* configure.ac: Improve Boost detection by trying several possible
	library suffixes before aborting.

2005-02-17  Derek Scherger  <derek@echologic.com>

	* tests/t_add_intermediate_MT_path.at: new test
	* testsuite.at: call it

2005-02-17  Julio M. Merino Vidal  <jmmv@menta.net>

	* testsuite.at:
	* tests/t_change_empty_file.at: Verify that modifying an empty file
	creates a patch revision rather than an add/delete sequence.  The
	incorrect behavior was reported in bug #9964.

2005-02-17  Derek Scherger  <derek@echologic.com>

	* app_state.{cc,hh} (app_state): initialize search root
	(initialize): boolean signature variant renamed to ...
	(allow_working_copy): this; add explicit search root; move
	requirement for working copy to ...
	(require_working_copy): this new method
	(initialize): string signature variant renamed to ...
	(create_working_copy): this
	(set_root): new method
	* commands.cc: remove app.initialize(false) calls; replace
	app.initialize(true) with app.require_working_copy(); replace
	app.initialize(dir) with app.create_working_copy(dir)
	(checkout): ensure revision is member of specified branch
	* file_io.{cc,hh} (find_working_copy): stop search at --root if
	specified
	* monotone.cc (OPT_ROOT): new option
	(cpp_main): call app.allow_working_copy() before executing
	commands to always read default options
	* monotone.1: add --root option
	* monotone.texi: add --root option
	* tests/t_checkout_noop_on_fail.at: un-XFAIL
	* tests/t_checkout_options.at: un-XFAIL, add check for specified
	revision not in specified branch
	* testsuite.at: add --root option to MONOTONE to prevent searching
	above test dir
	* vocab.cc: remove redundant forward declaration

2005-02-16  Derek Scherger  <derek@echologic.com>

	* commands.cc (revert): don't rewrite unchanged files
	* tests/t_revert_unchanged.at: new test
	* testsuite.at: call it

2005-02-12  Derek Scherger  <derek@echologic.com>

	* database.cc (sqlite3_unpack_fn): new function for viewing
	base64, gzipped data
	(install_functions): install it
	(rehash): remove unused obsolete fcerts ticker

2005-02-17  Nathaniel Smith  <njs@codesourcery.com>

	* debian/changelog: s/graydon@mogo/graydon@pobox.com/, to make
	lintian happy.
	* debian/rules (config.status): Remove --with-bundled-adns.
	* debian/control (Build-Depends): Don't Build-Depend on libpopt,
	only libpopt-dev.
	* .mt-attrs (debian/control): Make executable.

2005-02-17  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_undo_update.at: Stupid typo.
	* tests/t_largish_file.at: New test.
	* testsuite.at: Add it.

	* commands.cc (push, pull, sync): Remove misleading "..." from
	help text.

2005-02-16  Julio M. Merino Vidal  <jmmv@menta.net>

	* Makefile.am: Append $(BOOST_SUFFIX) to -lboost_unit_test_framework
	to fix 'make check' on systems where boost libraries can only be
	found by passing the exact suffix as part of the name.

2005-02-16  Julio M. Merino Vidal  <jmmv@menta.net>

	* monotone.texi: Fix a typo (hexidecimal to hexadecimal).  Also
	change an example command to append stuff to ~/.monotonerc, instead
	of completely destroying the possibily existing file.  Addresses
	bug #11136.

2005-02-16  Julio M. Merino Vidal  <jmmv@menta.net>

	* cryptopp/config.h: Use uint{8,16,32,64}_t as size types instead of
	trying to match them to unsigned char/int/long/long long respectively.
	Should fix build on FreeBSD/sparc64, as seen in bug #10203.

2005-02-16  Julio M. Merino Vidal  <jmmv@menta.net>

	* INSTALL:
	* Makefile.am:
	* configure.ac: Add the --disable-large-file option to manually
	disable large file support from the builtin sqlite (compatibility
	with old systems and FAT).  Addresses bug #8380.

2005-02-16  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_undo_update.at: New todo.
	* testsuite.at: Add it.

2005-02-15  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.1: Add cursory note about "automate".
	* monotone.texi: Synchronize with manpage.

2005-02-15  Nathaniel Smith  <njs@codesourcery.com>

	* automate.cc: Add "Error conditions" to the standard comment
	sections.

	* monotone.texi (Scripting): New section.
	(Automation): New section.

	* tests/t_automate_heads.at: Test behavior with nonexistent
	branch.

2005-02-14  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_merge_normalization_edge_case.at: New test.
	* testsuite.at: Add it.

	* diff_patch.cc (normalize_extents): Soften the warning message
	now that we have one test case.

2005-02-14  Matthew A. Nicholson  <mnicholson@digium.com>

	* std_hooks.lua: Add vimdiff merge hooks.

2005-02-14  Nathaniel Smith  <njs@codesourcery.com>

	* std_hooks.lua: Remove tabs.

2005-02-14  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_automate_heads.at: New test.
	* tests/t_automate_version.at: New test.
	* testsuite.at: Add then.

	* commands.cc (automate): Fix documentation string.
	* automate.cc: Much more structured documentation comments.

2005-02-13  Nathaniel Smith  <njs@codesourcery.com>

	* automate.{cc,hh}: New files.
	* commands.cc: New command "automate".

2005-02-13  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi (Creating a Database): Fix typo, clarify
	conventions for database management following question on mailing
	list.

2005-02-12  graydon hoare  <graydon@pobox.com>

	* change_set.{cc,hh}: Correct code to pass newly-added unit tests.

2005-02-10  Derek Scherger  <derek@echologic.com>

	* monotone.1: update for restrictions
	* monotone.texi: sync with manpage

2005-02-09  Derek Scherger  <derek@echologic.com>

	* cert.cc (cert_revision_testresult): allow pass/fail testresult
	values
	* commands.cc (testresult): likewise
	* commands.cc (do_diff): disallow restriction of non-working copy
	diffs
	* monotone.texi: update for restrictions

2005-02-08  graydon hoare  <graydon@pobox.com>

	* database.cc (version_cache::set): Fix bad expiry logic.

2005-02-08  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc (check_sane): Null sources are only valid for
	adds.

2005-02-07  Nathaniel Smith  <njs@codesourcery.com>

	* database.cc (struct version_cache): Fix invariant in cache
	clearing logic.

2005-02-06  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc: Add a few more invariants; add lots and lots of
	unit tests.

2005-02-06  graydon hoare  <graydon@pobox.com>

	* change_set.cc: Use hash_map in a few places.
	(confirm_unique_entries_in_directories): Fix invariants.
	* constants.{cc,hh} (db_version_cache_sz): New constant.
	* database.cc (version_cache): New structure.
	(get_version): Use it.
	* interner.hh: Rewrite to use hash_map and vector.
	* tests/t_no_rename_overwrite.at: Tweak return codes.

2005-02-06  Nathaniel Smith  <njs@codesourcery.com>

	* ui.hh (ensure_clean_line): New method.
	* ui.cc (inform): Use it.
	* keys.cc (get_passphrase): Call it before prompting for passphrase.

2005-02-06  Nathaniel Smith  <njs@codesourcery.com>

	* database.cc (info): Report more statistics.

	* ROADMAP: Remove finished items.

	* revision.cc (analyze_manifest_changes): Childs cannot be null,
	that makes no sense.
	(add_node_for_old_manifest): Log node names, don't print it.
	(construct_revision_from_ancestry): Partially rewrite to handle
	root nodes explicitly.
	(build_changesets_from_existing_revs): Don't put the null revision
	in the ancestry graph, to match changesetify logic.
	(add_node_for_old_revision): Enforce decision that the ancestry
	graph not contain the null revision.

	(anc_graph::heads): Remove.
	(add_node_ancestry): Don't try creating it; logic was broken
	anyway.
	(rebuild_from_heads): Rename to...
	(rebuild_ancestry): ...this.  Calculate head set correctly.

2005-02-05  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc (compose_path): Add more invariants.

2005-02-05  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.cc (cpp_main): Log command line, to help interpret the
	logs people send in.

2005-02-05  Nathaniel Smith  <njs@codesourcery.com>

	* revision.cc (check_sane): Turn off this invariant when
	global_sanity.relaxed.

2005-02-03  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_load_into_existing.at: Oops, really add it too, sigh.

2005-02-03  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_need_mt_revision.at: Oops, really add it.

2005-02-03  Nathaniel Smith  <njs@codesourcery.com>

	* interner.hh (interner::intern): Add version taking a bool&, so
	callers can tell whether this string has previously been checked.
	* change_set.cc: Use new interned string identifier
	'path_component's instead of file_path's for components of paths;
	sanity-check each component exactly once.

2005-02-03  Nathaniel Smith  <njs@codesourcery.com>

	* database.cc (load): Check for existence of target database.
	* tests/t_load_into_existing.at: New test.
	* testsuite.at: Add it.

2005-02-03  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_checkout_dir.at: Also check that checkout to unwriteable
	directory fails.
	* tests/t_branch_checkout.at: New test.
	* testsuite.at: Add it.

	* app_state.cc (initialize): Simplify working directory
	initialization, and improve error handling.

	* keys.cc (get_passphrase): Disallow empty passphrases early
	(before they trigger an invariant down the line...).

2005-02-03  Nathaniel Smith  <njs@codesourcery.com>

	* update.cc (pick_update_candidates): Add I().
	* commands.cc (calculate_base_revision): Remove 'rev' argument,
	which was never set and callers never used.
	(calculate_base_manifest, calculate_current_revision)
	(calculate_restricted_revision, revert): Update correspondingly.
	(update): Check for null old revision.

	* main.cc (main): Make exit status 3 if we caught an unhandled
	exception, in particular so the testsuite can tell the difference
	between an error handled cleanly and an error caught by an
	invariant.
	* tests/t_update_null_revision.at: New test.
	* testsuite.at: Add it.

2005-02-03  Nathaniel Smith  <njs@codesourcery.com>

	* main.cc: Remove tabs.

2005-02-02  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc (extract_first): Rename to...
	(extract_pairs_and_insert): ...this.
	(path_rearrangement::check_sane): Use it to add additional
	checks.

	* work.hh: Update comments (MT/manifest doesn't exist
	anymore...).

	* tests/t_need_mt_revision.at: New test.
	* testsuite.at: Add it.
	* commands.cc (get_revision_id): Require MT/revision to exist.
	(setup): Create MT/revision.

2005-02-02  Nathaniel Smith  <njs@codesourcery.com>

	* work.hh: Remove tabs.

2005-02-03  graydon hoare  <graydon@pobox.com>

	* tests/t_i18n_changelog.at: New test.
	* testsuite.at: Run it.
	* lua/lposix.c: New file.
	* lua/modemuncher.c: New file
	* lua.cc: Load posix library.
	* lua/liolib.c: Disable execute and popen.
	* std_hooks.lua: Remove io.execute uses.
	* AUTHORS: Update to mention lposix.c, modemuncher.c.
	* Makefile.am: Likewise.

2005-02-01  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_rebuild.at: Beef up test in response to possible
	problems reported by Derek Scherger.

2005-01-31  Nathaniel Smith  <njs@codesourcery.com>

	* rcs_import.cc (store_manifest_edge): Don't try to store deltas
	to the null manifest.
	(import_cvs_repo): Root revision has null manifest, not empty
	manifest.
	* revision.cc (check_sane): More invariants.

2005-01-28  graydon hoare  <graydon@pobox.com>

	* database.{cc,hh}: More netsync speed tweaks.
	* netsync.cc: Likewise.

2005-01-27  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_restrictions_warn_on_unknown.at: New test.
	* testsuite.at: Add it.

2005-01-27  Derek Scherger  <derek@echologic.com>

	* commands.cc (attr): adjust for subdir; ensure files exist
	* tests/t_attr.at: improve setup description
	* tests/t_attributes.at: improve setup description so that
	testsuite -k attr runs this test; check for attributes on missing
	files
	* tests/t_subdir_attr.at: new test
	* testsuite.at: fix dutch spelling of monotone; call new test

2005-01-27  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.hh (null_id): New function.
	* revision.cc (analyze_manifest_changes): Fix typo, use null_id.
	* tests/t_rebuild.at: Un-XFAIL.

2005-01-27  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_rebuild.at: Add priority tag.

	* tests/t_cvsimport.at: Be more thorough.

	* rcs_import.cc (store_edge): Rename to...
	(store_manifest_edge): ...this.  Remove revision arguments, and
	remove storing of revision.
	(import_states_recursive): Update accordingly.
	Add 'revisions' argument; update it instead of trying to write
	revisions now.
	(import_states_by_branch): Add 'revisions' argument.
	(import_cvs_repo): Add a stage 3 that writes out the revisions
	accumulated in the 'revisions' vector.

2005-01-27  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Mention Georg.
	* change_set.cc: Null out names which are in null directories.
	* commands.cc (reindex): Remove COLLECTION argument.
	* database.{cc,hh} (get_revision_certs):
	Add brute force "load all certs" method.
	* merkle_tree.{cc,hh}: Modify to use memory rather than disk.
	* netsync.{cc,hh}: Likewise.
	* packet.hh (manifest_edge_analyzer): Kill dead code.

2005-01-26  Nathaniel Smith  <njs@codesourcery.com>

	* mt_version.cc (print_full_version): Include system flavour.

2005-01-26  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_rebuild.at: New test.
	* testsuite.at: Add it.

2005-01-26  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_checkout_noop_on_fail.at: Clarify description and XFAIL.

	* tests/t_approval_semantics.at: New TODO.
	* tests/t_monotone_agent.at: New TODO.
	* testsuite.at: Add them.

2005-01-25  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_checkout_noop_on_fail.at: New test.
	* testsuite.at: Add it.
	(RAW_MONOTONE): Add $PREEXECUTE to definition.

2005-01-25  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc (extend_renumbering_from_path_identities): Add
	invariant.
	(extend_renumbering_via_added_files): Likewise.

	* constants.hh (maxbytes, postsz): Remove dead constants.
	(verify_depth): New constant.
	* constants.cc: Likewise.
	* revision.hh (check_sane_history): New function.
	* revision.cc (check_sane_history): Likewise.
	* database.cc (put_revision): Sanity check revision and revision
	history before storing it.
	This breaks cvs import.  Why?

	* update.cc (find_deepest_acceptable_descendent): Remove.
	(acceptable_descendent, calculate_update_set): New functions.
	(pick_update_candidates): Use 'calculate_update_set'.
	* tests/t_update_2.at: Un-XFAIL.
	* tests/t_ambig_update.at: Un-XFAIL.

	* tests/t_no_rename_overwrite.at: New test.
	* tests/t_cdiff.at: New test placeholder.
	* testsuite.at: Add them.
	(MONOTONE): Prefix command line with $PREEXECUTE to e.g. support
	running under Valgrind.

2005-01-25  Matt Johnston  <matt@ucc.asn.au>

	* cert.cc: ignore whitespace when comparing private keys
	from the database and with the lua hook
	* tests/t_lua_privkey.at: new test
	* testsuite.at: run it

2005-01-23  Derek Scherger  <derek@echologic.com>

	* commands.cc (restrict_rename_set): include renames if either
	name is present in restriction
	(calculate_base_revision): remove unused variant
	(calculate_current_revision): remove unsed variable
	(calculate_restricted_revision): remove unsed variable
	(ls_missing): remove unsed variable
	(revert): rewrite with restrictions
	* tests/t_revert.at: test partial reverts adjust MT/work properly
	* tests/t_revert_dirs.at: un-XFAIL
	* tests/t_revert_rename.at: un-XFAIL; revert rename via both names

2005-01-23  Derek Scherger  <derek@echologic.com>

	* tests/t_revert_rename.at: remove extra MONOTONE_SETUP
	attempt revert by both original name and new name

2005-01-23  Derek Scherger  <derek@echologic.com>

	* tests/t_revert_rename.at: New test.
	* testsuite.at: Add it.

2005-01-22  Derek Scherger  <derek@echologic.com>

	* tests/t_revert_dirs.at: New test.
	* testsuite.at: Add it.

2005-01-22  Nathaniel Smith  <njs@codesourcery.com>

	* configure.ac (AC_INIT): Set bug-reporting address to list
	address, rather than Graydon's personal email.
	* diff_patch.cc (normalize_extents): Use it.
	* ui.cc (fatal): Likewise.

	* tests/t_vcheck.at: New priority "todo", tweak descriptive text.

2005-01-22  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_delete_dir.at: Add more commentary.

	* tests/t_rename_dir_patch.at: New test.
	* tests/t_delete_dir_patch.at: New test.
	* testsuite.at: Add them.

2005-01-22  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc (apply_change_set): Add invariants.
	* tests/t_rename_dir_cross_level.at: New test.
	* tests/t_rename_added_in_rename.at: New test.
	* tests/t_rename_conflict.at: New test.
	* testsuite.at: Add them.

2005-01-21  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_ambig_update.at: Update comments.

	* tests/t_update_2.at: New test from Georg-W. Koltermann
	<Georg.Koltermann@mscsoftware.com>.
	* testsuite.at: Add it.

2005-01-20  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_lca_1.at: New bug report.
	* testsuite.at: Add it.

2005-01-19  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (merge): Improve merge chatter.
	(do_diff): Don't print anything when there are no
	changes.

2005-01-19  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_db_with_dots.at: New test.
	* testsuite.at: Add it.

2005-01-19  Patrick Mauritz <oxygene@studentenbude.ath.cx>

	* Makefile.am (%.h, package_revision.h, package_full_revision.h):
	Don't update target file if no change has occurred, to reduce
	unnecessary rebuilds.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* rcs_import.cc (cvs_key): Initialize struct tm to all zeros, to
	stop garbage sneaking in -- thanks to Zack Weinberg for pointing
	this out.  Also, handle 2 digit years properly on WIN32.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* rcs_import.cc: Remove tabs.

2005-01-19  Matt Johnston  <matt@ucc.asn.au>

	* database.cc: Pass filename to check_sqlite_format_version as a
	fs::path, so that it doesn't get passed as a freshly created fs::path
	with default checker (which disallows '.foo' path components)

2005-01-19  Nathaniel Smith  <njs@codesourcery.com>

	* netsync.cc (session, process_confirm_cmd, dispatch_payload):
	Back out some over-zealous changes that broke netsync
	compatibility.  Probably should redo later, when have a chance to
	bump netsync protocol number, but we're not ready for that now.

2005-01-19  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_subdir_revert.at: New test.
	* tests/t_subdir_rename.at: New test.
	* testsuite.at: Add them.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_subdir_add.at: New test.
	* tests/t_subdir_drop.at: New test.
	* testsuite.at: Add them.
	* tests/t_delete_dir.at: Implement it.

2005-01-19  Nathaniel Smith  <njs@codesourcery.com>

	* netcmd.cc: Remove tabs.

2005-01-19  Nathaniel Smith  <njs@codesourcery.com>

	* merkle_tree.cc: Remove tabs.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* rcs_import.cc (cvs_key): Initialize struct tm to all zeros, to
	stop garbage sneaking in -- thanks to Zack Weinberg for pointing
	this out.  Also, handle 2 digit years properly on WIN32.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* rcs_import.cc: Remove tabs.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi: Undocument mcerts, fcerts; rename rcerts to
	certs.
	* monotone.1: Likewise.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (restrict_rename_set): Fix types to compile with old
	rename_set gunk removed.
	Alter logic to yell if a rename crosses the restriction boundary,
	rather than silently ignore it.

2005-01-19  graydon hoare  <graydon@pobox.com>

	* commands.cc: Fix up some merge breakage.
	* tests/t_add_dot.at: Un-XFAIL.
	* testsuite.at: Run "setup ." before "db init".

2005-01-09  Derek Scherger  <derek@echologic.com>

	* commands.cc (get_path_rearrangement): new function/signature for
	splitting restricted rearrangements
	(calculate_restricted_revision): use it and update to work
	similarly to calculate_current_revision
	(trusted): call app.initialize(false)
	(ls_missing): adjust for new get_path_rearrangement
	(attr): call app.initialize(true)
	(diff): merge cleanup
	(lca, lcad, explicit_merge): call app.initialize(false)
	* app_state.cc (constructor): set database app state
	(load_rcfiles): add required booleans
	* lua.{cc,hh} (load_rcfile): add required boolean
	* tests/t_add.at:
	* tests/t_diff_added_file.at:
	* tests/t_disapprove.at:
	* tests/t_drop_missing.at:
	* tests/t_heads.at:
	* tests/t_heads_discontinuous_branch.at:
	* tests/t_i18n_file.at:
	* tests/t_log_nonexistent.at:
	* tests/t_merge_add_del.at:
	* tests/t_netsync.at:
	* tests/t_netsync_pubkey.at:
	* tests/t_netsync_single.at:
	* tests/t_persistent_server_keys.at:
	* tests/t_persistent_server_revision.at:
	* tests/t_remerge.at:
	* tests/t_tags.at:
	* tests/t_update_missing.at:
	* tests/t_update_to_revision.at: add --message option to commits
	* tests/t_merge2_add.at:
	* tests/t_merge2_data.at:
	* tests/t_netsync_unrelated.at: create working directory with new
	setup command
	* tests/t_erename.at: update for revisions
	* tests/t_no_change_deltas.at: add --revision options to diff
	* tests/t_restrictions.at: remove some cruft and update to work
	with revisions
	* tests/t_subdirs.at: pass correct --rcfile and --db options from
	within subdir
	* testsuite.at (REVERT_TO): remove MT dir before checkout, which
	now fails if MT exists, replace checkout MT/options with old
	MT/options
	(COMMIT): add --message option to commit macro
	* work.cc (read_options_map): don't overwrite option settings when
	reading options map so that command line settings take precedence

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* netsync.cc: Partially fix comment (s/manifest/revision/ etc.).
	(dispatch_payload): Ignore mcert and fcert refinement requests,
	instead of dying on them.  Hack, but I think it should let this
	netsync continue to interoperate with old netsync...

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* vocab.hh: Remove file<cert>.
	* vocab.cc: Likewise.
	* packet_types.hh: Remove file.
	* Makefile.am (MOST_SOURCES): Remove packet_types.hh and mac.hh.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* netsync.cc (process_confirm_cmd): Don't try refining mcert and
	fcert trees.
	Remove other dead/pointless code.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* database.hh: Remove file cert stuff.
	* netsync.cc (data_exists): We don't have file/manifest certs.
	(load_data): Likewise.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* netsync.cc (process_data_cmd): Ignore file/manifest certs.

	* database.cc (struct valid_certs): Don't support file certs.
	(rehash): No file certs.
	(file_cert_exists): Remove.
	(put_file_cert): Remove.
	(get_file_certs): Remove.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* packet.cc (class delayed_manifest_cert_packet):
	(class delayed_file_cert_packet): Remove.
	(packet_db_writer::consume_file_cert, consume_manifest_cert)
	(packet_writer::consume_file_cert, consume_manifest_cert)
	Remove.
	(struct feed_packet_consumer): Don't support mcert/fcert packets.
	(extract_packets): Likewise.
	(packet_roundabout_test): Test revision certs, not manifest/file
	certs.

	* packet.hh (packet_consumer::consume_file_cert):
	(packet_consumer::consume_manifest_cert):
	(packet_writer::consume_file_cert):
	(packet_writer::consume_manifest_cert):
	(packet_db_writer::consume_file_cert):
	(packet_db_writer::consume_manifest_cert):
	Remove.

	* lua.hh (hook_get_file_cert_trust): Remove.
	* lua.cc (hook_get_file_cert_trust): Remove.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* cert.hh (erase_bogus_certs): Re-add manifest cert version.

	* monotone.texi (Hook Reference): Remove documentation of
	get_{file,manifest}_cert_trust.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* cert.cc (erase_bogus_certs): Re-add manifest cert version.
	(bogus_cert_p): Likewise.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* cert.hh (rename_edge):
	(rename_set):
	(calculate_renames):
	(rename_cert_name): Remove.
	(cert_file_comment):
	(cert_manifest_comment): Remove.
	(erase_bogus_certs): Remove manifest and file versions.
	* cert.cc (rename_cert_name): Remove.
	(bogus_cert_p): Remove manifest<cert> and file<cert> variants.
	(erase_bogus_certs): Likewise.
	(put_simple_manifest_cert):
	(put_simple_file_cert):
	(cert_file_comment): Remove.

	* commands.cc (fcerts): Remove.
	(mcerts): Likewise.
	(rcerts): Rename to...
	(certs): ...this.  s/revision certs/certs/ in help text.
	(trusted): s/revision cert/cert/.
	(ls_certs): Don't special-case rename certs.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_vcheck.at: Fix AT_XFAIL_IF typo.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi (Reserved Certs): Remove 'vcheck'.
	(Key and Cert): Remove 'vcheck'.
	(Accidental collision): Likewise.
	(Commands): Likewise.
	* tests/t_vcheck.at: Add note about manual having useful stuff for
	when vcheck is re-added.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* mac.hh:
	* cert.cc (vcheck_cert_name):
	(calculate_vcheck_mac):
	(cert_manifest_vcheck
	(check_manifest_vcheck):
	* cert.hh (cert_manifest_vcheck):
	(check_manifest_vcheck):
	* constants.cc (constants::vchecklen):
	* constants.hh (constants::vchecklen):
	* commands.cc (vcheck):
	Remove.

	* tests/t_vcheck.at: New test.
	* testsuite.at: Call it.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* ROADMAP: Remove 'upgrade to sqlite3' todo item.

2005-01-18  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (tag):
	(testresult):
	(approve):
	(disapprove):
	(comment):
	(fload):
	(fmerge):
	(cat):
	(rcs_import): Change grouping for "--help" display, to make more
	informative.
	(rcs_import): Also add more details to help text.

2005-01-17  Nathaniel Smith  <njs@codesourcery.com>

	* diff_patch.cc (normalize_extents): Add missing ')'.

2005-01-17  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_update_1.at: New test.
	* testsuite.at: Call it.

2005-01-11  Nathaniel Smith  <njs@codesourcery.com>

	* diff_patch.cc (normalize_extents): Add warning for anyone who
	manages to trigger the untested part of the normalization code.

2005-01-14  Christian Kollee <stuka@pestilenz.org>

	* search for and link with sqlite3 when --bundle-sqlite=no

2005-01-12  Derek Scherger  <derek@echologic.com>

	* tests/t_ambig_update.at: add comments from discussion on irc
	* tests/t_status_missing.at: new test
	* testsuite.at: include it

2005-01-10  graydon hoare  <graydon@pboox.com>

	* commands.cc (explicit_merge): Tweak merge message.
	* database.cc (check_sqlite_format_version): New function.
	(database::sql): Call it.
	* sqlite/pager.hh (SQLITE_DEFAULT_PAGE_SIZE): Adjust to 8192.
	(SQLITE_MAX_PAGE_SIZE): Adjust to 65536.
	* schema_migration.cc: Post-merge cleanup.
	* Makefile.am: Likewise.

2005-01-10  Christof Petig <christof@petig-baender.de>

	* sqlite/*: SQLite 3.0.8 CVS import
	* database.{cc,hh}:
	* schema_migration.{cc,hh}: convert to use the SQLite3 API

	This does not yet use any of the more sophisticated API features
	of SQLite3 (query parameters, BLOBs), so there is plenty of room
	for optimization. This also does not change the schema (i.e.
	still uses base64 encoded values in tables)

2005-01-17  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Mention Wojciech and Neil.
	* revision.cc (calculate_ancestors_from_graph): Make non-recursive.

2005-01-17  Wojciech MiÅ√ÖÅ¬Çkowski  <wmilkowski@interia.pl>

	* std_hooks.lua: Teach about meld.

2005-01-17  Neil Conway  <neilc@samurai.com>

	* diff_patch.cc: add a new context diff hunk consumer. Rename
	unidiff() to make_diff().
	* diff_patch.hh: Rename unidiff() to make_diff().
	* command.cc: Add new "cdiff" command, and refactor "diff" to
	invoke a common subroutine that is parameterized on the diff
	type. Unrelated change: make a branch-based checkout default to
	using the same directory name as the branch name, unless a
	branch is specified.

2005-01-17  graydon hoare  <graydon@pobox.com>

	* cryptopp/osrng.cpp (NonblockingRng::GenerateBlock):
	Bring forward patch lost in cryptopp 5.2 upgrade.
	* revision.cc (add_bitset_to_union)
	(calculate_ancestors_from_graph): New functions.
	(erase_ancestors)
	(is_ancestor): Rewrite.
	* cert.cc (get_branch_heads): Rewrite.
	* database.{cc,hh} (get_heads): Remove
	(get_revision_ancestry): Use multimap.
	(install_views): Disable.
	Remove everything related to the trust views. Too slow.
	Also tidy up whitespace formatting in sqlite3 code.
	* views.sql: Clear out all views.
	* commands.cc: Adapt to using multimap for ancestry.
	* AUTHORS: Mention Faheem and Christian.

2005-01-17  Faheem Mitha  <faheem@email.unc.edu>

	* debian/control: Fix up build depends.

2005-01-17  Ulrich Drepper  <drepper@redhat.com>

	* acinclude.m4 (AC_CHECK_INADDR_NONE): Fix quoting.
	* Makefile.am (EXTRA_DIST): Add sqlite/keywordhash.c.

2005-01-14  Christian Kollee  <stuka@pestilenz.org>

	* search for and link with sqlite3 when --bundle-sqlite=no

2005-01-12  Derek Scherger  <derek@echologic.com>

	* tests/t_ambig_update.at: add comments from discussion on irc
	* tests/t_status_missing.at: new test
	* testsuite.at: include it

2005-01-10  graydon hoare  <graydon@pboox.com>

	* commands.cc (explicit_merge): Tweak merge message.
	* database.cc (check_sqlite_format_version): New function.
	(database::sql): Call it.
	* sqlite/pager.hh (SQLITE_DEFAULT_PAGE_SIZE): Adjust to 8192.
	(SQLITE_MAX_PAGE_SIZE): Adjust to 65536.
	* schema_migration.cc: Post-merge cleanup.
	* Makefile.am: Likewise.

2005-01-10  Christof Petig  <christof@petig-baender.de>

	* sqlite/*: SQLite 3.0.8 CVS import
	* database.{cc,hh}:
	* schema_migration.{cc,hh}: convert to use the SQLite3 API

	This does not yet use any of the more sophisticated API features
	of SQLite3 (query parameters, BLOBs), so there is plenty of room
	for optimization. This also does not change the schema (i.e.
	still uses base64 encoded values in tables)

2005-01-11  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_migrate_schema.at: Switch to using pre-dumped db's, make
	it work, un-XFAIL it.

2005-01-11  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_persistent_server_keys_2.at: XFAIL it, add commentary on
	solution.

2005-01-11  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_persistent_server_keys_2.at: New test.
	* testsuite.at: Add it.

2005-01-06  Nathaniel Smith  <njs@codesourcery.com>

	* schema_migration.cc (migrate_monotone_schema): Add comment
	pointing to t_migrate_schema.at.
	* tests/t_migrate_schema.at: Implement, mostly.  (Still broken.)

	* tests/t_heads_discontinuous_branch.at: Remove urgency
	annotation.
	* tests/t_netsync_nocerts.at: Add urgency annotation.

	* testsuite.at: Add UNGZ, UNGZB64 macros.
	* tests/t_fmerge.at: Use them.

2005-01-05  Nathaniel Smith  <njs@codesourcery.com>

	* schema_migration.cc: Update comment about depot code.
	(migrate_depot_split_seqnumbers_into_groups):
	(migrate_depot_make_seqnumbers_non_null):
	(migrate_depot_schema): Remove; all are dead code.

2005-01-05  Nathaniel Smith  <njs@codesourcery.com>

	* schema_migration.cc: Remove tabs.

2005-01-05  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_check_same_db_contents.at: Uncapitalize title to unbreak
	testsuite.

	* revision.cc (is_ancestor): Add FIXME comment.
	(erase_ancestors): New function.
	* revision.hh (erase_ancestors): Prototype it.
	* cert.cc (get_branch_heads): Call it.
	* tests/t_heads_discontinuous_branch.at: Un-XFAIL it.

	* revision.cc (find_subgraph_for_composite_search): Ignore null
	revision ids.
	* commands.cc (try_one_merge): Add invariant - never create merges
	where the left parent is an ancestor or descendent of the right.
	(explicit_merge): Same check.
	(propagate): Handle cases where no merge is necessary.  Also, make
	generated log message more readable.

	* tests/t_propagate_desc.at: Un-XFAIL it.
	* tests/t_propagate_anc.at: Un-XFAIL it.  Use new
	CHECK_SAME_DB_CONTENTS macros.
	* testsuite.at: Move t_check_same_db_contents.at to run before
	propagation tests.  Make CHECK_SAME_DB_CONTENTS more thorough.

	* tests/t_dump_load.at: Implement test.

2005-01-05  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_check_same_db_contents.at: New test.
	* testsuite.at: Add it.
	(CHECK_SAME_DB_CONTENTS): New macro.

2005-01-04  Nathaniel Smith  <njs@codesourcery.com>

	* cert.cc: Remove tabs.
	* revision.hh: Likewise.

2005-01-04  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_propagate_anc.at: Also check the case where we're
	propagating a non-strict ancestor, i.e. the heads are actually
	equal.

2005-01-04  Nathaniel Smith  <njs@codesourcery.com>

	* database.cc (get_revision_parents): Add invariant.
	(get_revision_children): Likewise.
	(get_revision): Likewise.
	(put_revision): Likewise.

	* tests/t_merge_ancestor.at: New test.
	* tests/t_propagate_desc.at: Likewise.
	* tests/t_propagate_anc.at: Likewise.
	* testsuite.at: Call them.

2005-01-04  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_netsync_diffbranch.at: Add priority, add description of
	problem and solution.
	Also, XFAIL it.
	* tests/t_netsync_unrelated.at: Add reference to discussion.
	* tests/t_cmdline_options.at: Remove priority marking from
	non-bug.
	* tests/t_checkout_dir.at: XFAIL when run as root.

	* tests/t_netsync_nocerts.at: New test.
	* testsuite.at: Call it.

2005-01-03  Matt Johnston  <matt@ucc.asn.au>

	* tests/t_netsync_diffbranch.at: add a new test for pulling a branch
	with a parent from a different branch.
	* testsuite.at: add it

2005-01-02  Derek Scherger  <derek@echologic.com>

	* commands.cc (log_certs): new function
	(log) add Ancestor: and Branch: entries to output; use above new
	function
	* tests/t_cross.at: update to work with changesets

2004-12-30  graydon hoare  <graydon@pobox.com>

	* constants.cc (netcmd_current_protocol_version): Set to 3.
	* tests/t_crlf.at: New test of crlf line encodings.
	* testsuite.at: Call it.
	* monotone.spec: Note 0.16 release.

2004-12-30  graydon hoare  <graydon@pobox.com>

	* win32/get_system_flavour.cc: Fix little compile bugs.

2004-12-30  Julio M. Merino Vidal  <jmmv@menta.net>

	* change_set.{cc,hh}: Add the has_renamed_file_src function in
	change_set::path_rearrangement.
	* commands.cc: Make the 'log' command show nothing for renamed or
	deleted files (when asked to do so) and stop going backwards in
	history when such condition is detected; they don't exist any more,
	so there is no point in showing history (and could drive to incorrect
	logs anyway).
	* tests/t_log_nonexistent.at: New check to verify previous.
	* testsuite.at: Add it.

2004-12-30  graydon hoare  <graydon@pobox.com>

	* Makefile.am: Clean full testsuite directory and full-version.
	* configure.ac: Bump version number.
	* po/monotone.pot: Regenerate.
	* NEWS: Describe new release.

2004-12-29  Julio M. Merino Vidal  <jmmv@menta.net>

	* tests/t_cmdline_options.at: New test for previous: ensure that
	monotone is actually checking for command line correctness.
	* testsuite.at: Add it.

2004-12-29  Julio M. Merino Vidal  <jmmv@menta.net>

	* monotone.cc: Verify that the command line is syntactically correct
	as regards to options (based on error codes from popt).

2004-12-29  Matt Johnston  <matt@ucc.asn.au>

	* tests/t_drop_rename_patch.at: A test to check that deltas on
	renamed files are included in concatenate_change_sets, if there was a
	deletion of a file with the same name as the rename src.
	* testsuite.at: add it

2004-12-29  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Add Jordi.
	* change_set.{cc,hh}: Make sanity helpers const.
	(normalize_change_set): Drop a->a deltas.
	(merge_change_sets): Call normalize.
	(invert_change_set): Likewise.
	* revision.cc
	(find_subgraph_for_composite_search): New fn.
	(calculate_composite_change_set): Call it.
	(calculate_change_sets_recursive): Use results.
	* tests/t_no_change_deltas.at: Fix.

2004-12-29  graydon hoare  <graydon@pobox.com>

	* change_set.cc: Fix unit tests to satisfy sanity checks.
	* std_hooks.lua: Fix status checking on external merges.

2004-12-29  Matt Johnston  <matt@ucc.asn.au>

	* change_set.{cc,hh}: Take account of files which are the
	destination of a rename_file operation, when examining
	file deletions. Added helper methods to clean up related code.

2004-12-29  Matt Johnston  <matt@ucc.asn.au>

	* change_set.cc: added a sanity check for deltas with same src/dst,
	and deleted files with deltas.

2004-12-29  Matt Johnston  <matt@ucc.asn.au>

	* testsuite.at, tests/t_netsync_single.at: don't use -q with
	killall since it isn't portable.

2004-12-28  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: Make the 'log' command show all affected files
	in each revision in a nice format (easier to read than what
	'cat revision' shows).

2004-12-28  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: Change the order used by the 'log' command to show
	affected files so that it matches the order in which these changes
	really happen.  Otherwise, a sequence like "rm foo; mv bar foo;
	patch foo" could be difficult to understand by the reader.

2004-12-28  Jordi Vilalta Prat  <jvprat@wanadoo.es>

	* monotone.texi: Fix a typo: "not not" should be "not".

2004-12-28  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: Make the 'log' command show all affected files
	in each revision in a nice format (easier to read than what
	'cat revision' shows).

2004-12-28  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Add various recent authors.

2004-12-28  Badai Aqrandista <badaiaqrandista@hotmail.com>

	* debian/*: Fix up for package building.

2004-12-28  graydon hoare  <graydon@pobox.com>

	* change_set.{cc,hh}: Add sanity checking, rework
	some of concatenation logic to accomodate.
	* revision.{cc,hh}: Likewise.
	Teach about generalized graph rebuilding.
	* database.cc (delete_existing_revs_and_certs): New fn.
	* commands.cc (db rebuild): New command.
	(db fsck) New command.
	* sanity.{cc,hh} (relaxed): New flag.
	* work.cc: Use new concatenation logic.

2004-12-25  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: During 'log', print duplicate certificates (by
	different people) in separate lines, rather than showing them
	together without any spacing.  While here, homogenize new lines
	in other messages as well; this also avoids printing some of
	them in case of missing certificates).

2004-12-24  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_disapprove.at: Enable previously disabled test.

	* tests/t_no_change_deltas.at: New test.
	* testsuite.at: Call it.

2004-12-23  Nathaniel Smith  <njs@codesourcery.com>

	* win32/read_password.c: Remove unused file.

2004-12-22  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: Verify that the key identifier passed to the pubkey
	and privkey commands exists in the database.  Otherwise exit with
	an informational message instead of an exception.

2004-12-20  Matt Johnston  <matt@ucc.asn.au>

	* keys.cc: don't cache bad passphrases, so prompt for a correct
	password if the first ones fail.

2004-12-19  Matt Johnston  <matt@ucc.asn.au>

	* commands.cc: print out author/date next to ambiguous revision
	lists from selectors.

2004-12-19  Julio M. Merino Vidal  <jmmv@menta.net>

	* testsuite.at:
	* tests/t_fmerge.at:
	* tests/t_netsync.at:
	* tests/t_netsync_single.at:
	* tests/t_revert.at:
	* tests/t_tags.at: Avoid usage of test's == operator.  It's a
	GNUism and causes unexpected failures in many tests.  The correct
	operator to use is just an equal sign (=).
	* tests/t_renamed.at: Don't use cp's -a flag, which is not
	supported by some implementations of this utility (such as the
	one in NetBSD).  Try to add some of its funcionality by using
	the -p flag, although everything could be fine without it.
	* tests/t_unidiff.at: Discard patch's stderr output.  Otherwise
	it's treated as errors, but NetBSD's patch uses it to print
	informative messages.

2004-12-19  Julio M. Merino Vidal  <jmmv@menta.net>

	* tests/t_scan.at: Instead of running sha1sum, use a prestored
	manifest file to do the verification.  This avoids problems in
	systems that do not have the sha1sum tool, like NetBSD.

2004-12-19  Julio M. Merino Vidal  <jmmv@menta.net>

	* Makefile.am: Remove obsolete --with-bundled-adns flag from
	DISTCHECK_CONFIGURE_FLAGS.

2004-12-18  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_checkout_dir.at: Make the test directory chdir'able
	again after the test.
	* tests/t_delete_dir.at: Add trailing newline.

	* tests/t_dump_load.at: New bug report.
	* tests/t_migrate_schema.at: Likewise.
	* testsuite.at: Call them.

2004-12-18  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.hh: Remove obsolete comment.

2004-12-18  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_delete_dir.at: New bug report.
	* testsuite.at: Call it.

2004-12-18  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: Homogenize help message for 'ls' with the one shown
	by 'list'.

2004-12-18  Julio M. Merino Vidal  <jmmv@menta.net>

	* ChangeLog: Add missing entries for several modifications I did
	in December 6th and 3rd.

2004-12-18  Julio M. Merino Vidal  <jmmv@menta.net>

	* tests/t_checkout_dir.at: New test triggering the bug I fixed
	  previously in the checkout command, verifying that directory
	  creation and chdir succeed.
	* testsuite.at: Add new test.

2004-12-18  Nathaniel Smith  <njs@codesourcery.com>

	* ChangeLog: Add log entry for <jmmv@menta.net>'s last change.
	* std_hooks.lua: Check exit status of external merge commands.

2004-12-18  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: Include cerrno, cstring,
	boost/filesystem/exception.hpp.
	(checkout): Verify that directory creation and chdir succeeded.

2004-12-18  Nathaniel Smith  <njs@codesourcery.com>

	* diff_patch.cc (struct hunk_offset_calculator): Remove dead
	code.  (I believe it was used by the old, non-extent-based
	merging.)
	(calculate_hunk_offsets): Likewise.
	(struct hunk_consumer): Move next to rest of unidiff code.
	(walk_hunk_consumer): Likewise.

2004-12-18  Matt Johnston <matt@ucc.asn.au>

	* change_set.cc (concatenate_change_sets): Be more careful checking
	whether to discard deltas for deleted files (in particular take
	care when files are removed then re-added) - fixes tests
	t_patch_drop_add, t_add_drop_add.at, t_add_patch_drop_add,
	t_merge2_add_drop_add
	* change_set.cc (project_missing_deltas): don't copy deltas
	for deleted files, and handle the case where src file ids vary when
	files are added/removed. (fixes t_patch_vs_drop_add)
	* t_patch_drop_add.at, t_add_drop_add.at, t_add_patch_drop_add.at,
	  t_merge2_add_drop_add.at, t_patch_vs_drop_add.t: don't expect
	to fail any more.

2004-12-17  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_persistent_server_keys.at:
	* tests/t_attr.at:
	* tests/t_patch_vs_drop_add.at:
	* tests/t_merge2_add_drop_add.at:
	* tests/t_add_drop_add.at:
	* tests/t_add_patch_drop_add.at:
	* tests/t_patch_drop_add.at: Remove priority notes, since these
	are no longer bugs.

2004-12-17  graydon hoare  <graydon@pobox.com>

	* tests/t_merge_2.at: Works now, remove xfail.

2004-12-17  graydon hoare  <graydon@pobox.com>

	* tests/t_merge_1.at: Remove AT_CHECK(false) and xfail.
	* tests/t_fdiff_normalize.at: New test.
	* testsuite.at: Call it.
	* diff_patch.cc (normalize_extents): Fix the normalize bug.
	* revision.{cc,hh} (construct_revisions): Rename to prepare for
	next rebuild-the-graph migration.
	* commands.cc (db): Change call name.

2004-12-16  Joel Rosdahl  <joel@rosdahl.net>

	* revision.cc (is_ancestor): Use std::queue for the queue.

2004-12-14  Joel Rosdahl  <joel@rosdahl.net>

	Generalize the explicit_merge command with an optional ancestor
	argument:
	* revision.cc (is_ancestor): New method.
	* revision.hh (is_ancestor): Add prototype.
	* commands.cc (try_one_merge): Add ancestor argument. Empty
	ancestor means use ancestor from find_common_ancestor_for_merge.
	(merge): Pass empty ancestor to try_one_merge.
	(propagate): Likewise.
	(explicit_merge): Add optional ancestor argument.
	* monotone.texi: Document new explicit_merge argument.

2004-12-13  Joel Rosdahl  <joel@rosdahl.net>

	* tests/t_merge_2.at: New test triggering a bad merge.
	* testsuite.at: Add new test.

2004-12-13  Joel Rosdahl  <joel@rosdahl.net>

	* revision.cc (find_least_common_ancestor): Add a missing "return
	true;" that mysteriously was removed in
	c853237f9d8d155431f88aca12932d2cdaaa31fe.

2004-12-13  Joel Rosdahl  <joel@rosdahl.net>

	* revision.cc (find_least_common_ancestor): Remove unused variable.
	* commands.cc (lca): Correct negative status text.
	* commands.cc (update): Use GNU style braces.

2004-12-12  graydon hoare  <graydon@pobox.com>

	* commands.cc: Fix bug reported in t_attr.at
	* tests/t_attr.at: Remove xfail.
	* change_set.cc: Change unit tests syntax.
	(read_change_set): Assert complete read.
	* revision_ser.cc (read_revision_set): Likewise.
	* os_specific.hh: Drop obsolete file.

2004-12-12  Joel Rosdahl  <joel@rosdahl.net>

	* revision.cc (find_least_common_ancestor): New function for
	finding the vanilla LCA.
	* revision.hh: Added prototype for find_least_common_ancestor.
	* commands.cc (update): Use find_least_common_ancestor for finding
	a common ancestor.
	* commands.cc (diff): Likewise.
	* revision.cc (find_common_ancestor): Rename to...
	(find_common_ancestor_for_merge): ...this, for clarity.
	* revision.hh: find_common_ancestor -->
	find_common_ancestor_for_merge.
	* commands.cc (try_one_merge): Call find_common_ancestor_for_merge
	to find ancestor.
	* commands.cc (lcad): Rename lca command to lcad.
	* commands.cc (lca): New command for finding the vanilla LCA.

2004-12-12  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_persistent_server_keys.at: Actually test what it's
	supposed to.  Also, un-XFAIL it, since now it seems to pass.

2004-12-12  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_persistent_server_keys.at: New test.

	* testsuite.at: Call it.
	* tests/t_persistent_server_revision.at: Fix typo.

2004-12-12  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_persistent_server_revision.at: New test.
	* testsuite.at: Call it.  Tweak NETSYNC macros in support of it.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* lua.hh (add_rcfile): Add 'required' argument.
	* lua.cc (add_rcfile): Implement it.  Simplify error checking
	logic while I'm there...
	* monotone.cc (cpp_main): Pass new argument to add_rcfile.

	* tests/t_rcfile_required.at: New test.
	* testsuite.at: Call it.
	Revamp netsync support macros, to allow long-running servers.
	Make netsync-killer try first with -TERM, in case that plays nicer
	with gcov.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* lua.hh: Remove tabs.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi: Document explicit_merge.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* Makefile.am: Redo full-revision support again, to properly
	handle 'make dist' and caching.  Hopefully.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi (File Attributes): Rewrite for new .mt-attrs
	syntax.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_attr.at: New test.
	* testsuite.at: Call it.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (trusted): Print spaces between key ids.

	* lua.cc (add_rcfile): Errors while loading a user-provided rc
	file are naughtiness, not oopses.

2004-12-11  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (commands::explain_usage): Use split_into_lines to
	do formatting of per-command usage; allow multi-line
	descriptions.
	(trusted): New command.
	* monotone.texi (Key and Cert): Document 'trusted' command.
	* tests/t_trusted.at: New test.
	* testsuite.at: Change get_revision_cert_trust to support
	t_trusted.at.  Call t_trusted.at.

2004-12-11  Derek Scherger  <derek@echologic.com>

	* app_state.{cc,hh} (restriction_includes): renamed from
	in_restriction to be less obscure; use path_set rather than
	set<file_path>
	* commands.cc
	(restrict_path_set):
	(restrict_rename_set):
	(restrict_path_rearrangement):
	(calculate_restricted_revision): new restriction functions
	(restrict_patch_set): remove old restrictions machinery
	(status): call calculate_restricted_revision
	(ls_tags): call app.initialize
	(unknown_itemizer): restriction_includes renamed
	(ls_unknown): call calculate_restricted_revision
	(ls_missing): rework for restrictions
	(commit): switch to --message option, optional paths and preserve
	restricted work
	(diff): allow restrictions for zero and one arg variants
	(revert): note some work left to do
	* manifest.{cc,hh} (build_manifest_map): hide unused things
	(build_restricted_manifest_map): new function
	* transforms.{cc,hh} (calculate_ident): clean up merge artifacts
	* work.cc (read_options_map): merge cleanup to preserve command
	line options

2004-12-10  Nathaniel Smith  <njs@codesourcery.com>

	* Makefile.am (package_full_revision.txt): Redo Joel Rosdahl
	<joel@rosdahl.net>'s change below after it got clobbered by
	merge.

2004-12-10  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (log): Synopsize optional 'file' argument, and
	describe both arguments in help description.

2004-12-10  Matt Johnston  <matt@ucc.asn.au>

	* cert.cc: Added priv_key_exists() function
	* commands.cc, rcs_import.cc: use new privkey functions
	* netsync.cc: change some bits that were missed

2004-12-09  Derek Scherger  <derek@echologic.com>

	* .mt-nonce: delete obsolete file
	* change_set.cc (merge_deltas): add file paths in call to
	try_to_merge_files
	* commands.cc (propagate): add progress logging similar to merge
	* diff_patch.{cc,hh} (try_to_merge_files): add file paths to
	merge2 and merge3 hooks; add logging of paths before calling merge
	hooks
	* lua.{cc,hh} (hook_merge2, hook_merge3): add file paths to merge
	hooks
	* std_hooks.lua (merge2, merge3, merge2_xxdiff_cmd,
	merge3_xxdiff_cmd): pass file paths to xxdiff for use as titles
	* testsuite.at (MONOTONE_SETUP): add paths to merge2 hook

2004-12-09  Matt Johnston  <matt@ucc.asn.au>

	* cert.cc, cert.hh, lua.cc, lua.hh, netsync.cc:
	Added a new get_priv_key(keyid) lua hook to retrieve
	a private key from ~/.monotonerc

2004-12-09  Matt Johnston  <matt@ucc.asn.au>

	* change_set.cc: Don't include patch deltas on files which
	are being deleted in changesets. (partial fix for bug
	invoked by t_merge_add_del.at)

2004-12-09  Matt Johnston  <matt@ucc.asn.au>

	* configure.ac,Makefile.am: Fix iconv and intl
	handling so that the libraries are used (required for OS X).

2004-12-09  Nathaniel Smith  <njs@codesourcery.com>

	* Makefile.am (BUILT_SOURCES_NOCLEAN): add 'S'.

	* netsync.cc (session): Make ticker pointers into auto_ptr's.  Add
	cert and revision tickers.
	(session::session): Initialize new tickers.
	(session::note_item_sent): New method.  Increment tickers.
	(session::note_item_arrived): Increment tickers.
	(session::read_some): Adjust for auto_ptr.
	(session::write_some): Likewise.
	(call_server): Conditionally initialize cert and revision
	tickers.
	(queue_data_cmd): Call 'note_item_sent'.
	(queue_delta_cmd): Call 'note_item_sent'.

2004-12-09  graydon hoare  <graydon@pobox.com>

	* ROADMAP: Add file.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_patch_vs_drop_add.at:
	* tests/t_patch_drop_add.at:
	* tests/t_netsync_unrelated.at:
	* tests/t_merge_add_del.at:
	* tests/t_merge2_add_drop_add.at:
	* tests/t_merge_1.at:
	* tests/t_heads_discontinuous_branch.at:
	* tests/t_cleanup_empty_dir.at:
	* tests/t_checkout_options.at:
	* tests/t_ambig_update.at:
	* tests/t_add_patch_drop_add.at:
	* tests/t_add_drop_add.at:
	* tests/t_add_dot.at: Add (importance) markers to all bug report
	tests.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* app_state.hh (write_options): Add 'force' option.
	* app_state.cc: Remove tabs.
	(write_options): Implement.
	* commands.cc (checkout): Pass force=true to 'write_options'.

	* tests/t_checkout_options.at: New test.
	* testsuite.at: Define RAW_MONOTONE.
	(t_checkout_options.at): Call it.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* update.hh (pick_update_target): Rename to...
	(pick_update_candidates): ...this.  Return a set of candidates,
	rather than a single best.
	* update.cc (pick_update_candidates): Likewise.  Remove logic
	checking for unique candidate.
	* commands.cc (describe_revision): New function.
	(heads): Use it.
	(update): Use new 'pick_update_candidates' function.  Add logic
	checking for unique candidate.  On non-unique candidate, print all
	candidates, using 'describe_revision'.

	* tests/t_ambig_update.at: Check that failure messages describe
	the candidate set.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* update.cc: Remove tabs.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_ambig_update.at: Also check that update fails when one
	candidate edge is deeper than the other.

2004-12-08  graydon hoare  <graydon@pobox.com>

	* change_set.cc (extend_renumbering_via_added_files):
	Look up parent tid in existing renumbering.
	* commands.cc (attr): Check index for "set" subcommand.
	(lca): New diagnostic command.
	(log): Tidy up output formatting a bit.
	* po/monotone.pot: Regenerate.
	* tests/t_add_edge.at: New test to catch add failure.
	* testsuite.at: Call it.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_ambig_update.at: New test.
	* testsuite.at: Add it.

	* tests/t_explicit_merge.at: Add, having forgotten to last time.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_explicit_merge.at: New test.
	* testsuite.at: Add it.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* testsuite.at: Remove duplicate line created by merge.
	* ChangeLog: Re-sort after merges.

	* commands.cc (explicit_merge): Remove stray space.  Print id of
	merge result.
	(complete_command): Add back "}" deleted by merge.

2004-12-08  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc: Remove tabs.
	* diff_patch.cc: Likewise.

	* commands.cc (explicit_merge): New command.

2004-12-08  graydon hoare  <graydon@pobox.com>

	* change_set.cc (extend_renumbering_via_added_files):
	Look up parent tid in existing renumbering.
	* commands.cc (attr): Check index for "set" subcommand.
	(lca): New diagnostic command.
	(log): Tidy up output formatting a bit.
	* po/monotone.pot: Regenerate.
	* tests/t_add_edge.at: New test to catch add failure.
	* testsuite.at: Call it.

2004-12-07  Richard Levitte  <richard@levitte.org>

	* Makefile.am: Keep package_*revision.{txt,h}, so they are saved
	as part of a distribution, and thereby make as sure as possible
	people who download monotone get historical information on where
	their copy of monotone came from.

2004-12-06  Richard Levitte  <richard@levitte.org>

	* monotone.cc: Add a hint on how to use --ticker.

2004-12-06  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (ls_certs): Sort the certs before printing.
	* tests/t_netsync_repeated.at: Actually check that certs were
	transferred correctly.

2004-12-06  Julio M. Merino Vidal  <jmmv@menta.net>

	* figures/cert.pdf:
	* figures/cert.png:
	* figures/oo-figures.sxd:
	* monotone.texi: Use example host names under the
	example.{com,org,net} subdomains instead of invented names.
	These are defined in RFC 2606.

2004-12-06  Julio M. Merino Vidal  <jmmv@menta.net>

	* configure.ac: Now that we depend on GNU Autoconf >= 2.58, we
	can use the AS_HELP_STRING macro everywhere we need to pretty-print
	help strings.  Also convert old calls to AC_HELP_STRING (deprecated)
	to this one.

2004-12-06  Joel Rosdahl  <joel@rosdahl.net>

	* Makefile.am (package_full_revision.txt): Silence error messages
	when deducing full package revision.

2004-12-06  graydon hoare  <graydon@pobox.com>

	* unix/get_system_flavour.cc:
	* win32/get_system_flavour.cc: Add missing files.

2004-12-06  graydon hoare  <graydon@pobox.com>

	* commands.cc (merge): Add newline in output.
	* change_set.cc (project_missing_deltas): Fix very bad
	delta-renaming bug.

2004-12-06  graydon hoare  <graydon@pobox.com>

	* change_set.cc:
	* tests/t_merge_add_del.at:
	* netsync.cc:
	* commands.cc: Clean up from merge.

2004-12-06  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_add_patch_drop_add.at: New test.
	* tests/t_merge2_add_drop_add.at: New test.
	* tests/t_patch_drop_add.at: New test.
	* tests/t_patch_vs_drop_add.at: New test.
	* testsuite.at: Add them.

	* tests/t_add_drop_add.at: Fix to test what it was supposed to.

	* tests/t_merge2_data.at: Remove extraneous [stdout].

	* tests/t_merge_add_del.at: Fix description.
	XFAIL it.

2004-12-06  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_add_drop_add.at: New test.
	* testsuite.at: Add it.

2004-12-05  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_merge_add_del: Shorten name for better display.

2004-12-05  Matt Johnston <matt@ucc.asn.au>

	* tests/t_merge_add_del: added a new test for merging
	  branches where a file is added then removed.
	* testsuite.at: added the new test
	* configure.ac: bumped the prequisite version to 2.58 since
	  some tests use AT_XFAIL_IF

2004-12-05  graydon hoare  <graydon@pobox.com>

	* Makefile.am (package_full_revision.txt): Use top_builddir
	to locate monotone executable.

2004-12-05  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_merge_add_del: Shorten name for better display.

2004-12-05  Matt Johnston <matt@ucc.asn.au>

	* tests/t_merge_add_del: added a new test for merging
	  branches where a file is added then removed.
	* testsuite.at: added the new test
	* configure.ac: bumped the prequisite version to 2.58 since
	  some tests use AT_XFAIL_IF

2004-12-04  graydon hoare  <graydon@pobox.com>

	* commands.cc (fcommit): New command.
	(update): Finish off merge of update command.

2004-12-04  Derek Scherger  <derek@echologic.com>

	* commands.cc: (complete_command): New function.
	(explain_usage/process): Use it.

2004-12-04  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc (merge_deltas): Call correct variant of
	try_to_merge_files depending on whether ancestor is available.
	* diff_patch.cc (try_to_merge_files -- merge3 version): Add
	assertions about ids.
	(try_to_merge_files -- merge2 version): Likewise.

	* testsuite.at: Add a trivial working merge2 hook.
	* tests/t_related_merge2_data.at: Update to use.
	Mark as expected to PASS.
	* tests/t_merge2_data.at: Likewise.

2004-12-04  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc (merge_deltas): Call correct variant of
	try_to_merge_files depending on whether ancestor is available.
	* diff_patch.cc (try_to_merge_files -- merge3 version): Add
	assertions about ids.
	(try_to_merge_files -- merge2 version): Likewise.

	* testsuite.at: Add a trivial working merge2 hook.
	* tests/t_related_merge2_data.at: Update to use.
	Mark as expected to PASS.
	* tests/t_merge2_data.at: Likewise.

2004-12-04  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc: Remove tabs.
	* diff_patch.cc: Likewise.

2004-12-04  Nathaniel Smith  <njs@codesourcery.com>

	* change_set.cc: Remove tabs.
	* diff_patch.cc: Likewise.

2004-12-03  Julio M. Merino Vidal  <jmmv@menta.net>

	* commands.cc: Add a missing newline to a message.

2004-12-03  Julio M. Merino Vidal  <jmmv@menta.net>

	* cryptopp/config.h:
	* configure.ac: NetBSD does not define __unix__ nor __unix, so the
	build fails.  To solve, check for __NetBSD__ where appropiate to
	detect a Unix system.

2004-12-03  Julio M. Merino Vidal  <jmmv@menta.net>

	* INSTALL: Document my latest changes: --enable-ipv6 option, ability
	to specify static boost prefix through --enable-static-boost and
	BOOST_SUFFIX variable.

2004-12-03  Julio M. Merino Vidal  <jmmv@menta.net>

	* Makefile.am:
	* configure.am: Add a variable, BOOST_SUFFIX, that identifies the
	suffix string that has to be appended to Boost library names to use
	them.  This variable can be defined on configure's command line.

2004-12-03  Julio M. Merino Vidal  <jmmv@menta.net>

	* configure.ac: Let the --enable-static-boost argument take a prefix
	to where boost libraries are located.

2004-12-03  Julio M. Merino Vidal  <jmmv@menta.net>

	* configure.ac: Add a three-state --enable-ipv6 argument to the
	configure script to explicitly enable or disable IPv6 support.

2004-12-03  Julio M. Merino Vidal  <jmmv@menta.net>

	* std_hooks.lua: Add missing newlines to two error messages.

2004-12-02  Derek Scherger  <derek@echologic.com>

	* commands.cc: more tweaking to ease changeset merge

2004-12-01  Derek Scherger  <derek@echologic.com>

	* commands.cc: reordered commands to help merge with changesets
	branch

2004-12-01  graydon hoare  <graydon@pobox.com>

	* {unix,win32}/get_system_flavour.cc: New files.
	* basic_io.{cc,hh}: Give names to input sources.
	* monotone.cc: Move app_state ctor inside try.
	* platform.hh (get_system_flavour): Declare.
	* revision.cc: Name input source "revision".
	* sanity.cc: Log flavour on startup.
	* tests/t_attributes.at: Use new syntax.
	* transforms.{cc,hh} (split_into_lines): New variant, and rewrite.
	* work.{cc,hh}: Rewrite attributes to use basic_io.
	(get_attribute_from_db):
	(get_attribute_from_working_copy): New functions.

2004-11-30  Nathaniel Smith  <njs@codesourcery.com>

	* keys.cc (get_passphrase): Simplify arguments.
	(generate_key_pair): Force new passphrases to come from the user.
	Adapt to new 'get_passphrase' arguments.
	(change_key_passphrase): Likewise.
	(generate_key_pair): Add argument specifying passphrase, for
	exclusive use of the unit tests.
	(signature_round_trip_test): Use it.
	* keys.hh (generate_key_pair): Adjust prototype correspondingly.

	* tests/t_genkey.at: Test that 'genkey' requires the passphrase to
	be entered.
	* tests/t_chkeypass.at: Check that 'chkeypass' fails if no
	passphrase is given.

2004-11-30  Nathaniel Smith  <njs@codesourcery.com>

	* keys.hh: Remove tabs.
	* keys.cc: Likewise.

2004-11-30  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi (Hook Reference): Clarify description of
	'get_passphrase', following confusion on IRC.

2004-11-30  Joel Rosdahl  <joel@rosdahl.net>

	* ui.cc (fatal): Added missing newlines in fatal message.

2004-11-29  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi: Add more details to documentation of 'update
	<revision>' command.

	* ui.cc (fatal): Typo in previous commit.

2004-11-29  Nathaniel Smith  <njs@codesourcery.com>

	* ui.cc (fatal): On suggestion of Zack Weinberg, add a note to
	fatal error messages 1) telling the user that it's a bug (i.e.,
	not their fault), and 2) requesting a bug report.

2004-11-29  Nathaniel Smith  <njs@codesourcery.com>

	* ui.cc: Remove tabs.

2004-11-30  Matt Johnston  <matt@ucc.asn.au>

	* change_set.cc (merge_disjoint_analyses): Prevent duplicated
	tids being used.
	(merge_disjoint_analyses): Fix typo (s/a_tmp/b_tmp/)

2004-11-24  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_cleanup_empty_dir.at: Shorten name.

2004-11-24  Nathaniel Smith  <njs@codesourcery.com>

	* Makefile.am (BUILT_SOURCES): List package_*version.{h,txt}.
	* package_{full_,}version.txt: Work when blddir != srcdir.

2004-11-24  Nathaniel Smith  <njs@codesourcery.com>

	* mt_version.hh: New file.
	* mt_version.cc: New file.
	* monotone.cc (package_revision.h): Don't include it.
	(mt_version.hh): Include it.
	(OPT_FULL_VERSION): New option.
	(options): Add it.
	(cpp_main): Implement --version and --full-version in terms of
	mt_version.hh.

	* Makefile.am (package_full_revision.h): Build it.
	(MOST_SOURCES): Add mt_version.{cc,hh}.

2004-11-24  Nathaniel Smith  <njs@codesourcery.com>

	* txt2c.cc (main): Add "--skip-trailing" option to skip trailing
	whitespace.
	* Makefile.am (package_revision.h): Generate it.
	* monotone.cc (package_revision.h): Include it.
	(cpp_main): Print it as part of --version.

2004-11-23  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_cleanup_empty_dir.at: New test.
	* testsuite.at: Call it.

2004-11-23  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi (File Attributes): Document how restricted format
	of .mt-attrs currently is.  Also talk about 'the' .mt-attrs file
	instead of 'an', in response to confusion.

2004-11-23  Nathaniel Smith  <njs@codesourcery.com>

	* work.cc (build_deletion): Add missing newline.
	(build_rename): Likewise.
	(build_rename): Likewise.

2004-11-23  Nathaniel Smith  <njs@codesourcery.com>

	* work.cc: Remove tabs.

2004-11-23  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc: Remove tabs.

2004-11-23  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_add_dot.at: New test.
	* testsuite.at: Call it.

2004-11-22  Joel Rosdahl  <joel@rosdahl.net>

	* testsuite.at (NEED_UNB64): Check that python knows how to decode
	strings before using it.

2004-11-21  Joel Rosdahl  <joel@rosdahl.net>

	* testsuite.at (NEED_UNB64): Find more programs for decoding
	base64.

2004-11-20  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_merge_1.at: New test.
	* testsuite.at: Add it.
	(NEED_UNB64): New macro.
	(UNB64): Likewise.
	* tests/t_unidiff.at: Use them.
	* tests/t_unidiff2.at: Likewise.

2004-11-19  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_initfork.at: Remove file; redundant with
	t_merge2_add.at.
	* testsuite.at: Don't call it.

2004-11-18  Derek Scherger  <derek@echologic.com>

	* commands.cc (list tags): new command.
	* monotone.1: update.
	* monotone.texi: update.
	* std_hooks.lua: remove unused get_problem_solution hook.
	* test/t_tags.at: new test.
	* testsuite.at: call it.

2004-11-18  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi (Committing Work): Remove mistakenly added
	redundant command line argument.

2004-11-17  Joel Rosdahl  <joel@rosdahl.net>

	* commands.cc (diff): Don't print hashes around diff output if
	there is no diff to print.

	Fix bugs #8714 "monotone update working copy to previous version"
	and #9069 "update with multiple candidates":
	* commands.cc (update): Let the update command take an optional
	revision target parameter. Without an explicit revision target,
	the current branch head is used just like before. Added logic for
	updating to an older revision or another revision reachable via a
	common ancestor.
	* tests/t_update_to_revision.at: Add regression tests for new
	update logic.
	* testsuite.at: Add new test.
	* monotone.texi: Document new update argument.

2004-11-17  Nathaniel Smith  <njs@codesourcery.com>

	* netsync.cc (request_fwd_revisions): Rename 'first_attached_edge'
	to 'an_attached_edge', because it does not represent the first
	attached edge.  Likewise for 'first_attached_cset'.
	(analyze_attachment): Remove early exit from loop; we want to
	analyze the entire graph, not just some linear subgraphs.

	* revision.cc (ensure_parents_loaded): Filter out the null
	revision when calculating parents.
	* change_set.hh (null_id): Define for 'revision_id's.

	* tests/t_merge2_add.at: New test.
	* tests/t_merge2_data.at: New test.
	* tests/t_related_merge2_data.at: New test.
	* tests/t_merge_add.at: New test.
	* tests/t_netsync_pubkey.at: New test.
	* tests/t_netsync_repeated.at: New test.
	* tests/t_netsync_unrelated.at: New test.


	* testsuite.at: Add new tests.
	(NETSYNC_SETUP): New macro.
	(MONOTONE2): New macro.
	(RUN_NETSYNC): New macro.
	(ADD_FILE): New macro.
	(SET_FILE): New macro.
	(COMMIT): New macro.
	* tests/t_netsync.at: Use them.

	* tests/t_singlenetsync.at: Add 'netsync' keyword'.  Rename to...
	* tests/t_netsync_single.at: ...this.

	* tests/t_heads_discontinuous_branch.at: XFAIL it.

2004-11-17  Nathaniel Smith  <njs@codesourcery.com>

	* netsync.cc: Remove hard tabs.

2004-11-17  Nathaniel Smith  <njs@codesourcery.com>

	* revision.cc: Remove hard tabs.
	* change_set.hh: Likewise.

2004-11-16  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_heads.at: Replace last tricky case with a less tricky case.
	* tests/t_heads_discontinuous_branch.at: New test for the really
	tricky case.
	* testsuite.at: Run it.

2004-11-16  Nathaniel Smith  <njs@codesourcery.com>

	* views.sql (trusted_parents_in_branch): Remove.
	(trusted_children_in_branch): Remove.
	(trusted_branch_members): New view.
	(trusted_branch_parents): New view.
	(branch_heads): Use the new views, not the removed ones.

	* database.cc (get_heads): Column name in 'branch_heads'
	unavoidably changed from 'id' to 'parent'; adjust SELECT statement
	to use new name.

2004-11-16  Nathaniel Smith  <njs@codesourcery.com>

	* database.cc: Remove hard tabs.

2004-11-16  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (dump_diffs): Fetch delta destination, not source,
	on new files.

2004-11-15  Joel Rosdahl  <joel@rosdahl.net>

	* tests/t_diff_added_file.at: Added testcase exposing a bug in
	"monotone diff x y" where x is an ancestor of y and y adds a new
	file.
	* testsuite.at: Add new test.

2004-11-14  Joel Rosdahl  <joel@rosdahl.net>

	Fix bug #9092 "add command to change passphrase":
	* commands.cc (chkeypass): New command.
	* keys.cc (get_passphrase): Added parameters for prompt beginning and
	disabling hook lookup and passphrase caching.
	* keys.hh, keys.cc (change_key_passphrase): New function.
	* database.hh, database.cc (delete_private_key): New function.
	* monotone.texi (Key and Cert): Document command.
	* tests/t_chkeypass.at: Testcase for the command.
	* testsuite.at: Added new testcase.

2004-11-14  Matt Johnston <matt@ucc.asn.au>

	* tests/t_initfork.at: New test for merging two ancestor-less heads.

2004-11-13  Nathaniel Smith  <njs@codesourcery.com>

	* tests/t_heads.at: New test.
	* testsuite.at: Add it.

2004-11-13  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi: Fix various typos.
	(Committing Work): Add missing command line argument.
	(Branch Names): New section.
	Add me to the copyright block.

2004-11-12  Joel Rosdahl  <joel@rosdahl.net>

	* monotone.texi: Fix documentation of the approve and disapprove
	commands. Fix jp.co.juicebot.jb7 branch name in examples. Other
	minor fixes.

2004-11-11  Joel Rosdahl  <joel@rosdahl.net>

	* monotone.texi: Fix typos.

2004-11-08  graydon hoare  <graydon@pobox.com>

	* monotone.texi: Some minor cleanups.
	* netsync.cc: Fix a formatter.

2004-11-07  graydon hoare  <graydon@pobox.com>

	* figures/*.txt: Drop.
	* monotone.texi: Pull ASCII figures back in conditionally.
	* NEWS, AUTHORS, monotone.spec: Update for 0.15.
	* monotone.1: Update.

2004-11-06  graydon hoare  <graydon@pobox.com>

	* README.changesets: New file.
	* config.guess, config.sub: Remove.
	* Makefile.am: Improve document-building brains.
	* cert.cc, netsync.cc: Remove include.
	* configure.ac: Bump version number.
	* merkle_tree.{cc,hh}: Use unsigned char in dynamic_bitset.
	* po/POTFILES.in: Update to remove os_specific.hh.
	* po/monotone.pot: Regenerate.

2004-11-05  graydon hoare  <graydon@pobox.com>

	* constants.cc: Up timeout, connection limit.
	* monotone.texi: Various cleanups.

2004-11-05  Ulrich Drepper  <drepper@redhat.com>

	* configure.ac: Reduce dependencies.
	* lua/lua.h: Include config.h.
	* mkstemp.{cc,hh}: Use system variant when found.
	* netxx/resolve_getaddrinfo.cxx: Check for AI_ADDRCONFIG
	definition.
	* po/POTFILES.in: Update to mention changes.
	* Makefile.am (EXTRA_DIST): Include spec file.
	* commands.cc (diff): No output if empty diff.

2004-10-31  graydon hoare  <graydon@pobox.com>

	* commands.cc (diff): Use guess_binary.
	Fix up some messages to fit on single lines.
	* Makefile.am: Make monotone.pdf depend on figures.
	* change_set.cc: Make inversion drop "delete deltas".
	* texinfo.css: Make images align nicely.
	* netsync.cc: Fix up some messages to be clearer.

2004-10-30  graydon hoare  <graydon@pobox.com>

	* figures/*: New figures.
	* monotone.texi: Rewrite much of the tutorial.

2004-10-30  Nathaniel Smith  <njs@codesourcery.com>

	* netsync.cc (process_hello_cmd): Make clear that when the
	server's key is unknown, we abort the connection.

2004-10-29  Nathaniel Smith  <njs@codesourcery.com>

	* sanity.cc (dump_buffer): Wrap bare string in call to string(),
	to disambiguate conversions (required by Boost 1.30).

2004-10-26  graydon hoare  <graydon@pobox.com>

	* tests/t_update_missing.at: New test from Bruce Stephens
	* testsuite.at: Call it.
	* change_set.cc: Fix the error exposed by it.

2004-10-26  graydon hoare  <graydon@pobox.com>

	* work.{cc,hh}: Comply with Derek's new tests.
	* commands.cc: Likewise.

2004-10-28  Derek Scherger  <derek@echologic.com>

	* tests/t_rename.at: add test for renaming a file after it has
	been moved rather than before
	* tests/t_revert.at: add test for reverting a missing file

2004-10-28  Derek Scherger  <derek@echologic.com>

	* tests/t_drop_missing.at: New test.
	* testsuite.at: Call it.

2004-10-28  Derek Scherger  <derek@echologic.com>

	* tests/t_add.at: New test.
	* testsuite.at: Call it.

2004-10-26  graydon hoare  <graydon@pobox.com>

	* basic_io.{cc,hh}: Rework to use indented stanzas.
	* change_set.cc, revision.cc: Likewise.
	* change_set.cc: Fix formatter bug.
	* commands.cc: Sanity check file ID on delta commit.
	* work.cc: Chatter a bit more on add/drop.

2004-10-17  graydon hoare  <graydon@pobox.com>

	* merkle_tree.cc: Fix bad logging.
	* netsync.cc: Fix transmission bugs.
	* work.cc: Add some progress messages back in.
	* monotone.texi: Change contents of MT/work in example.

2004-10-17  graydon hoare  <graydon@pobox.com>

	* commands.cc (log): Keep a seen list, mask frontier by it.
	* monotone.texi: Updates to cover revision terminology.

	Also various further merges from trunk, see below.

2004-10-17  Derek Scherger  <derek@echologic.com>

	* lua.{cc,hh} (hook_ignore_branch): new hook
	* commands.cc (ls_branches): call it
	* monotone.texi (Hook Reference): describe it

2004-10-17  Richard Levitte  <richard@levitte.org>

	fix bug 8715 and more
	* diff_patch.cc (struct unidiff_hunk_writer,
	unidiff_hunk_writer::flush_hunk): the skew is not just the
	size difference between added and deleted lines in the current
	hunk, it's the size difference between /all/ added and deleted
	lines so far.  Therefore, the skew needs to be a member of the
	struct rather than being something calculated for each hunk.
	Furthermore, we need to add trailing context even if the change
	only consisted of one line.

2004-10-17  Richard Levitte  <richard@levitte.org>

	* monotone.texi (Working Copy): Change the description of
	'monotone revert' to explain what happens when there are
	arguments.

2004-10-17  Richard Levitte  <richard@levitte.org>

	* monotone.texi (OPTIONS): Add a description of --ticker.

	* ui.cc, ui.hh: Rethink the writing conditions as the ticks being
	"dirty" when they have changed since the last print.  That way,
	it's very easy to see when they need being printed.  This fixes a
	small bug where, in some cases, the exact same tick output is
	produced twice, once before a separate message, and once after,
	when a ticker is actually being removed.
	(tick_write_dot::write_ticks): Add a line that describes the
	ticks, including the amount of each tick per short name.

2004-10-17  Richard Levitte  <richard@levitte.org>

	fix bug 8733
	* ui.cc, ui.hh: Define a separate tick writer struct, and two
	subclasses, one that write counters, and one that writes progress
	characters.  As a consequence, move the count to the ticker class
	itself, and have the user interface contain a map of pointers to
	tickers instead of a map of counters, so data is easier to expand
	and access in a consistent manner.  Finally, correct a few errors
	in the checks for when ticks should be written, and make sure the
	final value gets written when the tickers are removed.

	* cert.cc (write_ancestry_paths):
	* database.cc (rehash):
	* netsync.cc (call_server, rebuild_merkle_trees):
	* rcs_import.cc (import_cvs_repo, cvs_history): Adapt to the new
	tickers.

	* monotone.cc: Add the option '--ticker' which takes the values
	"dot" or "count" to express which type of tick writer to use.  As
	a result, set the tick writer to be the progress dot kind or the
	counting type.

2004-10-15  graydon hoare  <graydon@pobox.com>

	* std_hooks.lua (get_revision_cert_trust): Add.

2004-10-14  graydon hoare  <graydon@pobox.com>

	* main.cc (UNIX_STYLE_SIGNAL_HANDLING): Enable on OSX.
	* cryptopp/*: Upgrade to 5.2.1
	* Makefile.am: Adjust for a couple new files.

2004-10-13  graydon hoare  <graydon@pobox.com>

	* change_set.cc (__STDC_CONSTANT_MACROS): Further hammering.
	* commands.cc (changesetify): New subcommand to db.
	* database.{cc,hh} (sql): Install views.
	(install_views): New function.
	(get_manifest_certs): Restore old variant.
	* numeric_vocab.hh: Use stdint.h.
	* revision.{cc,hh} (analyze_manifest_changes)
	(construct_revisions)
	(build_changesets): New functions.
	* schema.sql: Remove views stuff.
	* views.sql: Put views here.
	* schema_migration.cc: Add migration code for revisions.
	* Makefile.am: Mention views.sql.

2004-10-12  graydon hoare  <graydon@pobox.com>

	* unix/read_password.cc: Don't force echo on.

2004-10-10  graydon hoare  <graydon@pobox.com>

	merge a batch of changes from trunk, see below.
	* monotone.spec: Bump to 0.14.

2004-10-10  graydon hoare  <graydon@pobox.com>

	fix bug 9884
	* tests/t_singlenetsync.at: sleep 5
	* tests/t_netsync.at: sleep 5

2004-10-10  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Mention Richard Levitte.
	* Makefile.am: Remove nonce stuff.
	* NEWS: Describe changes from last release.
	* cert.cc (cert_manifest_testresult): Teach about other ways
	of writing a boolean value.
	* commands.cc (commit): Don't commit when no change.
	(debug): Rename to "db execute".
	(serve): Require passphrase on startup.
	(bump): Remove command.
	(ls keys): Handle no keys.
	* configure.ac: Bump version number.
	* keys.cc (get_passphrase): Reject empty passphrase nicely,
	from user and from hook.
	* lua.{cc,hh} (hook_get_sorter): Dead code, remove.
	* main.cc (main_with_many_flavours_of_exception): s/char/int/.
	* monotone.cc (OPT_DUMP): New option.
	(OPT_VERBOSE): Rename as OPT_DEBUG.
	* monotone.{texi,1}: Document changes, s/rdiff/xdelta/.
	* nonce.{cc,hh}: Drop.
	* sanity.hh (sanity::filename): New field.
	* sanity.cc (dump_buffer): Dump to file or be silent.
	* testsuite.at (persist_phrase_ok): Define as true.
	* tests/t_null.at: Adjust for new option names.
	* unit_tests.cc: Set debug, not verbose.

2004-10-10  graydon hoare  <graydon@pobox.com>

	* tests/t_remerge.at: New test.
	* testsuite.at: Call it.

2004-10-10  graydon hoare  <graydon@pobox.com>

	* cryptopp/algebra.cpp:
	* cryptopp/asn.h:
	* cryptopp/hmac.h:
	* cryptopp/iterhash.h:
	* cryptopp/mdc.h:
	* cryptopp/modes.h:
	* cryptopp/osrng.h:
	* cryptopp/pubkey.h:
	* cryptopp/seckey.h:
	* cryptopp/simple.h:
	* cryptopp/smartptr.h:
	* cryptopp/strciphr.cpp:
	* cryptopp/strciphr.h:
	* lcs.cc:
	* lua.cc: Fixes for g++ 3.4 from Michael Scherer.
	* AUTHORS: Mention Michael.

2004-10-10  graydon hoare  <graydon@pobox.com>

	* tests/t_movedel.at: New test.
	* testsuite.at: Call it.

2004-10-10  graydon hoare  <graydon@pobox.com>

	* tests/t_movepatch.at: New test.
	* testsuite.at: Call it.

2004-10-10  graydon hoare  <graydon@pobox.com>

	* change_set.cc:
	* file_io.{cc,hh}: Bug Fixes.

2004-10-10  graydon hoare  <graydon@pobox.com>

	* cert.{cc,hh} (cert_revision_manifest): Bug fixes.
	* commands.cc (approve)
	(disapprove)
	(testresult): Teach about revisions.
	* tests/t_disapprove.at:
	* tests/t_i18n_file.at:
	* tests/t_ls_missing.at:
	* tests/t_testresult.at: Bug fixes.

2004-10-09  graydon hoare  <graydon@pobox.com>

	* netsync.cc:
	* packet.cc:
	* tests/t_i18n_file.at:
	* tests/t_netsync.at:
	* tests/t_single_char_filenames.at:
	* tests/t_singlenetsync.at: Bug fixes.

2004-10-04  graydon hoare  <graydon@pobox.com>

	* Makefile.am: Re-enable rcs stuff.
	* cert.{cc,hh}: Bug fixes.
	* change_set.{cc,hh} (apply_change_set)
	(apply_change_set_inverse): New helper functions.
	* commands.cc (log)
	(rcs_import)
	(cvs_import): Teach about revisions.
	* database.cc (get_version): Block reconstruction loops.
	* diff_patch.cc:
	* lua.cc:
	* netsync.cc: Remove references to obsolete includes.
	* rcs_file.cc: Pick up bug fix from trunk.
	* rcs_import.cc: Teach about revisions.

2004-10-03  graydon hoare  <graydon@pobox.com>

	* change_set.{cc,hh}: Lots of little bug fixes.
	* commands.cc: Likewise.
	* database.cc: Comment some chatter.
	* file_io.{cc,hh}: Bug fixes, remove unlink / hardlink stuff.
	* netcmd.cc: Bug fixes.
	* netsync.cc: Likewise.
	* tests/t_*.at: Teach about revisions.
	* testsuite.at: Likewise.
	* work.cc: Bug fixes.

2004-09-30  graydon hoare  <graydon@pobox.com>

	* app_state.cc: Inform db of app.
	* change_set.cc: Bug fixes.
	* commands.cc: Use delete_file not unlink.
	* database.{cc,hh}: Bug fixes in trust function machinery.
	* revisions.cc: Skip consideration of empty parents.
	* file_io.{cc,hh}: Remove unlink function.
	* schema.sql: Pass pubkey data into trust call.

2004-09-29  graydon hoare  <graydon@pobox.com>

	* change_set.cc: Various bug fixes, merge unit tests.

2004-09-26  graydon hoare  <graydon@pobox.com>

	* predicament.{cc,hh}: Remove.
	* Makefile.am: Update.
	* change_set.{cc,hh}: Compilation fixes.
	* commands.cc: Likewise.
	* file_io.{cc,hh}: Likewise, and implement link/unlink.
	* lua.{cc,hh}: Implement conflict resolver hooks.

2004-09-25  graydon hoare  <graydon@pobox.com>

	* change_set.{cc,hh}: Rewrite entirely.
	* work.cc: Adjust to compensate.
	* commands.cc: Likewise.
	* numeric_vocab.hh: Ask for C99 constant ctor macros.

2004-09-24  Derek Scherger  <derek@echologic.com>

	* app_state.{cc,hh} (initialize,prefix,in_restriction): rename
	restriction vars; require explicit subdir restriction with ".";
	remove restriction if any path evaluates to working copy root
	* commands.cc (update): disallow restricted updates
	(diff): use --manifest options for initialization
	* tests/t_restrictions.at: remove restricted update test
	* tests/t_subdirs.at: added (missed previously)
	* vocab.cc (verify): allow "." elements in local_path
	(test_file_path_verification): test for "." in paths

2004-09-20  Derek Scherger  <derek@echologic.com>

	* app_state.{cc,hh}: add message and manifest options; add subdir
	restriction; use set instead of vector for path restrictions
	(prefix): new method
	(add_restriction): change signature for set of path restrictions
	(in_restriction): renamed from is_restricted; adjust path matching
	(set_message): new method
	(add_manifest): new method
	(initialize): remove code to adjust restrictions from old options
	* commands.cc
	(restrict_patch_set, struct unknown_itemizer): rename
	app.is_restricted to app.in_restriction
	(add,drop,rename,revert): prefix file args with current subdir
	(update,status,ls_unknown,ls_missing): build restriction from args
	(commit): build restriction from args; use --message option
	(diff): build restriction from args; use --manifest options
	* file_io.cc (find_working_copy): logging tweaks
	* monotone.cc: remove --include/--exclude options; add --manifest
	and --message options
	* tests/t_attributes.at: add commit --message option
	* tests/t_cross.at: commit --message
	* tests/t_cwork.at: commit --message
	* tests/t_disapprove.at: commit --message
	* tests/t_drop.at: commit --message
	* tests/t_erename.at: commit --message; diff --manifest
	* tests/t_fork.at: commit --message
	* tests/t_genkey.at: commit --message
	* tests/t_i18n_file.at: commit --message
	* tests/t_import.at: commit --message
	* tests/t_ls_missing.at: commit --message
	* tests/t_merge.at: commit --message
	* tests/t_movedel.at: commit --message
	* tests/t_movepatch.at: commit --message
	* tests/t_netsync.at: commit --message
	* tests/t_persist_phrase.at: commit --message
	* tests/t_rename.at: commit --message
	* tests/t_renamed.at: commit --message
	* tests/t_restrictions.at: remove --include/--exlclude options
	* tests/t_revert.at: commit --message
	* tests/t_scan.at: commit --message
	* tests/t_single_char_filenames.at: commit --message
	* tests/t_testresult.at: commit --message
	* tests/t_unidiff.at: commit --message
	* tests/t_unidiff2.at: commit --message
	* tests/t_update.at: commit --message
	* tests/t_versions.at: commit --message

2004-09-19  graydon hoare  <graydon@pobox.com>

	* change_set.cc: More bug fixes.
	* basic_io.cc: Improve error reporting.
	* commands.cc (complete): Teach about revisions.
	* database.{cc,hh}: Add complete variant for revisions.

2004-09-19  graydon hoare  <graydon@pobox.com>

	* change_set.cc: Add a unit test, fix some bugs.

2004-09-18  graydon hoare  <graydon@pobox.com>

	* change_set.{cc,hh} (subtract_change_sets): New function.
	(build_pure_addition_change_set): New function.
	* commands.cc (try_one_merge): Teach about revisions
	(merge): Likewise.
	(propagate): Likewise.
	(update): Change from changeset inversion to negation.
	* database.{cc,hh} (get_manifest): New function.
	* cert.cc: Use it.

2004-09-13  graydon hoare  <graydon@pobox.com>

	* change_set.cc: Bug fixes.
	* commands.cc: Likewise.

2004-09-13  graydon hoare  <graydon@pobox.com>

	* change_set.{cc,hh}: Implement delta renaming and merging.
	* commands.cc
	(update): Teach about revisions.
	(agraph): Likewise.
	* diff_patch.{cc,hh}: Tidy up interface a bit.
	* database.{cc,hh} (get_revision_ancestry): New helper.
	* file_io.{cc,hh}
	(move_dir): New function.
	(delete_dir_recursive): New function.

2004-09-10  graydon hoare  <graydon@pobox.com>

	* basic_io.{cc,hh}: Move to more "normal" looking
	quoted output.
	* change_set.{cc,hh}: Extend, bugfix.
	* commands.cc (diff): Teach about revisions.
	* revision.{cc,hh}: Extend, bugfix.

2004-09-07  Derek Scherger  <derek@echologic.com>

	subdirectory restrictions

	* file_io.{hh,cc} (find_working_copy): new function
	(absolutify) use fs::current_path
	* work.cc (add_to_options_map): use options.insert to preserve
	previous settings
	* work.hh: add note about MT/options file to header comment
	* lua.{hh,cc} (load_rcfile): renamed from add_rcfile
	* app_state.{cc,hh} (constructor): remove read of MT/options
	(initialize): new methods to find/create working copy
	(set_stdhooks,set_rcfiles,add_rcfile,load_rcfiles,read_options):
	new methods
	(set_database,set_branch,set_signing_key): update for new options
	reading
	* monotone.cc: update help for --norc option
	(cpp_main): move loading of lua hooks to app_state after book
	keeping dir is found
	* commands.cc: all commands call app initialize to relocate to
	working copy directory
	(bookdir_exists,ensure_bookdir) remove
	(setup) new command to create working copy
	* tests/t_subdirs.at: new test
	* testsuite.at: call new setup command to initialize working copy;
	call new test
	(PROBE_NODE): adjust for new checkout requirement that MT dir does
	not exist
	* tests/t_attributes.at: ditto
	* tests/t_cwork.at: ditto
	* tests/t_single_char_filenames.at: ditto
	* tests/t_versions.at: ditto

2004-09-06  graydon hoare  <graydon@pobox.com>

	* Makefile.am: Revise,
	* cert.{cc,hh}: Minor bug fixes.
	* change_set.{cc,hh}
	(apply_path_rearrangement): New variant.
	(read_path_rearrangement): New function.
	(write_path_rearrangement): New function.
	* commands.cc: Partially teach about revisions.
	* database.{cc,hh}: Bug fixes.
	* revision.cc: Print new manifest as hex.
	* schema.sql: Fix typos.
	* update.{cc,hh}: Teach about revisions.

2004-09-06  graydon hoare  <graydon@pobox.com>

	* Makefile.am (unit_tests): Revise.
	* change_set.{cc,hh}: Move accessors to header.
	* constants.cc (netcmd_current_protocol_version): Bump.
	(netcmd_minimum_bytes_to_bother_with_gzip): Expand to 0xfff.
	* database.{cc,hh}: Teach about reverse deltas, bug fixes.
	* diff_patch.{cc,hh}: Remove dead code.
	* merkle_tree.{cc,hh}: Teach about revisions.
	* netsync.cc: Teach about revisions, reverse deltas.
	* packet.{cc,hh}: Likewise.
	* unit_tests.{cc,hh}: Reactivate tests.

2004-09-02  Derek Scherger  <derek@echologic.com>

	* tests/t_restrictions.at: rework and attempt to clean things up a
	bit; add test for bug in restrict_patch_set
	* commands.cc (restrict_patch_set): fix bug in removal of
	restricted adds/dels/moves/deltas

2004-08-28  graydon hoare  <graydon@pobox.com>

	* Makefile.am (unit_tests): Split out working parts.
	* basic_io.{cc,hh}: Minor fixes.
	* cert.{cc,hh}: Fixes, remove major algorithms.
	* revision.{cc,hh}: Rewrite algorithms from cert.cc.
	* change_set.{cc,hh}: Extensive surgery, unit tests.
	* database.{cc,hh}: Minor fixes.
	* file_io.{cc,hh}: Likewise.
	* lua.cc: Likewise.
	* packet.{cc,hh}: Teach about revisions.
	* schema.sql: Drop some optimistic tables.
	* unit_tests.{cc,hh}: Add revision, change_set tests.
	* vocab.cc: Instantiate revision<cert>.
	* work.{cc,hh}: Rewrite in terms of path_rearrangement.

2004-08-17  graydon hoare  <graydon@pobox.com>

	* database.cc: Simplified.
	* schema.sql: Simplified.
	* transforms.cc: Fixed bug.
	* revision.{hh,cc}: Stripped out tid_source.
	* change_set.{cc,hh}: Oops, never committed!

2004-08-16  graydon hoare  <graydon@pobox.com>

	* change_set.{hh,cc}: Simplified, finished i/o.
	* revision.{hh,cc}: Fix to match, redo i/o.
	* basic_io.cc (basic_io::parser::key): Print trailing colon.
	* vocab.hh: Whitespace tweak.

2004-08-09  graydon hoare  <graydon@pobox.com>

	* change_set.{hh,cc}: New files.
	* basic_io.{hh,cc}: New files.
	* predicament.{hh,cc}: New files.
	* revision.{hh,cc}: Break completely, need to fix.
	* diff_patch.{hh,cc}: Minor touchups.
	* lua.{hh,cc}, std_hooks.lua: Model predicaments.
	* Makefile.am: Update.

2004-07-10  graydon hoare  <graydon@pobox.com>

	* lcs.{hh,cc}: Move lcs.hh body into lcs.cc.
	* diff_patch.cc: Modify to compensate.
	* revision.{hh,cc}: New files.
	* Makefile.am: Update
	* patch_set.{hh,cc}: Remove.
	* {cert,database,lua,packets}.{hh,cc}, commands.cc:
	Modify partially (incomplete) to use revisions.
	* manifest.{hh,cc}: Cleanup, remove dead code.
	* schema.sql: Declare new revision tables.
	* schema_migration.cc: Incomplete migrator.
	* {transforms.{hh,cc}, vocab{,_terms}.hh:
	Infrastructure for revisions.

2004-07-20  Derek Scherger  <derek@echologic.com>

	* tests/t_restrictions.at: new test
	* testsuite.at: run it
	* app_state.{cc,hh} (add_restriction, is_restricted): new functions
	* monotone.cc (--include,--exclude): new options
	* commands.cc (restrict_patch_set): new function. called by
	commit, update, status, diff commands

2004-07-05  graydon hoare  <graydon@pobox.com>

	* cert.cc (operator<): Fix wrong ordering of
	fields.

2004-06-07  graydon hoare  <graydon@pobox.com>

	* cryptopp/algebra.cpp:
	* cryptopp/asn.h:
	* cryptopp/hmac.h:
	* cryptopp/iterhash.h:
	* cryptopp/mdc.h:
	* cryptopp/modes.h:
	* cryptopp/osrng.h:
	* cryptopp/pubkey.h:
	* cryptopp/seckey.h:
	* cryptopp/simple.h:
	* cryptopp/smartptr.h:
	* cryptopp/strciphr.cpp:
	* cryptopp/strciphr.h:
	* lcs.hh:
	* lua.cc: Fixes for g++ 3.4 from Michael Scherer.
	* AUTHORS: Mention Michael.

2004-05-28  graydon hoare  <graydon@pobox.com>

	* tests/t_movedel.at: New test.
	* testsuite.at: Call it.
	* diff_patch.cc (adjust_deletes_under_renames): New function.
	(merge3): Use it.

2004-05-27  graydon hoare  <graydon@pobox.com>

	* tests/t_movepatch.at: New test.
	* testsuite.at: Call it.
	* diff_patch.cc (adjust_deltas_under_renames): New function.
	(merge3): Use it.

2004-05-20  graydon hoare  <graydon@pobox.com>

	* NEWS: Note 0.13 release.
	* configure.ac: Bump version number.
	* monotone.spec: Likewise.

2004-05-19  graydon hoare  <graydon@pobox.com>

	* file_io.cc (tilde_expand): Fix fs::path use.

2004-05-18  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc (apply_directory_moves): Fix fs::path use.
	* file_io.cc (write_data_impl): Likewise.
	* packet.cc: Use explicit true/false maps in caches.
	* sanity.cc (dump_buffer): Write to clog (buffered).

2004-05-16  graydon hoare  <graydon@pobox.com>

	* keys.cc (get_passphrase): Reimplement.
	* unix/read_password.c: Remove.
	* {unix,win32}/read_password.cc: Add.
	* constants.{hh,cc} (maxpasswd): New constant.
	* Makefile.am: Teach about platform specific stuff.

2004-05-16  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc (merge2): Don't discard files on one side.
	* std_hooks.lua (merge2_xxdiff_cmd): Specify merge filename.

2004-05-14  Joel Rosdahl  <joel@rosdahl.net>

	* std_hooks.lua (ignore_file): Quote dots in .svn patterns.
	* monotone.texi: Updated ignore_file hook example.

2004-05-13  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc: Include boost/filesystem/path.hpp,
	boost/filesystem/convenience.hpp.
	(checkout): Make checkout directory an fs::path, not a local_path.

2004-05-13  Nathaniel Smith  <njs@codesourcery.com>

	* testsuite.at (test_hooks.lua): Add a 'test_attr' attribute
	hook.  Add tests t_attributes and t_single_char_filenames.
	* tests/t_attributes.at: New test.
	* tests/t_single_char_filenames.at: New test.
	* manifest.cc (read_manifest_map): Replace ".+" with ".*" to
	support single-character filenames.
	* work.cc (read_work_set): Likewise.
	(read_attr_map): Likewise.

2004-05-13  Nathaniel Smith  <njs@codesourcery.com>

	* monotone.texi (Hook Reference): Update documented default
	definitions of 'merge2' and 'merge3'.

2004-05-12  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Rename Netxx back to netxx. Really, look in
	the manifest; it's been renamed!
	* configure.ac: Remove prg_exec_monitor checks.

2004-05-12  Nathaniel Smith  <njs@pobox.com>

	* AUTHORS: Remove discussion of adns, since we no longer
	distribute it.  Fix capitalization of "Netxx".

2004-05-12  Nathaniel Smith  <njs@pobox.com>

	* std_hooks.lua (merge2): Support xemacs.  Add error message
	if no merge tool is found.
	(merge3): Likewise.  Also add (disabled) hook to use CVS
	'merge' command, as a demonstration of how to.

2004-05-12  graydon hoare  <graydon@pobox.com>

	* std_hooks.lua (get_author): Remove standard definition.
	* monotone.texi: Document change.

2004-05-12  graydon hoare  <graydon@pobox.com>

	* cert.cc (cert_manifest_author_default): Use default signing key
	name for default author, if lua hook fails.

2004-05-12  Joel Rosdahl  <joel@rosdahl.net>

	* file_io.cc (walk_tree): Removed extraneous newline in error
	message.

	* std_hooks.lua (edit_comment): Added missing newline in log
	message template.

	* tests/t_ls_missing.at: New test case.
	* testsuite.at: Added t_ls_missing.at.

2004-05-10  graydon hoare  <graydon@pobox.com>

	* nonce.cc, nonce.hh: New files.
	* Makefile.am: Note new files.
	* lua.cc, lua.hh (hook_get_nonce): New hook.
	* commands.cc (bump): New command.
	* commands.cc: Remove "(file|manifest)" args most places.
	* tests/t_disapprove.at
	* tests/t_genkey.at
	* tests/t_singlenetsync.at
	* tests/t_netsync.at
	* tests/t_persist_phrase.at: Adjust to compensate.
	* monotone.texi, monotone.1: Adjust to compensate.
	* work.cc, work.hh: Constify some arguments.

2004-05-09  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc: Remove recording of file merge ancestry.

2004-05-09  graydon hoare  <graydon@pobox.com>

	* commands.cc (ls_missing): Modify to account for work.

2004-05-09  graydon hoare  <graydon@pobox.com>

	* commands.cc (list missing): New command.
	* monotone.texi, monotone.1: Update to document.

2004-05-08  graydon hoare  <graydon@pobox.com>

	* main.cc: New file encompassing prg_exec_monitor.
	* mkstemp.cc, mkstemp.hh: New portable implementation.
	* lua.cc: Use mkstemp from bundled version.
	* lua/liolib.c: Remove old mkstemp definition.
	* monotone.cc (cpp_main): Remove prg_exec env setting.
	* sanity.cc (sanity::dump_buffer): Dump logbuf to stderr, not stdout.
	* std_hooks.lua (temp_file): Use mkstemp not io.mkstemp.
	* Makefile.am (MOST_SOURCES): Add new files.

2004-05-03  Joel Rosdahl  <joel@rosdahl.net>

	* monotone.texi: Removed extraneous @ftable directive.

2004-05-02  graydon hoare  <graydon@pobox.com>

	* monotone.texi: Add stuff on selectors, new hooks.
	* AUTHORS: Typo fix.
	* configure.ac: Bump version number.

	Release point (v 0.12).

2004-05-02  Joel Rosdahl  <joel@rosdahl.net>

	Made it possible to rename a rename target and to undo a rename.
	I.e.: Given a rename set A -> B, "monotone rename B C" gives the
	rename set A -> C and "monotone rename B A" gives the empty rename
	set.
	* work.cc (visit_file): Implement new behavior.
	* tests/t_rename.at: Added test cases for new behavior.
	* monotone.texi: Note that a rename can be undone.

	Fix bug #8458:
	* file_io.hh, file_io.cc (walk_tree): Added require_existing_path
	parameter.
	* work.cc (build_deletion): Pass new parameter to walk_tree.
	* work.cc (build_rename): Ditto.

	* manifest.cc (build_manifest_map): Fix missing file check for
	i18n paths.

2004-05-01  Joel Rosdahl  <joel@rosdahl.net>

	Fix bug #7220:
	* manifest.cc (build_manifest_map): Handle missing file
	gracefully.

	* file_io.cc (walk_tree): Handle nonexistent file/directory
	gracefully.

2004-04-30  Christof Petig <christof@petig-baender.de>

	* rcs_import.cc (store_trunk_manifest_edge):
		skip ancestry to empty manifest
	* rcs_import.cc (process_branch):
		also follow branches of last/first versions

2004-04-29  graydon hoare  <graydon@pobox.com>

	* configure.ac: Fix up windows probe and bundling checks.
	* netxx/resolve_getaddrinfo.cxx: Local hack for stream addresses.
	* netsync.cc: Report address before listening.

2004-04-29  graydon hoare  <graydon@pobox.com>

	* cert.cc (get_branch_heads): Calculate a "disapproved version"
	attribute which culls a version with only disapproved ancestry
	edges.
	* monotone.texi: Fix some ascii-art diagrams.

2004-04-28  Christof Petig <christof@petig-baender.de>

	* command.cc (heads):
	show date and author certificates for each head

2004-04-28  Christof Petig <christof@petig-baender.de>

	* configure.ac:
	default to using the bundled SQLite

2004-04-28  Christof Petig <christof@petig-baender.de>

	* commands.cc (log):
	support optional file argument to show change log for
	e.g. monotone log [ID] cert.cc

2004-04-26  Christof Petig <christof@petig-baender.de>

	* rcs_import.cc (process branch):
	insert dummy cvs_edge to mark newly added file
	as previously non existant

2004-04-25  Joel Rosdahl  <joel@rosdahl.net>

	* po/stamp-po: Removed since it's generated.
	* std_hooks.lua (ignore_file): Corrected name of Subversion's
	administrative directory.
	* work.hh: Ditto.
	* monotone.texi (Hook Reference): Updated default definition of
	ignore_file.

2004-04-23  Christof Petig <christof@petig-baender.de>

	* rcs_import.cc (build_parent_state, build_child_state):
	remove dying files from manifest
	* rcs_import.cc (cvs_file_edge, note_file_edge):
	calculate state and remember it (alive or dead)

2004-04-23  Christof Petig <christof@petig-baender.de>

	* rcs_import.cc (import_rcs_file_with_cvs):
	do not include dead files in head_manifest

2004-04-22  Christof Petig <christof@petig-baender.de>

	* rcs_file.cc, rcs_file.hh: read and remember 'state' of revision
	* rcs_import.cc: remove Attic/ part from path

2004-04-21  Christof Petig <christof@petig-baender.de>

	* configure.ac: enable use of installed SQLite library

2004-04-20  graydon hoare  <graydon@pobox.com>

	* lua.hh, lua.cc (hook_note_commit): New hook.
	* commands.cc (commit): Call it.

2004-04-19  graydon hoare  <graydon@pobox.com>

	* cert.cc: Make trust messages nicer.
	* merkle_tree.cc: Clarify logging messages.
	* netsync.cc: Reorganize tickers, put client in txn.
	* packet.cc, packet.hh: Teach about constructability.

2004-04-16  graydon hoare  <graydon@pobox.com>

	* netsync.cc (session::extra_manifests): New member.
	(session::analyze_ancestry_graph): Use it.
	* tests/t_singlenetsync.at: New test for single manifest sync.
	* testsuite.at: Call it.

2004-04-14  Tom Tromey  <tromey@redhat.com>

	* rcs_import.cc (import_cvs_repo): Use require_password.
	Include keys.hh.
	* keys.hh (require_password): Declare.
	* keys.cc (require_password): New function.

2004-04-13  Tom Tromey  <tromey@redhat.com>

	* monotone.texi: Typo fixes.

2004-04-10  graydon hoare  <graydon@pobox.com>

	* netsync.cc: Minor bug fixes.

2004-04-10  graydon hoare  <graydon@pobox.com>

	* database.{cc,hh}:
	* commands.{cc,hh}:
	* lua.{cc,hh}:
	* std_hooks.lua:
	* vocab_terms.hh:
	Implement first cut at selectors.

2004-04-10  graydon hoare  <graydon@pobox.com>

	* cert.cc (operator<): Include name in compare.
	(operator==): Likewise.
	* packet.cc: Include shared_ptr.
	* rcs_file.cc: Rewrite by hand, no spirit.
	* rcs_import.cc: Change ticker names a bit.

2004-04-09  graydon hoare  <graydon@pobox.com>

	* app_state.cc: Fix a couple file path constructions.
	* file_io.cc (book_keeping_file): Make one variant static.
	* manifest.cc: Remove some dead code in walkers.
	* work.cc: Ditto.
	* rcs_file.cc: fcntl fix from Paul Snively for OSX.

2004-04-09  graydon hoare  <graydon@pobox.com>

	* file_io.cc: Fix boost filesystem "." and ".." breakage.
	* lua.cc: Fix format of log entry.
	* monotone.cc: Log locale settings on startup.
	* sanity.cc: Dump prefix on --verbose activation.
	* testsuite/t_i18n_file.at: Fix autotest LANG breakage.
	* testsuite/t_null.at: Account for chatter with --verbose.

2004-04-09  graydon hoare  <graydon@pobox.com>

	* configure.ac: Comment out check for sse2,
	set bundling to true by default.
	* INSTALL: describe changes to bundling.
	* Makefile.am: Remove vestiges of depot.

2004-04-07  graydon hoare  <graydon@pobox.com>

	* adns/*:
	* network.{cc,hh}:
	* proto_machine.{cc,hh}:
	* {http,smtp,nntp}_tasks.{cc,hh}:
	* tests/t_{http,smtp,nntp,proxy}.at:
	* url.{cc,hh}:
	* depot.cc:
	Delete files.
	* commands.cc:
	* lua.{cc,hh}:
	* database.{cc,hh}: Remove network/queue stuff.
	* configure.ac:
	* constants.{cc,hh}:
	* tests/t_{netsync,singlecvs,cvsimport}.at:
	* testsuite.at:
	* transforms.{cc,hh}:
	* unit_tests.{cc,hh}:
	* vocab_terms.hh:
	* vocab.{cc,hh}:
	* Makefile.am: Adjust for deletions.
	* app_state.hh: Cleanup.
	* monotone.texi: Fix some typos.
	* packet.{cc,hh}: Implement database ordering.
	* netsync.cc: Massage to use new packet logic.
	* commands.cc:
	* std_hooks.lua: Add initial selector stuff.

2004-03-29  graydon hoare  <graydon@pobox.com>

	* monotone.spec: Update for 0.11 release.

	Release point (v 0.11).

2004-03-29  graydon hoare  <graydon@pobox.com>

	* Makefile.am (DISTCHECK_CONFIGURE_FLAGS): Set.
	* commands.cc: Tidy up / narrow output width.
	* patch_set.cc: Likewise.
	* monotone.texi: Cleanups for PDF generation.

2004-03-28  graydon hoare  <graydon@pobox.com>

	* NEWS: Mention 0.11 release.
	* AUTHORS: Mention Robert.

2004-03-28  Robert Bihlmeyer  <robbe+mt@orcus.priv.at>

	* file_io.cc (walk_tree_recursive): Ignore broken symlinks.

2004-03-27  graydon hoare  <graydon@pobox.com>

	* monotone.texi: Flesh out netsync stuff, remove old network stuff.
	* monotone.1: Likewise.

2004-03-27  Robert Helgesson  <rycee@home.se>

	* Makefile.am:
	* configure.ac:
	* database.cc:
	* depot.cc:
	* lua.cc:
	* network.cc:
	* schema_migration.cc: Bundled library switch logic.

2004-03-27  graydon hoare  <graydon@pobox.com>

	* depot.cc (dump): Implement.
	* tests/t_http.at, test/t_proxy.at: Use "depot.cgi dump" rather than sqlite.
	* sqlite/pager.h: Change page size.
	* README: Massage slightly.
	* INSTALL: Write real installation instructions.
	* Makefile.am: Include build of "one big page" docs.
	* boost/circular_buffer_base.hpp: Another boost version insulation fix.
	* vocab.cc (verify): Normalize local_path's during verification on boost 1.31.0.
	* monotone.texi: Rip out some of the pre-netsync networking docs.

2004-03-24  graydon hoare  <graydon@pobox.com>

	* boost/circular_buffer_base.hpp: Boost version insulation.
	* cert.cc, cert.hh, commands.cc: Differentiate "unknown" keys from "bad".
	* xdelta.cc, proto_machine.cc: Fix boost version insulation.

2004-03-24  graydon hoare  <graydon@pobox.com>

	* rcs_import.cc (import_substates): Filter by branch.
	* xdelta.cc: Minor bits of insulation.

2004-03-24  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Mention Robert.
	* configure.ac: Enable sse2 stuff.
	* monotone.spec: Adjust CFLAGS and CXXFLAGS
	* monotone.texi (Network Service): Expand a bit.

2004-03-24  Robert Helgesson  <rycee@home.se>

	* commands.cc:
	* http_tasks.cc:
	* lua.cc:
	* manifest.cc:
	* netsync.cc:
	* nntp_tasks.cc:
	* proto_machine.cc:
	* work.cc:
	* xdelta.cc:
	Portability fixes for boost 1.31.0

2004-03-22  graydon hoare  <graydon@pobox.com>

	* cryptopp/integer.cpp, integer.h: Enable SSE2 multiply code.
	* database.cc, database.hh, certs.cc: Speed up 'heads'.

2004-03-21  graydon hoare  <graydon@pobox.com>

	* lcs.hh, sanity.hh: Minor performance tweaks.

2004-03-20  graydon hoare  <graydon@pobox.com>

	* rcs_import.cc: Teach how to aggregate branches.
	* monotone.texi: Start section on netsync.

2004-03-20  Olivier Andrieu  <oliv__a@users.sourceforge.net>

	* commands.cc (log): Show tags in log.
	* AUTHORS: Mention Olivier.

2004-03-17  Nathan Myers  <ncm@cantrip.org>

	* boost/circular_buffer.hpp:
	* commands.cc:
	* cryptopp/fltrimpl.h:
	* cryptopp/iterhash.cpp:
	* quick_alloc.hh:
	Fixes for gcc 3.4 compat and warnings.

2004-03-17  graydon hoare  <graydon@pobox.com>
	* cryptopp/config.h: Fix for gcc aliasing optimization error.
	* rcs_import.cc (cvs_history::note_file_edge):
	Fix for first changelog import bug (#5813).

2004-03-15  graydon hoare  <graydon@pobox.com>

	* rcs_import.cc: Import lone versions properly.
	* tests/t_singlecvs.at: New test for it.
	* testsuite.at: Call it.

2004-03-14  graydon hoare  <graydon@pobox.com>

	* commands.cc (diff): Show added files too.
	* monotone.texi: Fix typo.

2004-03-08  graydon hoare  <graydon@pobox.com>

	* netsync.cc (analyze_manifest_edge): Fix broken formatter.

2004-03-07  graydon hoare  <graydon@pobox.com>

	* Makefile.am (BOOST_SANDBOX_SOURCES): Remove boost::socket entries.
	(NETXX_SOURCES): Predicate on IP6 support in OS (from Paul Snively).
	* boost/socket/*.[hc]pp: Remove.
	* boost/io/streambuf_wrapping.hpp: Remove.
	* AUTHORS: Remove copyright notice for boost::socket.
	* acinclude.m4 (ACX_PTHREAD): Add.
	* network.cc: Replace boost::socket machinery with Netxx.
	* network.hh (open_connection): Remove prototype, static function.
	* sanity.hh, sanity.cc: Make log formatters give file:line coords,
	throw log offending coordinate if formatting fails.

2004-03-07  graydon hoare  <graydon@pobox.com>

	* sqlite/date.c, sqlite/vdbeInt.h, sqlite/vdbeaux.c: Add.
	* sqlite/*.c: Upgrade to 2.8.12.
	* Makefile.am: Update to mention new files.
	* cert.cc
	(expand_ancestors)
	(expand_dominators): Resize child bitmaps to cover parent.

2004-03-06  graydon hoare  <graydon@pobox.com>

	* netsync.cc (get_root_prefix): Fix from Paul Snively
	to fix static initialization order on mac OSX.
	* montone.texi: Typo fix from Anders Petersson.
	* *.cc: Move all function defs into column 0.

2004-03-04  graydon hoare  <graydon@pobox.com>

	* std_hooks.lua: Fix merger execution pessimism.

2004-03-04  graydon hoare  <graydon@pobox.com>

	* adler32.hh: Modify to use u8.
	* depot.cc, netcmd.cc, xdelta.cc: Modify to use u8.
	* netio.hh, numeric_vocab.hh (widen): Move between headers.
	* netsync.cc: Correct role-assumption bugs.
	* schema_migration.cc: Strip whitespace in sha1.
	(changes received from Christof Petig)

2004-03-01  graydon hoare  <graydon@pobox.com>

	* commands.cc: Handle anonymous pulling.
	* netsync.cc: Ditto.

	Release point (v 0.10).

2004-03-01  graydon hoare  <graydon@pobox.com>

	* NEWS: Mention impending 0.10 release.
	* cert.cc, cert.hh: Bug fixes, implement trust function, QA stuff.
	* commands.cc: Tweak disapprove, approve, testresult, push, pull.
	* configure.ac: Bump version number.
	* cryptopp/rng.h, cryptopp/rng.cpp
	(MaurerRandomnessTest): Fix bitrot.
	* keys.cc: Add Maurer PRNG randomness test.
	* lua.cc, lua.hh: Add trust, testresult, anonymous netsync hooks.
	* monotone.1: Update to follow changes to commands.
	* monotone.texi: Include QA section, adjust some UI drift, clarify
	reserved cert names, document new hooks and commands.
	* netcmd.hh, netcmd.cc: Add anonymous, error commands; fix bugs.
	* netsync.cc: Process new commands, factor server loop a bit.
	* std_hooks.lua: Add new hook defaults, factor mergers.
	* tests/t_netsync.at: Check SHA1 of each edge.
	* tests/t_null.at: Call with --norc to skip ~/.monotonerc
	* tests/t_update.at: Fix glaring error.
	* tests/t_disapprove.at, tests/t_testresult.at: New tests.
	* testsuite.at: Call them.
	* ui.cc (sanitize): Clean escape chars from output (optional?)
	* update.cc: Rewrite entirely in terms of new QA definitions.

2004-02-24  graydon hoare  <graydon@pobox.com>

	* commands.cc (ls_keys): Write key hash codes.
	* constands.cc (netsync_timeout_seconds): Up to 120.
	* netsync.cc: Fix a bunch of bugs.
	* patch_set.cc (manifests_to_patch_set): Fix bug in overload
	default construction.

2004-02-22  graydon hoare  <graydon@pobox.com>

	* patch_set.cc, patch_set.hh: Parameterize yet further.
	* netsync.cc: Fix a lot of bugs, add manifest and file grovelling.
	* tests/t_netsync.at: A new test (which runs!)
	* testsuite.at: Call it.

2004-02-20  graydon hoare  <graydon@pobox.com>

	* cert.cc, cert.hh, key.cc, key.hh, database.cc, database.hh:
	Add lots of little netsync support routines.
	* commands.cc (rebuild): Rehash everything too.
	* constants.cc (netcmd_minsz): Recalculate.
	* cryptopp/osrng.cpp (NonblockingRng::GenerateBlock): Handle
	/dev/urandom a bit better.
	* netcmd.cc, netcmd.hh: Remove describe cmds, add nonexistant cmd.
	* netio.hh: Add uleb128 stuff.
	* xdelta.cc: Add randomizing unit test suite.
	* diff_patch.cc: Remove commented-out dead line-merger code.
	* merkle_tree.cc: Fix various bugs.
	* netcmd.cc: Switch everything over to uleb128s.
	* netsync.cc: Implement lots of missing stuff.

2004-02-09  graydon hoare  <graydon@pobox.com>

	* netsync.cc (ROOT_PREFIX): New variable.
	* commands.cc (merkle): New command.

2004-02-09  Ben Elliston  <bje@wasabisystems.com>

	* monotone.texi: Spelling corrections.

2004-02-09  graydon hoare  <graydon@pobox.com>

	* database.cc, database.hh
	(get_version_size)
	(get_file_version_size)
	(get_manifest_version_size): New functions.
	* xdelta.cc, xdelta.hh (measure_delta_target_size): New function.
	* merkle_tree.cc, merkle_tree.hh, netcmd.cc, netcmd.hh:
	Cleanup and typesafety.
	* netsync.cc: Cleanup, typesafety, implement refine phase.

2004-02-01  graydon hoare  <graydon@pobox.com>

	* netsync.cc: Remove a lot of stuff, implement auth phase.
	* constants.cc, constants.hh: Move constants from netsync.cc.
	* netcmd.cc, netcmd.hh: Split out of netsync.cc.
	* merkle_tree.cc, merkle_tree.hh: Likewise.
	* numeric_vocab.hh: New header.
	* adler32.hh: include numeric_vocab.hh.
	* netio.hh: Likewise.
	* unit_tests.cc, unit_tests.hh: Update.
	* Makefile.am: Likewise.
	* commands.cc: Guess signing key for auth phase.
	* database.cc, database.hh (public_key_exists)
	(get_pubkey): New functions based on key hashes.

2004-01-31  graydon hoare  <graydon@pobox.com>

	* Netxx/*: New files.
	* AUTHORS: Mention Netxx.
	* Makefile.am: Mention Netxx and netsync.{cc,hh}
	* adler32.hh: Delegate typedefs to boost.
	* cert.hh, cert.cc (cert_hash_code): New function.
	* commands.cc (find_oldest_ancestors): Block cycles.
	(netsync): New command.
	* database.cc, database.hh (schema): Update.
	(put_key): Calculate key hash on the fly.
	(put_cert): Likewise.
	(merkle_node_exists)
	(get_merkle_node)
	(put_merkle_node)
	(erase_merkle_nodes): New functions.
	* keys.hh, keys.cc (key_hash_code): New function.
	* lua.cc, lua.hh
	(hook_get_netsync_read_permitted)
	(hook_get_netsync_write_permitted): New hooks.
	* monotone.spec: Update for FC1 info conventions.
	* monotone.texi (Quality Assurance): New section.
	* netsync.cc, netsync.hh: New files, preliminary
	netsync infrastructure. Command bodies still missing.
	* schema.sql: Add intrinsic key and cert hashes, merkle nodes.
	* schema_migration.cc: Add code to migrate to new schema.
	* unit_tests.cc: Handle command-line args to limit test set.
	* vocab_terms.hh: Add merkle and prefix as new terms.

2004-01-13  Nathaniel Smith  <njs@codesourcery.com>

	* idna/idn-int.h: Remove (generated by configure).

2004-01-13  Nathaniel Smith  <njs@codesourcery.com>

	* configure.ac: Switch "if" and "else" branches in pthreads
	checks.

2004-01-12  Nathaniel Smith  <njs@codesourcery.com>

	* configure.ac: Remove check for -lpthread.
	Add check for pthread_mutex_lock and ACX_PTHREAD.
	* m4/acx_pthread.m4: New file.

2004-01-07  graydon hoare  <graydon@pobox.com>

	* Makefile.am:
	* po/POTFILES.in:
	* po/monotone.pot: Minor tweaks for distclean.
	* adns/config.h:
	* boost/socket/src/interface.cpp:
	* boost/socket/src/ip4/address.cpp:
	* boost/socket/src/ip4/protocol.cpp: OSX portability.
	* AUTHORS: Mention new contributors.
	* monotone.texi (Hook Reference): Document i18n hooks.

	Release point (v 0.9).

2004-01-07  graydon hoare  <graydon@pobox.com>

	* cert.cc (ensure_parents_loaded)
	(expand_dominators)
	(expand_ancestors)
	(find_intersecting_node): New functions.
	(find_common_ancestor): Reimplement in terms of dominator
	and ancestor bitset intersection.

2004-01-05  Christof Petig <christof@petig-baender.de>

	* vocab.cc (verify<local_path>) Fix use of val() / iterator.
	* constants.cc (illegal_path_bytes): NUL-terminate.

2004-01-02  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc (normalize_extents): Improve to handle an odd case.
	* tests/t_fmerge.at: New test, to test it.
	* commands.cc (fload, fmerge): Permanently enable, for test.
	* testsuite.at: Call new test.

2004-01-01  graydon hoare  <graydon@pobox.com>

	* file_io.hh, file_io.cc (read_localized_data, write_localized_data):
	New functions
	* commands.cc, manifest.cc, transforms.cc: Use them.
	* monotone.texi: Minor update to i18n docs.
	* lua.hh, lua.cc (hook_get_linesep_conv, hook_get_charset_conv):
	New hooks.
	* acinclude.m4: Move AX_CREATE_STDINT_H in here.
	* po/monotone.pot: Regenerate.
	* NEWS, configure.ac: Prep for 0.9 release.

2003-12-30  graydon hoare  <graydon@pobox.com>

	* file_io.hh, file_io.cc (mkpath): New function.
	* commands.cc, database.cc, diff_patch.cc, file_io.cc,
	lua.cc, vocab.cc, work.cc: Use it.
	* constants.cc (illegal_path_bytes_arr): Remove leading null.
	* monotone.texi: Include i18n docs.
	* tests/t_i18n_file.at: Check colon in filename.

2003-12-29  graydon hoare  <graydon@pobox.com>

	* file_io.cc: Localize names before touching fs.
	* lua.hh, lua.cc (hook_get_system_charset): Remove useless fn.
	* test_hooks.lua: Likewise.
	* monotone.cc, transforms.cc, transforms.hh:
	Remove lua from system charset conv.
	* tests/t_i18n_file.at: New test.
	* testsuite.at: Call it.

2003-12-28  graydon hoare  <graydon@pobox.com>

	* app_state.cc, app_state.hh: Massage to use i18n vocab.
	* cert.cc, commands.cc, commands.hh, rcs_import.cc,
	update.cc, update.hh, url.cc, url.hh: Likewise.

	* work.cc, work.hh: --> Likewise, and break file format! <--

	* constants.hh, constants.cc (legal_ace_bytes): New constant.
	* vocab.cc (verify<ace>): Use it.
	(verify<urlenc>) New function.
	* vocab_terms.hh (ace, urlenc, utf8): New terms.
	* transforms.hh, transforms.cc: Use them.
	* monotone.cc (utf8_argv): Charconv argv.
	* network.hh, network.cc: Use url.{hh,cc}.

2003-12-28  graydon hoare  <graydon@pobox.com>

	* constants.hh, constants.cc (idlen): New constant.
	* commands.cc, vocab.cc: Use it.
	* manifest.cc (read_manifest_map): Tighten up regex.
	* packet.cc: Likewise.
	* transforms.cc (uppercase)
	(lowercase): Rewrite.
	(utf8_to_urlenc)
	(urlenc_to_utf8)
	(internalize_url)
	(internalize_cert_name)
	(internalize_rsa_keypair_id)
	(externalize_url)
	(externalize_cert_name)
	(externalize_rsa_keypair_id): New functions.
	* url.hh, url.cc (parse_utf8_url): New function.

2003-12-20  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc (normalize_extents): New function.
	(merge_via_edit_scripts): Use it.

2003-12-19  graydon hoare  <graydon@pobox.com>

	[net.venge.monotone.i18n branch]

	* idna/*.[ch]: New files.
	* po/*: New files.
	* url.cc, url.hh, constants.cc: New files.
	* Makefile.am, configure.ac: Various fiddling for gettext.
	* lua.hh, lua.cc (hook_get_system_charset): New hook.
	(hook_get_system_linesep): New hook.
	* transforms.hh, transforms.cc
	(charset_convert)
	(system_to_utf8)
	(utf8_to_system)
	(ace_to_utf8)
	(utf8_to_ace)
	(line_end_convert): New functions.
	* vocab.cc: Refine constraints.
	* vocab_terms.hh (external): New atomic type.
	* monotone.cc (cpp_main): Initialize gettext.
	* sanity.hh (F): Call gettext() on format strings.
	* commands.cc, depot.cc, database.cc, http_tasks.cc, keys.cc,
	network.cc, rcs_import.cc, sanity.cc, mac.hh : Update to use
	'constants::' namespace.
	* config.h.in: Remove.
	* commands.cc: Various formatting cleanups.
	* unit_tests.cc, unit_tests.hh: Connect to url tests.

2003-12-19  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc (merge3): Skip patches to deleted files.

2003-12-16  graydon hoare  <graydon@pobox.com>

	* commands.cc (ls_ignored, ignored_itemizer): Fold in as subcases of unknown.

2003-12-16  graydon hoare  <graydon@pobox.com>

	* lua.cc (working_copy_rcfilename): MT/monotonerc not MT/.monotonerc.

2003-12-16  graydon hoare  <graydon@pobox.com>

	* lua.hh, lua.cc (working_copy_rcfilename): New function.
	* monotone.cc: Add working copy rcfiles.
	* commands.cc (ls_unknown, unknown_itemizer): Skip ignored files.

2003-12-16  graydon hoare  <graydon@pobox.com>

	* file_io.cc (walk_tree_recursive): continue on book-keeping file.

2003-12-15  graydon hoare  <graydon@pobox.com>

	* tests/t_unidiff.at, t_unidiff2.at: Check for mimencode.

2003-12-15  graydon hoare  <graydon@pobox.com>

	* configure.ac: Add --enable-static-boost.
	* Makefile.am: Likewise.
	* AUTHORS: Mention new contributors.

2003-12-14  Lorenzo Campedelli <lorenzo.campedelli@libero.it>

	* work.cc (add_to_attr_map): Finish change to attr map format.

2003-12-10  Tom Tromey  <tromey@redhat.com>

	* commands.cc (checkout): Give better error message if branch is
	empty.

2003-12-07  Eric Kidd  <eric.kidd@pobox.com>

	* commands.cc (agraph): Handle repositories with a single version.
	* database.cc (get_head_candidates): Handle heads with no ancestors.
	* cert.cc (get_branch_heads): Handle heads with no ancestors.

2003-12-06  Eric Kidd  <eric.kidd@pobox.com>

	* update.hh, update.cc (pick_update_target): Return current
	version if no better update candidates available.
	* update.cc (pick_update_target): Always do branch filtering.
	* commands.cc (update): Notice when we're already up-to-date.
	* commands.cc (propagate): Assign branch name correctly when merging.

2003-12-05  graydon hoare  <graydon@pobox.com>

	* lcs.hh (edit_script): New entry point.
	* diff_patch.cc: Rewrite merge in terms of edit scripts.
	* network.cc (post_queued_blobs_to_network): Tidy up transient
	failure message.
	* randomfile.hh: Prohibit deletes on end of chunks.
	* sanity.cc: EOL-terminate truncated long lines.

2003-12-02  graydon hoare  <graydon@pobox.com>

	* database.cc, database.hh (reverse_queue): Copy constructor.
	* std_hooks.lua (merge3): Remove afile, not ancestor.
	* monotone.cc: Remove debugging message.
	* ui.cc (finish_ticking): Set last_write_was_a_tick to false.

2003-12-01  graydon hoare  <graydon@pobox.com>

	* app_state.hh, app_state.cc (set_signing_key): New fn, persist key.
	* monotone.cc (cpp_main): Permit commuting the --help argument around.

2003-11-30  graydon hoare  <graydon@pobox.com>

	* network.cc (post_queued_blobs_to_network): Fail when posted_ok is false.
	* database.cc (initialize): Fail when -journal file exists.
	* keys.cc (make_signature): Nicer message when privkey decrypt fails.

2003-11-29  Tom Tromey  <tromey@redhat.com>

	* rcs_import.cc (store_auxiliary_certs): Renamed to fix typo.
	Updated all callers.

	* http_tasks.cc (check_received_bytes): Allow "-" as well.
	* depot.cc (execute_post_query): Allow "-" as well.

2003-11-28  Tom Tromey  <tromey@redhat.com>

	* http_tasks.cc (check_received_bytes): Allow "-" as well.
	* depot.cc (execute_post_query): Allow "-" as well.

2003-11-28  graydon hoare  <graydon@pobox.com>

	* cert.cc: Various speedups.
	* cycle_detector.hh (edge_makes_cycle): Use visited set, too.
	* database.hh, database.cc (get_head_candidates): New, complex query.
	* keys.hh, keys.cc (check_signature): Cache verifiers.
	* sqlite/os.c (sqliteOsRandomSeed): Harmless valgrind purification.
	* tests/t_fork.at, tests/t_merge.at: Ignore stderr chatter on 'heads'.

2003-11-27  graydon hoare  <graydon@pobox.com>

	* Makefile.am (AM_LDFLAGS): No more -static, sigh.
	* cert.cc (find_relevant_edges): Keep dynamic-programming caches.
	(calculate_renames_recursive): Likewise.
	* cert.cc, cert.hh (rename_edge): Add constructor, copy constructor.
	* commands.cc (list certs): Note rename certs are binary.

2003-11-24  graydon hoare  <graydon@pobox.com>

	* network.cc: Continue fetch, post loops even if one target has
	an exception.

2003-11-24  graydon hoare  <graydon@pobox.com>

	* database.hh, database.cc (delete_posting): Change to take queue
	sequence numbers.
	* commands.cc (queue): Use new API.
	* network.cc (post_queued_blobs_to_network): Use new API.

2003-11-24  graydon hoare  <graydon@pobox.com>

	* std_hooks.lua (get_http_proxy): Return nil when no ENV var.
	* monotone.texi (get_http_proxY): Document change.

2003-11-24  graydon hoare  <graydon@pobox.com>

	* tests/t_proxy.at: Add a test for proxying with tinyproxy.
	* testsuite.at: Call it.
	* lua.cc: Fix dumb error breaking proxying.
	* network.cc: Be verbose about proxying.

2003-11-23  graydon hoare  <graydon@pobox.com>

	* http_tasks.cc (read_chunk): Tolerate 0x20* after chunk len.

2003-11-23  graydon hoare  <graydon@pobox.com>

	* network.cc: Make more informative error policy.
	* boost/socket/socketstream.hpp: Pass SocketType to streambuf template.
	* boost/socket/src/default_socket_impl.cpp: Translate EINTR.

2003-11-22  graydon hoare  <graydon@pobox.com>

	* lua.cc, lua.hh (hook_get_http_proxy): New hook.
	* std_hooks.lua (get_http_proxy): Default uses HTTP_PROXY.
	(get_connect_addr): Undefine, it's for tunnels alone now.
	* network.cc: Use new hook.
	* http_tasks.hh, http_tasks.cc: Teach about proxies (sigh).
	* monotone.texi: Document new hooks.

2003-11-22  graydon hoare  <graydon@pobox.com>

	* lua.cc, lua.hh (hook_get_connect_addr): New hook.
	* std_hooks.lua (get_connect_addr): Default uses HTTP_PROXY.
	* network.cc, network.hh: Use new hook.
	* http_tasks.cc: Teach about HTTP/1.1.
	* cert.cc (bogus_cert_p): Fix UI ugly.

2003-11-21  graydon hoare  <graydon@pobox.com>

	* constants.hh (postsz): New constant for suggested post size.
	* database.cc, database.hh (queue*): Change db API slightly.
	* commands.cc (queue): Adjust to changed db API.
	* network.cc (post_queued_blobs_to_network): Switch to doing
	incremental posts.
	* cert.cc (write_rename_edge, read_rename_edge): Put files on
	separate lines to accomodate future i18n work.
	* work.cc (add_to_attr_map, write_attr_map): Reorder fields to
	accomodate future i18n work.
	* monotone.texi: Document it.
	* configure.ac, NEWS: Mention 0.8 release.

	Release point (v 0.8).

2003-11-16  Tom Tromey  <tromey@redhat.com>

	* missing: Removed generated file.

2003-11-14  graydon hoare  <graydon@pobox.com>

	* commands.cc (vcheck): Add.
	* cert.cc, cert.hh (cert_manifest_vcheck): Add.
	(check_manifest_vcheck): Add.
	(calculate_vcheck_mac): Add.
	* constants.hh (vchecklen): New constant.
	* mac.hh: Re-add.
	* monotone.texi (Hash Integrity): New section.
	* monotone.1: Document vcheck.

2003-11-14  graydon hoare  <graydon@pobox.com>

	* database.cc, database.hh (reverse_queue): New class.
	(compute_older_version): New functions.
	(get_manifest_delta): Remove.
	* network.cc, network.hh (queue_blob_for_network): Remove.
	* packet.cc, packet.hh (queueing_packet_writer): Change UI,
	write to queue directly, accept optional<reverse_queue>.
	* cert.cc (write_paths_recursive): Rewrite to use constant
	memory.
	* commands.cc (queue, queue_edge_for_target_ancestor):
	Install optional<reverse_queue> in qpw.
	* tests/t_cross.at: Ignore new UI chatter.
	* monotone.texi (Transmitting Changes): Change UI output.

2003-11-13  graydon hoare  <graydon@pobox.com>

	* Makefile.am (AUTOMAKE_OPTIONS): Require 1.7.1
	* commands.cc (addtree): Wrap in transaction guard.
	* database.cc, database.hh (manifest_delta_exists): Add.
	(get_manifest_delta): Add.
	* cert.cc (write_paths_recursive): Use partial deltas.
	* manifest.cc, manifest.hh (read_manifest_map): New variant.
	* patch_set.cc, patch_set.hh (patch_set): Add map_new, map_old
	fields.
	(manifests_to_patch_set) Store new field.
	(patch_set_to_packets) Don't read manifest versions from db.
	* std_hooks.lua (ignore_file): ignore .a, .so, .lo, .la, ~ files.
	* tests/t_cvsimport.at: New test.
	* testsuite.at: Call it.

2003-11-10  graydon hoare  <graydon@pobox.com>

	* commands.cc (find_oldest_ancestors): New function.
	(queue): New "addtree" subcommand.
	* monotone.texi: Document it.
	* monotone.1: Document it.

2003-11-10  graydon hoare  <graydon@pobox.com>

	* file_io.cc (walk_tree_recursive): Ignore MT/

2003-11-09  graydon hoare  <graydon@pobox.com>

	* database.cc (dump, load): Implement.
	* commands.cc (db): Call db.dump, load.
	* cycle_detector.hh: Skip when no in-edge on src.
	* monotone.texi: Document dump and load, add some
	special sections.
	* monotone.1: Mention dump and load.

2003-11-09  graydon hoare  <graydon@pobox.com>

	* rcs_file.hh (rcs_symbol): New structure.
	* rcs_file.cc (symbol): New rule.
	* rcs_import.cc (find_branch_for_version): New function.
	(cvs_key::branch): New field.
	(store_auxilliary_certs): Cert branch tag.
	* cycle_detector.hh: Fix bugs, don't use quick_alloc.
	* commands.cc (checkout): Add --branch based version.
	* monotone.texi: Document new command variant.
	* monotone.1: Ditto.

2003-11-09  graydon hoare  <graydon@pobox.com>

	* quick_alloc.hh: New file.
	* Makefile.am: Add it.
	* cycle_detector.hh: Rewrite.
	* manifest.hh: Use quick_alloc.
	* vocab.cc: Relax path name requirements a bit.
	* sqlite/sqliteInt.h: Up size of row to 16mb.

2003-11-02  graydon hoare  <graydon@pobox.com>

	* commands.cc (post): Post everything if no URL given; don't base
	decision off branch name presence.
	* app_state.cc, monotone.cc, file_io.cc, file_io.hh: Support
	absolutifying args.
	* lua.hh, lua.cc, std_hooks.lua (hook_get_mail_hostname): New hook.
	* monotone.texi: Document it.
	* monotone.texi, monotone.1: Minor corrections, new sections.
	* monotone.cc: Don't look in $ENV at all.
	* network.cc: Correct MX logic.
	* nntp_tasks.cc, smtp_tasks.cc: Separate postlines state.
	* smtp_tasks.cc: Correct some SMTP logic.
	* configure.ac, NEWS: Mention 0.7 release.

	Release point (v 0.7).

2003-11-01  graydon hoare  <graydon@pobox.com>

	* http_tasks.cc: Drop extra leading slashes in HTTP messages.

2003-10-31  graydon hoare  <graydon@pobox.com>

	* commands.cc, database.cc, database.hh, lua.cc, lua.hh,
	network.cc, network.hh, packet.cc, packet.hh, schema.sql,
	schema_migration.cc, tests/t_http.at, tests/t_nntp.at, vocab.cc:
	Eliminate "groupname", use lone URL.
	* monotone.texi: Update to cover new URL rules.
	* network.cc, network.hh, lua.cc, lua.hh, smtp_tasks.cc:
	Implement "mailto" URLs.
	* tests/t_smtp.at: New test.
	* testsuite.at: Call it.

2003-10-31  graydon hoare  <graydon@pobox.com>

	* patch_set.cc (manifests_to_patch_set): Second form with explicit renames.
	(manifests_to_patch_set): Split edit+rename events when we see them.
	* commands.cc (status, commit): Include explicit rename set.
	* diff_patch.cc (merge3): Accept edit+rename events split by patch_set.cc.
	* smtp_tasks.hh, smtp_tasks.cc: New files.
	* nntp_machine.hh, nntp_machine.cc: Rename to proto_machine.{hh,cc} (woo!)
	* nntp_tasks.cc: Adjust to use proto_ prefix in various places.
	* proto_machine.cc (read_line): get() into streambuf.
	* Makefile.am: Cover renames and adds.

2003-10-31  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc (merge3): Extract renames.
	* commands.cc (calculate_new_manifest_map): Extract renames.
	(try_one_merge): Extract renames, propagate to merge target.
	(commit): Extract renames, propagate to commit target.
	* cert.cc (calculate_renames_recursive): Fix wrong logic.
	(find_common_ancestor_recursive): Stall advances at top of graph.
	* patch_set.cc: (manifests_to_patch_set): Teach about historical
	renames.
	* tests/t_erename.at: New test for edit+rename events.
	* testsuite.at: Call t_erename.at.

2003-10-30  graydon hoare  <graydon@pobox.com>

	* patch_set.cc (operator<): s/a/b/ in a few places, yikes!
	* cert.cc: Add machinery for rename edge certs.
	* commands.cc: Call diff(manifest,manifest) directly.
	* tests/t_nntp.at: Kill tcpserver DNS lookups on nntp test.
	* network.cc (parse_url): Character class typo fix, from
	Johannes Winkelmann.
	* app_state.hh, cert.hh, commands.hh, cycle_detector.hh,
	database.hh, diff_patch.cc, diff_patch.hh, http_tasks.hh,
	interner.hh, keys.hh, lua.hh, manifest.hh, network.hh,
	nntp_machine.hh, nntp_tasks.hh, packet.hh, patch_set.hh,
	transforms.hh, update.hh, vocab.hh, work.hh, xdelta.hh:
	fix use of std:: prefix / "using namespace" pollution.

2003-10-27  graydon hoare  <graydon@pobox.com>

	* lua/liolib.c (io_mkstemp): Portability fix
	from Ian Main.
	* xdelta.cc,hh (compute_delta): New manifest-specific variant.
	* transforms.cc,hh (diff): Same.
	* rcs_import.cc: Various speedups to cvs import.

2003-10-26  graydon hoare  <graydon@pobox.com>

	* cert.cc (get_parents): New function.
	(write_paths_recursive): New function.
	(write_ancestry_paths): New function.
	* cert.hh (write_ancestry_paths): Declare.
	* commands.cc (queue_edge_for_target_ancestor):
	Call write_ancestry_paths for "reposting" queue
	strategy.

2003-10-25  graydon hoare  <graydon@pobox.com>

	* commands.cc (log): Skip looking inside nonexistent
	manifests for file comments.

2003-10-24  graydon hoare  <graydon@pobox.com>

	* adns/*.c, adns/*.h: Import adns library.
	* Makefile.am: Update to build adns into lib3rdparty.a.
	* AUTHORS: Mention adns.
	* network.cc: Call adns functions, not gethostbyname.

2003-10-20  Nathaniel Smith  <njs@codesourcery.com>

	* patch_set.cc (patch_set_to_text_summary): Give more detailed
	output.
	* commands.cc (get_log_message, status, diff): Use
	patch_set_to_text_summary for complete description.

2003-10-22  graydon hoare  <graydon@pobox.com>

	* monotone.texi: Document 'queue' command.
	* monotone.1: Likewise.

2003-10-22  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc
	(infer_directory_moves): New function.
	(rebuild_under_directory_moves): New function.
	(apply_directory_moves): New function.
	(merge3): Handle directory moves.
	* tests/t_renamed.at: New test for dir renames.
	* testsuite.at: Call it.

2003-10-21  graydon hoare  <graydon@pobox.com>

	* commands.cc (queue): New command.
	(list): Add "queue" subcommand, too.

2003-10-21  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc (merge_deltas): New function.
	(check_map_inclusion): New function.
	(check_no_intersect): New function.
	(merge3): Rewrite completely.
	* tests/t_rename.at: New test.
	* testsuite.at: Call it.
	* file_io.cc, file_io.hh (make_dir_for): New function.
	* commands.cc (update): Call make_dir_for on update.

2003-10-20  graydon hoare  <graydon@pobox.com>

	* commands.cc: Replace [] with idx() everywhere.

2003-10-20  Tom Tromey  <tromey@redhat.com>

	* cert.hh (get_branch_heads): Updated.
	Include <set>.
	* commands.cc (head): Updated for new get_branch_heads.
	(merge): Likewise.
	(propagate): Likewise.
	* cert.cc (get_branch_heads): Use set<manifest_id>.

	* commands.cc (merge): Use all caps for metasyntactic variable.
	(heads): Likewise.

	* network.cc (post_queued_blobs_to_network): Do nothing if no
	packets to post.

2003-10-20  graydon hoare  <graydon@pobox.com>

	* cert.cc (get_branch_heads): Fix dumb bug.
	* diff_patch.cc (merge3): Fix dumb bug.
	(merge2): Fix dumb bug.
	(try_to_merge_files): Fix dumb bug.

2003-10-20  graydon hoare  <graydon@pobox.com>

	* file_io.cc (tilde_expand): New function.
	* monotone.cc (cpp_main): Expand tildes in
	db and rcfile arguments.

2003-10-20  graydon hoare  <graydon@pobox.com>

	* rcs_import.cc (import_cvs_repo): Check key existence
	at beginning of import pass, to avoid wasted work.

2003-10-19  Tom Tromey  <tromey@redhat.com>

	* commands.cc (log): Add each seen id to `cycles'.

2003-10-19  graydon hoare  <graydon@pobox.com>

	* AUTHORS: Mention Tecgraf PUC-Rio and their
	copyright.
	* Makefile.am: Mention circular buffer stuff.
	* configure.ac, NEWS: Mention 0.6 release.
	* cert.hh, cert.cc (erase_bogus_certs): file<cert> variant.
	* commands.cc (log): Erase bogus certs before writing,
	cache comment-less file IDs.
	* monotone.spec: Don't specify install-info args,
	do build with optimization on RHL.

	Release point (v 0.6).

2003-10-19  Matt Kraai  <kraai@ftbfs.org>

	* commands.cc (merge): Use app.branch_name instead of args[0] for
	the branch name.

2003-10-17  graydon hoare  <graydon@pobox.com>

	* commands.cc (log): New command.
	Various other bug fixes.
	* monotone.1, monotone.texi: Minor updates.

2003-10-17  graydon hoare  <graydon@pobox.com>

	* monotone.texi: Expand command and hook references.
	* commands.cc: Disable db dump / load commands for now.

2003-10-16  graydon hoare  <graydon@pobox.com>

	* sanity.hh: Add a const version of idx().
	* diff_patch.cc: Change to using idx() everywhere.
	* cert.cc (find_common_ancestor): Rewrite to recursive
	form, stepping over historic merges.
	* tests/t_cross.at: New test for merging merges.
	* testsuite.at: Call t_cross.at.

2003-10-10  graydon hoare  <graydon@pobox.com>

	* lua.hh, lua.cc (hook_apply_attribute): New hook.
	* work.hh, work.cc (apply_attributes): New function.
	* commands.cc (update_any_attrs): Update attrs when writing to
	working copy.
	* std_hooks.lua (temp_file): Use some env vars.
	(attr_functions): Make table of attr-setting functions.

2003-10-10  graydon hoare  <graydon@pobox.com>

	* work.cc: Fix add/drop inversion bug.
	* lua/*.{c,h}: Import lua 5.0 sources.
	* lua.cc: Rewrite lua interface completely.
	* std_hooks.lua, test_hooks.lua, testsuite,
	tests/t_persist_phrase.at, configure.ac, config.h.in, Makefile.am:
	Modify to handle presence of lua 5.0.

2003-10-08  graydon hoare  <graydon@pobox.com>

	* rcs_import.cc: Attach aux certs to child, not parent.
	* manifest.cc: Speed up some calculations.
	* keys.cc: Optionally cache decoded keys.

2003-10-07  graydon hoare  <graydon@pobox.com>

	* manifest.hh, manifest.cc, rcs_import.cc: Write manifests w/o
	compression.
	* vocab.hh, vocab.cc: Don't re-verify verified data.
	* ui.hh, ui.cc: Minor efficiency tweaks.

2003-10-07  graydon hoare  <graydon@pobox.com>

	* commands.cc, work.cc, work.hh: Add some preliminary stuff
	to support explicit renaming, .mt-attrs.
	* monotone.texi: Add skeletal sections for command reference,
	hook reference, CVS phrasebook. Fill in some parts.

2003-10-02  graydon hoare  <graydon@pobox.com>

	* boost/circular_buffer*.hpp: Add.
	* AUTHORS, cert.cc, commands.cc, database.cc,
	diff_patch.cc, http_tasks.cc, keys.cc, lua.cc, manifest.cc,
	network.cc, nntp_machine.cc, packet.cc, patch_set.cc,
	rcs_import.cc, sanity.cc, sanity.hh, ui.hh, update.cc,
	vocab_terms.hh, work.cc:
	remove existing circular buffer code, replace all
	logging and asserty stuff with boost::format objects
	rather than vsnprintf.

2003-10-01  graydon hoare  <graydon@pobox.com>

	* testsuite.at: Don't use getenv("HOSTNAME").
	* database.cc (exec, fetch): Do va_end/va_start again in between
	logging and executing query.

2003-09-28  Tom Tromey  <tromey@redhat.com>

	* monotone.texi: Added @direntry.

2003-09-27  Nathaniel Smith  <njs@pobox.com>

	* monotone.cc: Remove "monotone.db" default to --db
	option in help text.

2003-09-27  graydon hoare  <graydon@pobox.com>

	* diff_patch.cc: Rework conflict detection.
	* rcs_import.cc: Remove some pointless slowness.
	* monotone.spec: Install info files properly.

	Release point (v 0.5).

2003-09-27  graydon hoare  <graydon@pobox.com>

	* AUTHORS, NEWS, configure.ac: Update for 0.5 release.
	* monotone.texi: Various updates.
	* xdelta.cc (compute_delta): Fix handling of empty data.
	* database.cc (sql): Require --db for init.
	* work.cc (read_options_map): Fix options regex.

2003-09-27  graydon hoare  <graydon@pobox.com>

	* lcs.hh: New jaffer LCS algorithm.
	* interner.hh, rcs_import.cc: Templatize interner.
	* diff_patch.hh: Use interner, new LCS.

2003-09-27  Tom Tromey  <tromey@redhat.com>

	* commands.cc (fetch): Always try lua hook; then default to all
	known URLs.

2003-09-26  Tom Tromey  <tromey@redhat.com>

	* commands.cc (tag): Use all-caps for meta-syntactic variables.
	(comment, add, cat, complete, mdelta, fdata): Likewise.

	* monotone.1: There's no default database.
	* monotone.texi (OPTIONS): There's no default database.

	* database.cc (sql): Throw informative error if database name not
	set.
	* app_state.cc (app_state): Default to no database.

2003-09-26  graydon hoare  <graydon@pobox.com>

	* debian/*, monotone.spec: Add packaging control files.

2003-09-24  graydon hoare  <graydon@pobox.com>

	* database.cc, database.hh (debug): New function.
	* commands.cc (debug): New command.
	* cert.cc, cert.hh (guess_branch): New function.
	* commands.cc (cert): Queue certs to network servers.
	* commands.cc (cert, commit): Use guess_branch.
	* commands.cc (list): List unknown, ignored files.
	* monotone.texi, monotone.1: Document.

2003-09-24  graydon hoare  <graydon@pobox.com>

	* commands.cc (queue_edge_for_target_ancestor): Queue the
	correct ancestry cert, from child to target, as well as
	patch_set.

2003-09-22  graydon hoare  <graydon@pobox.com>

	* depot_schema.sql, schema_migration.cc,
	schema_migration.hh: Add.
	* database.cc, depot.cc: Implement schema migration.
	* database.cc, commands.cc: Change to db ... cmd.
	* monotone.texi, monotone.1: Document command change.
	* depot.cc: Fix various query bugs.

2003-09-21  Nathaniel Smith  <njs@codesourcery.com>

	* depot.cc (depot_schema): Remove unique constraint on (contents),
	replace with unique constraint on (groupname, contents).

2003-09-21  Nathaniel Smith  <njs@codesourcery.com>

	* commands.cc (diff): Take manifest ids as arguments.  Add
	explanatory text on files added, removed, modified.

2003-09-19  Tom Tromey  <tromey@redhat.com>

	* commands.cc (genkey): Use all-caps for meta-syntactic variable.
	(cert, tag, approve, disapprove, comment, add, drop, commit,
	update, revert, cat, checkout, co, propagate, complete, list, ls,
	mdelta, fdelta, mdata, fdata, mcerts, fcerts, pubkey, privkey,
	fetch, post, rcs_import, rcs): Likewise.
	(explain_usage): Indent explanatory text past the command names.

2003-09-17  Tom Tromey  <tromey@redhat.com>

	* commands.cc (list): Don't compute or use "subname".

	* commands.cc (revert): Handle case where argument is a
	directory.
	* tests/t_revert.at: Test for revert of directory.

	* testsuite.at (MONOTONE_SETUP): Use "monotone initdb".
	* monotone.1: Document "initdb".
	* monotone.texi (Commands): Document initdb.
	(Creating a Database): New node.
	(Getting Started): Refer to it.
	* commands.cc (initdb): New command.
	* database.cc (database::sql): New argument `init'.
	(database::initialize): New method.
	* database.hh (database::initalize): Declare.
	(database::sql): New argument `init'.

2003-09-17  Tom Tromey  <tromey@redhat.com>

	* tests/t_persist_phrase.at: Use "ls certs".
	* tests/t_nntp.at: Use "ls certs".
	* tests/t_genkey.at: Use "ls keys" and "ls certs".

2003-09-16  Tom Tromey  <tromey@redhat.com>

	* monotone.1: Document "list branches".
	* commands.cc (ls_certs): New function, from `lscerts' command.
	(ls_keys): New function, from `lskeys' command.
	(ls_branches): New function.
	(list): New command.
	(ls): New alias.
	(explain_usage): Split parameter info at \n.
	* monotone.texi (Adding Files): Use "list certs".
	(Committing Changes): Likewise.
	(Forking and Merging): Likewise.
	(Commands): Likewise.
	(Generating Keys): Use "list keys".
	(Commands): Likewise.
	(Commands): Mention "list branches".
	(Branches): Likewise.

2003-09-15  graydon hoare  <graydon@redhat.com>

	* http_tasks.cc: Fix networking to handle long input.

	* ui.cc, ui.hh: Only pad with blanks enough to cover old output
	when ticking.

	* update.cc, cert.cc, commands.cc: Fix cert fetching functions to
	remove bogus certs.

2003-09-15  Tom Tromey  <tromey@redhat.com>

	* monotone.1: Don't mention MT_KEY or MT_BRANCH.

	* monotone.texi (Getting Started): Don't mention MT_DB or
	MT_BRANCH.
	(Adding Files): Explicitly use --db and --branch.
	* app_state.hh (app_state): New fields options, options_changed.
	Declare new methods.  Include work.hh.
	* work.cc (work_file_name): New constant.
	(add_to_options_map): New structure.
	(get_options_path): New function.
	(read_options_map, write_options_map): Likewise.
	* work.hh (options_map): New type.
	(get_options_path, read_options_map, write_options_map): Declare.
	* commands.cc (add, drop, commit, update, revert, checkout,
	merge): Write options file.
	* app_state.cc (database_option, branch_option): New constants.
	(app_state::app_state): Read options file.
	(app_state::set_database): New method.
	(app_state::set_branch): Likewise.
	(app_state::write_options): Likewise.
	Include work.hh.
	* monotone.cc (cpp_main): Don't set initial database name on
	app.  Use new settor methods.  Don't look at MT_BRANCH or MT_DB.

2003-09-14  graydon hoare  <graydon@pobox.com>

	* vocab.cc, vocab.hh: Add streamers for vocab terms in preparation
	for switch to formatter.

	* cert.cc (check_signature): Treat missing key as failed check.
	* commands.cc (lscerts): Warn when keys are missing.

	* rcs_import.cc, nntp_tasks.cc, http_tasks.cc: Tick progress.

	* sanity.cc, monotone.cc: Tidy up output a bit.

	* xdelta.cc: Add code to handle empty files. Maybe correct?

	* ui.cc, ui.hh: Add.

2003-09-13  Tom Tromey  <tromey@redhat.com>

	* tests/t_nntp.at: If we can't find tcpserver or snntpd, skip the
	test.
	* tests/t_http.at: If we can't find boa or depot.cgi, skip the
	test.

2003-09-12  graydon hoare  <graydon@pobox.com>

	* update.cc (pick_update_target): Only insert base rev as update
	candidate if it actually exists in db.

	* commands.cc, database.cc, database.hh: Implement id completion
	command, and general id completion in all other commands.

2003-09-12  Tom Tromey  <tromey@redhat.com>

	* commands.cc (revert): A deleted file always appears in the
	manifest.
	* tests/t_revert.at: Check reverting a change plus a delete; also
	test reverting by file name.

	* work.cc (deletion_builder::visit_file): Check for file in
	working add set before looking in manifest.
	* tests/t_drop.at: Added add-then-drop test.

	* testsuite.at: Include t_drop.at.
	* tests/t_drop.at: New test.
	* work.cc (visit_file): Check for file in working delete set
	before looking in manifest.

2003-09-12  Tom Tromey  <tromey@redhat.com>

	* Makefile.am ($(srcdir)/testsuite): tests/atconfig and
	tests/atlocal are not in srcdir.

	* Makefile.am (TESTS): unit_tests is not in srcdir.

2003-09-11  graydon hoare  <graydon@pobox.com>

	* commands.cc: Check for MT directory in status.
	* commands.cc: Require directory for checkout.
	* commands.cc: Delete MT/work file after checkout.
	* commands.cc: Implement 'revert', following tromey's lead.
	* commands.cc: Print base, working manifest ids in status.

	* diff_patch.cc: Further merge corrections.
	* diff_patch.cc (unidiff): Compensate for occasional miscalculation
	of LCS.

	* tests/t_merge.at: Check that heads works after a merge.
	* tests/t_fork.at:  Check that heads works after a fork.
	* tests/t_genkey.at: Remove use of 'import'.
	* tests/t_cwork.at: Check deletion of work file on checkout.
	* tests/t_revert.at: Check that revert works.

	* commands.cc, monotone.cc: Report unknown commands nicely.

2003-09-08  graydon hoare  <graydon@pobox.com>

	* tests/merge.at: Accept tromey's non-error case for update.

	* commands.cc(try_one_merge): Write merged version to packet
	writer, not directly to db.
	(merge): Write branch, changelog cert on merged version to db.

	* std_hooks.lua(merge3): Open result in mode "r", not "w+".

2003-09-06  Tom Tromey  <tromey@redhat.com>

	* update.cc (pick_update_target): Not an error if nothing to
	update.

	* monotone.texi: Use VERSION; include version.texi.

	* monotone.1: Document "co".
	* monotone.texi (Commands): Document "co".
	* commands.cc (ALIAS): New macro.
	(co): New alias.

	* README: Updated.

	* txt2c.cc: Added missing file.

	* texinfo.tex, INSTALL, Makefile.in, aclocal.m4, compile, depcomp,
	install-sh, missing, mkinstalldirs: Removed generated files.

2003-09-04  graydon hoare  <graydon@pobox.com>

	* Makefile.am, depot.cc, http_tasks.cc, http_tasks.hh,
	lua.cc, lua.hh, monotone.texi, network.cc, tests/t_http.at,
	vocab_terms.hh:

	Use public key signatures to talk to depot, not mac keys.

	* commands.cc, file_io.cc, monotone.texi, monotone.1,
	tests/t_scan.at, tests/t_import.at, work.cc, work.hh:

	Remove the 'import' and 'scan' commands, in favour of generalized
	'add' which chases subdirectories.

	* configure.ac, NEWS:

	Release point (v 0.4).

2003-09-03  graydon hoare  <graydon@pobox.com>

	* monotone.texi: Expand notes about setting up depot.

	* update.cc: Update by ancestry. Duh.

2003-09-02  graydon hoare  <graydon@pobox.com>

	* boost/socket/streambuf.hpp: Bump ppos on overflow.

	* packet.cc, transforms.cc, transforms.hh: Add function for
	canonicalization of base64 encoded strings. Use on incoming cert
	packet values.

	* commands.cc: Change fetch and post to take URL/groupname params
	rather than branchname.

	* network.cc, network.hh, depot.cc, http_tasks.cc: Fix URL parser,
	improve logging, change signatures to match needs of commands.cc

	* Makefile.am: Don't install txt2c or unit_tests.

	* Makefile.am: Build depot.cgi not depot.

	* database.cc, database.hh: Add "all known sources" fetching support.

	* patch_set.cc: Sort in a path-lexicographic order for nicer summaries.

	* monotone.texi: Expand coverage of packets and networking.

	* tests/t_nntp.at, tests/t_http.at: Update to provide URL/groupname
	pairs.

2003-09-02  Tom Tromey  <tromey@redhat.com>

	* aclocal.m4, monotone.info: Removed generated files.

2003-08-31  Nathaniel Smith  <njs@codesourcery.com>

	* configure.ac: Check for lua40/lua.h, lua40/lualib.h and -llua40,
	-lliblua40.
	* config.h.in: Add LUA_H, LIBLUA_H templates, remove HAVE_LIBLUA,
	HAVE_LIBLUALIB templates.
	* lua.cc: Include config.h.  Use LUA_H, LIBLUA_H macros.

2003-08-29  graydon hoare  <graydon@pobox.com>

	* Makefile.am, txt2c.cc, lua.cc, database.cc:
	Use a C constant-building converter rather than objcopy.

	* cert.cc, cert.hh, packet.cc, packet.hh, diff_patch.cc,
	rcs_import.cc:
	Modify cert functions to require a packet consumer, do no implicit
	database writing.

	* commands.cc, database.cc, database.hh, schema.sql, network.cc:
	Modify packet queueing strategy to select ancestors from known
	network server content, rather than most recent edge.

2003-08-25  graydon hoare  <graydon@pobox.com>

	* AUTHORS, ChangeLog, Makefile.am, NEWS, configure.ac,
	tests/t_http.at: Release point (v 0.3)

2003-08-24  graydon hoare  <graydon@pobox.com>

	* nntp_tasks.cc: Measure success from postlines state.
	* network.cc: Print summary counts of transmissions.
	* packet.cc: Count packets into database.
	* depot.cc: Add administrative commands, fix a bunch of
	little bugs.
	* t_http.at: Testcase for depot-driven communication.
	* monotone.texi: Update to reflect depot existence.
	* http_tasks.cc: Pick bugs out.

2003-08-24  graydon hoare  <graydon@pobox.com>

	* commands.cc: Wash certs before output.
	* *.cc,*.hh: Adjust cert packet format to
	be more readable, avoid superfluous gzipping.

2003-08-24  graydon hoare  <graydon@pobox.com>

	* configure, Makefile.in: Remove generated files, oops.
	* commands.cc: Implement 'propagate'.
	* lua.cc, lua.hh, network.cc, network.hh: Remove
	'aggregate posting' stuff.
	* network.cc: Batch postings into larger articles.
	* diff_patch.hh, diff_patch.cc: Implement basic
	merge2-on-manifest.

2003-08-23  graydon hoare  <graydon@pobox.com>

	* monotone.cc: Handle user-defined lua hooks as
	overriding internal / .monotonerc hooks no matter
	where on cmd line they occur.
	* update.cc: Made failures more user-friendly.
	* lua.cc: Improve logging a bit.
	* testsuite.at, tests/*.{at,in}, testsuite/: Rewrite tests in
	autotest framework, move to tests/ directory.
	* boost/io/*, cryptopp/hmac.h: Add missing files.

2003-08-23  Tom Tromey  <tromey@redhat.com>

	* monotone.cc (OPT_VERSION): New macro.
	(cpp_main): Handle OPT_VERSION.
	(options): Added `version' entry.
	Include config.h.

2003-08-21  Tom Tromey  <tromey@redhat.com>

	* database.cc: Include "sqlite/sqlite.h", not <sqlite.h>.

2003-08-20  graydon hoare  <graydon@pobox.com>

	* boost/*:
	incorporate boost sandbox bits, for now.

	* Makefile.am, Makefile.in, configure, configure.ac, diff_patch.cc,
	http_tasks.cc, http_tasks.hh, network.cc, nntp_machine.cc,
	nntp_machine.hh, nntp_tasks.cc, nntp_tasks.hh, testsuite/t_nntp.sh:

	fix up networking layer to pass nntp tests again

2003-08-19  graydon hoare  <graydon@pobox.com>

	* Makefile.am, Makefile.in, app_state.hh, cert.cc, commands.cc,
	constants.hh, cryptopp/misc.h, database.cc, depot.cc,
	http_tasks.cc, http_tasks.hh, keys.cc, lua.cc, lua.hh, monotone.cc,
	network.cc, network.hh, nntp_machine.cc, nntp_machine.hh,
	nntp_tasks.cc, nntp_tasks.hh, packet.cc, packet.hh, rcs_import.cc,
	sanity.cc, sanity.hh, schema.sql, test_hooks.lua,
	testsuite/runtest.sh, testsuite/t_null.sh, vocab_terms.hh:

	major surgery time
	- move to multi-protocol posting and fetching.
	- implement nicer failure modes for sanity.
	- redo commands to print nicer, fail nicer.

2003-08-18  graydon hoare  <graydon@pobox.com>

	* Makefile.am, Makefile.in, adler32.hh, database.cc, depot.cc,
	mac.hh, xdelta.cc, Makefile.am, Makefile.in:

	first pass at a depot (CGI-based packet service)

2003-08-08  graydon hoare  <graydon@pobox.com>

	* Makefile.am, Makefile.in AUTHORS, ChangeLog, Makefile.am,
	Makefile.in, NEWS, monotone.1, monotone.info, monotone.texi:

	release point (v 0.2)

2003-08-08  graydon hoare  <graydon@pobox.com>

	* cert.cc, cert.hh, interner.hh, rcs_import.cc:

	auxilliary certs

	* cert.cc, cert.hh, cycle_detector.hh, interner.hh, patch_set.cc,
	rcs_import.cc:

	improvements to cycle detection stuff

2003-08-05  graydon hoare  <graydon@pobox.com>

	* rcs_import.cc:

	almost even more seemingly correct CVS graph reconstruction (still slow)

	* sqlite/* cryptopp/* Makefile.am, Makefile.in, aclocal.m4,
	config.h.in, configure, configure.ac, file_io.cc, keys.cc,
	sanity.cc, sanity.hh, transforms.cc:

	minimizing dependencies on 3rd party libs by importing the
	necessary bits and rewriting others.

	* cert.cc, cert.hh, rcs_import.cc:

	cvs import seems to be working, but several linear algorithms need
	replacement

2003-07-28  graydon hoare  <graydon@pobox.com>

	* Makefile.am, Makefile.in, cert.cc, commands.cc, database.cc,
	database.hh, manifest.cc, rcs_file.cc, rcs_import.cc,
	rcs_import.hh, vocab.cc, xdelta.cc:

	cvs graph reconstruction hobbling along.

2003-07-21  graydon hoare  <graydon@pobox.com>

	* database.cc, xdelta.cc, xdelta.hh:

	piecewise xdelta; improves speed a fair bit.

2003-07-11  graydon hoare  <graydon@pobox.com>

	* Makefile.am, Makefile.in, config.h.in, configure, configure.ac,
	transforms.cc, xdelta.cc, xdelta.hh:

	implement xdelta by hand, forget 3rd party delta libs.

2003-07-02  graydon hoare  <graydon@pobox.com>

	* database.cc, rcs_import.cc, transforms.cc, transforms.hh:

	speedups all around in the storage system

2003-07-01  graydon hoare  <graydon@pobox.com>

	* database.hh, rcs_import.cc, transforms.cc, transforms.hh: speed

	improvements to RCS import

2003-06-30  graydon hoare  <graydon@pobox.com>

	* rcs_import.cc, transforms.cc:

	some speed improvements to RCS import

2003-06-29  graydon hoare  <graydon@pobox.com>

	* commands.cc, database.hh, rcs_import.cc, transforms.cc:

	RCS file import successfully (albeit slowly) pulls in some pretty
	large (multi-hundred revision, >1MB) test cases from GCC CVS

	* Makefile.in, commands.cc, rcs_file.cc, rcs_file.hh,
	rcs_import.cc, rcs_import.hh,

	Makefile.am: preliminary support for reading and walking RCS files

2003-04-09  graydon hoare  <graydon@pobox.com>

	* autogen.sh: oops
	* */*: savannah import

2003-04-06  graydon hoare  <graydon@pobox.com>

	* initial release.

